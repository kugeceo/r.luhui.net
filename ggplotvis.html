<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>30 ggplot的各种图形 | R语言教程</title>
  <meta name="description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="30 ggplot的各种图形 | R语言教程" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="30 ggplot的各种图形 | R语言教程" />
  
  <meta name="twitter:description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  

<meta name="author" content="李东风" />


<meta name="date" content="2020-12-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ggplot2.html"/>
<link rel="next" href="stat-basics.html"/>
<script src="static/js/jquery.min.js"></script>
<link href="static/css/style.css" rel="stylesheet" />
<link href="static/css/plugin-table.css" rel="stylesheet" />
<link href="static/css/plugin-bookdown.css" rel="stylesheet" />
<link href="static/css/plugin-highlight.css" rel="stylesheet" />
<link href="static/css/plugin-search.css" rel="stylesheet" />
<link href="static/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="static/css/plugin-clipboard.css" rel="stylesheet" />






<div style="display:none">
    <script src="http://s11.cnzz.com/z_stat.php?id=610720&web_id=610720" language="JavaScript"></script>
</div>





<script src="static/js/empty-anchor.js"></script>
<script src="static/js/htmlwidgets.js"></script>
<link href="static/css/str_view.css" rel="stylesheet" />
<script src="static/js/str_view.js"></script>
<link href="static/css/wordcloud.css" rel="stylesheet" />
<script src="static/js/wordcloud2-all.js"></script>
<script src="static/js/hover.js"></script>
<script src="static/js/wordcloud2.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="static/js/mathjax.js">
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html">R语言教程</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="part"><span><b>I 介绍</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> R语言介绍</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#intro-hist-char"><i class="fa fa-check"></i><b>1.1</b> R的历史和特点</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#intro-hc-hist"><i class="fa fa-check"></i><b>1.1.1</b> R的历史</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro.html"><a href="intro.html#intro-hc-char"><i class="fa fa-check"></i><b>1.1.2</b> R的特点</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#intro-install"><i class="fa fa-check"></i><b>1.2</b> R的下载与安装</a><ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#intro-ins-down"><i class="fa fa-check"></i><b>1.2.1</b> R的下载</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#intro-ins-install"><i class="fa fa-check"></i><b>1.2.2</b> R软件安装</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#intro-ins-other-soft"><i class="fa fa-check"></i><b>1.2.3</b> 辅助软件</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#intro-ins-packages"><i class="fa fa-check"></i><b>1.3</b> R扩展软件包的安装与管理</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#intro-ins-pack-ins"><i class="fa fa-check"></i><b>1.3.1</b> 安装</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#intro-ins-pack-gitbioc"><i class="fa fa-check"></i><b>1.3.2</b> Github和BioConductor的扩展包</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#intro-ins-pack-upd"><i class="fa fa-check"></i><b>1.3.3</b> 更新扩展包</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#intro-ins-pack-verup"><i class="fa fa-check"></i><b>1.3.4</b> 迁移扩展包</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#intro-ins-pack-renv"><i class="fa fa-check"></i><b>1.3.5</b> 项目私有扩展包目录</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#intro-ruse"><i class="fa fa-check"></i><b>1.4</b> 基本R软件的用法</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#intro-ruse-run"><i class="fa fa-check"></i><b>1.4.1</b> 基本运行</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#intro-ruse-proj"><i class="fa fa-check"></i><b>1.4.2</b> 项目目录</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#intro-rstudio"><i class="fa fa-check"></i><b>1.5</b> RStudio软件</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#intro-rstudio-intro"><i class="fa fa-check"></i><b>1.5.1</b> 介绍</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#intro-rstudio-proj"><i class="fa fa-check"></i><b>1.5.2</b> 项目</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro.html"><a href="intro.html#intro-rstudio-help"><i class="fa fa-check"></i><b>1.5.3</b> 帮助</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro.html"><a href="intro.html#intro-rstudio-shortcuts"><i class="fa fa-check"></i><b>1.5.4</b> 使用技巧</a></li>
<li class="chapter" data-level="1.5.5" data-path="intro.html"><a href="intro.html#intro-rstudio-rmd"><i class="fa fa-check"></i><b>1.5.5</b> Rmd文件</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#intro-ins-ex"><i class="fa fa-check"></i><b>1.6</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-example.html"><a href="intro-example.html"><i class="fa fa-check"></i><b>2</b> R语言入门运行样例</a><ul>
<li class="chapter" data-level="2.1" data-path="intro-example.html"><a href="intro-example.html#i-e-command-line"><i class="fa fa-check"></i><b>2.1</b> 命令行界面</a></li>
<li class="chapter" data-level="2.2" data-path="intro-example.html"><a href="intro-example.html#i-e-arith-op"><i class="fa fa-check"></i><b>2.2</b> 四则运算</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro-example.html"><a href="intro-example.html#i-e-arith-op-poker"><i class="fa fa-check"></i><b>2.2.1</b> 计算例子</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro-example.html"><a href="intro-example.html#i-e-a-o-ex"><i class="fa fa-check"></i><b>2.2.2</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro-example.html"><a href="intro-example.html#i-e-math-func"><i class="fa fa-check"></i><b>2.3</b> 数学函数</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-sqrt"><i class="fa fa-check"></i><b>2.3.1</b> 数学函数——平方根、指数、对数</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-round"><i class="fa fa-check"></i><b>2.3.2</b> 数学函数——取整</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-sin"><i class="fa fa-check"></i><b>2.3.3</b> 数学函数——三角函数</a></li>
<li class="chapter" data-level="2.3.4" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-asin"><i class="fa fa-check"></i><b>2.3.4</b> 数学函数——反三角函数</a></li>
<li class="chapter" data-level="2.3.5" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-dist"><i class="fa fa-check"></i><b>2.3.5</b> 分布函数和分位数函数</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro-example.html"><a href="intro-example.html#i-e-output"><i class="fa fa-check"></i><b>2.4</b> 输出</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro-example.html"><a href="intro-example.html#i-e-o-simple"><i class="fa fa-check"></i><b>2.4.1</b> 简单输出</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro-example.html"><a href="intro-example.html#i-e-o-sink"><i class="fa fa-check"></i><b>2.4.2</b> 用<code>sink()</code>函数作运行记录</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro-example.html"><a href="intro-example.html#i-e-o-ex"><i class="fa fa-check"></i><b>2.4.3</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-example.html"><a href="intro-example.html#i-e-vector"><i class="fa fa-check"></i><b>2.5</b> 向量计算与变量赋值</a></li>
<li class="chapter" data-level="2.6" data-path="intro-example.html"><a href="intro-example.html#i-e-workspace"><i class="fa fa-check"></i><b>2.6</b> 工作空间介绍</a><ul>
<li class="chapter" data-level="2.6.1" data-path="intro-example.html"><a href="intro-example.html#i-e-w-ex"><i class="fa fa-check"></i><b>2.6.1</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="intro-example.html"><a href="intro-example.html#i-e-graph"><i class="fa fa-check"></i><b>2.7</b> 绘图示例</a><ul>
<li class="chapter" data-level="2.7.1" data-path="intro-example.html"><a href="intro-example.html#i-e-g-curve"><i class="fa fa-check"></i><b>2.7.1</b> 函数曲线示例</a></li>
<li class="chapter" data-level="2.7.2" data-path="intro-example.html"><a href="intro-example.html#i-e-g-barplot"><i class="fa fa-check"></i><b>2.7.2</b> 条形图示例</a></li>
<li class="chapter" data-level="2.7.3" data-path="intro-example.html"><a href="intro-example.html#i-e-g-scatter"><i class="fa fa-check"></i><b>2.7.3</b> 散点图示例</a></li>
<li class="chapter" data-level="2.7.4" data-path="intro-example.html"><a href="intro-example.html#i-e-g-demo"><i class="fa fa-check"></i><b>2.7.4</b> R软件自带的图形示例</a></li>
<li class="chapter" data-level="2.7.5" data-path="intro-example.html"><a href="intro-example.html#i-e-g-ex"><i class="fa fa-check"></i><b>2.7.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="intro-example.html"><a href="intro-example.html#i-e-summary"><i class="fa fa-check"></i><b>2.8</b> 汇总统计示例</a><ul>
<li class="chapter" data-level="2.8.1" data-path="intro-example.html"><a href="intro-example.html#i-e-s-table"><i class="fa fa-check"></i><b>2.8.1</b> 表格数据</a></li>
<li class="chapter" data-level="2.8.2" data-path="intro-example.html"><a href="intro-example.html#i-e-s-t-read-table"><i class="fa fa-check"></i><b>2.8.2</b> 读入表格数据</a></li>
<li class="chapter" data-level="2.8.3" data-path="intro-example.html"><a href="intro-example.html#i-e-s-ex"><i class="fa fa-check"></i><b>2.8.3</b> 练习</a></li>
<li class="chapter" data-level="2.8.4" data-path="intro-example.html"><a href="intro-example.html#i-e-s-qual-freq"><i class="fa fa-check"></i><b>2.8.4</b> 分类变量频数统计</a></li>
<li class="chapter" data-level="2.8.5" data-path="intro-example.html"><a href="intro-example.html#i-e-s-num-summ"><i class="fa fa-check"></i><b>2.8.5</b> 数值型变量的统计</a></li>
<li class="chapter" data-level="2.8.6" data-path="intro-example.html"><a href="intro-example.html#i-e-s-ex2"><i class="fa fa-check"></i><b>2.8.6</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="intro-example.html"><a href="intro-example.html#i-e-source"><i class="fa fa-check"></i><b>2.9</b> 运行源程序文件</a><ul>
<li class="chapter" data-level="2.9.1" data-path="intro-example.html"><a href="intro-example.html#i-e-source-enc"><i class="fa fa-check"></i><b>2.9.1</b> 源文件编码</a></li>
<li class="chapter" data-level="2.9.2" data-path="intro-example.html"><a href="intro-example.html#i-e-cwd"><i class="fa fa-check"></i><b>2.9.2</b> 当前工作目录</a></li>
<li class="chapter" data-level="2.9.3" data-path="intro-example.html"><a href="intro-example.html#i-e-source-ex"><i class="fa fa-check"></i><b>2.9.3</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="intro-example.html"><a href="intro-example.html#i-e-appendix-data"><i class="fa fa-check"></i><b>2.10</b> 附录：数据</a><ul>
<li class="chapter" data-level="2.10.1" data-path="intro-example.html"><a href="intro-example.html#i-e-appendix-data-tax"><i class="fa fa-check"></i><b>2.10.1</b> 公司纳税数据样例</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II 数据类型与相应的运算</b></span></li>
<li class="chapter" data-level="3" data-path="prog-type-intro.html"><a href="prog-type-intro.html"><i class="fa fa-check"></i><b>3</b> 常量与变量</a><ul>
<li class="chapter" data-level="3.1" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-const"><i class="fa fa-check"></i><b>3.1</b> 常量</a></li>
<li class="chapter" data-level="3.2" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-cv-var"><i class="fa fa-check"></i><b>3.2</b> 变量</a></li>
<li class="chapter" data-level="3.3" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-type"><i class="fa fa-check"></i><b>3.3</b> R数据类型</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prog-type-num.html"><a href="prog-type-num.html"><i class="fa fa-check"></i><b>4</b> 数值型向量及其运算</a><ul>
<li class="chapter" data-level="4.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-num"><i class="fa fa-check"></i><b>4.1</b> 数值型向量</a></li>
<li class="chapter" data-level="4.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith"><i class="fa fa-check"></i><b>4.2</b> 向量运算</a><ul>
<li class="chapter" data-level="4.2.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-scalar"><i class="fa fa-check"></i><b>4.2.1</b> 标量和标量运算</a></li>
<li class="chapter" data-level="4.2.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-with-scalar"><i class="fa fa-check"></i><b>4.2.2</b> 向量与标量运算</a></li>
<li class="chapter" data-level="4.2.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-eq-len"><i class="fa fa-check"></i><b>4.2.3</b> 等长向量运算</a></li>
<li class="chapter" data-level="4.2.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-uneq-len"><i class="fa fa-check"></i><b>4.2.4</b> 不等长向量的运算</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc"><i class="fa fa-check"></i><b>4.3</b> 向量函数</a><ul>
<li class="chapter" data-level="4.3.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-vector-func"><i class="fa fa-check"></i><b>4.3.1</b> 向量化的函数</a></li>
<li class="chapter" data-level="4.3.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-sort"><i class="fa fa-check"></i><b>4.3.2</b> 排序函数</a></li>
<li class="chapter" data-level="4.3.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-stat"><i class="fa fa-check"></i><b>4.3.3</b> 统计函数</a></li>
<li class="chapter" data-level="4.3.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-seq"><i class="fa fa-check"></i><b>4.3.4</b> 生成规则序列的函数</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-complex"><i class="fa fa-check"></i><b>4.4</b> 复数向量</a></li>
<li class="chapter" data-level="4.5" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-ex"><i class="fa fa-check"></i><b>4.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="prog-type-logi.html"><a href="prog-type-logi.html"><i class="fa fa-check"></i><b>5</b> 逻辑型向量及其运算</a><ul>
<li class="chapter" data-level="5.1" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-logical-vec"><i class="fa fa-check"></i><b>5.1</b> 逻辑型向量与比较运算</a></li>
<li class="chapter" data-level="5.2" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-lvec-logic-op"><i class="fa fa-check"></i><b>5.2</b> 逻辑运算</a></li>
<li class="chapter" data-level="5.3" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-lvec-logic-op-vec"><i class="fa fa-check"></i><b>5.3</b> 逻辑运算函数</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="prog-type-char.html"><a href="prog-type-char.html"><i class="fa fa-check"></i><b>6</b> 字符型数据及其处理</a><ul>
<li class="chapter" data-level="6.1" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char"><i class="fa fa-check"></i><b>6.1</b> 字符型向量</a></li>
<li class="chapter" data-level="6.2" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-paste"><i class="fa fa-check"></i><b>6.2</b> <code>paste()</code>函数</a></li>
<li class="chapter" data-level="6.3" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-toupper"><i class="fa fa-check"></i><b>6.3</b> 转换大小写</a></li>
<li class="chapter" data-level="6.4" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-nchar"><i class="fa fa-check"></i><b>6.4</b> 字符串长度</a></li>
<li class="chapter" data-level="6.5" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-substr"><i class="fa fa-check"></i><b>6.5</b> 取子串</a></li>
<li class="chapter" data-level="6.6" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-asnum"><i class="fa fa-check"></i><b>6.6</b> 类型转换</a></li>
<li class="chapter" data-level="6.7" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-strsplit"><i class="fa fa-check"></i><b>6.7</b> 字符串拆分</a></li>
<li class="chapter" data-level="6.8" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-gsub"><i class="fa fa-check"></i><b>6.8</b> 字符串替换功能</a></li>
<li class="chapter" data-level="6.9" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-regexp"><i class="fa fa-check"></i><b>6.9</b> 正则表达式</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="prog-type-index.html"><a href="prog-type-index.html"><i class="fa fa-check"></i><b>7</b> R向量下标和子集</a><ul>
<li class="chapter" data-level="7.1" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-int"><i class="fa fa-check"></i><b>7.1</b> 正整数下标</a></li>
<li class="chapter" data-level="7.2" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-negint"><i class="fa fa-check"></i><b>7.2</b> 负整数下标</a></li>
<li class="chapter" data-level="7.3" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-all"><i class="fa fa-check"></i><b>7.3</b> 空下标与零下标</a></li>
<li class="chapter" data-level="7.4" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-over"><i class="fa fa-check"></i><b>7.4</b> 下标超界</a></li>
<li class="chapter" data-level="7.5" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-logic"><i class="fa fa-check"></i><b>7.5</b> 逻辑下标</a></li>
<li class="chapter" data-level="7.6" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-which"><i class="fa fa-check"></i><b>7.6</b> <code>which()</code>、<code>which.min()</code>、<code>which.max()</code>函数</a></li>
<li class="chapter" data-level="7.7" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-names"><i class="fa fa-check"></i><b>7.7</b> 元素名</a></li>
<li class="chapter" data-level="7.8" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-mapping"><i class="fa fa-check"></i><b>7.8</b> 用R向量下标作映射</a></li>
<li class="chapter" data-level="7.9" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-set"><i class="fa fa-check"></i><b>7.9</b> 集合运算</a></li>
<li class="chapter" data-level="7.10" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-set-ex"><i class="fa fa-check"></i><b>7.10</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="prog-type-attr.html"><a href="prog-type-attr.html"><i class="fa fa-check"></i><b>8</b> R数据类型的性质</a><ul>
<li class="chapter" data-level="8.1" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-typeof"><i class="fa fa-check"></i><b>8.1</b> 存储模式与基本类型</a></li>
<li class="chapter" data-level="8.2" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-as"><i class="fa fa-check"></i><b>8.2</b> 类型转换与类型升档</a></li>
<li class="chapter" data-level="8.3" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr"><i class="fa fa-check"></i><b>8.3</b> 属性</a><ul>
<li class="chapter" data-level="8.3.1" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-asfun"><i class="fa fa-check"></i><b>8.3.1</b> <code>attributes</code>函数</a></li>
<li class="chapter" data-level="8.3.2" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-attrfun"><i class="fa fa-check"></i><b>8.3.2</b> <code>attr</code>函数</a></li>
<li class="chapter" data-level="8.3.3" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-names"><i class="fa fa-check"></i><b>8.3.3</b> <code>names</code>属性</a></li>
<li class="chapter" data-level="8.3.4" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-dim"><i class="fa fa-check"></i><b>8.3.4</b> <code>dim</code>属性</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-class"><i class="fa fa-check"></i><b>8.4</b> 类属</a></li>
<li class="chapter" data-level="8.5" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-str"><i class="fa fa-check"></i><b>8.5</b> <code>str()</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="prog-type-date.html"><a href="prog-type-date.html"><i class="fa fa-check"></i><b>9</b> R日期时间</a><ul>
<li class="chapter" data-level="9.1" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-intro"><i class="fa fa-check"></i><b>9.1</b> R日期和日期时间类型</a></li>
<li class="chapter" data-level="9.2" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-fromchr"><i class="fa fa-check"></i><b>9.2</b> 从字符串生成日期数据</a></li>
<li class="chapter" data-level="9.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-format"><i class="fa fa-check"></i><b>9.3</b> 日期显示格式</a></li>
<li class="chapter" data-level="9.4" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-comp"><i class="fa fa-check"></i><b>9.4</b> 访问日期时间的组成值</a></li>
<li class="chapter" data-level="9.5" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-round"><i class="fa fa-check"></i><b>9.5</b> 日期舍入计算</a></li>
<li class="chapter" data-level="9.6" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc"><i class="fa fa-check"></i><b>9.6</b> 日期计算</a><ul>
<li class="chapter" data-level="9.6.1" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-dur"><i class="fa fa-check"></i><b>9.6.1</b> 时间长度</a></li>
<li class="chapter" data-level="9.6.2" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-per"><i class="fa fa-check"></i><b>9.6.2</b> 时间周期</a></li>
<li class="chapter" data-level="9.6.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-int"><i class="fa fa-check"></i><b>9.6.3</b> 时间区间</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-baser"><i class="fa fa-check"></i><b>9.7</b> 基本R软件的日期功能</a><ul>
<li class="chapter" data-level="9.7.1" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-gen"><i class="fa fa-check"></i><b>9.7.1</b> 生成日期和日期时间型数据</a></li>
<li class="chapter" data-level="9.7.2" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-comp"><i class="fa fa-check"></i><b>9.7.2</b> 取出日期时间的组成值</a></li>
<li class="chapter" data-level="9.7.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-calc"><i class="fa fa-check"></i><b>9.7.3</b> 日期计算</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-ex"><i class="fa fa-check"></i><b>9.8</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="prog-type-fact.html"><a href="prog-type-fact.html"><i class="fa fa-check"></i><b>10</b> R因子类型</a><ul>
<li class="chapter" data-level="10.1" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-fact"><i class="fa fa-check"></i><b>10.1</b> 因子</a></li>
<li class="chapter" data-level="10.2" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-table"><i class="fa fa-check"></i><b>10.2</b> <code>table()</code>函数</a></li>
<li class="chapter" data-level="10.3" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-tapply"><i class="fa fa-check"></i><b>10.3</b> <code>tapply()</code>函数</a></li>
<li class="chapter" data-level="10.4" data-path="prog-type-fact.html"><a href="prog-type-fact.html#summ-by-forcats"><i class="fa fa-check"></i><b>10.4</b> forcats包的因子函数</a></li>
<li class="chapter" data-level="10.5" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-ex"><i class="fa fa-check"></i><b>10.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="prog-type-list.html"><a href="prog-type-list.html"><i class="fa fa-check"></i><b>11</b> 列表类型</a><ul>
<li class="chapter" data-level="11.1" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list"><i class="fa fa-check"></i><b>11.1</b> 列表</a></li>
<li class="chapter" data-level="11.2" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-access"><i class="fa fa-check"></i><b>11.2</b> 列表元素访问</a></li>
<li class="chapter" data-level="11.3" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-as"><i class="fa fa-check"></i><b>11.3</b> 列表类型转换</a></li>
<li class="chapter" data-level="11.4" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-ex-strsplit"><i class="fa fa-check"></i><b>11.4</b> 返回列表的函数示例–<code>strsplit()</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html"><i class="fa fa-check"></i><b>12</b> R矩阵和数组</a><ul>
<li class="chapter" data-level="12.1" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matrix"><i class="fa fa-check"></i><b>12.1</b> R矩阵</a></li>
<li class="chapter" data-level="12.2" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-subset"><i class="fa fa-check"></i><b>12.2</b> 矩阵子集</a></li>
<li class="chapter" data-level="12.3" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-cbind"><i class="fa fa-check"></i><b>12.3</b> <code>cbind()</code>和<code>rbind()</code>函数</a></li>
<li class="chapter" data-level="12.4" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop"><i class="fa fa-check"></i><b>12.4</b> 矩阵运算</a><ul>
<li class="chapter" data-level="12.4.1" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-arith"><i class="fa fa-check"></i><b>12.4.1</b> 四则运算</a></li>
<li class="chapter" data-level="12.4.2" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-mult"><i class="fa fa-check"></i><b>12.4.2</b> 矩阵乘法</a></li>
<li class="chapter" data-level="12.4.3" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-vecmat"><i class="fa fa-check"></i><b>12.4.3</b> 向量与矩阵相乘</a></li>
<li class="chapter" data-level="12.4.4" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-inprod"><i class="fa fa-check"></i><b>12.4.4</b> 内积</a></li>
<li class="chapter" data-level="12.4.5" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-outer"><i class="fa fa-check"></i><b>12.4.5</b> 外积</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-solve"><i class="fa fa-check"></i><b>12.5</b> 逆矩阵与线性方程组求解</a></li>
<li class="chapter" data-level="12.6" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-apply"><i class="fa fa-check"></i><b>12.6</b> <code>apply()</code>函数</a></li>
<li class="chapter" data-level="12.7" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-array"><i class="fa fa-check"></i><b>12.7</b> 多维数组</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="prog-type-df.html"><a href="prog-type-df.html"><i class="fa fa-check"></i><b>13</b> 数据框</a><ul>
<li class="chapter" data-level="13.1" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-dataframe"><i class="fa fa-check"></i><b>13.1</b> 数据框</a></li>
<li class="chapter" data-level="13.2" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-access"><i class="fa fa-check"></i><b>13.2</b> 数据框内容访问</a></li>
<li class="chapter" data-level="13.3" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-rownames"><i class="fa fa-check"></i><b>13.3</b> 数据框的行名</a></li>
<li class="chapter" data-level="13.4" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-notmatrix"><i class="fa fa-check"></i><b>13.4</b> 数据框与矩阵的区别</a></li>
<li class="chapter" data-level="13.5" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-gl-func"><i class="fa fa-check"></i><b>13.5</b> <code>tidyr::expand_grid()</code>函数</a></li>
<li class="chapter" data-level="13.6" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-tibble"><i class="fa fa-check"></i><b>13.6</b> <code>tibble</code>类型</a></li>
<li class="chapter" data-level="13.7" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-ex"><i class="fa fa-check"></i><b>13.7</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="prog-type-ws.html"><a href="prog-type-ws.html"><i class="fa fa-check"></i><b>14</b> 工作空间和变量赋值</a><ul>
<li class="chapter" data-level="14.1" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws"><i class="fa fa-check"></i><b>14.1</b> 工作空间</a></li>
<li class="chapter" data-level="14.2" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-nlvname"><i class="fa fa-check"></i><b>14.2</b> 非法变量名</a></li>
<li class="chapter" data-level="14.3" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws-asign"><i class="fa fa-check"></i><b>14.3</b> 变量赋值与绑定</a></li>
<li class="chapter" data-level="14.4" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws-env"><i class="fa fa-check"></i><b>14.4</b> 环境</a></li>
</ul></li>
<li class="part"><span><b>III 编程</b></span></li>
<li class="chapter" data-level="15" data-path="prog-io.html"><a href="prog-io.html"><i class="fa fa-check"></i><b>15</b> R输入输出</a><ul>
<li class="chapter" data-level="15.1" data-path="prog-io.html"><a href="prog-io.html#p-io-simple"><i class="fa fa-check"></i><b>15.1</b> 输入输出的简单方法</a><ul>
<li class="chapter" data-level="15.1.1" data-path="prog-io.html"><a href="prog-io.html#p-io-simple-out"><i class="fa fa-check"></i><b>15.1.1</b> 简单的输出</a></li>
<li class="chapter" data-level="15.1.2" data-path="prog-io.html"><a href="prog-io.html#p-io-simple-input"><i class="fa fa-check"></i><b>15.1.2</b> 简单的输入</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv"><i class="fa fa-check"></i><b>15.2</b> 读取CSV文件</a><ul>
<li class="chapter" data-level="15.2.1" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-format"><i class="fa fa-check"></i><b>15.2.1</b> CSV格式</a></li>
<li class="chapter" data-level="15.2.2" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-fromstr"><i class="fa fa-check"></i><b>15.2.2</b> 从字符串读入</a></li>
<li class="chapter" data-level="15.2.3" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-opt"><i class="fa fa-check"></i><b>15.2.3</b> <code>read_csv</code>选项</a></li>
<li class="chapter" data-level="15.2.4" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-enc"><i class="fa fa-check"></i><b>15.2.4</b> 编码设置</a></li>
<li class="chapter" data-level="15.2.5" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-na"><i class="fa fa-check"></i><b>15.2.5</b> 缺失值设置</a></li>
<li class="chapter" data-level="15.2.6" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-colt"><i class="fa fa-check"></i><b>15.2.6</b> 各列类型设置</a></li>
<li class="chapter" data-level="15.2.7" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-fact"><i class="fa fa-check"></i><b>15.2.7</b> 因子类型设置</a></li>
<li class="chapter" data-level="15.2.8" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-date"><i class="fa fa-check"></i><b>15.2.8</b> 读入日期</a></li>
<li class="chapter" data-level="15.2.9" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-funcs"><i class="fa fa-check"></i><b>15.2.9</b> 其它函数</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="prog-io.html"><a href="prog-io.html#p-io-excel"><i class="fa fa-check"></i><b>15.3</b> Excel表访问</a><ul>
<li class="chapter" data-level="15.3.1" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-csv"><i class="fa fa-check"></i><b>15.3.1</b> 借助于文本格式</a></li>
<li class="chapter" data-level="15.3.2" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-clip"><i class="fa fa-check"></i><b>15.3.2</b> 使用剪贴板</a></li>
<li class="chapter" data-level="15.3.3" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-readxl"><i class="fa fa-check"></i><b>15.3.3</b> 利用readxl扩展包</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="prog-io.html"><a href="prog-io.html#p-io-file"><i class="fa fa-check"></i><b>15.4</b> 文件访问</a><ul>
<li class="chapter" data-level="15.4.1" data-path="prog-io.html"><a href="prog-io.html#p-io-file-conn"><i class="fa fa-check"></i><b>15.4.1</b> 连接</a></li>
<li class="chapter" data-level="15.4.2" data-path="prog-io.html"><a href="prog-io.html#p-io-file-text"><i class="fa fa-check"></i><b>15.4.2</b> 文本文件访问</a></li>
<li class="chapter" data-level="15.4.3" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-batch"><i class="fa fa-check"></i><b>15.4.3</b> 文本文件分批读写</a></li>
<li class="chapter" data-level="15.4.4" data-path="prog-io.html"><a href="prog-io.html#p-io-file-bin"><i class="fa fa-check"></i><b>15.4.4</b> 二进制文件访问</a></li>
<li class="chapter" data-level="15.4.5" data-path="prog-io.html"><a href="prog-io.html#p-io-file-textcon"><i class="fa fa-check"></i><b>15.4.5</b> 字符型连接</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="prog-io.html"><a href="prog-io.html#p-io-enc"><i class="fa fa-check"></i><b>15.5</b> 中文编码问题</a><ul>
<li class="chapter" data-level="15.5.1" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-base"><i class="fa fa-check"></i><b>15.5.1</b> 用基本R的读取函数读取</a></li>
<li class="chapter" data-level="15.5.2" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-readr"><i class="fa fa-check"></i><b>15.5.2</b> 用readr包读取</a></li>
<li class="chapter" data-level="15.5.3" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-write"><i class="fa fa-check"></i><b>15.5.3</b> 输出文件的编码</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="prog-io.html"><a href="prog-io.html#p-io-dir"><i class="fa fa-check"></i><b>15.6</b> 目录和文件管理</a></li>
<li class="chapter" data-level="15.7" data-path="prog-io.html"><a href="prog-io.html#p-io-db"><i class="fa fa-check"></i><b>15.7</b> SQL数据库访问</a><ul>
<li class="chapter" data-level="15.7.1" data-path="prog-io.html"><a href="prog-io.html#p-io-db-intro"><i class="fa fa-check"></i><b>15.7.1</b> 介绍</a></li>
<li class="chapter" data-level="15.7.2" data-path="prog-io.html"><a href="prog-io.html#p-io-db-sqlite"><i class="fa fa-check"></i><b>15.7.2</b> SQLite数据库访问</a></li>
<li class="chapter" data-level="15.7.3" data-path="prog-io.html"><a href="prog-io.html#p-io-db-sql"><i class="fa fa-check"></i><b>15.7.3</b> SQL命令简介</a></li>
<li class="chapter" data-level="15.7.4" data-path="prog-io.html"><a href="prog-io.html#p-io-db-oracle"><i class="fa fa-check"></i><b>15.7.4</b> 访问Oracle数据库</a></li>
<li class="chapter" data-level="15.7.5" data-path="prog-io.html"><a href="prog-io.html#p-io-db-mysql"><i class="fa fa-check"></i><b>15.7.5</b> MySQL数据库访问</a></li>
<li class="chapter" data-level="15.7.6" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-rodbc"><i class="fa fa-check"></i><b>15.7.6</b> 利用RODBC访问Access数据库</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="prog-control.html"><a href="prog-control.html"><i class="fa fa-check"></i><b>16</b> 程序控制结构</a><ul>
<li class="chapter" data-level="16.1" data-path="prog-control.html"><a href="prog-control.html#p-con-exp"><i class="fa fa-check"></i><b>16.1</b> 表达式</a></li>
<li class="chapter" data-level="16.2" data-path="prog-control.html"><a href="prog-control.html#p-con-if"><i class="fa fa-check"></i><b>16.2</b> 分支结构</a><ul>
<li class="chapter" data-level="16.2.1" data-path="prog-control.html"><a href="prog-control.html#p-con-logic-index"><i class="fa fa-check"></i><b>16.2.1</b> 用逻辑下标代替分支结构</a></li>
<li class="chapter" data-level="16.2.2" data-path="prog-control.html"><a href="prog-control.html#p-con-ifelsef"><i class="fa fa-check"></i><b>16.2.2</b> <code>ifelse</code>函数</a></li>
<li class="chapter" data-level="16.2.3" data-path="prog-control.html"><a href="prog-control.html#p-con-switch"><i class="fa fa-check"></i><b>16.2.3</b> <code>switch</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="prog-control.html"><a href="prog-control.html#p-con-loop"><i class="fa fa-check"></i><b>16.3</b> 循环结构</a><ul>
<li class="chapter" data-level="16.3.1" data-path="prog-control.html"><a href="prog-control.html#p-con-for"><i class="fa fa-check"></i><b>16.3.1</b> 计数循环</a></li>
<li class="chapter" data-level="16.3.2" data-path="prog-control.html"><a href="prog-control.html#p-con-while"><i class="fa fa-check"></i><b>16.3.2</b> <code>while</code>循环和<code>repeat</code>循环</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="prog-control.html"><a href="prog-control.html#p-con-cond"><i class="fa fa-check"></i><b>16.4</b> R中判断条件</a></li>
<li class="chapter" data-level="16.5" data-path="prog-control.html"><a href="prog-control.html#p-pipe"><i class="fa fa-check"></i><b>16.5</b> 管道控制</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="prog-func.html"><a href="prog-func.html"><i class="fa fa-check"></i><b>17</b> 函数</a><ul>
<li class="chapter" data-level="17.1" data-path="prog-func.html"><a href="prog-func.html#p-func"><i class="fa fa-check"></i><b>17.1</b> 函数基础</a><ul>
<li class="chapter" data-level="17.1.1" data-path="prog-func.html"><a href="prog-func.html#p-func-intro"><i class="fa fa-check"></i><b>17.1.1</b> 介绍</a></li>
<li class="chapter" data-level="17.1.2" data-path="prog-func.html"><a href="prog-func.html#p-func-def"><i class="fa fa-check"></i><b>17.1.2</b> 函数定义</a></li>
<li class="chapter" data-level="17.1.3" data-path="prog-func.html"><a href="prog-func.html#p-func-call"><i class="fa fa-check"></i><b>17.1.3</b> 函数调用</a></li>
<li class="chapter" data-level="17.1.4" data-path="prog-func.html"><a href="prog-func.html#p-func-recursive"><i class="fa fa-check"></i><b>17.1.4</b> 递归调用</a></li>
<li class="chapter" data-level="17.1.5" data-path="prog-func.html"><a href="prog-func.html#p-func-vr"><i class="fa fa-check"></i><b>17.1.5</b> 向量化</a></li>
<li class="chapter" data-level="17.1.6" data-path="prog-func.html"><a href="prog-func.html#p-func-anonymf"><i class="fa fa-check"></i><b>17.1.6</b> 无名函数</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="prog-func.html"><a href="prog-func.html#p-func-space"><i class="fa fa-check"></i><b>17.2</b> 变量作用域</a><ul>
<li class="chapter" data-level="17.2.1" data-path="prog-func.html"><a href="prog-func.html#p-func-global"><i class="fa fa-check"></i><b>17.2.1</b> 全局变量和工作空间</a></li>
<li class="chapter" data-level="17.2.2" data-path="prog-func.html"><a href="prog-func.html#p-func-local"><i class="fa fa-check"></i><b>17.2.2</b> 局部变量</a></li>
<li class="chapter" data-level="17.2.3" data-path="prog-func.html"><a href="prog-func.html#p-func-global-access"><i class="fa fa-check"></i><b>17.2.3</b> 在函数内访问全局变量</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="prog-prof.html"><a href="prog-prof.html"><i class="fa fa-check"></i><b>18</b> R程序效率</a><ul>
<li class="chapter" data-level="18.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-effic"><i class="fa fa-check"></i><b>18.1</b> R的运行效率</a></li>
<li class="chapter" data-level="18.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect"><i class="fa fa-check"></i><b>18.2</b> 向量化编程</a><ul>
<li class="chapter" data-level="18.2.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex1"><i class="fa fa-check"></i><b>18.2.1</b> 示例1</a></li>
<li class="chapter" data-level="18.2.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex2"><i class="fa fa-check"></i><b>18.2.2</b> 示例2</a></li>
<li class="chapter" data-level="18.2.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex3"><i class="fa fa-check"></i><b>18.2.3</b> 示例3</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-loop"><i class="fa fa-check"></i><b>18.3</b> 减少显式循环</a><ul>
<li class="chapter" data-level="18.3.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-replicate"><i class="fa fa-check"></i><b>18.3.1</b> <code>replicate()</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-copy"><i class="fa fa-check"></i><b>18.4</b> 避免制作副本</a></li>
<li class="chapter" data-level="18.5" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun"><i class="fa fa-check"></i><b>18.5</b> R的计算函数</a><ul>
<li class="chapter" data-level="18.5.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-math"><i class="fa fa-check"></i><b>18.5.1</b> 数学函数</a></li>
<li class="chapter" data-level="18.5.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-sum"><i class="fa fa-check"></i><b>18.5.2</b> 概括函数</a></li>
<li class="chapter" data-level="18.5.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-max"><i class="fa fa-check"></i><b>18.5.3</b> 最值</a></li>
<li class="chapter" data-level="18.5.4" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-sort"><i class="fa fa-check"></i><b>18.5.4</b> 排序</a></li>
<li class="chapter" data-level="18.5.5" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-integrate"><i class="fa fa-check"></i><b>18.5.5</b> 一元定积分<code>integrate</code></a></li>
<li class="chapter" data-level="18.5.6" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-uniroot"><i class="fa fa-check"></i><b>18.5.6</b> 一元函数求根<code>uniroot</code></a></li>
<li class="chapter" data-level="18.5.7" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-fft"><i class="fa fa-check"></i><b>18.5.7</b> 离散傅立叶变换<code>fft</code></a></li>
<li class="chapter" data-level="18.5.8" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-filter"><i class="fa fa-check"></i><b>18.5.8</b> 用<code>filter</code>函数作迭代</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu"><i class="fa fa-check"></i><b>18.6</b> 并行计算</a><ul>
<li class="chapter" data-level="18.6.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex1"><i class="fa fa-check"></i><b>18.6.1</b> 例1：完全不互相依赖的并行运算</a></li>
<li class="chapter" data-level="18.6.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex2"><i class="fa fa-check"></i><b>18.6.2</b> 例2：使用相同随机数序列的并行计算</a></li>
<li class="chapter" data-level="18.6.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex3"><i class="fa fa-check"></i><b>18.6.3</b> 例3：使用独立随机数序列的并行计算</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="p-advfunc.html"><a href="p-advfunc.html"><i class="fa fa-check"></i><b>19</b> 函数进阶</a><ul>
<li class="chapter" data-level="19.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-callspe"><i class="fa fa-check"></i><b>19.1</b> 函数调用的各种形式</a></li>
<li class="chapter" data-level="19.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-lex"><i class="fa fa-check"></i><b>19.2</b> 嵌套定义与句法作用域(lexical scoping)</a></li>
<li class="chapter" data-level="19.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-inner"><i class="fa fa-check"></i><b>19.3</b> 辅助嵌套函数</a></li>
<li class="chapter" data-level="19.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-lazy"><i class="fa fa-check"></i><b>19.4</b> 懒惰求值</a></li>
<li class="chapter" data-level="19.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug"><i class="fa fa-check"></i><b>19.5</b> 程序调试</a><ul>
<li class="chapter" data-level="19.5.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-intro"><i class="fa fa-check"></i><b>19.5.1</b> 基本调试策略</a></li>
<li class="chapter" data-level="19.5.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-findfunc"><i class="fa fa-check"></i><b>19.5.2</b> 找到出错的函数</a></li>
<li class="chapter" data-level="19.5.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-browser"><i class="fa fa-check"></i><b>19.5.3</b> 跟踪调试</a></li>
<li class="chapter" data-level="19.5.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-cond"><i class="fa fa-check"></i><b>19.5.4</b> 条件断点</a></li>
<li class="chapter" data-level="19.5.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-debugf"><i class="fa fa-check"></i><b>19.5.5</b> 开启对一个函数的调试</a></li>
<li class="chapter" data-level="19.5.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-opt"><i class="fa fa-check"></i><b>19.5.6</b> 出错调试选项</a></li>
<li class="chapter" data-level="19.5.7" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-stop"><i class="fa fa-check"></i><b>19.5.7</b> <code>stop()</code>、<code>warning()</code>、<code>message()</code></a></li>
<li class="chapter" data-level="19.5.8" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-preventive"><i class="fa fa-check"></i><b>19.5.8</b> 预防性设计</a></li>
<li class="chapter" data-level="19.5.9" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-try"><i class="fa fa-check"></i><b>19.5.9</b> 出错处理机制</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-funcprog"><i class="fa fa-check"></i><b>19.6</b> 函数式编程介绍</a><ul>
<li class="chapter" data-level="19.6.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-pure"><i class="fa fa-check"></i><b>19.6.1</b> 纯函数</a></li>
<li class="chapter" data-level="19.6.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-rec"><i class="fa fa-check"></i><b>19.6.2</b> 副作用和运行环境恢复</a></li>
<li class="chapter" data-level="19.6.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-rsupp"><i class="fa fa-check"></i><b>19.6.3</b> R的函数式编程功能</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-functional"><i class="fa fa-check"></i><b>19.7</b> 泛函</a><ul>
<li class="chapter" data-level="19.7.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-map"><i class="fa fa-check"></i><b>19.7.1</b> <code>purrr::map</code>函数</a></li>
<li class="chapter" data-level="19.7.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-mapv"><i class="fa fa-check"></i><b>19.7.2</b> purrr包中<code>map</code>函数的变种</a></li>
<li class="chapter" data-level="19.7.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-reduce"><i class="fa fa-check"></i><b>19.7.3</b> purrr包中<code>reduce</code>类函数</a></li>
<li class="chapter" data-level="19.7.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-pred"><i class="fa fa-check"></i><b>19.7.4</b> purrr包中使用示性函数的泛函</a></li>
<li class="chapter" data-level="19.7.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-lapp"><i class="fa fa-check"></i><b>19.7.5</b> 基本R的函数式编程支持</a></li>
<li class="chapter" data-level="19.7.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-udef"><i class="fa fa-check"></i><b>19.7.6</b> 自定义泛函</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory"><i class="fa fa-check"></i><b>19.8</b> 函数工厂</a><ul>
<li class="chapter" data-level="19.8.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-clex"><i class="fa fa-check"></i><b>19.8.1</b> 闭包例子</a></li>
<li class="chapter" data-level="19.8.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-lazy"><i class="fa fa-check"></i><b>19.8.2</b> 动态查找和懒惰求值引起的问题</a></li>
<li class="chapter" data-level="19.8.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-mem"><i class="fa fa-check"></i><b>19.8.3</b> 函数工厂的内存负担</a></li>
<li class="chapter" data-level="19.8.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-operator"><i class="fa fa-check"></i><b>19.8.4</b> 函数算子</a></li>
</ul></li>
<li class="chapter" data-level="19.9" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env"><i class="fa fa-check"></i><b>19.9</b> 环境</a><ul>
<li class="chapter" data-level="19.9.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-def"><i class="fa fa-check"></i><b>19.9.1</b> 基本概念</a></li>
<li class="chapter" data-level="19.9.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-recurs"><i class="fa fa-check"></i><b>19.9.2</b> 逐层向上访问环境</a></li>
<li class="chapter" data-level="19.9.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-spec"><i class="fa fa-check"></i><b>19.9.3</b> 特殊环境</a></li>
<li class="chapter" data-level="19.9.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-callst"><i class="fa fa-check"></i><b>19.9.4</b> 调用栈</a></li>
<li class="chapter" data-level="19.9.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-usedt"><i class="fa fa-check"></i><b>19.9.5</b> 将环境用作一般数据结构</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV 制作研究报告和图书</b></span></li>
<li class="chapter" data-level="20" data-path="knitr.html"><a href="knitr.html"><i class="fa fa-check"></i><b>20</b> 用R制作研究报告</a></li>
<li class="chapter" data-level="21" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>21</b> Markdown格式</a><ul>
<li class="chapter" data-level="21.1" data-path="markdown.html"><a href="markdown.html#markdown-intro"><i class="fa fa-check"></i><b>21.1</b> 介绍</a></li>
<li class="chapter" data-level="21.2" data-path="markdown.html"><a href="markdown.html#markdown-app"><i class="fa fa-check"></i><b>21.2</b> Markdown格式文件的应用</a></li>
<li class="chapter" data-level="21.3" data-path="markdown.html"><a href="markdown.html#markdown-format"><i class="fa fa-check"></i><b>21.3</b> markdown格式说明</a><ul>
<li class="chapter" data-level="21.3.1" data-path="markdown.html"><a href="markdown.html#markdown-format-intro"><i class="fa fa-check"></i><b>21.3.1</b> 概述</a></li>
<li class="chapter" data-level="21.3.2" data-path="markdown.html"><a href="markdown.html#markdown-format-paragraph"><i class="fa fa-check"></i><b>21.3.2</b> 段落</a></li>
<li class="chapter" data-level="21.3.3" data-path="markdown.html"><a href="markdown.html#markdown-format-inline"><i class="fa fa-check"></i><b>21.3.3</b> 段内文字格式</a></li>
<li class="chapter" data-level="21.3.4" data-path="markdown.html"><a href="markdown.html#markdown-format-header"><i class="fa fa-check"></i><b>21.3.4</b> 标题和分隔线</a></li>
<li class="chapter" data-level="21.3.5" data-path="markdown.html"><a href="markdown.html#markdown-format-cite"><i class="fa fa-check"></i><b>21.3.5</b> 引用段落</a></li>
<li class="chapter" data-level="21.3.6" data-path="markdown.html"><a href="markdown.html#markdown-format-list"><i class="fa fa-check"></i><b>21.3.6</b> 列表</a></li>
<li class="chapter" data-level="21.3.7" data-path="markdown.html"><a href="markdown.html#markdown-format-code"><i class="fa fa-check"></i><b>21.3.7</b> 源程序</a></li>
<li class="chapter" data-level="21.3.8" data-path="markdown.html"><a href="markdown.html#markdown-format-link"><i class="fa fa-check"></i><b>21.3.8</b> 链接</a></li>
<li class="chapter" data-level="21.3.9" data-path="markdown.html"><a href="markdown.html#markdown-format-fig"><i class="fa fa-check"></i><b>21.3.9</b> 插入图形</a></li>
<li class="chapter" data-level="21.3.10" data-path="markdown.html"><a href="markdown.html#markdown-format-table"><i class="fa fa-check"></i><b>21.3.10</b> 表格</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="markdown.html"><a href="markdown.html#markdown-pandoc"><i class="fa fa-check"></i><b>21.4</b> 附录：pandoc软件介绍</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>22</b> R Markdown文件格式</a><ul>
<li class="chapter" data-level="22.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-intro"><i class="fa fa-check"></i><b>22.1</b> R Markdown文件</a></li>
<li class="chapter" data-level="22.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-compile"><i class="fa fa-check"></i><b>22.2</b> R Markdown文件的编译</a><ul>
<li class="chapter" data-level="22.2.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-compile-proc"><i class="fa fa-check"></i><b>22.2.1</b> 编译的实际过程</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode"><i class="fa fa-check"></i><b>22.3</b> 在R Markdown文件中插入R代码</a></li>
<li class="chapter" data-level="22.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-kable"><i class="fa fa-check"></i><b>22.4</b> 输出表格</a></li>
<li class="chapter" data-level="22.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-graph"><i class="fa fa-check"></i><b>22.5</b> 利用R程序插图</a></li>
<li class="chapter" data-level="22.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-opt"><i class="fa fa-check"></i><b>22.6</b> 代码段选项</a><ul>
<li class="chapter" data-level="22.6.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-outformat"><i class="fa fa-check"></i><b>22.6.1</b> 代码和文本输出结果格式</a></li>
<li class="chapter" data-level="22.6.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-figopt"><i class="fa fa-check"></i><b>22.6.2</b> 图形选项</a></li>
<li class="chapter" data-level="22.6.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-cache"><i class="fa fa-check"></i><b>22.6.3</b> 缓存(cache)选项</a></li>
</ul></li>
<li class="chapter" data-level="22.7" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd--sectionlink"><i class="fa fa-check"></i><b>22.7</b> 章节目录链接问题</a></li>
<li class="chapter" data-level="22.8" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula"><i class="fa fa-check"></i><b>22.8</b> 数学公式</a><ul>
<li class="chapter" data-level="22.8.1" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-intro"><i class="fa fa-check"></i><b>22.8.1</b> 在Markdown中输入数学公式</a></li>
<li class="chapter" data-level="22.8.2" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-type"><i class="fa fa-check"></i><b>22.8.2</b> 数学公式类别</a></li>
<li class="chapter" data-level="22.8.3" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-basic"><i class="fa fa-check"></i><b>22.8.3</b> 基本功能</a></li>
<li class="chapter" data-level="22.8.4" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-accent"><i class="fa fa-check"></i><b>22.8.4</b> 修饰符</a></li>
<li class="chapter" data-level="22.8.5" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-align"><i class="fa fa-check"></i><b>22.8.5</b> 对齐与矩阵</a></li>
<li class="chapter" data-level="22.8.6" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-fonts"><i class="fa fa-check"></i><b>22.8.6</b> 特殊字体</a></li>
</ul></li>
<li class="chapter" data-level="22.9" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-engines"><i class="fa fa-check"></i><b>22.9</b> 其它编程语言引擎</a></li>
<li class="chapter" data-level="22.10" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-interact"><i class="fa fa-check"></i><b>22.10</b> 交互内容</a></li>
<li class="chapter" data-level="22.11" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-attryaml"><i class="fa fa-check"></i><b>22.11</b> 属性设置</a><ul>
<li class="chapter" data-level="22.11.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-yaml"><i class="fa fa-check"></i><b>22.11.1</b> YAML元数据</a></li>
<li class="chapter" data-level="22.11.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-types"><i class="fa fa-check"></i><b>22.11.2</b> 输出格式</a></li>
<li class="chapter" data-level="22.11.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr"><i class="fa fa-check"></i><b>22.11.3</b> 输出格式设置</a></li>
<li class="chapter" data-level="22.11.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-toc"><i class="fa fa-check"></i><b>22.11.4</b> 目录设置</a></li>
<li class="chapter" data-level="22.11.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-numsec"><i class="fa fa-check"></i><b>22.11.5</b> 章节自动编号</a></li>
<li class="chapter" data-level="22.11.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-wordnumsec"><i class="fa fa-check"></i><b>22.11.6</b> Word输出章节自动编号及模板功能</a></li>
<li class="chapter" data-level="22.11.7" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-htmlspecific"><i class="fa fa-check"></i><b>22.11.7</b> HTML特有输出格式设置</a></li>
<li class="chapter" data-level="22.11.8" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-mathjax"><i class="fa fa-check"></i><b>22.11.8</b> 关于数学公式支持的设置</a></li>
<li class="chapter" data-level="22.11.9" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-yml"><i class="fa fa-check"></i><b>22.11.9</b> 输出设置文件</a></li>
</ul></li>
<li class="chapter" data-level="22.12" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex"><i class="fa fa-check"></i><b>22.12</b> LaTeX和PDF输出</a><ul>
<li class="chapter" data-level="22.12.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex-tinytex"><i class="fa fa-check"></i><b>22.12.1</b> TinyTex的安装使用</a></li>
<li class="chapter" data-level="22.12.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex-yaml"><i class="fa fa-check"></i><b>22.12.2</b> Rmd中Latex设置</a></li>
</ul></li>
<li class="chapter" data-level="22.13" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-rticles"><i class="fa fa-check"></i><b>22.13</b> 生成期刊文章</a></li>
<li class="chapter" data-level="22.14" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1"><i class="fa fa-check"></i><b>22.14</b> 附录：经验与问题</a><ul>
<li class="chapter" data-level="22.14.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1-wordtemplate"><i class="fa fa-check"></i><b>22.14.1</b> Word模板制作</a></li>
<li class="chapter" data-level="22.14.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1-math"><i class="fa fa-check"></i><b>22.14.2</b> 数学公式设置补充</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="bookdown.html"><a href="bookdown.html"><i class="fa fa-check"></i><b>23</b> 用bookdown制作图书</a><ul>
<li class="chapter" data-level="23.1" data-path="bookdown.html"><a href="bookdown.html#bookdown-intro"><i class="fa fa-check"></i><b>23.1</b> 介绍</a></li>
<li class="chapter" data-level="23.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-settings"><i class="fa fa-check"></i><b>23.2</b> 一本书的设置</a></li>
<li class="chapter" data-level="23.3" data-path="bookdown.html"><a href="bookdown.html#bookdown-sectioning"><i class="fa fa-check"></i><b>23.3</b> 章节结构</a></li>
<li class="chapter" data-level="23.4" data-path="bookdown.html"><a href="bookdown.html#bookdown-compile"><i class="fa fa-check"></i><b>23.4</b> 书的编译</a></li>
<li class="chapter" data-level="23.5" data-path="bookdown.html"><a href="bookdown.html#bookdown-cref"><i class="fa fa-check"></i><b>23.5</b> 交叉引用</a></li>
<li class="chapter" data-level="23.6" data-path="bookdown.html"><a href="bookdown.html#bookdown-formula"><i class="fa fa-check"></i><b>23.6</b> 数学公式和公式编号</a></li>
<li class="chapter" data-level="23.7" data-path="bookdown.html"><a href="bookdown.html#bookdown-theorem"><i class="fa fa-check"></i><b>23.7</b> 定理类编号</a></li>
<li class="chapter" data-level="23.8" data-path="bookdown.html"><a href="bookdown.html#bookdown-bib"><i class="fa fa-check"></i><b>23.8</b> 文献引用</a></li>
<li class="chapter" data-level="23.9" data-path="bookdown.html"><a href="bookdown.html#bookdown-graph"><i class="fa fa-check"></i><b>23.9</b> 插图</a></li>
<li class="chapter" data-level="23.10" data-path="bookdown.html"><a href="bookdown.html#bookdown-table"><i class="fa fa-check"></i><b>23.10</b> 表格</a><ul>
<li class="chapter" data-level="23.10.1" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-md"><i class="fa fa-check"></i><b>23.10.1</b> Markdown表格</a></li>
<li class="chapter" data-level="23.10.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-kable"><i class="fa fa-check"></i><b>23.10.2</b> 用<code>kable()</code>函数制作表格</a></li>
<li class="chapter" data-level="23.10.3" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-kable"><i class="fa fa-check"></i><b>23.10.3</b> R中其它制作表格的包</a></li>
</ul></li>
<li class="chapter" data-level="23.11" data-path="bookdown.html"><a href="bookdown.html#bookdown-mathjax"><i class="fa fa-check"></i><b>23.11</b> 数学公式的设置</a></li>
<li class="chapter" data-level="23.12" data-path="bookdown.html"><a href="bookdown.html#bookdown-exp"><i class="fa fa-check"></i><b>23.12</b> 使用经验</a></li>
<li class="chapter" data-level="23.13" data-path="bookdown.html"><a href="bookdown.html#bookdown-bugs"><i class="fa fa-check"></i><b>23.13</b> bookdown的一些使用问题</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="rmdsite.html"><a href="rmdsite.html"><i class="fa fa-check"></i><b>24</b> 用R Markdown制作简易网站</a><ul>
<li class="chapter" data-level="24.1" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-intro"><i class="fa fa-check"></i><b>24.1</b> 介绍</a></li>
<li class="chapter" data-level="24.2" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown"><i class="fa fa-check"></i><b>24.2</b> 简易网站制作</a><ul>
<li class="chapter" data-level="24.2.1" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-struct"><i class="fa fa-check"></i><b>24.2.1</b> 网站结构</a></li>
<li class="chapter" data-level="24.2.2" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-build"><i class="fa fa-check"></i><b>24.2.2</b> 编译</a></li>
<li class="chapter" data-level="24.2.3" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-pages"><i class="fa fa-check"></i><b>24.2.3</b> 内容文件</a></li>
<li class="chapter" data-level="24.2.4" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-config"><i class="fa fa-check"></i><b>24.2.4</b> 网站设置</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="rmdsite.html"><a href="rmdsite.html#blogdown"><i class="fa fa-check"></i><b>24.3</b> 用blogdown制作网站</a><ul>
<li class="chapter" data-level="24.3.1" data-path="rmdsite.html"><a href="rmdsite.html#blogd-new"><i class="fa fa-check"></i><b>24.3.1</b> 生成新网站的框架</a></li>
<li class="chapter" data-level="24.3.2" data-path="rmdsite.html"><a href="rmdsite.html#blogd-page"><i class="fa fa-check"></i><b>24.3.2</b> 网页内容文件及其设置</a></li>
<li class="chapter" data-level="24.3.3" data-path="rmdsite.html"><a href="rmdsite.html#blogd-workflow"><i class="fa fa-check"></i><b>24.3.3</b> 初学者的工作流程</a></li>
<li class="chapter" data-level="24.3.4" data-path="rmdsite.html"><a href="rmdsite.html#blogd-config"><i class="fa fa-check"></i><b>24.3.4</b> 网站设置文件</a></li>
<li class="chapter" data-level="24.3.5" data-path="rmdsite.html"><a href="rmdsite.html#blogd-static"><i class="fa fa-check"></i><b>24.3.5</b> 静态文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="slides.html"><a href="slides.html"><i class="fa fa-check"></i><b>25</b> 制作幻灯片</a><ul>
<li class="chapter" data-level="25.1" data-path="slides.html"><a href="slides.html#rmd-slides-intro"><i class="fa fa-check"></i><b>25.1</b> 介绍</a></li>
<li class="chapter" data-level="25.2" data-path="slides.html"><a href="slides.html#rmd-slidy"><i class="fa fa-check"></i><b>25.2</b> Slidy幻灯片</a><ul>
<li class="chapter" data-level="25.2.1" data-path="slides.html"><a href="slides.html#rmd-slidy-format"><i class="fa fa-check"></i><b>25.2.1</b> 文件格式</a></li>
<li class="chapter" data-level="25.2.2" data-path="slides.html"><a href="slides.html#rmd-slidy-compile"><i class="fa fa-check"></i><b>25.2.2</b> 幻灯片编译</a></li>
<li class="chapter" data-level="25.2.3" data-path="slides.html"><a href="slides.html#rmd-slidy-play"><i class="fa fa-check"></i><b>25.2.3</b> 播放控制</a></li>
<li class="chapter" data-level="25.2.4" data-path="slides.html"><a href="slides.html#rmd-slidy-handout"><i class="fa fa-check"></i><b>25.2.4</b> 生成单页HTML</a></li>
<li class="chapter" data-level="25.2.5" data-path="slides.html"><a href="slides.html#rmd-slidy-mathjax"><i class="fa fa-check"></i><b>25.2.5</b> 数学公式处理与输出设置文件</a></li>
<li class="chapter" data-level="25.2.6" data-path="slides.html"><a href="slides.html#rmd-slidy-options"><i class="fa fa-check"></i><b>25.2.6</b> 其它选项</a></li>
<li class="chapter" data-level="25.2.7" data-path="slides.html"><a href="slides.html#rmd-slidy-laser"><i class="fa fa-check"></i><b>25.2.7</b> slidy幻灯片激光笔失效问题的修改</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="slides.html"><a href="slides.html#rmdslides-pp"><i class="fa fa-check"></i><b>25.3</b> MS PowerPoint幻灯片</a></li>
<li class="chapter" data-level="25.4" data-path="slides.html"><a href="slides.html#rmdslides-beamer"><i class="fa fa-check"></i><b>25.4</b> Bearmer幻灯片格式</a></li>
<li class="chapter" data-level="25.5" data-path="slides.html"><a href="slides.html#rmdslides-rpres"><i class="fa fa-check"></i><b>25.5</b> R Presentation格式</a></li>
</ul></li>
<li class="part"><span><b>V 数据整理与汇总</b></span></li>
<li class="chapter" data-level="26" data-path="summary-manip.html"><a href="summary-manip.html"><i class="fa fa-check"></i><b>26</b> 数据整理</a><ul>
<li class="chapter" data-level="26.1" data-path="summary-manip.html"><a href="summary-manip.html#summm-tidyv"><i class="fa fa-check"></i><b>26.1</b> tidyverse系统</a></li>
<li class="chapter" data-level="26.2" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-filter"><i class="fa fa-check"></i><b>26.2</b> 用<code>filter()</code>选择行子集</a></li>
<li class="chapter" data-level="26.3" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-head"><i class="fa fa-check"></i><b>26.3</b> 按行序号选择行子集</a></li>
<li class="chapter" data-level="26.4" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-samplen"><i class="fa fa-check"></i><b>26.4</b> 用<code>sample_n()</code>对观测随机抽样</a></li>
<li class="chapter" data-level="26.5" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-distinct"><i class="fa fa-check"></i><b>26.5</b> 用<code>distinct()</code>去除重复行</a></li>
<li class="chapter" data-level="26.6" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-dropna"><i class="fa fa-check"></i><b>26.6</b> 用<code>drop_na()</code>去除指定的变量有缺失值的行</a></li>
<li class="chapter" data-level="26.7" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-select"><i class="fa fa-check"></i><b>26.7</b> 用<code>select()</code>选择列子集</a></li>
<li class="chapter" data-level="26.8" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-pull"><i class="fa fa-check"></i><b>26.8</b> 取出单个变量为向量</a></li>
<li class="chapter" data-level="26.9" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-arrange"><i class="fa fa-check"></i><b>26.9</b> 用<code>arrange()</code>排序</a></li>
<li class="chapter" data-level="26.10" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-rename"><i class="fa fa-check"></i><b>26.10</b> 用<code>rename()</code>修改变量名</a></li>
<li class="chapter" data-level="26.11" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-mutate"><i class="fa fa-check"></i><b>26.11</b> 用<code>mutate()</code>计算新变量</a></li>
<li class="chapter" data-level="26.12" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-transmute"><i class="fa fa-check"></i><b>26.12</b> 用<code>tranmute()</code>生成新变量的数据框</a></li>
<li class="chapter" data-level="26.13" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-pipe"><i class="fa fa-check"></i><b>26.13</b> 用管道连接多次操作</a></li>
<li class="chapter" data-level="26.14" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer"><i class="fa fa-check"></i><b>26.14</b> 宽表转换为长表</a><ul>
<li class="chapter" data-level="26.14.1" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-pl"><i class="fa fa-check"></i><b>26.14.1</b> <code>pivot_longer</code>函数</a></li>
<li class="chapter" data-level="26.14.2" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-prefixvalue"><i class="fa fa-check"></i><b>26.14.2</b> 从列名中提取数值</a></li>
<li class="chapter" data-level="26.14.3" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-colnamemultclassv"><i class="fa fa-check"></i><b>26.14.3</b> 从列名中提取多个分类变量值</a></li>
<li class="chapter" data-level="26.14.4" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-multvarsmultclassv"><i class="fa fa-check"></i><b>26.14.4</b> 一行中有多个属性的多次观测的情形</a></li>
</ul></li>
<li class="chapter" data-level="26.15" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider"><i class="fa fa-check"></i><b>26.15</b> 长表转换为宽表</a><ul>
<li class="chapter" data-level="26.15.1" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-sepvars"><i class="fa fa-check"></i><b>26.15.1</b> 将多个混在一起的变量拆开</a></li>
<li class="chapter" data-level="26.15.2" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-combtimes"><i class="fa fa-check"></i><b>26.15.2</b> 将多个类别合并到一个观测</a></li>
<li class="chapter" data-level="26.15.3" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-combcross"><i class="fa fa-check"></i><b>26.15.3</b> 将交叉类别合并到一个观测</a></li>
<li class="chapter" data-level="26.15.4" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-mvmest"><i class="fa fa-check"></i><b>26.15.4</b> 多个变量的多种值</a></li>
<li class="chapter" data-level="26.15.5" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-mixed"><i class="fa fa-check"></i><b>26.15.5</b> 长宽转换混合使用</a></li>
</ul></li>
<li class="chapter" data-level="26.16" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-spearate"><i class="fa fa-check"></i><b>26.16</b> 拆分数据列</a></li>
<li class="chapter" data-level="26.17" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-unite"><i class="fa fa-check"></i><b>26.17</b> 合并数据列</a></li>
<li class="chapter" data-level="26.18" data-path="summary-manip.html"><a href="summary-manip.html#summ-trans-combv"><i class="fa fa-check"></i><b>26.18</b> 数据框纵向合并</a></li>
<li class="chapter" data-level="26.19" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-join"><i class="fa fa-check"></i><b>26.19</b> 横向合并</a></li>
<li class="chapter" data-level="26.20" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-semi"><i class="fa fa-check"></i><b>26.20</b> 利用第二个数据集筛选</a></li>
<li class="chapter" data-level="26.21" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-set"><i class="fa fa-check"></i><b>26.21</b> 数据集的集合操作</a></li>
<li class="chapter" data-level="26.22" data-path="summary-manip.html"><a href="summary-manip.html#summ-trans-standard"><i class="fa fa-check"></i><b>26.22</b> 标准化</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="summary-summ.html"><a href="summary-summ.html"><i class="fa fa-check"></i><b>27</b> 数据汇总</a><ul>
<li class="chapter" data-level="27.1" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-summ"><i class="fa fa-check"></i><b>27.1</b> 用dplyr作数据汇总</a></li>
<li class="chapter" data-level="27.2" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-summat"><i class="fa fa-check"></i><b>27.2</b> 多个变量的汇总</a></li>
<li class="chapter" data-level="27.3" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-groupby"><i class="fa fa-check"></i><b>27.3</b> 用dplyr作数据分组汇总</a></li>
<li class="chapter" data-level="27.4" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-crossgroup"><i class="fa fa-check"></i><b>27.4</b> 交叉分类的汇总</a></li>
<li class="chapter" data-level="27.5" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest"><i class="fa fa-check"></i><b>27.5</b> tibble中的列表列</a><ul>
<li class="chapter" data-level="27.5.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-intro"><i class="fa fa-check"></i><b>27.5.1</b> <code>nest</code>和<code>unnest</code></a></li>
<li class="chapter" data-level="27.5.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-groupby"><i class="fa fa-check"></i><b>27.5.2</b> <code>group_by</code>与<code>nest</code>配合</a></li>
<li class="chapter" data-level="27.5.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-summarise"><i class="fa fa-check"></i><b>27.5.3</b> <code>summarise</code>统计量用列表表示</a></li>
<li class="chapter" data-level="27.5.4" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-unnest-grammar"><i class="fa fa-check"></i><b>27.5.4</b> <code>unnest</code>的语法格式</a></li>
<li class="chapter" data-level="27.5.5" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-direct"><i class="fa fa-check"></i><b>27.5.5</b> 直接生成列表类型的列</a></li>
</ul></li>
<li class="chapter" data-level="27.6" data-path="summary-summ.html"><a href="summary-summ.html#summ-base"><i class="fa fa-check"></i><b>27.6</b> 基本R的汇总功能</a><ul>
<li class="chapter" data-level="27.6.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-base-summary"><i class="fa fa-check"></i><b>27.6.1</b> <code>summary()</code>函数</a></li>
<li class="chapter" data-level="27.6.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-cont"><i class="fa fa-check"></i><b>27.6.2</b> 连续型变量概括函数</a></li>
<li class="chapter" data-level="27.6.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-fact"><i class="fa fa-check"></i><b>27.6.3</b> 分类变量概括</a></li>
<li class="chapter" data-level="27.6.4" data-path="summary-summ.html"><a href="summary-summ.html#summ-df"><i class="fa fa-check"></i><b>27.6.4</b> 数据框概括</a></li>
</ul></li>
<li class="chapter" data-level="27.7" data-path="summary-summ.html"><a href="summary-summ.html#summ-by"><i class="fa fa-check"></i><b>27.7</b> 用基本R作分类概括</a><ul>
<li class="chapter" data-level="27.7.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-tapply"><i class="fa fa-check"></i><b>27.7.1</b> 用<code>tapply()</code>分组概括向量</a></li>
<li class="chapter" data-level="27.7.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-aggregate"><i class="fa fa-check"></i><b>27.7.2</b> 用<code>aggregate()</code>分组概括数据框</a></li>
<li class="chapter" data-level="27.7.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-split"><i class="fa fa-check"></i><b>27.7.3</b> 用<code>split()</code>函数分组后概括</a></li>
</ul></li>
<li class="chapter" data-level="27.8" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-plyr"><i class="fa fa-check"></i><b>27.8</b> 用plyr包进行分类概括</a></li>
<li class="chapter" data-level="27.9" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-exer"><i class="fa fa-check"></i><b>27.9</b> 练习</a></li>
</ul></li>
<li class="part"><span><b>VI 绘图</b></span></li>
<li class="chapter" data-level="28" data-path="graph.html"><a href="graph.html"><i class="fa fa-check"></i><b>28</b> 基本R绘图</a><ul>
<li class="chapter" data-level="28.1" data-path="graph.html"><a href="graph.html#graph-ph"><i class="fa fa-check"></i><b>28.1</b> 常用高级图形</a><ul>
<li class="chapter" data-level="28.1.1" data-path="graph.html"><a href="graph.html#graph-ph-barplot"><i class="fa fa-check"></i><b>28.1.1</b> 条形图</a></li>
<li class="chapter" data-level="28.1.2" data-path="graph.html"><a href="graph.html#graph-ph-hist"><i class="fa fa-check"></i><b>28.1.2</b> 直方图和密度估计图</a></li>
<li class="chapter" data-level="28.1.3" data-path="graph.html"><a href="graph.html#graph-ph-boxplot"><i class="fa fa-check"></i><b>28.1.3</b> 盒形图</a></li>
<li class="chapter" data-level="28.1.4" data-path="graph.html"><a href="graph.html#graph-pr-qq"><i class="fa fa-check"></i><b>28.1.4</b> 正态QQ图</a></li>
<li class="chapter" data-level="28.1.5" data-path="graph.html"><a href="graph.html#graph-ph-plot"><i class="fa fa-check"></i><b>28.1.5</b> 散点图</a></li>
<li class="chapter" data-level="28.1.6" data-path="graph.html"><a href="graph.html#graph-ph-curve"><i class="fa fa-check"></i><b>28.1.6</b> 曲线图</a></li>
<li class="chapter" data-level="28.1.7" data-path="graph.html"><a href="graph.html#graph-ph-3d"><i class="fa fa-check"></i><b>28.1.7</b> 三维图</a></li>
<li class="chapter" data-level="28.1.8" data-path="graph.html"><a href="graph.html#graph-ph-rgl"><i class="fa fa-check"></i><b>28.1.8</b> 动态三维图</a></li>
</ul></li>
<li class="chapter" data-level="28.2" data-path="graph.html"><a href="graph.html#graph-pl"><i class="fa fa-check"></i><b>28.2</b> 低级图形函数</a><ul>
<li class="chapter" data-level="28.2.1" data-path="graph.html"><a href="graph.html#graph-pl-abline"><i class="fa fa-check"></i><b>28.2.1</b> <code>abline()</code></a></li>
<li class="chapter" data-level="28.2.2" data-path="graph.html"><a href="graph.html#graph-pl-points"><i class="fa fa-check"></i><b>28.2.2</b> <code>points()</code></a></li>
<li class="chapter" data-level="28.2.3" data-path="graph.html"><a href="graph.html#graph-pl-lines"><i class="fa fa-check"></i><b>28.2.3</b> <code>lines()</code></a></li>
<li class="chapter" data-level="28.2.4" data-path="graph.html"><a href="graph.html#graph-pl-legend"><i class="fa fa-check"></i><b>28.2.4</b> 图例</a></li>
<li class="chapter" data-level="28.2.5" data-path="graph.html"><a href="graph.html#graph-pl-axis"><i class="fa fa-check"></i><b>28.2.5</b> <code>axis()</code></a></li>
<li class="chapter" data-level="28.2.6" data-path="graph.html"><a href="graph.html#graph-pl-text"><i class="fa fa-check"></i><b>28.2.6</b> <code>text()</code></a></li>
<li class="chapter" data-level="28.2.7" data-path="graph.html"><a href="graph.html#graph-pl-locator"><i class="fa fa-check"></i><b>28.2.7</b> <code>locator()</code>和<code>identify()</code></a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="graph.html"><a href="graph.html#graph-par"><i class="fa fa-check"></i><b>28.3</b> 图形参数</a><ul>
<li class="chapter" data-level="28.3.1" data-path="graph.html"><a href="graph.html#graph-par-ex1"><i class="fa fa-check"></i><b>28.3.1</b> 例子：用图形参数解决barplot图形横坐标值过宽</a></li>
<li class="chapter" data-level="28.3.2" data-path="graph.html"><a href="graph.html#graph-par-elem"><i class="fa fa-check"></i><b>28.3.2</b> 图形元素控制</a></li>
<li class="chapter" data-level="28.3.3" data-path="graph.html"><a href="graph.html#graph-par-axis"><i class="fa fa-check"></i><b>28.3.3</b> 坐标轴与坐标刻度</a></li>
<li class="chapter" data-level="28.3.4" data-path="graph.html"><a href="graph.html#graph-par-mar"><i class="fa fa-check"></i><b>28.3.4</b> 图形边空</a></li>
<li class="chapter" data-level="28.3.5" data-path="graph.html"><a href="graph.html#graph-par-mfrow"><i class="fa fa-check"></i><b>28.3.5</b> 一页多图</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="graph.html"><a href="graph.html#graph-pout"><i class="fa fa-check"></i><b>28.4</b> 图形输出</a><ul>
<li class="chapter" data-level="28.4.1" data-path="graph.html"><a href="graph.html#graph-pout-pdf"><i class="fa fa-check"></i><b>28.4.1</b> PDF 输出</a></li>
<li class="chapter" data-level="28.4.2" data-path="graph.html"><a href="graph.html#graph-pout-png"><i class="fa fa-check"></i><b>28.4.2</b> PNG输出</a></li>
</ul></li>
<li class="chapter" data-level="28.5" data-path="graph.html"><a href="graph.html#graph-pzhn"><i class="fa fa-check"></i><b>28.5</b> 包含多种中文字体的图形</a></li>
<li class="chapter" data-level="28.6" data-path="graph.html"><a href="graph.html#graph-other"><i class="fa fa-check"></i><b>28.6</b> 其它图形</a><ul>
<li class="chapter" data-level="28.6.1" data-path="graph.html"><a href="graph.html#graph-other-corr"><i class="fa fa-check"></i><b>28.6.1</b> 相关系数图</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="29" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>29</b> ggplot作图入门</a><ul>
<li class="chapter" data-level="29.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-intro"><i class="fa fa-check"></i><b>29.1</b> 介绍</a></li>
<li class="chapter" data-level="29.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-principles"><i class="fa fa-check"></i><b>29.2</b> 作图的一般原则</a></li>
<li class="chapter" data-level="29.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point"><i class="fa fa-check"></i><b>29.3</b> 散点图：ggplot入门</a><ul>
<li class="chapter" data-level="29.3.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-base"><i class="fa fa-check"></i><b>29.3.1</b> 基本的散点图</a></li>
<li class="chapter" data-level="29.3.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-layers"><i class="fa fa-check"></i><b>29.3.2</b> 逐步改善</a></li>
<li class="chapter" data-level="29.3.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-otheraes"><i class="fa fa-check"></i><b>29.3.3</b> 颜色、符号、线型等映射</a></li>
<li class="chapter" data-level="29.3.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-geomaes"><i class="fa fa-check"></i><b>29.3.4</b> 在geom函数中映射变量</a></li>
<li class="chapter" data-level="29.3.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-contcolor"><i class="fa fa-check"></i><b>29.3.5</b> 连续变量的颜色映射</a></li>
<li class="chapter" data-level="29.3.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-save"><i class="fa fa-check"></i><b>29.3.6</b> 保存图像</a></li>
</ul></li>
<li class="chapter" data-level="29.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right"><i class="fa fa-check"></i><b>29.4</b> 折线图、分组、小图</a><ul>
<li class="chapter" data-level="29.4.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-group"><i class="fa fa-check"></i><b>29.4.1</b> 图形中的分组和折线图</a></li>
<li class="chapter" data-level="29.4.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-facet"><i class="fa fa-check"></i><b>29.4.2</b> 小图(facet)</a></li>
</ul></li>
<li class="chapter" data-level="29.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-bar-trans"><i class="fa fa-check"></i><b>29.5</b> 数据变换与条形图</a><ul>
<li class="chapter" data-level="29.5.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-morebar"><i class="fa fa-check"></i><b>29.5.1</b> 分段与并列条形图</a></li>
<li class="chapter" data-level="29.5.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-bar-morebar"><i class="fa fa-check"></i><b>29.5.2</b> 条形图的其它应用</a></li>
</ul></li>
<li class="chapter" data-level="29.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-hist"><i class="fa fa-check"></i><b>29.6</b> 直方图与密度估计</a></li>
<li class="chapter" data-level="29.7" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm"><i class="fa fa-check"></i><b>29.7</b> 绘图语法介绍</a><ul>
<li class="chapter" data-level="29.7.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm-gramm"><i class="fa fa-check"></i><b>29.7.1</b> 绘图语法</a></li>
<li class="chapter" data-level="29.7.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm-geoms"><i class="fa fa-check"></i><b>29.7.2</b> 图形种类</a></li>
</ul></li>
<li class="chapter" data-level="29.8" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom"><i class="fa fa-check"></i><b>29.8</b> 更多图形种类</a><ul>
<li class="chapter" data-level="29.8.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-continuousvar"><i class="fa fa-check"></i><b>29.8.1</b> 连续变量的分组图形</a></li>
<li class="chapter" data-level="29.8.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-text"><i class="fa fa-check"></i><b>29.8.2</b> 坐标系中的文字</a></li>
<li class="chapter" data-level="29.8.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-textops"><i class="fa fa-check"></i><b>29.8.3</b> 文字选项</a></li>
<li class="chapter" data-level="29.8.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-outliers"><i class="fa fa-check"></i><b>29.8.4</b> 标出特殊点</a></li>
</ul></li>
<li class="chapter" data-level="29.9" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-scale"><i class="fa fa-check"></i><b>29.9</b> 刻度(scale)</a></li>
<li class="chapter" data-level="29.10" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-color"><i class="fa fa-check"></i><b>29.10</b> 如何使用颜色</a><ul>
<li class="chapter" data-level="29.10.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-qual"><i class="fa fa-check"></i><b>29.10.1</b> 名义型变量的颜色</a></li>
<li class="chapter" data-level="29.10.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-tile"><i class="fa fa-check"></i><b>29.10.2</b> 色块图</a></li>
<li class="chapter" data-level="29.10.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-seq"><i class="fa fa-check"></i><b>29.10.3</b> 有序型变量的颜色</a></li>
<li class="chapter" data-level="29.10.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-div"><i class="fa fa-check"></i><b>29.10.4</b> 相异型变量的颜色</a></li>
<li class="chapter" data-level="29.10.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-num"><i class="fa fa-check"></i><b>29.10.5</b> 连续数值变量的颜色</a></li>
</ul></li>
<li class="chapter" data-level="29.11" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs"><i class="fa fa-check"></i><b>29.11</b> 标题、标注、指南、拼接</a><ul>
<li class="chapter" data-level="29.11.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-labs"><i class="fa fa-check"></i><b>29.11.1</b> 标题</a></li>
<li class="chapter" data-level="29.11.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-anno"><i class="fa fa-check"></i><b>29.11.2</b> 标注功能</a></li>
<li class="chapter" data-level="29.11.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-guides"><i class="fa fa-check"></i><b>29.11.3</b> 指南(guides)</a></li>
<li class="chapter" data-level="29.11.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-compfig"><i class="fa fa-check"></i><b>29.11.4</b> 拼接图形</a></li>
</ul></li>
<li class="chapter" data-level="29.12" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine"><i class="fa fa-check"></i><b>29.12</b> 图形定制调整</a><ul>
<li class="chapter" data-level="29.12.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-asasec"><i class="fa fa-check"></i><b>29.12.1</b> 图形逐步调整例子</a></li>
</ul></li>
<li class="chapter" data-level="29.13" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-theme"><i class="fa fa-check"></i><b>29.13</b> 主题</a></li>
<li class="chapter" data-level="29.14" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-ref"><i class="fa fa-check"></i><b>29.14</b> 参考文献</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="ggplotvis.html"><a href="ggplotvis.html"><i class="fa fa-check"></i><b>30</b> ggplot的各种图形</a><ul>
<li class="chapter" data-level="30.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-intro"><i class="fa fa-check"></i><b>30.1</b> 介绍</a></li>
<li class="chapter" data-level="30.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount"><i class="fa fa-check"></i><b>30.2</b> 表现数量</a><ul>
<li class="chapter" data-level="30.2.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-bar"><i class="fa fa-check"></i><b>30.2.1</b> 条形图</a></li>
<li class="chapter" data-level="30.2.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-point"><i class="fa fa-check"></i><b>30.2.2</b> 点图</a></li>
<li class="chapter" data-level="30.2.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-heatmap"><i class="fa fa-check"></i><b>30.2.3</b> 热力图</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist"><i class="fa fa-check"></i><b>30.3</b> 表现分布</a><ul>
<li class="chapter" data-level="30.3.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-suni-hist"><i class="fa fa-check"></i><b>30.3.1</b> 单个一元分布的直方图与密度估计图</a></li>
<li class="chapter" data-level="30.3.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-muni"><i class="fa fa-check"></i><b>30.3.2</b> 多个一元分布的直方图和密度图形</a></li>
<li class="chapter" data-level="30.3.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-cdf"><i class="fa fa-check"></i><b>30.3.3</b> 经验分布函数图</a></li>
<li class="chapter" data-level="30.3.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-qqplot"><i class="fa fa-check"></i><b>30.3.4</b> QQ图</a></li>
<li class="chapter" data-level="30.3.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-boxplot"><i class="fa fa-check"></i><b>30.3.5</b> 盒形图</a></li>
<li class="chapter" data-level="30.3.6" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-violin"><i class="fa fa-check"></i><b>30.3.6</b> 小提琴图</a></li>
<li class="chapter" data-level="30.3.7" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-mdens"><i class="fa fa-check"></i><b>30.3.7</b> 多个密度的其它画法</a></li>
<li class="chapter" data-level="30.3.8" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-2d"><i class="fa fa-check"></i><b>30.3.8</b> 二元分布直方图和等值线图</a></li>
</ul></li>
<li class="chapter" data-level="30.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop"><i class="fa fa-check"></i><b>30.4</b> 表现比例</a><ul>
<li class="chapter" data-level="30.4.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-uni"><i class="fa fa-check"></i><b>30.4.1</b> 单个分布</a></li>
<li class="chapter" data-level="30.4.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-mult"><i class="fa fa-check"></i><b>30.4.2</b> 组间的比例分布的比较</a></li>
<li class="chapter" data-level="30.4.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-nest"><i class="fa fa-check"></i><b>30.4.3</b> 嵌套比例分布的比较</a></li>
</ul></li>
<li class="chapter" data-level="30.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar"><i class="fa fa-check"></i><b>30.5</b> 表现多个变量间的关系</a><ul>
<li class="chapter" data-level="30.5.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-scatter"><i class="fa fa-check"></i><b>30.5.1</b> 散点图</a></li>
<li class="chapter" data-level="30.5.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-scatmat"><i class="fa fa-check"></i><b>30.5.2</b> 散点图矩阵</a></li>
<li class="chapter" data-level="30.5.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-corrgram"><i class="fa fa-check"></i><b>30.5.3</b> 相关系数矩阵图</a></li>
<li class="chapter" data-level="30.5.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-dimreduct"><i class="fa fa-check"></i><b>30.5.4</b> 数据降维</a></li>
<li class="chapter" data-level="30.5.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-paird"><i class="fa fa-check"></i><b>30.5.5</b> 成对数据</a></li>
</ul></li>
<li class="chapter" data-level="30.6" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts"><i class="fa fa-check"></i><b>30.6</b> 时间序列图</a><ul>
<li class="chapter" data-level="30.6.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-uni"><i class="fa fa-check"></i><b>30.6.1</b> 一元时间序列</a></li>
<li class="chapter" data-level="30.6.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-mul"><i class="fa fa-check"></i><b>30.6.2</b> 多元时间序列</a></li>
<li class="chapter" data-level="30.6.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-het"><i class="fa fa-check"></i><b>30.6.3</b> 多个不同类型指标的时间序列</a></li>
</ul></li>
<li class="chapter" data-level="30.7" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit"><i class="fa fa-check"></i><b>30.7</b> 拟合曲线图</a><ul>
<li class="chapter" data-level="30.7.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit-smooth"><i class="fa fa-check"></i><b>30.7.1</b> 平滑方法</a></li>
<li class="chapter" data-level="30.7.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit-param"><i class="fa fa-check"></i><b>30.7.2</b> 参数模型方法</a></li>
</ul></li>
<li class="chapter" data-level="30.8" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert"><i class="fa fa-check"></i><b>30.8</b> 表现不确定性</a><ul>
<li class="chapter" data-level="30.8.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-prob"><i class="fa fa-check"></i><b>30.8.1</b> 表现概率</a></li>
<li class="chapter" data-level="30.8.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-se"><i class="fa fa-check"></i><b>30.8.2</b> 表现点估计精度</a></li>
<li class="chapter" data-level="30.8.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-cband"><i class="fa fa-check"></i><b>30.8.3</b> 拟合曲线的置信带</a></li>
<li class="chapter" data-level="30.8.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-dyn"><i class="fa fa-check"></i><b>30.8.4</b> 随机结果动态演示</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII 统计模型</b></span></li>
<li class="chapter" data-level="31" data-path="stat-basics.html"><a href="stat-basics.html"><i class="fa fa-check"></i><b>31</b> R初等统计分析</a><ul>
<li class="chapter" data-level="31.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-distr"><i class="fa fa-check"></i><b>31.1</b> 概率分布</a></li>
<li class="chapter" data-level="31.2" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-mle"><i class="fa fa-check"></i><b>31.2</b> 最大似然估计</a><ul>
<li class="chapter" data-level="31.2.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-mle-norm1"><i class="fa fa-check"></i><b>31.2.1</b> 一元正态分布参数最大似然估计</a></li>
</ul></li>
<li class="chapter" data-level="31.3" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest"><i class="fa fa-check"></i><b>31.3</b> 假设检验和置信区间</a><ul>
<li class="chapter" data-level="31.3.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-mu"><i class="fa fa-check"></i><b>31.3.1</b> 均值的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.2" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-prop"><i class="fa fa-check"></i><b>31.3.2</b> 比例的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.3" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-sigma"><i class="fa fa-check"></i><b>31.3.3</b> 方差的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.4" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-gof"><i class="fa fa-check"></i><b>31.3.4</b> 拟合优度检验</a></li>
<li class="chapter" data-level="31.3.5" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-gof-vcd"><i class="fa fa-check"></i><b>31.3.5</b> 检验分布类型</a></li>
<li class="chapter" data-level="31.3.6" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-indepcont"><i class="fa fa-check"></i><b>31.3.6</b> 列联表独立性卡方检验</a></li>
<li class="chapter" data-level="31.3.7" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-npar"><i class="fa fa-check"></i><b>31.3.7</b> 非参数检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="32" data-path="stat-reg.html"><a href="stat-reg.html"><i class="fa fa-check"></i><b>32</b> R相关与回归</a><ul>
<li class="chapter" data-level="32.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor"><i class="fa fa-check"></i><b>32.1</b> 相关分析</a><ul>
<li class="chapter" data-level="32.1.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-prop"><i class="fa fa-check"></i><b>32.1.1</b> 相关系数的性质</a></li>
<li class="chapter" data-level="32.1.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-caus"><i class="fa fa-check"></i><b>32.1.2</b> 相关与因果</a></li>
<li class="chapter" data-level="32.1.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-magn"><i class="fa fa-check"></i><b>32.1.3</b> 相关系数大小</a></li>
<li class="chapter" data-level="32.1.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-test"><i class="fa fa-check"></i><b>32.1.4</b> 相关系数的检验</a></li>
<li class="chapter" data-level="32.1.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-vcorr"><i class="fa fa-check"></i><b>32.1.5</b> 相关阵</a></li>
</ul></li>
<li class="chapter" data-level="32.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp"><i class="fa fa-check"></i><b>32.2</b> 一元回归分析</a><ul>
<li class="chapter" data-level="32.2.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-model"><i class="fa fa-check"></i><b>32.2.1</b> 模型</a></li>
<li class="chapter" data-level="32.2.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-ls"><i class="fa fa-check"></i><b>32.2.2</b> 最小二乘法</a></li>
<li class="chapter" data-level="32.2.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-test"><i class="fa fa-check"></i><b>32.2.3</b> 回归有效性</a></li>
<li class="chapter" data-level="32.2.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-prog"><i class="fa fa-check"></i><b>32.2.4</b> R程序</a></li>
<li class="chapter" data-level="32.2.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-diag"><i class="fa fa-check"></i><b>32.2.5</b> 回归诊断</a></li>
<li class="chapter" data-level="32.2.6" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-ci"><i class="fa fa-check"></i><b>32.2.6</b> 预测区间</a></li>
<li class="chapter" data-level="32.2.7" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-control"><i class="fa fa-check"></i><b>32.2.7</b> 控制</a></li>
</ul></li>
<li class="chapter" data-level="32.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu"><i class="fa fa-check"></i><b>32.3</b> 多元线性回归</a><ul>
<li class="chapter" data-level="32.3.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-mod"><i class="fa fa-check"></i><b>32.3.1</b> 模型</a></li>
<li class="chapter" data-level="32.3.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-est"><i class="fa fa-check"></i><b>32.3.2</b> 参数估计</a></li>
<li class="chapter" data-level="32.3.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-rcode"><i class="fa fa-check"></i><b>32.3.3</b> R的多元回归程序</a></li>
<li class="chapter" data-level="32.3.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-test"><i class="fa fa-check"></i><b>32.3.4</b> 模型的检验</a></li>
<li class="chapter" data-level="32.3.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-subset"><i class="fa fa-check"></i><b>32.3.5</b> 回归自变量筛选</a></li>
<li class="chapter" data-level="32.3.6" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-dum"><i class="fa fa-check"></i><b>32.3.6</b> 哑变量与变截距项的模型</a></li>
<li class="chapter" data-level="32.3.7" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-resid"><i class="fa fa-check"></i><b>32.3.7</b> 残差诊断</a></li>
<li class="chapter" data-level="32.3.8" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-colin"><i class="fa fa-check"></i><b>32.3.8</b> 多重共线性</a></li>
<li class="chapter" data-level="32.3.9" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-lev"><i class="fa fa-check"></i><b>32.3.9</b> 强影响点分析</a></li>
<li class="chapter" data-level="32.3.10" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-overfit"><i class="fa fa-check"></i><b>32.3.10</b> 过度拟合示例</a></li>
<li class="chapter" data-level="32.3.11" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-comp-inset"><i class="fa fa-check"></i><b>32.3.11</b> 嵌套模型的比较</a></li>
<li class="chapter" data-level="32.3.12" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-pred"><i class="fa fa-check"></i><b>32.3.12</b> 拟合与预测</a></li>
<li class="chapter" data-level="32.3.13" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-curve"><i class="fa fa-check"></i><b>32.3.13</b> 利用线性回归模型做曲线拟合</a></li>
<li class="chapter" data-level="32.3.14" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-group"><i class="fa fa-check"></i><b>32.3.14</b> 分组建立多个模型</a></li>
</ul></li>
<li class="chapter" data-level="32.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-npar"><i class="fa fa-check"></i><b>32.4</b> 非参数回归</a><ul>
<li class="chapter" data-level="32.4.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-npar-mod"><i class="fa fa-check"></i><b>32.4.1</b> 模型</a></li>
<li class="chapter" data-level="32.4.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-spl1d"><i class="fa fa-check"></i><b>32.4.2</b> 样条平滑</a></li>
<li class="chapter" data-level="32.4.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-loess"><i class="fa fa-check"></i><b>32.4.3</b> 局部多项式曲线平滑</a></li>
<li class="chapter" data-level="32.4.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-bs"><i class="fa fa-check"></i><b>32.4.4</b> 样条函数变换</a></li>
<li class="chapter" data-level="32.4.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-gam"><i class="fa fa-check"></i><b>32.4.5</b> 线性可加模型</a></li>
</ul></li>
<li class="chapter" data-level="32.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog"><i class="fa fa-check"></i><b>32.5</b> Logistic回归</a><ul>
<li class="chapter" data-level="32.5.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog-mod"><i class="fa fa-check"></i><b>32.5.1</b> 模型</a></li>
<li class="chapter" data-level="32.5.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog-rcode"><i class="fa fa-check"></i><b>32.5.2</b> R程序</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="33" data-path="stat-tsa.html"><a href="stat-tsa.html"><i class="fa fa-check"></i><b>33</b> R时间序列分析</a><ul>
<li class="chapter" data-level="33.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-defs"><i class="fa fa-check"></i><b>33.1</b> 基本概念</a></li>
<li class="chapter" data-level="33.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype"><i class="fa fa-check"></i><b>33.2</b> 时间序列数据类型</a><ul>
<li class="chapter" data-level="33.2.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype-ts"><i class="fa fa-check"></i><b>33.2.1</b> ts类型</a></li>
<li class="chapter" data-level="33.2.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype-xts"><i class="fa fa-check"></i><b>33.2.2</b> xts类型与常用函数</a></li>
</ul></li>
<li class="chapter" data-level="33.3" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-basicstat"><i class="fa fa-check"></i><b>33.3</b> 基本分析与作图</a></li>
<li class="chapter" data-level="33.4" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima"><i class="fa fa-check"></i><b>33.4</b> ARIMA建模和模拟</a><ul>
<li class="chapter" data-level="33.4.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-def"><i class="fa fa-check"></i><b>33.4.1</b> 模型公式</a></li>
<li class="chapter" data-level="33.4.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-sim"><i class="fa fa-check"></i><b>33.4.2</b> 模拟</a></li>
<li class="chapter" data-level="33.4.3" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-armod"><i class="fa fa-check"></i><b>33.4.3</b> AR建模</a></li>
<li class="chapter" data-level="33.4.4" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-armamod"><i class="fa fa-check"></i><b>33.4.4</b> ARMA建模</a></li>
<li class="chapter" data-level="33.4.5" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-diag"><i class="fa fa-check"></i><b>33.4.5</b> 模型诊断</a></li>
<li class="chapter" data-level="33.4.6" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-lbtest"><i class="fa fa-check"></i><b>33.4.6</b> 白噪声检验</a></li>
<li class="chapter" data-level="33.4.7" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-sparse"><i class="fa fa-check"></i><b>33.4.7</b> 稀疏系数估计</a></li>
<li class="chapter" data-level="33.4.8" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-adftest"><i class="fa fa-check"></i><b>33.4.8</b> 单位根检验</a></li>
<li class="chapter" data-level="33.4.9" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-cfuncs"><i class="fa fa-check"></i><b>33.4.9</b> ARMA模型的一些自定义函数</a></li>
</ul></li>
<li class="chapter" data-level="33.5" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-spectra"><i class="fa fa-check"></i><b>33.5</b> 谱密度估计</a></li>
<li class="chapter" data-level="33.6" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-garch"><i class="fa fa-check"></i><b>33.6</b> GARCH类模型</a></li>
<li class="chapter" data-level="33.7" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-mtsa"><i class="fa fa-check"></i><b>33.7</b> 多元时间序列基础统计</a></li>
<li class="chapter" data-level="33.8" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-var"><i class="fa fa-check"></i><b>33.8</b> VAR模型</a></li>
<li class="chapter" data-level="33.9" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-coint"><i class="fa fa-check"></i><b>33.9</b> 协整分析</a></li>
<li class="chapter" data-level="33.10" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-causal"><i class="fa fa-check"></i><b>33.10</b> 因果性检验</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="stat-learning.html"><a href="stat-learning.html"><i class="fa fa-check"></i><b>34</b> 统计学习介绍</a><ul>
<li class="chapter" data-level="34.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro"><i class="fa fa-check"></i><b>34.1</b> 统计学习的基本概念和一般步骤</a><ul>
<li class="chapter" data-level="34.1.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro-basic"><i class="fa fa-check"></i><b>34.1.1</b> 统计学习的基本概念和方法</a></li>
<li class="chapter" data-level="34.1.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro-biasvar"><i class="fa fa-check"></i><b>34.1.2</b> 偏差与方差折衷</a></li>
<li class="chapter" data-level="34.1.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-cv"><i class="fa fa-check"></i><b>34.1.3</b> 交叉验证</a></li>
<li class="chapter" data-level="34.1.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-steps"><i class="fa fa-check"></i><b>34.1.4</b> 一般步骤</a></li>
</ul></li>
<li class="chapter" data-level="34.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters"><i class="fa fa-check"></i><b>34.2</b> Hitters数据分析</a><ul>
<li class="chapter" data-level="34.2.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-subset"><i class="fa fa-check"></i><b>34.2.1</b> 回归自变量选择</a></li>
<li class="chapter" data-level="34.2.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-ridge"><i class="fa fa-check"></i><b>34.2.2</b> 岭回归</a></li>
<li class="chapter" data-level="34.2.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-lasso"><i class="fa fa-check"></i><b>34.2.3</b> Lasso回归</a></li>
<li class="chapter" data-level="34.2.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-simpt"><i class="fa fa-check"></i><b>34.2.4</b> 树回归的简单演示</a></li>
<li class="chapter" data-level="34.2.5" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-tree"><i class="fa fa-check"></i><b>34.2.5</b> 树回归</a></li>
<li class="chapter" data-level="34.2.6" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-bag"><i class="fa fa-check"></i><b>34.2.6</b> 装袋法</a></li>
<li class="chapter" data-level="34.2.7" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-rf"><i class="fa fa-check"></i><b>34.2.7</b> 随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart"><i class="fa fa-check"></i><b>34.3</b> Heart数据分析</a><ul>
<li class="chapter" data-level="34.3.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-tree"><i class="fa fa-check"></i><b>34.3.1</b> 树回归</a></li>
<li class="chapter" data-level="34.3.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-bag"><i class="fa fa-check"></i><b>34.3.2</b> 用装袋法</a></li>
<li class="chapter" data-level="34.3.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-rf"><i class="fa fa-check"></i><b>34.3.3</b> 用随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-car"><i class="fa fa-check"></i><b>34.4</b> 汽车销量数据分析</a><ul>
<li class="chapter" data-level="34.4.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-car-tree"><i class="fa fa-check"></i><b>34.4.1</b> 判别树</a></li>
<li class="chapter" data-level="34.4.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-car-rf"><i class="fa fa-check"></i><b>34.4.2</b> 随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.5" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston"><i class="fa fa-check"></i><b>34.5</b> 波士顿郊区房价数据</a><ul>
<li class="chapter" data-level="34.5.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-tree"><i class="fa fa-check"></i><b>34.5.1</b> 回归树</a></li>
<li class="chapter" data-level="34.5.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-bag"><i class="fa fa-check"></i><b>34.5.2</b> 装袋法</a></li>
<li class="chapter" data-level="34.5.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-rf"><i class="fa fa-check"></i><b>34.5.3</b> 随机森林</a></li>
<li class="chapter" data-level="34.5.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-boost"><i class="fa fa-check"></i><b>34.5.4</b> 提升法</a></li>
</ul></li>
<li class="chapter" data-level="34.6" data-path="stat-learning.html"><a href="stat-learning.html#statl-svm"><i class="fa fa-check"></i><b>34.6</b> 支持向量机方法</a><ul>
<li class="chapter" data-level="34.6.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-svm-heart"><i class="fa fa-check"></i><b>34.6.1</b> 支持向量机用于Heart数据</a></li>
</ul></li>
<li class="chapter" data-level="34.7" data-path="stat-learning.html"><a href="stat-learning.html#statl-app"><i class="fa fa-check"></i><b>34.7</b> 附录</a><ul>
<li class="chapter" data-level="34.7.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-hitters"><i class="fa fa-check"></i><b>34.7.1</b> Hitters数据</a></li>
<li class="chapter" data-level="34.7.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-heart"><i class="fa fa-check"></i><b>34.7.2</b> Heart数据</a></li>
<li class="chapter" data-level="34.7.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-car"><i class="fa fa-check"></i><b>34.7.3</b> CarSeats数据</a></li>
<li class="chapter" data-level="34.7.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-boston"><i class="fa fa-check"></i><b>34.7.4</b> Boston数据</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="35" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>35</b> 随机模拟</a><ul>
<li class="chapter" data-level="35.1" data-path="simulation.html"><a href="simulation.html#simint"><i class="fa fa-check"></i><b>35.1</b> 随机数</a></li>
<li class="chapter" data-level="35.2" data-path="simulation.html"><a href="simulation.html#simsamp"><i class="fa fa-check"></i><b>35.2</b> <code>sample()</code>函数</a></li>
<li class="chapter" data-level="35.3" data-path="simulation.html"><a href="simulation.html#simexamp"><i class="fa fa-check"></i><b>35.3</b> 随机模拟示例</a><ul>
<li class="chapter" data-level="35.3.1" data-path="simulation.html"><a href="simulation.html#simexamp-expect"><i class="fa fa-check"></i><b>35.3.1</b> 估计期望值</a></li>
<li class="chapter" data-level="35.3.2" data-path="simulation.html"><a href="simulation.html#simexamp-lm"><i class="fa fa-check"></i><b>35.3.2</b> 线性回归模拟</a></li>
<li class="chapter" data-level="35.3.3" data-path="simulation.html"><a href="simulation.html#simexamp-kde"><i class="fa fa-check"></i><b>35.3.3</b> 核密度的bootstrap置信区间</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VIII 特殊应用</b></span></li>
<li class="chapter" data-level="36" data-path="text.html"><a href="text.html"><i class="fa fa-check"></i><b>36</b> R语言的文本处理</a><ul>
<li class="chapter" data-level="36.1" data-path="text.html"><a href="text.html#text-simple"><i class="fa fa-check"></i><b>36.1</b> 简单的文本处理</a><ul>
<li class="chapter" data-level="36.1.1" data-path="text.html"><a href="text.html#text-simple-const"><i class="fa fa-check"></i><b>36.1.1</b> 字符型常量与字符型向量</a></li>
<li class="chapter" data-level="36.1.2" data-path="text.html"><a href="text.html#text-paste"><i class="fa fa-check"></i><b>36.1.2</b> 字符串连接、重复</a></li>
<li class="chapter" data-level="36.1.3" data-path="text.html"><a href="text.html#text-formatout"><i class="fa fa-check"></i><b>36.1.3</b> 格式化输出</a></li>
<li class="chapter" data-level="36.1.4" data-path="text.html"><a href="text.html#text-length"><i class="fa fa-check"></i><b>36.1.4</b> 字符串长度</a></li>
<li class="chapter" data-level="36.1.5" data-path="text.html"><a href="text.html#text-substring"><i class="fa fa-check"></i><b>36.1.5</b> 取子串</a></li>
<li class="chapter" data-level="36.1.6" data-path="text.html"><a href="text.html#text-convert"><i class="fa fa-check"></i><b>36.1.6</b> 字符串变换</a></li>
<li class="chapter" data-level="36.1.7" data-path="text.html"><a href="text.html#text-simp-find"><i class="fa fa-check"></i><b>36.1.7</b> 简单匹配与查找</a></li>
<li class="chapter" data-level="36.1.8" data-path="text.html"><a href="text.html#text-simple-gsub"><i class="fa fa-check"></i><b>36.1.8</b> 字符串替换</a></li>
<li class="chapter" data-level="36.1.9" data-path="text.html"><a href="text.html#text-simple-strsplit"><i class="fa fa-check"></i><b>36.1.9</b> 字符串拆分</a></li>
</ul></li>
<li class="chapter" data-level="36.2" data-path="text.html"><a href="text.html#text-file"><i class="fa fa-check"></i><b>36.2</b> 文本文件读写</a></li>
<li class="chapter" data-level="36.3" data-path="text.html"><a href="text.html#text-regex"><i class="fa fa-check"></i><b>36.3</b> 正则表达式</a><ul>
<li class="chapter" data-level="36.3.1" data-path="text.html"><a href="text.html#text-regex-strview"><i class="fa fa-check"></i><b>36.3.1</b> 字面匹配与匹配显示</a></li>
<li class="chapter" data-level="36.3.2" data-path="text.html"><a href="text.html#text-regex-ignore"><i class="fa fa-check"></i><b>36.3.2</b> 不区分大小写匹配和<code>regex</code>函数</a></li>
<li class="chapter" data-level="36.3.3" data-path="text.html"><a href="text.html#text-regex-dot"><i class="fa fa-check"></i><b>36.3.3</b> 用句点匹配单个字符</a></li>
<li class="chapter" data-level="36.3.4" data-path="text.html"><a href="text.html#text-regex-set"><i class="fa fa-check"></i><b>36.3.4</b> 匹配一组字符中的某一个</a></li>
<li class="chapter" data-level="36.3.5" data-path="text.html"><a href="text.html#text-regex-metalit"><i class="fa fa-check"></i><b>36.3.5</b> 原样匹配元字符</a></li>
<li class="chapter" data-level="36.3.6" data-path="text.html"><a href="text.html#text-regex-space"><i class="fa fa-check"></i><b>36.3.6</b> 匹配空白</a></li>
<li class="chapter" data-level="36.3.7" data-path="text.html"><a href="text.html#text-regex-digit"><i class="fa fa-check"></i><b>36.3.7</b> 匹配数字</a></li>
<li class="chapter" data-level="36.3.8" data-path="text.html"><a href="text.html#text-regex-alnum"><i class="fa fa-check"></i><b>36.3.8</b> 匹配字母、数字、下划线</a></li>
<li class="chapter" data-level="36.3.9" data-path="text.html"><a href="text.html#text-regex-hex"><i class="fa fa-check"></i><b>36.3.9</b> 十六进制和八进制数</a></li>
<li class="chapter" data-level="36.3.10" data-path="text.html"><a href="text.html#text-regex-posix"><i class="fa fa-check"></i><b>36.3.10</b> POSIX字符类</a></li>
<li class="chapter" data-level="36.3.11" data-path="text.html"><a href="text.html#text-regex-start"><i class="fa fa-check"></i><b>36.3.11</b> 匹配开头和末尾</a></li>
<li class="chapter" data-level="36.3.12" data-path="text.html"><a href="text.html#text-regex-wordb"><i class="fa fa-check"></i><b>36.3.12</b> 单词边界</a></li>
<li class="chapter" data-level="36.3.13" data-path="text.html"><a href="text.html#text-regex-repeat"><i class="fa fa-check"></i><b>36.3.13</b> 重复匹配</a></li>
<li class="chapter" data-level="36.3.14" data-path="text.html"><a href="text.html#text-regex-lazy"><i class="fa fa-check"></i><b>36.3.14</b> 贪婪匹配和懒惰匹配</a></li>
<li class="chapter" data-level="36.3.15" data-path="text.html"><a href="text.html#text-regex-smlines"><i class="fa fa-check"></i><b>36.3.15</b> 句点全匹配与多行模式</a></li>
<li class="chapter" data-level="36.3.16" data-path="text.html"><a href="text.html#text-regex-alt"><i class="fa fa-check"></i><b>36.3.16</b> 备择模式</a></li>
<li class="chapter" data-level="36.3.17" data-path="text.html"><a href="text.html#text-regex-group"><i class="fa fa-check"></i><b>36.3.17</b> 分组与捕获</a></li>
</ul></li>
<li class="chapter" data-level="36.4" data-path="text.html"><a href="text.html#text-stringr-funcs"><i class="fa fa-check"></i><b>36.4</b> stringr包的正则表达式函数</a><ul>
<li class="chapter" data-level="36.4.1" data-path="text.html"><a href="text.html#text-stringr-funcs-strview"><i class="fa fa-check"></i><b>36.4.1</b> <code>str_view()</code>函数</a></li>
<li class="chapter" data-level="36.4.2" data-path="text.html"><a href="text.html#text-stringr-funcs-regex"><i class="fa fa-check"></i><b>36.4.2</b> <code>regex()</code>函数</a></li>
<li class="chapter" data-level="36.4.3" data-path="text.html"><a href="text.html#text-stringr-funcs-detect"><i class="fa fa-check"></i><b>36.4.3</b> 检查那些元素能够匹配</a></li>
<li class="chapter" data-level="36.4.4" data-path="text.html"><a href="text.html#text-stringr-funcs-replace"><i class="fa fa-check"></i><b>36.4.4</b> 替换</a></li>
<li class="chapter" data-level="36.4.5" data-path="text.html"><a href="text.html#text-stringr-funcs-subset"><i class="fa fa-check"></i><b>36.4.5</b> 返回匹配的元素</a></li>
<li class="chapter" data-level="36.4.6" data-path="text.html"><a href="text.html#text-stringr-funcs-extract"><i class="fa fa-check"></i><b>36.4.6</b> 提取匹配内容</a></li>
<li class="chapter" data-level="36.4.7" data-path="text.html"><a href="text.html#text-stringr-funcs-match"><i class="fa fa-check"></i><b>36.4.7</b> 提取分组捕获内容</a></li>
<li class="chapter" data-level="36.4.8" data-path="text.html"><a href="text.html#text-stringr-funcs-locate"><i class="fa fa-check"></i><b>36.4.8</b> 定位匹配位置</a></li>
</ul></li>
<li class="chapter" data-level="36.5" data-path="text.html"><a href="text.html#text-regex-bfuncs"><i class="fa fa-check"></i><b>36.5</b> 利用基本R函数进行正则表达式处理</a><ul>
<li class="chapter" data-level="36.5.1" data-path="text.html"><a href="text.html#text-regex-bfuncs-igcase"><i class="fa fa-check"></i><b>36.5.1</b> 不区分大小写匹配</a></li>
<li class="chapter" data-level="36.5.2" data-path="text.html"><a href="text.html#text-regex-bfuncs-dotp"><i class="fa fa-check"></i><b>36.5.2</b> 匹配单个字符</a></li>
<li class="chapter" data-level="36.5.3" data-path="text.html"><a href="text.html#text-regex-bfuncs-setp"><i class="fa fa-check"></i><b>36.5.3</b> 匹配一组字符中的某一个</a></li>
<li class="chapter" data-level="36.5.4" data-path="text.html"><a href="text.html#text-regex-bfuncs-metalit"><i class="fa fa-check"></i><b>36.5.4</b> 原样匹配元字符</a></li>
<li class="chapter" data-level="36.5.5" data-path="text.html"><a href="text.html#text-regex-bfuncs-digit"><i class="fa fa-check"></i><b>36.5.5</b> 匹配数字</a></li>
<li class="chapter" data-level="36.5.6" data-path="text.html"><a href="text.html#text-regex-bfuncs-start"><i class="fa fa-check"></i><b>36.5.6</b> 匹配开头和末尾</a></li>
<li class="chapter" data-level="36.5.7" data-path="text.html"><a href="text.html#text-regex-bfuncs-alnum"><i class="fa fa-check"></i><b>36.5.7</b> 匹配字母、数字、下划线</a></li>
<li class="chapter" data-level="36.5.8" data-path="text.html"><a href="text.html#text-regex-bfuncs-hex"><i class="fa fa-check"></i><b>36.5.8</b> 十六进制和八进制数</a></li>
<li class="chapter" data-level="36.5.9" data-path="text.html"><a href="text.html#text-regex-bfuncs-posix"><i class="fa fa-check"></i><b>36.5.9</b> POSIX字符类</a></li>
<li class="chapter" data-level="36.5.10" data-path="text.html"><a href="text.html#text-regex-bfuncs-plus"><i class="fa fa-check"></i><b>36.5.10</b> 加号重复匹配</a></li>
<li class="chapter" data-level="36.5.11" data-path="text.html"><a href="text.html#text-regex-bfuncs-ast"><i class="fa fa-check"></i><b>36.5.11</b> 星号和问号重复匹配</a></li>
<li class="chapter" data-level="36.5.12" data-path="text.html"><a href="text.html#text-regex-bfuncs-repnum"><i class="fa fa-check"></i><b>36.5.12</b> 计数重复</a></li>
<li class="chapter" data-level="36.5.13" data-path="text.html"><a href="text.html#text-regex-bfuncs-lazy"><i class="fa fa-check"></i><b>36.5.13</b> 贪婪匹配和懒惰匹配</a></li>
<li class="chapter" data-level="36.5.14" data-path="text.html"><a href="text.html#text-regex-bfuncs-wordb"><i class="fa fa-check"></i><b>36.5.14</b> 单词边界</a></li>
<li class="chapter" data-level="36.5.15" data-path="text.html"><a href="text.html#text-regex-bfuncs-sm"><i class="fa fa-check"></i><b>36.5.15</b> 句点全匹配与多行模式</a></li>
<li class="chapter" data-level="36.5.16" data-path="text.html"><a href="text.html#text-regex-bfuncs-alt"><i class="fa fa-check"></i><b>36.5.16</b> 备择模式</a></li>
<li class="chapter" data-level="36.5.17" data-path="text.html"><a href="text.html#text-regex-bfuncs-group"><i class="fa fa-check"></i><b>36.5.17</b> 分组与捕获</a></li>
</ul></li>
<li class="chapter" data-level="36.6" data-path="text.html"><a href="text.html#text-regexex"><i class="fa fa-check"></i><b>36.6</b> 正则表达式应用例子</a><ul>
<li class="chapter" data-level="36.6.1" data-path="text.html"><a href="text.html#text-regexex-pre"><i class="fa fa-check"></i><b>36.6.1</b> 数据预处理</a></li>
<li class="chapter" data-level="36.6.2" data-path="text.html"><a href="text.html#text-regexex-excelmore"><i class="fa fa-check"></i><b>36.6.2</b> 不规则Excel文件处理</a></li>
<li class="chapter" data-level="36.6.3" data-path="text.html"><a href="text.html#text-regexex-wordfreq"><i class="fa fa-check"></i><b>36.6.3</b> 字频统计</a></li>
<li class="chapter" data-level="36.6.4" data-path="text.html"><a href="text.html#text-regexex-digits"><i class="fa fa-check"></i><b>36.6.4</b> 数字验证</a></li>
<li class="chapter" data-level="36.6.5" data-path="text.html"><a href="text.html#text-regexex-digfn"><i class="fa fa-check"></i><b>36.6.5</b> 文件名中的数字提取</a></li>
</ul></li>
<li class="chapter" data-level="36.7" data-path="text.html"><a href="text.html#text-webscape"><i class="fa fa-check"></i><b>36.7</b> 网站数据获取</a></li>
<li class="chapter" data-level="36.8" data-path="text.html"><a href="text.html#text-jiebaR"><i class="fa fa-check"></i><b>36.8</b> 中文分词与词频</a></li>
</ul></li>
<li class="part"><span><b>IX 用Rcpp访问C++代码</b></span></li>
<li class="chapter" data-level="37" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>37</b> Rcpp介绍</a><ul>
<li class="chapter" data-level="37.1" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-use"><i class="fa fa-check"></i><b>37.1</b> Rcpp的用途</a></li>
<li class="chapter" data-level="37.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp"><i class="fa fa-check"></i><b>37.2</b> Rcpp入门样例</a><ul>
<li class="chapter" data-level="37.2.1" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex1"><i class="fa fa-check"></i><b>37.2.1</b> 用<code>cppFunction()</code>转换简单的C++函数—Fibnacci例子</a></li>
<li class="chapter" data-level="37.2.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex2"><i class="fa fa-check"></i><b>37.2.2</b> 用<code>sourceCpp()</code>转换C++程序—正负交替迭代例子</a></li>
<li class="chapter" data-level="37.2.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex3"><i class="fa fa-check"></i><b>37.2.3</b> 用<code>sourceCpp()</code>转换C++源文件中的程序—正负交替迭代例子</a></li>
<li class="chapter" data-level="37.2.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex4"><i class="fa fa-check"></i><b>37.2.4</b> 用<code>sourceCpp()</code>转换C++源程序文件—卷积例子</a></li>
<li class="chapter" data-level="37.2.5" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-rmdconv"><i class="fa fa-check"></i><b>37.2.5</b> 在Rmd文件中使用C++源程序文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="38" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html"><i class="fa fa-check"></i><b>38</b> R与C++的类型转换</a><ul>
<li class="chapter" data-level="38.1" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-wrap"><i class="fa fa-check"></i><b>38.1</b> 用<code>wrap()</code>把C++变量返回到R中</a></li>
<li class="chapter" data-level="38.2" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-as"><i class="fa fa-check"></i><b>38.2</b> 用<code>as()</code>函数把R变量转换为C++类型</a></li>
<li class="chapter" data-level="38.3" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-implicit"><i class="fa fa-check"></i><b>38.3</b> <code>as()</code>和<code>wrap()</code>的隐含调用</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="rcpp-attr.html"><a href="rcpp-attr.html"><i class="fa fa-check"></i><b>39</b> Rcpp 属性</a><ul>
<li class="chapter" data-level="39.1" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-intro"><i class="fa fa-check"></i><b>39.1</b> Rcpp属性介绍</a></li>
<li class="chapter" data-level="39.2" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-export"><i class="fa fa-check"></i><b>39.2</b> 在C++源程序中指定要导出的C++函数</a></li>
<li class="chapter" data-level="39.3" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-sourcecpp"><i class="fa fa-check"></i><b>39.3</b> 在R中编译链接C++代码</a></li>
<li class="chapter" data-level="39.4" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc"><i class="fa fa-check"></i><b>39.4</b> Rcpp属性的其它功能</a><ul>
<li class="chapter" data-level="39.4.1" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-default"><i class="fa fa-check"></i><b>39.4.1</b> 自变量有缺省值的函数</a></li>
<li class="chapter" data-level="39.4.2" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-interrupt"><i class="fa fa-check"></i><b>39.4.2</b> 允许用户中断</a></li>
<li class="chapter" data-level="39.4.3" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-rinclude"><i class="fa fa-check"></i><b>39.4.3</b> 把R代码写在C++源文件中</a></li>
<li class="chapter" data-level="39.4.4" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-rand"><i class="fa fa-check"></i><b>39.4.4</b> 在C++中调用R的随机数发生器</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="40" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html"><i class="fa fa-check"></i><b>40</b> Rcpp提供的C++数据类型</a><ul>
<li class="chapter" data-level="40.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-robject"><i class="fa fa-check"></i><b>40.1</b> RObject类</a></li>
<li class="chapter" data-level="40.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec"><i class="fa fa-check"></i><b>40.2</b> IntegerVector类</a><ul>
<li class="chapter" data-level="40.2.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec-ex1"><i class="fa fa-check"></i><b>40.2.1</b> IntegerVector示例1：返回完全数</a></li>
<li class="chapter" data-level="40.2.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec-ex2"><i class="fa fa-check"></i><b>40.2.2</b> IntegerVector示例2：输入整数向量</a></li>
</ul></li>
<li class="chapter" data-level="40.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num"><i class="fa fa-check"></i><b>40.3</b> NumericVector类</a><ul>
<li class="chapter" data-level="40.3.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex1"><i class="fa fa-check"></i><b>40.3.1</b> 示例1：计算元素<span class="math inline">\(p\)</span>次方的和</a></li>
<li class="chapter" data-level="40.3.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex2"><i class="fa fa-check"></i><b>40.3.2</b> 示例2：<code>clone</code>函数</a></li>
<li class="chapter" data-level="40.3.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex3"><i class="fa fa-check"></i><b>40.3.3</b> 示例3：向量子集</a></li>
</ul></li>
<li class="chapter" data-level="40.4" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat"><i class="fa fa-check"></i><b>40.4</b> NumericMatrix类</a><ul>
<li class="chapter" data-level="40.4.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex1"><i class="fa fa-check"></i><b>40.4.1</b> 示例1：计算矩阵各列模的最大值</a></li>
<li class="chapter" data-level="40.4.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex2"><i class="fa fa-check"></i><b>40.4.2</b> 示例2：把输入矩阵制作副本计算元素平方根</a></li>
<li class="chapter" data-level="40.4.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex3"><i class="fa fa-check"></i><b>40.4.3</b> 示例3：访问列子集</a></li>
</ul></li>
<li class="chapter" data-level="40.5" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-other"><i class="fa fa-check"></i><b>40.5</b> Rcpp的其它向量类</a><ul>
<li class="chapter" data-level="40.5.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-logic"><i class="fa fa-check"></i><b>40.5.1</b> Rcpp的LogicalVector类</a></li>
<li class="chapter" data-level="40.5.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-char"><i class="fa fa-check"></i><b>40.5.2</b> Rcpp的CharacterVector类型</a></li>
</ul></li>
<li class="chapter" data-level="40.6" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types"><i class="fa fa-check"></i><b>40.6</b> Rcpp提供的其它数据类型</a><ul>
<li class="chapter" data-level="40.6.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-named"><i class="fa fa-check"></i><b>40.6.1</b> Named类型</a></li>
<li class="chapter" data-level="40.6.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-list"><i class="fa fa-check"></i><b>40.6.2</b> List类型</a></li>
<li class="chapter" data-level="40.6.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-df"><i class="fa fa-check"></i><b>40.6.3</b> Rcpp的DataFrame类</a></li>
<li class="chapter" data-level="40.6.4" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-func"><i class="fa fa-check"></i><b>40.6.4</b> Rcpp的Function类</a></li>
<li class="chapter" data-level="40.6.5" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-environ"><i class="fa fa-check"></i><b>40.6.5</b> Rcpp的Environment类</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="41" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html"><i class="fa fa-check"></i><b>41</b> Rcpp糖</a><ul>
<li class="chapter" data-level="41.1" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-examp"><i class="fa fa-check"></i><b>41.1</b> 简单示例</a></li>
<li class="chapter" data-level="41.2" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop"><i class="fa fa-check"></i><b>41.2</b> 向量化的运算符</a><ul>
<li class="chapter" data-level="41.2.1" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-arith"><i class="fa fa-check"></i><b>41.2.1</b> 向量化的四则运算</a></li>
<li class="chapter" data-level="41.2.2" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-binop"><i class="fa fa-check"></i><b>41.2.2</b> 向量化的二元逻辑运算</a></li>
<li class="chapter" data-level="41.2.3" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-uop"><i class="fa fa-check"></i><b>41.2.3</b> 向量化的一元运算符</a></li>
</ul></li>
<li class="chapter" data-level="41.3" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-mathfunc"><i class="fa fa-check"></i><b>41.3</b> 用Rcpp访问数学函数</a></li>
<li class="chapter" data-level="41.4" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-any"><i class="fa fa-check"></i><b>41.4</b> 返回单一逻辑值的函数</a></li>
<li class="chapter" data-level="41.5" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-expfunc"><i class="fa fa-check"></i><b>41.5</b> 返回糖表达式的函数</a></li>
<li class="chapter" data-level="41.6" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-diff"><i class="fa fa-check"></i><b>41.6</b> R与Rcpp不同语法示例</a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="rcpp-package.html"><a href="rcpp-package.html"><i class="fa fa-check"></i><b>42</b> 用Rcpp帮助制作R扩展包</a><ul>
<li class="chapter" data-level="42.1" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-wo"><i class="fa fa-check"></i><b>42.1</b> 不用扩展包共享C++代码的方法</a></li>
<li class="chapter" data-level="42.2" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen"><i class="fa fa-check"></i><b>42.2</b> 生成扩展包</a><ul>
<li class="chapter" data-level="42.2.1" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-exist"><i class="fa fa-check"></i><b>42.2.1</b> 利用已有基于Rcpp属性的源程序制作扩展包</a></li>
<li class="chapter" data-level="42.2.2" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-desc"><i class="fa fa-check"></i><b>42.2.2</b> DESCRIPTION文件</a></li>
<li class="chapter" data-level="42.2.3" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-namespace"><i class="fa fa-check"></i><b>42.2.3</b> NAMESPACE文件</a></li>
</ul></li>
<li class="chapter" data-level="42.3" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-recomp"><i class="fa fa-check"></i><b>42.3</b> 重新编译</a></li>
<li class="chapter" data-level="42.4" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-interface"><i class="fa fa-check"></i><b>42.4</b> 建立C++用的接口界面</a></li>
</ul></li>
<li class="part"><span><b>X 编程例子</b></span></li>
<li class="chapter" data-level="43" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>43</b> R编程例子</a><ul>
<li class="chapter" data-level="43.1" data-path="examples.html"><a href="examples.html#examples-rlang"><i class="fa fa-check"></i><b>43.1</b> R语言</a><ul>
<li class="chapter" data-level="43.1.1" data-path="examples.html"><a href="examples.html#examples-rlang-inverse"><i class="fa fa-check"></i><b>43.1.1</b> 用向量作逆变换</a></li>
<li class="chapter" data-level="43.1.2" data-path="examples.html"><a href="examples.html#examples-rlang-fibonacci"><i class="fa fa-check"></i><b>43.1.2</b> 斐波那契数列计算</a></li>
<li class="chapter" data-level="43.1.3" data-path="examples.html"><a href="examples.html#examples-rlang-permutation"><i class="fa fa-check"></i><b>43.1.3</b> 穷举所有排列</a></li>
<li class="chapter" data-level="43.1.4" data-path="examples.html"><a href="examples.html#examples-rlang-repgroup"><i class="fa fa-check"></i><b>43.1.4</b> 可重复分组方式穷举</a></li>
<li class="chapter" data-level="43.1.5" data-path="examples.html"><a href="examples.html#examples-rlang-runs"><i class="fa fa-check"></i><b>43.1.5</b> 升降连计数</a></li>
</ul></li>
<li class="chapter" data-level="43.2" data-path="examples.html"><a href="examples.html#examples-prob"><i class="fa fa-check"></i><b>43.2</b> 概率</a><ul>
<li class="chapter" data-level="43.2.1" data-path="examples.html"><a href="examples.html#examples-prob-thsage"><i class="fa fa-check"></i><b>43.2.1</b> 智者千虑必有一失</a></li>
<li class="chapter" data-level="43.2.2" data-path="examples.html"><a href="examples.html#examples-prob-coupleseats"><i class="fa fa-check"></i><b>43.2.2</b> 圆桌夫妇座位问题</a></li>
</ul></li>
<li class="chapter" data-level="43.3" data-path="examples.html"><a href="examples.html#examples-scicomp"><i class="fa fa-check"></i><b>43.3</b> 科学计算</a><ul>
<li class="chapter" data-level="43.3.1" data-path="examples.html"><a href="examples.html#examples-scicomp-citylink"><i class="fa fa-check"></i><b>43.3.1</b> 城市间最短路径</a></li>
<li class="chapter" data-level="43.3.2" data-path="examples.html"><a href="examples.html#examples-scicomp-daub"><i class="fa fa-check"></i><b>43.3.2</b> Daubechies小波函数计算</a></li>
<li class="chapter" data-level="43.3.3" data-path="examples.html"><a href="examples.html#examples-scicomp-heating"><i class="fa fa-check"></i><b>43.3.3</b> 房间加热温度变化</a></li>
</ul></li>
<li class="chapter" data-level="43.4" data-path="examples.html"><a href="examples.html#examples-statcomp"><i class="fa fa-check"></i><b>43.4</b> 统计计算</a><ul>
<li class="chapter" data-level="43.4.1" data-path="examples.html"><a href="examples.html#examples-statcomp-kernden"><i class="fa fa-check"></i><b>43.4.1</b> 核回归与核密度估计</a></li>
<li class="chapter" data-level="43.4.2" data-path="examples.html"><a href="examples.html#examples-statcomp-mcquad2d"><i class="fa fa-check"></i><b>43.4.2</b> 二维随机模拟积分</a></li>
<li class="chapter" data-level="43.4.3" data-path="examples.html"><a href="examples.html#examples-statcomp-hidfreq"><i class="fa fa-check"></i><b>43.4.3</b> 潜周期估计</a></li>
<li class="chapter" data-level="43.4.4" data-path="examples.html"><a href="examples.html#examples-statcomp-armaest"><i class="fa fa-check"></i><b>43.4.4</b> ARMA(1,1)模型估计</a></li>
<li class="chapter" data-level="43.4.5" data-path="examples.html"><a href="examples.html#examples-statcomp-varprop"><i class="fa fa-check"></i><b>43.4.5</b> VAR模型平稳性</a></li>
<li class="chapter" data-level="43.4.6" data-path="examples.html"><a href="examples.html#examples-statcomp-storereliab"><i class="fa fa-check"></i><b>43.4.6</b> 贮存可靠性评估</a></li>
</ul></li>
<li class="chapter" data-level="43.5" data-path="examples.html"><a href="examples.html#examples-datatreat"><i class="fa fa-check"></i><b>43.5</b> 数据处理</a><ul>
<li class="chapter" data-level="43.5.1" data-path="examples.html"><a href="examples.html#examples-datatreat-subscore"><i class="fa fa-check"></i><b>43.5.1</b> 小题分题型分数汇总</a></li>
<li class="chapter" data-level="43.5.2" data-path="examples.html"><a href="examples.html#examples-datatreat-cluslab"><i class="fa fa-check"></i><b>43.5.2</b> 类别编号重排</a></li>
</ul></li>
<li class="chapter" data-level="43.6" data-path="examples.html"><a href="examples.html#examples-texttr"><i class="fa fa-check"></i><b>43.6</b> 文本处理</a><ul>
<li class="chapter" data-level="43.6.1" data-path="examples.html"><a href="examples.html#examples-texttr-hongloument"><i class="fa fa-check"></i><b>43.6.1</b> 用R语言下载处理《红楼梦》htm文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://www.math.pku.edu.cn/teachers/lidf/" target="blank">编著：李东风</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R语言教程</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplotvis" class="section level1">
<h1><span class="header-section-number">30</span> ggplot的各种图形</h1>
<div id="ggplotvis-intro" class="section level2">
<h2><span class="header-section-number">30.1</span> 介绍</h2>
<p>ggplot2包提供了许多种图形，
其作用可以大致地分为：</p>
<ul>
<li>表现数量；</li>
<li>表现一维或者二维分布；</li>
<li>表现两个变量之间的数量关系，等等。</li>
</ul>
<p>下面按照其作用分别进行介绍。</p>
<p>主要参考：</p>
<ul>
<li>Claus O. Wilke(2019).
Fundamentals of Data Visualization.
O’Reilly Media.
<a href="https://serialmentor.com/dataviz/" class="uri">https://serialmentor.com/dataviz/</a></li>
</ul>
</div>
<div id="ggplotvis-amount" class="section level2">
<h2><span class="header-section-number">30.2</span> 表现数量</h2>
<div id="ggplotvis-amount-bar" class="section level3">
<h3><span class="header-section-number">30.2.1</span> 条形图</h3>
<p>设有若干个类，
每个类有一个数量属性值。
经常用条形图表现数量。</p>
<div id="ggplotvis-amount-bar-simp" class="section level4">
<h4><span class="header-section-number">30.2.1.1</span> 简单的条形图</h4>
<p>例如，
有25个共同基金，
分为三个类别，
各类别的频数为：</p>
<div class="sourceCode" id="cb1886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1886-1"><a href="ggplotvis.html#cb1886-1"></a>d_funds_type &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb1886-2"><a href="ggplotvis.html#cb1886-2"></a>  <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;国内股本&quot;</span>, <span class="st">&quot;国际股本&quot;</span>, <span class="st">&quot;固定收益&quot;</span>),</span>
<span id="cb1886-3"><a href="ggplotvis.html#cb1886-3"></a>  <span class="dt">freq =</span> <span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1886-4"><a href="ggplotvis.html#cb1886-4"></a>)</span>
<span id="cb1886-5"><a href="ggplotvis.html#cb1886-5"></a>knitr<span class="op">::</span><span class="kw">kable</span>(d_funds_type)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="right">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">国内股本</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">国际股本</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">固定收益</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>用<code>ggplot()</code>输入数据并指定映射，
用<code>geom_col()</code>作条形图，
x轴为类别，y轴为每个类别对应的数值，这里是输入数据中的频数：</p>
<div class="sourceCode" id="cb1887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1887-1"><a href="ggplotvis.html#cb1887-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d_funds_type, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1887-2"><a href="ggplotvis.html#cb1887-2"></a>  <span class="dt">x =</span> type, <span class="dt">y =</span> freq ))</span>
<span id="cb1887-3"><a href="ggplotvis.html#cb1887-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-funds01b-1.png" width="672" /></p>
<p>上面的最后一行程序也可以用<code>geom_bar()</code>函数写成<code>p + geom_bar(stat = "identity")</code>。
<code>geom_bar()</code>可以对分类变量的原始值自动统计频数然后做频数条形图，
如果输入数据已经是频数，
就需要加<code>stat = "identity"</code>选项。</p>
<p>上面的三个类的次序并不是输入的次序，
这是因为字符型变量会自动转换为因子型，
因子水平一般按字典序排列。
可以在输入时用<code>factor(x, levels=&lt;指定的因子水平表&gt;)</code>定义因子并人为指定因子次序，
或者用forcats包的<code>fct_relevel()</code>函数，如：</p>
<div class="sourceCode" id="cb1888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1888-1"><a href="ggplotvis.html#cb1888-1"></a>d &lt;-<span class="st"> </span>d_funds_type <span class="op">%&gt;%</span></span>
<span id="cb1888-2"><a href="ggplotvis.html#cb1888-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">fct_relevel</span>(type, <span class="st">&quot;国内股本&quot;</span>, <span class="st">&quot;国际股本&quot;</span>, <span class="st">&quot;固定收益&quot;</span>))</span>
<span id="cb1888-3"><a href="ggplotvis.html#cb1888-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1888-4"><a href="ggplotvis.html#cb1888-4"></a>  <span class="dt">x =</span> type, <span class="dt">y =</span> freq ))</span>
<span id="cb1888-5"><a href="ggplotvis.html#cb1888-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-funds01c-1.png" width="672" /></p>
<p>可以用forcats包的<code>fct_reorder()</code>函数，
将各个水平按照频数大小排序，如：</p>
<div class="sourceCode" id="cb1889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1889-1"><a href="ggplotvis.html#cb1889-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1889-2"><a href="ggplotvis.html#cb1889-2"></a>  <span class="dt">x =</span> <span class="kw">fct_reorder</span>(type, <span class="kw">desc</span>(freq)),</span>
<span id="cb1889-3"><a href="ggplotvis.html#cb1889-3"></a>  <span class="dt">y =</span> freq ))</span>
<span id="cb1889-4"><a href="ggplotvis.html#cb1889-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-funds01d-1.png" width="672" /></p>
<p>注意，
条形图中这种对各条形按照高度重排序的做法仅适用于各类没有自然的次序的情形，
如果各类有自然的次序，
比如年份、月份、季度、年龄组、收入高低分组等，
就应该按照各类的自然次序，
可以在输入数据时用<code>factor(x, levels=&lt;指定的因子水平表&gt;)</code>定义因子并人为指定因子次序，
或者在输入数据后用forcats包的<code>fct_relevel()</code>函数重排次序。</p>
<p>当分类的标签值（如“固定收益”）较长而且类个数较多时，
横轴的宽度可能不够用，使得相邻两项的标签重叠，
只好省略部分标签。
这时，
一种办法是将类标签方向变成45度角：</p>
<div class="sourceCode" id="cb1890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1890-1"><a href="ggplotvis.html#cb1890-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1890-2"><a href="ggplotvis.html#cb1890-2"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb1890-3"><a href="ggplotvis.html#cb1890-3"></a>    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb1890-4"><a href="ggplotvis.html#cb1890-4"></a>  )</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-funds01e-1.png" width="672" /></p>
<p>针对条形图的各条形的标签太长的问题，
更好的办法是将条形横向放置，
这样类标签就到了y轴，
可以横向显示。
这可以在映射中直接修改，
但最好还是用<code>coord_flip()</code>函数颠倒x轴与y轴的作用，
因为有些图形是不允许修改映射的。
程序如</p>
<div class="sourceCode" id="cb1891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1891-1"><a href="ggplotvis.html#cb1891-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1891-2"><a href="ggplotvis.html#cb1891-2"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-funds01f-1.png" width="672" /></p>
<p>下面用<code>labs()</code>去掉分类标签轴的标题并修改频数轴的标题：</p>
<div class="sourceCode" id="cb1892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1892-1"><a href="ggplotvis.html#cb1892-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1892-2"><a href="ggplotvis.html#cb1892-2"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1892-3"><a href="ggplotvis.html#cb1892-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, </span>
<span id="cb1892-4"><a href="ggplotvis.html#cb1892-4"></a>       <span class="dt">y =</span> <span class="st">&quot;频数&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-funds01g-1.png" width="672" /></p>
<p>如果需要将频数替换成比例或者百分数，
只要修改输入数据增加相应的变量即可。</p>
</div>
<div id="ggplotvis-amount-bar-group" class="section level4">
<h4><span class="header-section-number">30.2.1.2</span> 并列和堆叠的条形图</h4>
<p>在某次对某物业公司服务的4个社区的居民的抽样调查中抽查了80位居民，
其性别与所属社区如下：</p>
<div class="sourceCode" id="cb1893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1893-1"><a href="ggplotvis.html#cb1893-1"></a>mat_comm &lt;-<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb1893-2"><a href="ggplotvis.html#cb1893-2"></a>  <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">4</span>,</span>
<span id="cb1893-3"><a href="ggplotvis.html#cb1893-3"></a>  <span class="dv">18</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">11</span>),</span>
<span id="cb1893-4"><a href="ggplotvis.html#cb1893-4"></a>  <span class="dt">nrow=</span><span class="dv">4</span>, <span class="dt">ncol=</span><span class="dv">2</span>,</span>
<span id="cb1893-5"><a href="ggplotvis.html#cb1893-5"></a>  <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;A社区&quot;</span>, <span class="st">&quot;B社区&quot;</span>, <span class="st">&quot;C社区&quot;</span>, <span class="st">&quot;D社区&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;男&quot;</span>, <span class="st">&quot;女&quot;</span>))</span>
<span id="cb1893-6"><a href="ggplotvis.html#cb1893-6"></a>)</span>
<span id="cb1893-7"><a href="ggplotvis.html#cb1893-7"></a>knitr<span class="op">::</span><span class="kw">kable</span>(mat_comm)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="center">男</th>
<th align="center">女</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A社区</td>
<td align="center">9</td>
<td align="center">18</td>
</tr>
<tr class="even">
<td>B社区</td>
<td align="center">10</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td>C社区</td>
<td align="center">13</td>
<td align="center">8</td>
</tr>
<tr class="even">
<td>D社区</td>
<td align="center">4</td>
<td align="center">11</td>
</tr>
</tbody>
</table>
<p>将表格数据转换为数据框：</p>
<div class="sourceCode" id="cb1894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1894-1"><a href="ggplotvis.html#cb1894-1"></a>d_comm &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">as.table</span>(mat_comm))</span>
<span id="cb1894-2"><a href="ggplotvis.html#cb1894-2"></a><span class="kw">names</span>(d_comm) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;社区&quot;</span>, <span class="st">&quot;性别&quot;</span>, <span class="st">&quot;频数&quot;</span>)</span>
<span id="cb1894-3"><a href="ggplotvis.html#cb1894-3"></a>knitr<span class="op">::</span><span class="kw">kable</span>(d_comm)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">社区</th>
<th align="left">性别</th>
<th align="center">频数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A社区</td>
<td align="left">男</td>
<td align="center">9</td>
</tr>
<tr class="even">
<td align="left">B社区</td>
<td align="left">男</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="left">C社区</td>
<td align="left">男</td>
<td align="center">13</td>
</tr>
<tr class="even">
<td align="left">D社区</td>
<td align="left">男</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="left">A社区</td>
<td align="left">女</td>
<td align="center">18</td>
</tr>
<tr class="even">
<td align="left">B社区</td>
<td align="left">女</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td align="left">C社区</td>
<td align="left">女</td>
<td align="center">8</td>
</tr>
<tr class="even">
<td align="left">D社区</td>
<td align="left">女</td>
<td align="center">11</td>
</tr>
</tbody>
</table>
<p>现在数据中有两个分类变量，
频数是交叉分类的结果，
这样的数据称为“列联表”。
这时，
将两个分类变量中一个作为大类，
映射到x维度，
另一个作为小类，
映射到fill维度，
频数映射到y维度。
使用<code>geom_col()</code>或者<code>geom_bar(stat = "identity")</code>。
如：</p>
<div class="sourceCode" id="cb1895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1895-1"><a href="ggplotvis.html#cb1895-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d_comm, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1895-2"><a href="ggplotvis.html#cb1895-2"></a>  <span class="dt">x =</span> <span class="st">`</span><span class="dt">性别</span><span class="st">`</span>, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">社区</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">频数</span><span class="st">`</span></span>
<span id="cb1895-3"><a href="ggplotvis.html#cb1895-3"></a>))</span>
<span id="cb1895-4"><a href="ggplotvis.html#cb1895-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-comm01b-1.png" width="672" /></p>
<p>结果为堆叠的条形图，
每个大类画一个分段的条形，
条形的程度等于各段长度之和。
这需要各段长度之和相当于每个大类的某种总计，
对于频数，这当然是合理的，
每段长度每个交叉小类的频数，
而一个条形的总长度是一个大类的频数。
当y轴映射到其它指标时堆叠条形图不一定合适，
比如，
如果y映射到每个交叉小类的某个指标的标准差，
因为标准差的和并不是标准差，
所以就不能用堆叠条形图表示。</p>
<p>下面将社区作为大类，性别作为小类：</p>
<div class="sourceCode" id="cb1896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1896-1"><a href="ggplotvis.html#cb1896-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d_comm, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1896-2"><a href="ggplotvis.html#cb1896-2"></a>  <span class="dt">x =</span> <span class="st">`</span><span class="dt">社区</span><span class="st">`</span>, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">性别</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">频数</span><span class="st">`</span></span>
<span id="cb1896-3"><a href="ggplotvis.html#cb1896-3"></a>))</span>
<span id="cb1896-4"><a href="ggplotvis.html#cb1896-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-comm01c-1.png" width="672" /></p>
<p>在<code>geom_col()</code>和<code>geom_bar()</code>中加选项<code>position = "dodge"</code>可以将小类并列放置：</p>
<div class="sourceCode" id="cb1897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1897-1"><a href="ggplotvis.html#cb1897-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d_comm, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1897-2"><a href="ggplotvis.html#cb1897-2"></a>  <span class="dt">x =</span> <span class="st">`</span><span class="dt">性别</span><span class="st">`</span>, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">社区</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">频数</span><span class="st">`</span></span>
<span id="cb1897-3"><a href="ggplotvis.html#cb1897-3"></a>))</span>
<span id="cb1897-4"><a href="ggplotvis.html#cb1897-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-comm01d-1.png" width="672" /></p>
<p>这样得到并列的条形图。
并列条形图就不需要像堆叠条形图那样要求各个小类的y轴变量和有意义。
堆叠条形图相当于在<code>geom_col()</code>中加<code>position = "stack"</code>。</p>
<p>也可以将不同的大类放置到不同的小图，
用<code>facet_wrap()</code>或者<code>facet_grid()</code>函数：</p>
<div class="sourceCode" id="cb1898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1898-1"><a href="ggplotvis.html#cb1898-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d_comm, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1898-2"><a href="ggplotvis.html#cb1898-2"></a>  <span class="dt">x =</span> <span class="st">`</span><span class="dt">社区</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">频数</span><span class="st">`</span></span>
<span id="cb1898-3"><a href="ggplotvis.html#cb1898-3"></a>))</span>
<span id="cb1898-4"><a href="ggplotvis.html#cb1898-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1898-5"><a href="ggplotvis.html#cb1898-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> `</span><span class="dt">性别</span><span class="st">`</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-comm01e-1.png" width="672" /></p>
<p>注意各小图默认使用相同的坐标范围。</p>
</div>
<div id="ggplotvis-amount-bar-pct" class="section level4">
<h4><span class="header-section-number">30.2.1.3</span> 百分数的条形图</h4>
<p>对于只有一个分类变量的条形图，
如果y轴代表频数，
为了转换成比例或者百分比，
修改输入数据增加像相应的变量，
如：</p>
<div class="sourceCode" id="cb1899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1899-1"><a href="ggplotvis.html#cb1899-1"></a>d_funds_type <span class="op">%&gt;%</span></span>
<span id="cb1899-2"><a href="ggplotvis.html#cb1899-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ratio =</span> freq <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(freq),</span>
<span id="cb1899-3"><a href="ggplotvis.html#cb1899-3"></a>         <span class="dt">pct =</span> <span class="dv">100</span><span class="op">*</span>ratio) -&gt;<span class="st"> </span>d</span></code></pre></div>
<p>对于有两个分类变量的列联表，
如果希望y轴表现总百分数，
只要修改输入数据集增加相应的变量。
如果y轴希望表现每个大类内的百分数，
首先增加大类内的百分数，
比如下面的程序将社区居民调查数据按社区分为大类，
每个社区内计算不同性别的百分数：</p>
<div class="sourceCode" id="cb1900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1900-1"><a href="ggplotvis.html#cb1900-1"></a>d_comm <span class="op">%&gt;%</span></span>
<span id="cb1900-2"><a href="ggplotvis.html#cb1900-2"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">社区</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="cb1900-3"><a href="ggplotvis.html#cb1900-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">百分数</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">频数</span><span class="st">`</span> <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(<span class="st">`</span><span class="dt">频数</span><span class="st">`</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb1900-4"><a href="ggplotvis.html#cb1900-4"></a><span class="st">  </span><span class="kw">ungroup</span>() -&gt;<span class="st"> </span>d</span></code></pre></div>
<p>这样，与对频数作图类似就可以做堆叠条形图，
每个社区为一个大类，
每个大类总计100%：</p>
<div class="sourceCode" id="cb1901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1901-1"><a href="ggplotvis.html#cb1901-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1901-2"><a href="ggplotvis.html#cb1901-2"></a>  <span class="dt">x =</span> <span class="st">`</span><span class="dt">社区</span><span class="st">`</span>, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">性别</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">百分数</span><span class="st">`</span></span>
<span id="cb1901-3"><a href="ggplotvis.html#cb1901-3"></a>))</span>
<span id="cb1901-4"><a href="ggplotvis.html#cb1901-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-comm02b-1.png" width="672" /></p>
<p>在<code>geom_col()</code>中加<code>position = "dodge"</code>可以变成并列条形图，
每个社区为一个大类，
每个大类中总计100%：</p>
<div class="sourceCode" id="cb1902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1902-1"><a href="ggplotvis.html#cb1902-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1902-2"><a href="ggplotvis.html#cb1902-2"></a>  <span class="dt">x =</span> <span class="st">`</span><span class="dt">社区</span><span class="st">`</span>, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">性别</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">百分数</span><span class="st">`</span></span>
<span id="cb1902-3"><a href="ggplotvis.html#cb1902-3"></a>))</span>
<span id="cb1902-4"><a href="ggplotvis.html#cb1902-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-comm02c-1.png" width="672" /></p>
<p>与前一章<a href="ggplot2.html#ggplot2-right-morebar">29.5.1</a>中类似问题相比，
对表格数据做比例或者百分数条形图，
比基于原始数据直接用<code>geom_bar()</code>做图要简单而且不易出错。</p>
</div>
<div id="ggplotvis-amount-bar-digit" class="section level4">
<h4><span class="header-section-number">30.2.1.4</span> 直接标记数字的条形图</h4>
<p>比较简单的条形图，
可以不使用y坐标轴而是对每个条形或者堆叠的每个段标出数字。
用<code>geom_text()</code>函数标数字。
如：</p>
<div class="sourceCode" id="cb1903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1903-1"><a href="ggplotvis.html#cb1903-1"></a>d &lt;-<span class="st"> </span>d_funds_type <span class="op">%&gt;%</span></span>
<span id="cb1903-2"><a href="ggplotvis.html#cb1903-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">fct_relevel</span>(type, <span class="st">&quot;国内股本&quot;</span>, <span class="st">&quot;国际股本&quot;</span>, <span class="st">&quot;固定收益&quot;</span>))</span>
<span id="cb1903-3"><a href="ggplotvis.html#cb1903-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1903-4"><a href="ggplotvis.html#cb1903-4"></a>  <span class="dt">x =</span> type, <span class="dt">y =</span> freq ))</span>
<span id="cb1903-5"><a href="ggplotvis.html#cb1903-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span></span>
<span id="cb1903-6"><a href="ggplotvis.html#cb1903-6"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1903-7"><a href="ggplotvis.html#cb1903-7"></a>    <span class="dt">y =</span> freq <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">label =</span> <span class="kw">paste</span>(freq))) <span class="op">+</span></span>
<span id="cb1903-8"><a href="ggplotvis.html#cb1903-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1903-9"><a href="ggplotvis.html#cb1903-9"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1903-10"><a href="ggplotvis.html#cb1903-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, </span>
<span id="cb1903-11"><a href="ggplotvis.html#cb1903-11"></a>       <span class="dt">y =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-funds01g1-1.png" width="672" /></p>
<p>上述程序中，
用了<code>scale_y_continuous()</code>的<code>breaks = NULL</code>选项使得y轴（经过对换后画在了x轴）不画刻度和刻度值。</p>
<p>堆叠的条形图用数字而非坐标轴的例子如下：</p>
<div class="sourceCode" id="cb1904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1904-1"><a href="ggplotvis.html#cb1904-1"></a>d_comm <span class="op">%&gt;%</span></span>
<span id="cb1904-2"><a href="ggplotvis.html#cb1904-2"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="st">`</span><span class="dt">性别</span><span class="st">`</span>, <span class="kw">desc</span>(<span class="st">`</span><span class="dt">社区</span><span class="st">`</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1904-3"><a href="ggplotvis.html#cb1904-3"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">性别</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="cb1904-4"><a href="ggplotvis.html#cb1904-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ylabel =</span> <span class="kw">cumsum</span>(<span class="st">`</span><span class="dt">频数</span><span class="st">`</span>) <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span><span class="op">*</span><span class="st">`</span><span class="dt">频数</span><span class="st">`</span>) -&gt;<span class="st"> </span>d</span>
<span id="cb1904-5"><a href="ggplotvis.html#cb1904-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1904-6"><a href="ggplotvis.html#cb1904-6"></a>  <span class="dt">x =</span> <span class="st">`</span><span class="dt">性别</span><span class="st">`</span>, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">社区</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">频数</span><span class="st">`</span></span>
<span id="cb1904-7"><a href="ggplotvis.html#cb1904-7"></a>))</span>
<span id="cb1904-8"><a href="ggplotvis.html#cb1904-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1904-9"><a href="ggplotvis.html#cb1904-9"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1904-10"><a href="ggplotvis.html#cb1904-10"></a>    <span class="dt">y =</span> ylabel, <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">`</span><span class="dt">频数</span><span class="st">`</span>)  )) <span class="op">+</span></span>
<span id="cb1904-11"><a href="ggplotvis.html#cb1904-11"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1904-12"><a href="ggplotvis.html#cb1904-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-am-bar-comm01b1-1.png" width="672" /></p>
<p>上述程序中预先计算了每段的纵坐标值，
保存在变量<code>ylabel</code>中。
注意计算过程中的排序与分组操作。</p>
</div>
</div>
<div id="ggplotvis-amount-point" class="section level3">
<h3><span class="header-section-number">30.2.2</span> 点图</h3>
<p>条形图的y轴一般都代表数量，
最小值从0开始，
一般不画y轴最小值大于0的条形图。</p>
<p>对于不会取0的量，
可以取y轴的范围为某个区间而不必总是从0开始。
这时，
可以用散点位置表示y坐标。</p>
<p>考虑gapminder包的gapminder数据集中各国的平均期望寿命，
先求出每个大洲的期望寿命最大值：</p>
<div class="sourceCode" id="cb1905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1905-1"><a href="ggplotvis.html#cb1905-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb1905-2"><a href="ggplotvis.html#cb1905-2"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1905-3"><a href="ggplotvis.html#cb1905-3"></a><span class="st">  </span><span class="kw">select</span>(continent, country, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb1905-4"><a href="ggplotvis.html#cb1905-4"></a><span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span></span>
<span id="cb1905-5"><a href="ggplotvis.html#cb1905-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">lifeExp =</span> <span class="kw">max</span>(lifeExp, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1905-6"><a href="ggplotvis.html#cb1905-6"></a><span class="st">  </span><span class="kw">ungroup</span>() -&gt;<span class="st"> </span>d_gap</span></code></pre></div>
<p>用点图表现各大洲的期望寿命：</p>
<div class="sourceCode" id="cb1906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1906-1"><a href="ggplotvis.html#cb1906-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d_gap, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1906-2"><a href="ggplotvis.html#cb1906-2"></a>  <span class="dt">x =</span> <span class="kw">fct_reorder</span>(continent, lifeExp), <span class="dt">y =</span> lifeExp ))</span>
<span id="cb1906-3"><a href="ggplotvis.html#cb1906-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1906-4"><a href="ggplotvis.html#cb1906-4"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-point-gap01b-1.png" width="672" /></p>
<p>程序中并没有人为指定lifeExp轴的坐标范围，
作图程序自动选择了合适的范围。
对各大洲按照lifeExp的值做了排序。
这个图形很好地体现了不同大洲的最大期望寿命的差距。
如果使用条形图，
因为坐标轴从0开始，
各个条形的长度会很接近，
不利于体现差距：</p>
<div class="sourceCode" id="cb1907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1907-1"><a href="ggplotvis.html#cb1907-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1907-2"><a href="ggplotvis.html#cb1907-2"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-point-gap01c-1.png" width="672" /></p>
</div>
<div id="ggplotvis-amount-heatmap" class="section level3">
<h3><span class="header-section-number">30.2.3</span> 热力图</h3>
<p>如果交叉分类得到许多个交叉组，
每组有一个数量需要展示，
用堆叠或者并排条形图可能过于复杂，
结果很难判读；
如果用点图，
不同小类之间的区别也不容易认读。</p>
<p>可以用x轴和y轴分别表示两种分类，
在坐标交叉处用色块颜色代表数量，
称为热力图。
用<code>geom_tile()</code>作这种图，
将数量映射到fill维度。</p>
<p>例如，
考虑gapminder包的gapminder数据集中各国的平均期望寿命，
先得到每个大洲每年内各国期望寿命的中位数：</p>
<div class="sourceCode" id="cb1908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1908-1"><a href="ggplotvis.html#cb1908-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1908-2"><a href="ggplotvis.html#cb1908-2"></a><span class="st">  </span><span class="kw">select</span>(continent, year, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb1908-3"><a href="ggplotvis.html#cb1908-3"></a><span class="st">  </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span></span>
<span id="cb1908-4"><a href="ggplotvis.html#cb1908-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">lifeExp =</span> <span class="kw">median</span>(lifeExp, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1908-5"><a href="ggplotvis.html#cb1908-5"></a><span class="st">  </span><span class="kw">ungroup</span>() -&gt;<span class="st"> </span>d_gap2a</span>
<span id="cb1908-6"><a href="ggplotvis.html#cb1908-6"></a>d_gap2a <span class="op">%&gt;%</span></span>
<span id="cb1908-7"><a href="ggplotvis.html#cb1908-7"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span></span>
<span id="cb1908-8"><a href="ggplotvis.html#cb1908-8"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lifeExp)) -&gt;<span class="st"> </span>d_gap2b</span>
<span id="cb1908-9"><a href="ggplotvis.html#cb1908-9"></a>d_gap2a <span class="op">%&gt;%</span></span>
<span id="cb1908-10"><a href="ggplotvis.html#cb1908-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">continent =</span> <span class="kw">factor</span>(continent, <span class="dt">levels =</span> d_gap2b<span class="op">$</span>continent)) -&gt;<span class="st"> </span>d_gap2</span></code></pre></div>
<p>上面的程序中将各大洲的次序调整为最后一年的中位期望寿命。
作热力图：</p>
<div class="sourceCode" id="cb1909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1909-1"><a href="ggplotvis.html#cb1909-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d_gap2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1909-2"><a href="ggplotvis.html#cb1909-2"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> continent, <span class="dt">fill =</span> lifeExp))</span>
<span id="cb1909-3"><a href="ggplotvis.html#cb1909-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>() <span class="op">+</span></span>
<span id="cb1909-4"><a href="ggplotvis.html#cb1909-4"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-am-point-gap02b-1.png" width="672" /></p>
<p>函数<code>scale_fill_viridis_c()</code>提供了连续变量到颜色的一种映射，
在黑白显示时仍适用，且使用色盲的读者。</p>
<p>热力图中不易读出每个交叉组的数量的具体数值，
但是比较容易进行组间比较以及展示发展趋势。</p>
</div>
</div>
<div id="ggplotvis-dist" class="section level2">
<h2><span class="header-section-number">30.3</span> 表现分布</h2>
<p>对于离散变量，
可以用频数、比例、百分数的条形图表现单个离散变量分布，
可以用热力图表现两个离散变量的分布。</p>
<p>对于连续型变量，
可以用直方图、密度估计图表现单个变量分布，
可以对多个变量同时做密度估计图。
可以用正态QQ图、盒形图、经验分布函数图等表现一元分布。</p>
<div id="ggplotvis-dist-suni-hist" class="section level3">
<h3><span class="header-section-number">30.3.1</span> 单个一元分布的直方图与密度估计图</h3>
<p>直方图是最常用的表现一元连续变量分布的方法。
<code>geom_histogram()</code>作直方图，
可以自动选取合适的分组个数，
也可以人为指定分组个数。
直方图的结果受分组个数与分组的开始位置的影响较大，
所以使用直方图时应该尝试选用不同的分组数，
选择较适当的分组个数。</p>
<p>ggplot2包中的<code>midwest</code>数据集包含了美国中西部的一些县的统计数据，
如面积（单位：平方英里）。
下面的程序对连续取值的数值型变量area作频数直方图，
自动确定分组个数：</p>
<div class="sourceCode" id="cb1910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1910-1"><a href="ggplotvis.html#cb1910-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1910-2"><a href="ggplotvis.html#cb1910-2"></a>  <span class="dt">x =</span> area))</span>
<span id="cb1910-3"><a href="ggplotvis.html#cb1910-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-hist-midwest01-1.png" width="672" /></p>
<p>不像R基本绘图的<code>hist()</code>函数，
<code>geom_histogram()</code>默认使用30个分组，
而不是根据样本量大小决定分组，
所以一般应该自己指定分组数或者分组宽度。
在<code>geom_histogram()</code>中用<code>bins =</code>指定分组个数，
或者用<code>width</code>指定分组宽度，如：</p>
<div class="sourceCode" id="cb1912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1912-1"><a href="ggplotvis.html#cb1912-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-hist-midwest01b-1.png" width="672" /></p>
<p>可以用<code>boundary</code>或者<code>center</code>指定某一个条形的边界或者中心，
用<code>breaks</code>指定所有分点位置。
如</p>
<div class="sourceCode" id="cb1913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1913-1"><a href="ggplotvis.html#cb1913-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">boundary =</span> <span class="fl">0.0025</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-hist-midwest01c-1.png" width="672" /></p>
<p>可以将直方图画成连线形式，用<code>geom_freqpoly()</code>函数，如上图可以改为：</p>
<div class="sourceCode" id="cb1914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1914-1"><a href="ggplotvis.html#cb1914-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">bins =</span> <span class="dv">15</span>, <span class="dt">boundary =</span> <span class="fl">0.0025</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-hist-midwest01c1-1.png" width="672" /></p>
<p>上图虽然是连线形式，但本质上还是一个阶梯函数的不同画法。
<code>geom_density()</code>可以对连续变量先做核密度估计，
然后绘制密度估计曲线，如：</p>
<div class="sourceCode" id="cb1915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1915-1"><a href="ggplotvis.html#cb1915-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di-hist-midwest01d-1.png" width="672" /></p>
<p>密度曲线估计受到窗宽<code>bw</code>与核函数<code>kernel</code>的影响。
默认核函数为高斯核（标准正态分布密度作为核函数）。</p>
<p>除了估计曲线，
还可以用涂色区域表示密度估计，
用<code>geom_area(stat = "density")</code>函数：</p>
<div class="sourceCode" id="cb1916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1916-1"><a href="ggplotvis.html#cb1916-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_area</span>(<span class="dt">stat =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;cadetblue1&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-hist-midwest01e-1.png" width="672" /></p>
<p>因为核密度估计一般是连续曲线，
所以估计的曲线很可能在密度为零的地方估计为正数。
ggplot2在设计时已经考虑了避免这个问题，
但是用户自己用R的<code>density()</code>函数作核密度估计时还有这个问题。</p>
<p>可以将直方图与密度估计图合并在一起，
这时直方图的纵坐标需指定为密度估计，
这样两种图的纵坐标才处于相同的范围：</p>
<div class="sourceCode" id="cb1917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1917-1"><a href="ggplotvis.html#cb1917-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">stat</span>(density))) <span class="op">+</span></span>
<span id="cb1917-2"><a href="ggplotvis.html#cb1917-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-hist-midwest01f-1.png" width="672" /></p>
</div>
<div id="ggplotvis-dist-muni" class="section level3">
<h3><span class="header-section-number">30.3.2</span> 多个一元分布的直方图和密度图形</h3>
<p>考虑ggplot2包的midwest数据集，
这是美国中西部若干个县的数据。
选取其中的IL和IN两个州的数据，
只要将州名映射为<code>fill</code>维，
就可以在<code>geom_histogram()</code>或者<code>geom_line(stat = "density")</code>对各县面积作直方图时按不同州分段显示：</p>
<div class="sourceCode" id="cb1919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1919-1"><a href="ggplotvis.html#cb1919-1"></a>midwest <span class="op">%&gt;%</span></span>
<span id="cb1919-2"><a href="ggplotvis.html#cb1919-2"></a><span class="st">  </span><span class="kw">filter</span>(state <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;IL&quot;</span>, <span class="st">&quot;IN&quot;</span>)) -&gt;<span class="st"> </span>d</span>
<span id="cb1919-3"><a href="ggplotvis.html#cb1919-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1919-4"><a href="ggplotvis.html#cb1919-4"></a>  <span class="dt">x =</span> area, <span class="dt">fill =</span> state))</span>
<span id="cb1919-5"><a href="ggplotvis.html#cb1919-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-muni-midwest01-1.png" width="672" /></p>
<p>可以看出，
IN州的县面积偏小，
IL州的县面积较大。
这样的条形分段的直方图的缺点是，
下面的段的直方图形状是清楚的，
但是上面一段（上图中为IL州）的直方图则看不出形状。</p>
<p>如果将数据中所有的5个州都包含并在直方图中分段，
图形就变得更难认读：</p>
<div class="sourceCode" id="cb1921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1921-1"><a href="ggplotvis.html#cb1921-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1921-2"><a href="ggplotvis.html#cb1921-2"></a>  <span class="dt">x =</span> area))</span>
<span id="cb1921-3"><a href="ggplotvis.html#cb1921-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> state))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-muni-midwest02-1.png" width="672" /></p>
<p>可以用折线方式画直方图，
不同州用不同颜色：</p>
<div class="sourceCode" id="cb1923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1923-1"><a href="ggplotvis.html#cb1923-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> state))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-muni-midwest02b-1.png" width="672" /></p>
<p>可以将州映射到<code>fill</code>，
给<code>geom_histogram()</code>加<code>position = "fill"</code>选项：</p>
<div class="sourceCode" id="cb1925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1925-1"><a href="ggplotvis.html#cb1925-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(</span>
<span id="cb1925-2"><a href="ggplotvis.html#cb1925-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> state),</span>
<span id="cb1925-3"><a href="ggplotvis.html#cb1925-3"></a>  <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>,</span>
<span id="cb1925-4"><a href="ggplotvis.html#cb1925-4"></a>  <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-muni-midwest02c-1.png" width="672" /></p>
<p>上图的每个条形长度都拉平了，
显示的是按area分组后每组内不同州的比例大小。</p>
<p>可以将不同的州分配到不同的小图，如：</p>
<div class="sourceCode" id="cb1927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1927-1"><a href="ggplotvis.html#cb1927-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1927-2"><a href="ggplotvis.html#cb1927-2"></a>  <span class="dt">x =</span> area))</span>
<span id="cb1927-3"><a href="ggplotvis.html#cb1927-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>() <span class="op">+</span></span>
<span id="cb1927-4"><a href="ggplotvis.html#cb1927-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>state)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-muni-midwest03-1.png" width="672" /></p>
<p>为了表现多个组的分布，
也可以将各组的具体数据用散点画出，
并添加随机扰动使其不重叠：</p>
<div class="sourceCode" id="cb1929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1929-1"><a href="ggplotvis.html#cb1929-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1929-2"><a href="ggplotvis.html#cb1929-2"></a>  <span class="dt">x =</span> area, <span class="dt">y =</span> state))</span>
<span id="cb1929-3"><a href="ggplotvis.html#cb1929-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="dv">0</span>, <span class="dt">height =</span> <span class="fl">0.3</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-muni-midwest04-1.png" width="672" /></p>
<p>对每个州作密度估计并将多条密度曲线画在同一坐标系可以较好地反映不同州的县面积分布：</p>
<div class="sourceCode" id="cb1930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1930-1"><a href="ggplotvis.html#cb1930-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1930-2"><a href="ggplotvis.html#cb1930-2"></a>  <span class="dt">x =</span> area, <span class="dt">color =</span> state))</span>
<span id="cb1930-3"><a href="ggplotvis.html#cb1930-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&quot;density&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-muni-midwest05-1.png" width="672" /></p>
<p>增加涂色，用透明度<code>alpha</code>使其可以重叠显示：</p>
<div class="sourceCode" id="cb1931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1931-1"><a href="ggplotvis.html#cb1931-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1931-2"><a href="ggplotvis.html#cb1931-2"></a>  <span class="dt">x =</span> area, <span class="dt">color =</span> state, <span class="dt">fill =</span> state))</span>
<span id="cb1931-3"><a href="ggplotvis.html#cb1931-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-muni-midwest06-1.png" width="672" /></p>
<p>可以利用<code>geom_text()</code>或者<code>geom_text_repl()</code>将各曲线的标签标在曲线附近，
就可以取消图例显示。</p>
</div>
<div id="ggplotvis-dist-cdf" class="section level3">
<h3><span class="header-section-number">30.3.3</span> 经验分布函数图</h3>
<p>直方图和密度估计图能够比较直观地了解数据的分布情况，
但是会受到窗宽、分组位置的影响，
所以可以看成是对数据的某种建模结果。
可以将所有数据观测值画出来，
用适当的透明度可以表现点的稠密程度，
但是当数据量特别大的时候这种方法就不合适，
而且对数据的概括性描述总是必要的。
经验分布函数图很好地描述和概括了数据的分布，
从中可以很容易得到样本分位数的估计，
而且不会受到任何参数选择影响。
一组观测值<span class="math inline">\(X_1, X_2, \dots, X_n\)</span>的经验分布函数定义为
<span class="math display">\[
F_n(x) = \frac{\#\{X_i: X_i \leq x \}}{n}
= \frac{1}{n} \sum_{i=1}^n I_{(-\infty, x]}(x)
\]</span>
其中<span class="math inline">\(\#\{\dots\}\)</span>表示集合元素计数，
<span class="math inline">\(I_A(x)\)</span>是集合<span class="math inline">\(A\)</span>的示性函数，
当<span class="math inline">\(x \in A\)</span>是取1，否则取0。</p>
<p>设有如下的10位学生的成绩：</p>
<div class="sourceCode" id="cb1932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1932-1"><a href="ggplotvis.html#cb1932-1"></a>scores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">63</span>, <span class="dv">72</span>, <span class="dv">74</span>, <span class="dv">79</span>, <span class="dv">82</span>, <span class="dv">82</span>, <span class="dv">87</span>, <span class="dv">89</span>, <span class="dv">90</span>, <span class="dv">90</span>)</span>
<span id="cb1932-2"><a href="ggplotvis.html#cb1932-2"></a>scores</span></code></pre></div>
<pre><code>##  [1] 63 72 74 79 82 82 87 89 90 90</code></pre>
<p>可以制作如下的经验分布函数表格：</p>
<div class="sourceCode" id="cb1934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1934-1"><a href="ggplotvis.html#cb1934-1"></a>cdf_table &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb1934-2"><a href="ggplotvis.html#cb1934-2"></a>  x &lt;-<span class="st"> </span><span class="kw">sort</span>(x)</span>
<span id="cb1934-3"><a href="ggplotvis.html#cb1934-3"></a>  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb1934-4"><a href="ggplotvis.html#cb1934-4"></a>  tab &lt;-<span class="st"> </span><span class="kw">unname</span>(<span class="kw">c</span>(<span class="kw">table</span>(x)))</span>
<span id="cb1934-5"><a href="ggplotvis.html#cb1934-5"></a>  pct =<span class="st"> </span>tab <span class="op">/</span><span class="st"> </span>n</span>
<span id="cb1934-6"><a href="ggplotvis.html#cb1934-6"></a>  d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1934-7"><a href="ggplotvis.html#cb1934-7"></a>    <span class="dt">x =</span> <span class="kw">sort</span>(<span class="kw">unique</span>(x)), </span>
<span id="cb1934-8"><a href="ggplotvis.html#cb1934-8"></a>    <span class="dt">freq =</span> tab,</span>
<span id="cb1934-9"><a href="ggplotvis.html#cb1934-9"></a>    <span class="dt">pct =</span> pct,</span>
<span id="cb1934-10"><a href="ggplotvis.html#cb1934-10"></a>    <span class="dt">cumfreq =</span> <span class="kw">cumsum</span>(tab),</span>
<span id="cb1934-11"><a href="ggplotvis.html#cb1934-11"></a>    <span class="dt">cumpct =</span> <span class="kw">cumsum</span>(pct))</span>
<span id="cb1934-12"><a href="ggplotvis.html#cb1934-12"></a>  d</span>
<span id="cb1934-13"><a href="ggplotvis.html#cb1934-13"></a>}</span>
<span id="cb1934-14"><a href="ggplotvis.html#cb1934-14"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">cdf_table</span>(scores))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
<th align="right">freq</th>
<th align="right">pct</th>
<th align="right">cumfreq</th>
<th align="right">cumpct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">63</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">1</td>
<td align="right">0.1</td>
</tr>
<tr class="even">
<td align="right">72</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">2</td>
<td align="right">0.2</td>
</tr>
<tr class="odd">
<td align="right">74</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">3</td>
<td align="right">0.3</td>
</tr>
<tr class="even">
<td align="right">79</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">4</td>
<td align="right">0.4</td>
</tr>
<tr class="odd">
<td align="right">82</td>
<td align="right">2</td>
<td align="right">0.2</td>
<td align="right">6</td>
<td align="right">0.6</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">7</td>
<td align="right">0.7</td>
</tr>
<tr class="odd">
<td align="right">89</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">8</td>
<td align="right">0.8</td>
</tr>
<tr class="even">
<td align="right">90</td>
<td align="right">2</td>
<td align="right">0.2</td>
<td align="right">10</td>
<td align="right">1.0</td>
</tr>
</tbody>
</table>
<p>作经验分布函数(ECDF)图如下：</p>
<div class="sourceCode" id="cb1935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1935-1"><a href="ggplotvis.html#cb1935-1"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1935-2"><a href="ggplotvis.html#cb1935-2"></a>  <span class="dt">scores =</span> <span class="kw">c</span>(<span class="dv">63</span>, <span class="dv">72</span>, <span class="dv">74</span>, <span class="dv">79</span>, <span class="dv">82</span>, <span class="dv">82</span>, <span class="dv">87</span>, <span class="dv">89</span>, <span class="dv">90</span>, <span class="dv">90</span>))</span>
<span id="cb1935-3"><a href="ggplotvis.html#cb1935-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1935-4"><a href="ggplotvis.html#cb1935-4"></a>  <span class="dt">x =</span> scores, <span class="dt">y =</span> ..y.. ))</span>
<span id="cb1935-5"><a href="ggplotvis.html#cb1935-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_ecdf</span>(<span class="dt">geom =</span> <span class="st">&quot;step&quot;</span>) <span class="op">+</span></span>
<span id="cb1935-6"><a href="ggplotvis.html#cb1935-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb1935-7"><a href="ggplotvis.html#cb1935-7"></a>    <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">01</span>, <span class="fl">1.01</span>), </span>
<span id="cb1935-8"><a href="ggplotvis.html#cb1935-8"></a>    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb1935-9"><a href="ggplotvis.html#cb1935-9"></a>    <span class="dt">name =</span> <span class="st">&quot;累计百分比&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-score-ecdf01-1.png" width="672" /></p>
<p>从上图中，
可以看出80分及以下的人数40%左右，
最高分的25%学生分数至少为88分。
当然，
准确的数字还需要查看上面的频数分布表。</p>
<p>作经验分布函数图，
用了<code>stat_ecdf()</code>统计函数，
其中指定<code>geom="step"</code>选项，
并将y轴映射为统计函数的结果<code>..y..</code>。
如果已经有经验分布函数，
则可以直接做阶梯函数图：</p>
<div class="sourceCode" id="cb1936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1936-1"><a href="ggplotvis.html#cb1936-1"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1936-2"><a href="ggplotvis.html#cb1936-2"></a>  <span class="dt">scores =</span> <span class="kw">c</span>(<span class="dv">63</span>, <span class="dv">72</span>, <span class="dv">74</span>, <span class="dv">79</span>, <span class="dv">82</span>, <span class="dv">82</span>, <span class="dv">87</span>, <span class="dv">89</span>, <span class="dv">90</span>, <span class="dv">90</span>))</span>
<span id="cb1936-3"><a href="ggplotvis.html#cb1936-3"></a>dfreq &lt;-<span class="st"> </span><span class="kw">cdf_table</span>(d<span class="op">$</span>scores)</span>
<span id="cb1936-4"><a href="ggplotvis.html#cb1936-4"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dfreq, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1936-5"><a href="ggplotvis.html#cb1936-5"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> cumpct ))</span>
<span id="cb1936-6"><a href="ggplotvis.html#cb1936-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_ecdf</span>(<span class="dt">geom =</span> <span class="st">&quot;step&quot;</span>) <span class="op">+</span></span>
<span id="cb1936-7"><a href="ggplotvis.html#cb1936-7"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb1936-8"><a href="ggplotvis.html#cb1936-8"></a>    <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">01</span>, <span class="fl">1.01</span>), </span>
<span id="cb1936-9"><a href="ggplotvis.html#cb1936-9"></a>    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb1936-10"><a href="ggplotvis.html#cb1936-10"></a>    <span class="dt">name =</span> <span class="st">&quot;累计百分比&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-score-ecdf02-1.png" width="672" /></p>
<p>现实中有许多数据的分布呈现严重的偏态，
即有比较多的值偏离数据的中心。
比如，
全国各省的人口数、居民收入，
全世界各国的GDP，
等等。</p>
<p>下面是全国31个省（不含港澳台）2017年的人口（单位：万人）、居民年均可支配收入（单位：千元）数据，来自统计年鉴：</p>
<div class="sourceCode" id="cb1937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1937-1"><a href="ggplotvis.html#cb1937-1"></a>dpop &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1937-2"><a href="ggplotvis.html#cb1937-2"></a>  <span class="dt">province =</span><span class="kw">c</span>(</span>
<span id="cb1937-3"><a href="ggplotvis.html#cb1937-3"></a>    <span class="st">&quot;北京&quot;</span>, <span class="st">&quot;天津&quot;</span>, <span class="st">&quot;河北&quot;</span>, <span class="st">&quot;山西&quot;</span>, <span class="st">&quot;内蒙古&quot;</span>, <span class="st">&quot;辽宁&quot;</span>, <span class="st">&quot;吉林&quot;</span>, <span class="st">&quot;黑龙江&quot;</span>, </span>
<span id="cb1937-4"><a href="ggplotvis.html#cb1937-4"></a><span class="st">&quot;上海&quot;</span>, <span class="st">&quot;江苏&quot;</span>, <span class="st">&quot;浙江&quot;</span>, <span class="st">&quot;安徽&quot;</span>, <span class="st">&quot;福建&quot;</span>, <span class="st">&quot;江西&quot;</span>, <span class="st">&quot;山东&quot;</span>, <span class="st">&quot;河南&quot;</span>, </span>
<span id="cb1937-5"><a href="ggplotvis.html#cb1937-5"></a><span class="st">&quot;湖北&quot;</span>, <span class="st">&quot;湖南&quot;</span>, <span class="st">&quot;广东&quot;</span>, <span class="st">&quot;广西&quot;</span>, <span class="st">&quot;海南&quot;</span>, <span class="st">&quot;重庆&quot;</span>, <span class="st">&quot;四川&quot;</span>, <span class="st">&quot;贵州&quot;</span>, </span>
<span id="cb1937-6"><a href="ggplotvis.html#cb1937-6"></a><span class="st">&quot;云南&quot;</span>, <span class="st">&quot;西藏&quot;</span>, <span class="st">&quot;陕西&quot;</span>, <span class="st">&quot;甘肃&quot;</span>, <span class="st">&quot;青海&quot;</span>, <span class="st">&quot;宁夏&quot;</span>, <span class="st">&quot;新疆&quot;</span>),</span>
<span id="cb1937-7"><a href="ggplotvis.html#cb1937-7"></a>  <span class="dt">pop =</span> <span class="kw">c</span>(</span>
<span id="cb1937-8"><a href="ggplotvis.html#cb1937-8"></a>    2171L, 1557L, 7520L, 3702L, 2529L, 4369L, 2717L, 3789L, 2418L, </span>
<span id="cb1937-9"><a href="ggplotvis.html#cb1937-9"></a>8029L, 5657L, 6255L, 3911L, 4622L, 10006L, 9559L, 5902L, 6860L, </span>
<span id="cb1937-10"><a href="ggplotvis.html#cb1937-10"></a>11169L, 4885L, 926L, 3075L, 8302L, 3580L, 4801L, 337L, 3835L, </span>
<span id="cb1937-11"><a href="ggplotvis.html#cb1937-11"></a>2626L, 598L, 682L, 2445L),</span>
<span id="cb1937-12"><a href="ggplotvis.html#cb1937-12"></a>  <span class="dt">inc =</span> <span class="kw">c</span>(57L, 37L, 21L, 20L, 26L, 28L, 21L, 21L, 59L, 35L, 42L, 22L, </span>
<span id="cb1937-13"><a href="ggplotvis.html#cb1937-13"></a>30L, 22L, 27L, 20L, 24L, 23L, 33L, 20L, 23L, 24L, 20L, 17L, 18L, </span>
<span id="cb1937-14"><a href="ggplotvis.html#cb1937-14"></a>15L, 20L, 16L, 19L, 21L, 20L))</span>
<span id="cb1937-15"><a href="ggplotvis.html#cb1937-15"></a>knitr<span class="op">::</span><span class="kw">kable</span>(dpop)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">province</th>
<th align="right">pop</th>
<th align="right">inc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">北京</td>
<td align="right">2171</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="left">天津</td>
<td align="right">1557</td>
<td align="right">37</td>
</tr>
<tr class="odd">
<td align="left">河北</td>
<td align="right">7520</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">山西</td>
<td align="right">3702</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">内蒙古</td>
<td align="right">2529</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">辽宁</td>
<td align="right">4369</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">吉林</td>
<td align="right">2717</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">黑龙江</td>
<td align="right">3789</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">上海</td>
<td align="right">2418</td>
<td align="right">59</td>
</tr>
<tr class="even">
<td align="left">江苏</td>
<td align="right">8029</td>
<td align="right">35</td>
</tr>
<tr class="odd">
<td align="left">浙江</td>
<td align="right">5657</td>
<td align="right">42</td>
</tr>
<tr class="even">
<td align="left">安徽</td>
<td align="right">6255</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">福建</td>
<td align="right">3911</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">江西</td>
<td align="right">4622</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">山东</td>
<td align="right">10006</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">河南</td>
<td align="right">9559</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">湖北</td>
<td align="right">5902</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">湖南</td>
<td align="right">6860</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">广东</td>
<td align="right">11169</td>
<td align="right">33</td>
</tr>
<tr class="even">
<td align="left">广西</td>
<td align="right">4885</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">海南</td>
<td align="right">926</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="left">重庆</td>
<td align="right">3075</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">四川</td>
<td align="right">8302</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">贵州</td>
<td align="right">3580</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">云南</td>
<td align="right">4801</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">西藏</td>
<td align="right">337</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">陕西</td>
<td align="right">3835</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">甘肃</td>
<td align="right">2626</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="left">青海</td>
<td align="right">598</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">宁夏</td>
<td align="right">682</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">新疆</td>
<td align="right">2445</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<p>作各省人均可支配收入的直方图以及密度估计图：</p>
<div class="sourceCode" id="cb1938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1938-1"><a href="ggplotvis.html#cb1938-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dpop, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1938-2"><a href="ggplotvis.html#cb1938-2"></a>  <span class="dt">x =</span> inc))</span>
<span id="cb1938-3"><a href="ggplotvis.html#cb1938-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-di-dpop-plot01-1.png" width="672" /></p>
<div class="sourceCode" id="cb1940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1940-1"><a href="ggplotvis.html#cb1940-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di-dpop-plot02-1.png" width="672" /></p>
<p>这样的分布称为右偏分布，
特点是大部分数据取值集中在左侧，
但是有不可忽略的多个数据点出现在远离数据取值中心的右侧。
作收入的经验分布函数图：</p>
<div class="sourceCode" id="cb1941"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1941-1"><a href="ggplotvis.html#cb1941-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dpop, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1941-2"><a href="ggplotvis.html#cb1941-2"></a>  <span class="dt">x =</span> inc, <span class="dt">y =</span> ..y..))</span>
<span id="cb1941-3"><a href="ggplotvis.html#cb1941-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_ecdf</span>(<span class="dt">geom =</span> <span class="st">&quot;step&quot;</span>) <span class="op">+</span></span>
<span id="cb1941-4"><a href="ggplotvis.html#cb1941-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;居民可支配收入（千元）&quot;</span>, <span class="dt">y =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-dpop-plot03-1.png" width="672" /></p>
<p>如果将数据做适当的变换，
比如对数变换，
分布形状可能变得比较正态。</p>
</div>
<div id="ggplotvis-dist-qqplot" class="section level3">
<h3><span class="header-section-number">30.3.4</span> QQ图</h3>
<p>对连续型随机变量<span class="math inline">\(X\)</span>，
设其分布函数为<span class="math inline">\(F(x)\)</span>，
其反函数<span class="math inline">\(F^{-1}(p), p \in (0, 1)\)</span>称为<span class="math inline">\(X\)</span>的分位数函数(quantile function)。
为了估计<span class="math inline">\(F^{-1}(p)\)</span>，
可以将观测值<span class="math inline">\(X_1, X_2, \dots, X_n\)</span>从小到大排序为
<span class="math inline">\(X_{(1)}, X_{(2)}, \dots, X_{(n)}\)</span>，
令<span class="math inline">\(X_{(i)}\)</span>作为<span class="math inline">\(F^{-1}(\frac{i}{n})\)</span>的估计，
或者做连续性修正，
作为<span class="math inline">\(F^{-1}(\frac{i - 0.375}{n + 0.25})\)</span>的估计。</p>
<p>为了对比总体<span class="math inline">\(X\)</span>的观测数据与某个理论分布比如正态分布之间的差距，
可以用上述的样本分位数为散点纵坐标，
以相应的理论分位数为横坐标作散点图，
称为QQ图。
如果总体服从所对比的分布，
散点应该在一条直线附近，
否则就会有明显的偏离。</p>
<p>最常见的QQ图是正态QQ图。
下面对一些模拟数据做正态QQ图。</p>
<p>首先是模拟的正态分布数据:</p>
<div class="sourceCode" id="cb1942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1942-1"><a href="ggplotvis.html#cb1942-1"></a><span class="kw">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb1942-2"><a href="ggplotvis.html#cb1942-2"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">60</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>, <span class="dt">sd =</span> <span class="dv">3</span>))</span>
<span id="cb1942-3"><a href="ggplotvis.html#cb1942-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1942-4"><a href="ggplotvis.html#cb1942-4"></a>  <span class="dt">sample =</span> x ))</span>
<span id="cb1942-5"><a href="ggplotvis.html#cb1942-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1942-6"><a href="ggplotvis.html#cb1942-6"></a><span class="st">  </span><span class="kw">geom_qq_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di-qq01-1.png" width="672" /></p>
<p>模拟的对数正态数据：</p>
<div class="sourceCode" id="cb1943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1943-1"><a href="ggplotvis.html#cb1943-1"></a><span class="kw">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb1943-2"><a href="ggplotvis.html#cb1943-2"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">10</span><span class="op">^</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>, <span class="dt">sd =</span> <span class="dv">1</span>)))</span>
<span id="cb1943-3"><a href="ggplotvis.html#cb1943-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1943-4"><a href="ggplotvis.html#cb1943-4"></a>  <span class="dt">sample =</span> x ))</span>
<span id="cb1943-5"><a href="ggplotvis.html#cb1943-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1943-6"><a href="ggplotvis.html#cb1943-6"></a><span class="st">  </span><span class="kw">geom_qq_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di-qq02-1.png" width="672" /></p>
<p>上图为典型的右偏分布正态QQ图形状。</p>
<p>作t(3)分布样本的正态QQ图：</p>
<div class="sourceCode" id="cb1944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1944-1"><a href="ggplotvis.html#cb1944-1"></a><span class="kw">set.seed</span>(<span class="dv">104</span>)</span>
<span id="cb1944-2"><a href="ggplotvis.html#cb1944-2"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rt</span>(<span class="dv">50</span>, <span class="dt">df=</span><span class="dv">3</span>))</span>
<span id="cb1944-3"><a href="ggplotvis.html#cb1944-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1944-4"><a href="ggplotvis.html#cb1944-4"></a>  <span class="dt">sample =</span> x ))</span>
<span id="cb1944-5"><a href="ggplotvis.html#cb1944-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1944-6"><a href="ggplotvis.html#cb1944-6"></a><span class="st">  </span><span class="kw">geom_qq_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di-qq03-1.png" width="672" /></p>
<p>上图为典型的两侧都厚尾的分布的正态QQ图形状。</p>
</div>
<div id="ggplotvis-dist-boxplot" class="section level3">
<h3><span class="header-section-number">30.3.5</span> 盒形图</h3>
<p>如果需要同时表现多个分布，
上面给出了同时绘制多条密度曲线的方法，
但是这主要比较分布形状，
而不能比较分布的主要数字特征。
盒形图、小提琴图、脊线图(ridgeline plot)比较适合同时表现和比较多个分布。</p>
<p>比较多个分布的需求，
可能是比较多个类似的变量，
比如，
同一个学校的不同科目的成绩；
也可以是比较不同组的同一属性，
比如，
比较不同省的城镇居民收入。</p>
<p>如果想仅表现每个分布的均值和标准差，
可以对每个均值加减标准差画一个小的条形。
比如，
ggplot2扩展包的diamonds数据集包含了5万多枚钻石的分级、大小、价格数据，
我们从中抽取不含缺失数据的1000个观测，
按5种不同品质（Fair, Good, Very Good, Premium, Ideal）分类，
对克拉重量计算每类的均值和标准差：</p>
<div class="sourceCode" id="cb1945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1945-1"><a href="ggplotvis.html#cb1945-1"></a><span class="kw">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb1945-2"><a href="ggplotvis.html#cb1945-2"></a>diamonds <span class="op">%&gt;%</span></span>
<span id="cb1945-3"><a href="ggplotvis.html#cb1945-3"></a><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span></span>
<span id="cb1945-4"><a href="ggplotvis.html#cb1945-4"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">1000</span>) -&gt;<span class="st"> </span>ddsmall</span>
<span id="cb1945-5"><a href="ggplotvis.html#cb1945-5"></a>ddsmall <span class="op">%&gt;%</span></span>
<span id="cb1945-6"><a href="ggplotvis.html#cb1945-6"></a><span class="st">  </span><span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span></span>
<span id="cb1945-7"><a href="ggplotvis.html#cb1945-7"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb1945-8"><a href="ggplotvis.html#cb1945-8"></a>    <span class="dt">mean_carat =</span> <span class="kw">mean</span>(carat),</span>
<span id="cb1945-9"><a href="ggplotvis.html#cb1945-9"></a>    <span class="dt">sd_carat =</span> <span class="kw">sd</span>(carat)) -&gt;<span class="st"> </span>ddsmall_summ</span></code></pre></div>
<p>对每个类画以均值为中心、以均值加减标准差为两段的条形：</p>
<div class="sourceCode" id="cb1946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1946-1"><a href="ggplotvis.html#cb1946-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddsmall_summ, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1946-2"><a href="ggplotvis.html#cb1946-2"></a>  <span class="dt">x =</span> cut,</span>
<span id="cb1946-3"><a href="ggplotvis.html#cb1946-3"></a>  <span class="dt">y =</span> mean_carat ))</span>
<span id="cb1946-4"><a href="ggplotvis.html#cb1946-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span></span>
<span id="cb1946-5"><a href="ggplotvis.html#cb1946-5"></a><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1946-6"><a href="ggplotvis.html#cb1946-6"></a>    <span class="dt">ymin =</span> mean_carat <span class="op">-</span><span class="st"> </span>sd_carat,</span>
<span id="cb1946-7"><a href="ggplotvis.html#cb1946-7"></a>    <span class="dt">ymax =</span> mean_carat <span class="op">+</span><span class="st"> </span>sd_carat)) <span class="op">+</span></span>
<span id="cb1946-8"><a href="ggplotvis.html#cb1946-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Cut&quot;</span>,</span>
<span id="cb1946-9"><a href="ggplotvis.html#cb1946-9"></a>       <span class="dt">y =</span> <span class="st">&quot;Carat&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-box01-1.png" width="672" /></p>
<p>竖线的上下界也可以改为正态情形下的近似95%置信限，
即<span class="math inline">\(\bar x \pm 1.96 S\)</span>。
可以用<code>coord_flip()</code>颠倒x轴和y轴。</p>
<p>这种图形对分布信息压缩过甚，
对于非正态的分布则不能表现分布的形状。
盒形图可以表现分布的中位数、四分之一和四分之三分位数，
最小值、最大值和可能的离群值。
<code>geom_boxplot()</code>作盒形图。
比如，
diamonds数据集抽样1000个观测的克拉重量的盒形图：</p>
<div class="sourceCode" id="cb1947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1947-1"><a href="ggplotvis.html#cb1947-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddsmall, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1947-2"><a href="ggplotvis.html#cb1947-2"></a>  <span class="dt">y =</span> carat ))</span>
<span id="cb1947-3"><a href="ggplotvis.html#cb1947-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb1947-4"><a href="ggplotvis.html#cb1947-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1947-5"><a href="ggplotvis.html#cb1947-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,</span>
<span id="cb1947-6"><a href="ggplotvis.html#cb1947-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Carat&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-box02-1.png" width="672" /></p>
<p>从这个盒形图可以看出克拉重量呈现右偏分布。</p>
<p>比较不同品质的钻石的克拉重量，并将盒形图横向画出：</p>
<div class="sourceCode" id="cb1948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1948-1"><a href="ggplotvis.html#cb1948-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddsmall, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1948-2"><a href="ggplotvis.html#cb1948-2"></a>  <span class="dt">x =</span> cut, </span>
<span id="cb1948-3"><a href="ggplotvis.html#cb1948-3"></a>  <span class="dt">y =</span> carat ))</span>
<span id="cb1948-4"><a href="ggplotvis.html#cb1948-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb1948-5"><a href="ggplotvis.html#cb1948-5"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1948-6"><a href="ggplotvis.html#cb1948-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Cut&quot;</span>,</span>
<span id="cb1948-7"><a href="ggplotvis.html#cb1948-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Carat&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-box03-1.png" width="672" /></p>
<p>从克拉重量中位数看，
品质从Fair到Ideal基本上是逐步下降的，
只有Very Good级和Premium级的中位重量略有乱序。
除了Fair和Good级，
更好品质的三个等级的重量都呈右偏，
而Fair和Good级的分布则相对来说不偏态。</p>
<p>盒形图的轮廓线与盒子内部填充色可以用<code>color</code>和<code>fill</code>参数指定。</p>
</div>
<div id="ggplotvis-dist-violin" class="section level3">
<h3><span class="header-section-number">30.3.6</span> 小提琴图</h3>
<p>小提琴图是盒形图的一个改进版本，
比如，
钻石数据抽样数据集的克拉重量的小提琴图：</p>
<div class="sourceCode" id="cb1949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1949-1"><a href="ggplotvis.html#cb1949-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddsmall, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1949-2"><a href="ggplotvis.html#cb1949-2"></a>  <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> carat ))</span>
<span id="cb1949-3"><a href="ggplotvis.html#cb1949-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>() <span class="op">+</span></span>
<span id="cb1949-4"><a href="ggplotvis.html#cb1949-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1949-5"><a href="ggplotvis.html#cb1949-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,</span>
<span id="cb1949-6"><a href="ggplotvis.html#cb1949-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Carat&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-violin01-1.png" width="672" /></p>
<p>这实际是将密度估计曲线旋转90度画出，并左右镜像画两条。
它提供了比盒形图更详细的分布信息，
比如，
可以表现出双峰分布。
下面是R的faithful数据集中变量eruptions的小提琴图：</p>
<div class="sourceCode" id="cb1950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1950-1"><a href="ggplotvis.html#cb1950-1"></a><span class="kw">data</span>(faithful)</span>
<span id="cb1950-2"><a href="ggplotvis.html#cb1950-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> faithful, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1950-3"><a href="ggplotvis.html#cb1950-3"></a>  <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> eruptions ))</span>
<span id="cb1950-4"><a href="ggplotvis.html#cb1950-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>() <span class="op">+</span></span>
<span id="cb1950-5"><a href="ggplotvis.html#cb1950-5"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1950-6"><a href="ggplotvis.html#cb1950-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,</span>
<span id="cb1950-7"><a href="ggplotvis.html#cb1950-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Eruption Times&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-faithful-voilin01-1.png" width="672" /></p>
<p>钻石数据小数据集中各品质级别的钻石克拉重量的小提琴图比较，
横向放置：</p>
<div class="sourceCode" id="cb1951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1951-1"><a href="ggplotvis.html#cb1951-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddsmall, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1951-2"><a href="ggplotvis.html#cb1951-2"></a>  <span class="dt">x =</span> cut, </span>
<span id="cb1951-3"><a href="ggplotvis.html#cb1951-3"></a>  <span class="dt">y =</span> carat ))</span>
<span id="cb1951-4"><a href="ggplotvis.html#cb1951-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>() <span class="op">+</span></span>
<span id="cb1951-5"><a href="ggplotvis.html#cb1951-5"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1951-6"><a href="ggplotvis.html#cb1951-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Cut&quot;</span>,</span>
<span id="cb1951-7"><a href="ggplotvis.html#cb1951-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Carat&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-violin02-1.png" width="672" /></p>
<p>对连续变量，
可以用ggplot2包的<code>cut_width()</code>函数分组，
然后可以分组作小提琴图或者盒形图。
例如，
按照钻石数据的<code>carat</code>变量分组，
对<code>depth</code>变量作小提琴图：</p>
<div class="sourceCode" id="cb1952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1952-1"><a href="ggplotvis.html#cb1952-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1952-2"><a href="ggplotvis.html#cb1952-2"></a>  <span class="dt">x =</span> carat,</span>
<span id="cb1952-3"><a href="ggplotvis.html#cb1952-3"></a>  <span class="dt">y =</span> depth,</span>
<span id="cb1952-4"><a href="ggplotvis.html#cb1952-4"></a>  <span class="dt">group =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.1</span>) ))</span>
<span id="cb1952-5"><a href="ggplotvis.html#cb1952-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>() <span class="op">+</span></span>
<span id="cb1952-6"><a href="ggplotvis.html#cb1952-6"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="ot">NA</span>, <span class="fl">2.05</span>) <span class="op">+</span></span>
<span id="cb1952-7"><a href="ggplotvis.html#cb1952-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Cut&quot;</span>,</span>
<span id="cb1952-8"><a href="ggplotvis.html#cb1952-8"></a>       <span class="dt">y =</span> <span class="st">&quot;Carat&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 997 rows containing non-finite values (stat_ydensity).</code></pre>
<p><img src="static/picture/ggvis-di-diamond-violin03-1.png" width="672" /></p>
<p>其中<code>xlim()</code>函数用来指定x轴的左右边界，
<code>NA</code>表示用数据的值确定。</p>
</div>
<div id="ggplotvis-dist-mdens" class="section level3">
<h3><span class="header-section-number">30.3.7</span> 多个密度的其它画法</h3>
<p><a href="ggplotvis.html#ggplotvis-dist-muni">30.3.2</a>给出了将多个密度曲线叠加画出的方法。
在对多个组分别画某个连续变量的密度估计时，
可以将组别放置在y轴上，
仍用x轴表示该连续变量的取值范围。
这种图形尤其适用于考察随着时间或者地点变化的变量分布。
ggridges包提供了<code>geom_density_ridges()</code>函数作脊线图。
对钻石小数据集的各个级别的克拉重量作分布密度脊线图：</p>
<div class="sourceCode" id="cb1954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1954-1"><a href="ggplotvis.html#cb1954-1"></a><span class="kw">library</span>(ggridges)</span>
<span id="cb1954-2"><a href="ggplotvis.html#cb1954-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddsmall, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1954-3"><a href="ggplotvis.html#cb1954-3"></a>  <span class="dt">x =</span> carat, </span>
<span id="cb1954-4"><a href="ggplotvis.html#cb1954-4"></a>  <span class="dt">y =</span> cut))</span>
<span id="cb1954-5"><a href="ggplotvis.html#cb1954-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density_ridges</span>() <span class="op">+</span></span>
<span id="cb1954-6"><a href="ggplotvis.html#cb1954-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Carat&quot;</span>,</span>
<span id="cb1954-7"><a href="ggplotvis.html#cb1954-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Cut&quot;</span>)</span></code></pre></div>
<pre><code>## Picking joint bandwidth of 0.13</code></pre>
<p><img src="static/picture/ggvis-di-diamond-ridge01-1.png" width="672" /></p>
<p>可以添加颜色和透明度：</p>
<div class="sourceCode" id="cb1956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1956-1"><a href="ggplotvis.html#cb1956-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddsmall, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1956-2"><a href="ggplotvis.html#cb1956-2"></a>  <span class="dt">x =</span> carat, </span>
<span id="cb1956-3"><a href="ggplotvis.html#cb1956-3"></a>  <span class="dt">y =</span> cut,</span>
<span id="cb1956-4"><a href="ggplotvis.html#cb1956-4"></a>  <span class="dt">fill =</span> cut))</span>
<span id="cb1956-5"><a href="ggplotvis.html#cb1956-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density_ridges</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb1956-6"><a href="ggplotvis.html#cb1956-6"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb1956-7"><a href="ggplotvis.html#cb1956-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Carat&quot;</span>,</span>
<span id="cb1956-8"><a href="ggplotvis.html#cb1956-8"></a>       <span class="dt">y =</span> <span class="st">&quot;Cut&quot;</span>)</span></code></pre></div>
<pre><code>## Picking joint bandwidth of 0.13</code></pre>
<p><img src="static/picture/ggvis-di-diamond-ridge01b-1.png" width="672" /></p>
<p>可以看出不同级别的钻石的重量密度峰值的变化，
以及一定的多峰分布特征。</p>
</div>
<div id="ggplotvis-dist-2d" class="section level3">
<h3><span class="header-section-number">30.3.8</span> 二元分布直方图和等值线图</h3>
<p>对二元分布样本<span class="math inline">\((x_i, y_i)\)</span>，
可以用散点图表现其分布情况；
当点比较多时，
可以使用<code>alpha</code>参数设定一定的透明度，
使得颜色深表示点比较密集，
颜色浅表示点比较稀疏。
但是，
当点的数量很大时，
设定透明度就效果不好了，
这时稀疏的地方可能基本看不到颜色，
稠密的地方就是一团黑，无法分别分布情况。</p>
<p>可以用类似直方图的想法将二元分布的取值区域分块，
每块统计频数，
然后用不同深浅的颜色为每个小块染色，
颜色的深浅代表频数高低。
这样的图形称为二维直方图。
每个小块可以是正方形或者正六边形。</p>
<p>例如，对iris数据的花瓣长、宽变量画正六边形的二维直方图：</p>
<div class="sourceCode" id="cb1958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1958-1"><a href="ggplotvis.html#cb1958-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1958-2"><a href="ggplotvis.html#cb1958-2"></a>  <span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width))</span>
<span id="cb1958-3"><a href="ggplotvis.html#cb1958-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">25</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-iris01-1.png" width="672" /></p>
<p>在<code>geom_bins()</code>中可以用<code>bins=</code>指定分块的个数。
上图中颜色浅的值高，
颜色浅的值低。
可以用<code>scale_color_gradient</code>人为地指定代表频数的渐变色，
可以改为用深色代表高值，
如：</p>
<div class="sourceCode" id="cb1959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1959-1"><a href="ggplotvis.html#cb1959-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">25</span>) <span class="op">+</span></span>
<span id="cb1959-2"><a href="ggplotvis.html#cb1959-2"></a><span class="st">  </span><span class="kw">scale_fill_gradient</span>(</span>
<span id="cb1959-3"><a href="ggplotvis.html#cb1959-3"></a>    <span class="dt">low =</span> <span class="st">&quot;#9696F2&quot;</span>, </span>
<span id="cb1959-4"><a href="ggplotvis.html#cb1959-4"></a>    <span class="dt">high =</span> <span class="st">&quot;#0A0A3D&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-iris01b-1.png" width="672" /></p>
<p>可以利用colourpicker包的colourPicker函数或者该包的RStudio Addin – colourPicker挑选颜色。</p>
<p>下面做ggplot2包的diamonds数据集中的price和carat的散点图和二维直方图：</p>
<div class="sourceCode" id="cb1960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1960-1"><a href="ggplotvis.html#cb1960-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1960-2"><a href="ggplotvis.html#cb1960-2"></a>  <span class="dt">x =</span> price, <span class="dt">y =</span> carat))</span>
<span id="cb1960-3"><a href="ggplotvis.html#cb1960-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-diamonds01-1.png" width="672" /></p>
<div class="sourceCode" id="cb1961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1961-1"><a href="ggplotvis.html#cb1961-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">80</span>) <span class="op">+</span></span>
<span id="cb1961-2"><a href="ggplotvis.html#cb1961-2"></a><span class="st">  </span><span class="kw">scale_fill_gradient</span>(</span>
<span id="cb1961-3"><a href="ggplotvis.html#cb1961-3"></a>    <span class="dt">low =</span> <span class="st">&quot;#9696F2&quot;</span>, </span>
<span id="cb1961-4"><a href="ggplotvis.html#cb1961-4"></a>    <span class="dt">high =</span> <span class="st">&quot;#0A0A3D&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-diamonds01b-1.png" width="672" /></p>
<p>二维直方图估计的是二元阶梯函数，
也可以像一元情况估计分布密度那样估计连续的二元分布密度，
并用等值线图表示（类似于地图中的等高线）。
例如diamonds数据集中价格和重量的联合密度估计：</p>
<div class="sourceCode" id="cb1962"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1962-1"><a href="ggplotvis.html#cb1962-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_density_2d</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.6</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-diamonds01c-1.png" width="672" /></p>
<p>其中<code>color</code>是等值线颜色，
<code>size</code>是等值线粗细，单位是毫米。
密度很低的区域被忽略了，
为此，
将price用对数轴：</p>
<div class="sourceCode" id="cb1963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1963-1"><a href="ggplotvis.html#cb1963-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_density_2d</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.6</span>) <span class="op">+</span></span>
<span id="cb1963-2"><a href="ggplotvis.html#cb1963-2"></a><span class="st">  </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-diamonds01c1-1.png" width="672" /></p>
<p>等值线图还可以与散点图叠加在一起：</p>
<div class="sourceCode" id="cb1964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1964-1"><a href="ggplotvis.html#cb1964-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;green4&quot;</span>) <span class="op">+</span></span>
<span id="cb1964-2"><a href="ggplotvis.html#cb1964-2"></a><span class="st">  </span><span class="kw">stat_density_2d</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb1964-3"><a href="ggplotvis.html#cb1964-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-diamonds01d-1.png" width="672" /></p>
<p>等值线图还可以配合不同密度区域的不同颜色填充，
如：</p>
<div class="sourceCode" id="cb1965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1965-1"><a href="ggplotvis.html#cb1965-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">stat_density_2d</span>(</span>
<span id="cb1965-2"><a href="ggplotvis.html#cb1965-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> ..level..),</span>
<span id="cb1965-3"><a href="ggplotvis.html#cb1965-3"></a>  <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb1965-4"><a href="ggplotvis.html#cb1965-4"></a>  <span class="dt">geom =</span> <span class="st">&quot;polygon&quot;</span>) <span class="op">+</span></span>
<span id="cb1965-5"><a href="ggplotvis.html#cb1965-5"></a><span class="st">  </span><span class="kw">scale_fill_gradient</span>(</span>
<span id="cb1965-6"><a href="ggplotvis.html#cb1965-6"></a>    <span class="dt">low =</span> <span class="st">&quot;#9696F2&quot;</span>, </span>
<span id="cb1965-7"><a href="ggplotvis.html#cb1965-7"></a>    <span class="dt">high =</span> <span class="st">&quot;#0A0A3D&quot;</span>) <span class="op">+</span></span>
<span id="cb1965-8"><a href="ggplotvis.html#cb1965-8"></a><span class="st">  </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-diamonds01e-1.png" width="672" /></p>
<p>对于已经估计的二元密度曲面，
可以用<code>geom_contour()</code>作等值线图，
用<code>geom_raster()</code>作密度热力图。
比如，<code>faithfuld</code>是Faithful喷泉的间隔与喷发时间的二维密度估计数据框，
作密度的等值线图：</p>
<div class="sourceCode" id="cb1966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1966-1"><a href="ggplotvis.html#cb1966-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> faithfuld, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1966-2"><a href="ggplotvis.html#cb1966-2"></a>  <span class="dt">x =</span> eruptions, <span class="dt">y =</span> waiting))</span>
<span id="cb1966-3"><a href="ggplotvis.html#cb1966-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_contour</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1966-4"><a href="ggplotvis.html#cb1966-4"></a>  <span class="dt">z =</span> density))</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-faithfuld01-1.png" width="672" /></p>
<p>可以用等值线颜色代表密度值大小：</p>
<div class="sourceCode" id="cb1967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1967-1"><a href="ggplotvis.html#cb1967-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_contour</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1967-2"><a href="ggplotvis.html#cb1967-2"></a>  <span class="dt">z =</span> density, <span class="dt">color =</span> ..level..))</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-faithfuld01b-1.png" width="672" /></p>
<p>作密度估计的热力图：</p>
<div class="sourceCode" id="cb1968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1968-1"><a href="ggplotvis.html#cb1968-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_raster</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1968-2"><a href="ggplotvis.html#cb1968-2"></a>  <span class="dt">fill =</span> density))</span></code></pre></div>
<p><img src="static/picture/ggvis-di2d-faithfuld01c-1.png" width="672" /></p>
</div>
</div>
<div id="ggplotvis-prop" class="section level2">
<h2><span class="header-section-number">30.4</span> 表现比例</h2>
<p>条形图、堆叠条形图、并排条形图可以用来表现比例以及分组内的比例。
饼图经常用来表现单个分组方式的各组比例。</p>
<div id="ggplotvis-prop-uni" class="section level3">
<h3><span class="header-section-number">30.4.1</span> 单个分布</h3>
<p>考虑diamonds数据集中各级别，
首先计算其频数分布：</p>
<div class="sourceCode" id="cb1969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1969-1"><a href="ggplotvis.html#cb1969-1"></a>ddstab &lt;-<span class="st"> </span><span class="kw">cdf_table</span>(diamonds<span class="op">$</span>cut)</span>
<span id="cb1969-2"><a href="ggplotvis.html#cb1969-2"></a>knitr<span class="op">::</span><span class="kw">kable</span>(ddstab)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">x</th>
<th align="right">freq</th>
<th align="right">pct</th>
<th align="right">cumfreq</th>
<th align="right">cumpct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Fair</td>
<td align="right">1610</td>
<td align="right">0.0298480</td>
<td align="right">1610</td>
<td align="right">0.0298480</td>
</tr>
<tr class="even">
<td align="left">Good</td>
<td align="right">4906</td>
<td align="right">0.0909529</td>
<td align="right">6516</td>
<td align="right">0.1208009</td>
</tr>
<tr class="odd">
<td align="left">Very Good</td>
<td align="right">12082</td>
<td align="right">0.2239896</td>
<td align="right">18598</td>
<td align="right">0.3447905</td>
</tr>
<tr class="even">
<td align="left">Premium</td>
<td align="right">13791</td>
<td align="right">0.2556730</td>
<td align="right">32389</td>
<td align="right">0.6004635</td>
</tr>
<tr class="odd">
<td align="left">Ideal</td>
<td align="right">21551</td>
<td align="right">0.3995365</td>
<td align="right">53940</td>
<td align="right">1.0000000</td>
</tr>
</tbody>
</table>
<p>ggplot2没有专门的饼图函数，
可以用<code>geom_col()</code>与<code>coord_polar()</code>配合，
或者用ggforce包的<code>geom_arc_bar()</code>。</p>
<p>下面作级别分布的饼图，
用饼图中色块大小代表不同级别的比例大小：</p>
<div class="sourceCode" id="cb1970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1970-1"><a href="ggplotvis.html#cb1970-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddstab, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1970-2"><a href="ggplotvis.html#cb1970-2"></a>  <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> freq, <span class="dt">fill =</span> x ))</span>
<span id="cb1970-3"><a href="ggplotvis.html#cb1970-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1970-4"><a href="ggplotvis.html#cb1970-4"></a><span class="st">  </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="op">+</span></span>
<span id="cb1970-5"><a href="ggplotvis.html#cb1970-5"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">name =</span> <span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1970-6"><a href="ggplotvis.html#cb1970-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1970-7"><a href="ggplotvis.html#cb1970-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Cut&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop01b-1.png" width="672" /></p>
<p>用<code>geom_arc_bar()</code>函数需要直接指定各个分界线的角度。
程序如：</p>
<div class="sourceCode" id="cb1971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1971-1"><a href="ggplotvis.html#cb1971-1"></a><span class="kw">library</span>(ggforce)</span>
<span id="cb1971-2"><a href="ggplotvis.html#cb1971-2"></a>d &lt;-<span class="st"> </span>ddstab <span class="op">%&gt;%</span></span>
<span id="cb1971-3"><a href="ggplotvis.html#cb1971-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb1971-4"><a href="ggplotvis.html#cb1971-4"></a>    <span class="dt">end_angle =</span> cumpct <span class="op">*</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>pi, <span class="co"># 每块的结束角度</span></span>
<span id="cb1971-5"><a href="ggplotvis.html#cb1971-5"></a>    <span class="dt">start_angle =</span> <span class="kw">lag</span>(end_angle, <span class="dt">default =</span> <span class="dv">0</span>), <span class="co"># 每块的开始角度</span></span>
<span id="cb1971-6"><a href="ggplotvis.html#cb1971-6"></a>    <span class="dt">mid_angle =</span> <span class="fl">0.5</span><span class="op">*</span>(start_angle <span class="op">+</span><span class="st"> </span>end_angle), <span class="co"># 每块的中间角度，用于频数数值</span></span>
<span id="cb1971-7"><a href="ggplotvis.html#cb1971-7"></a>    <span class="dt">hjust =</span> <span class="kw">ifelse</span>(mid_angle<span class="op">&gt;</span>pi, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1971-8"><a href="ggplotvis.html#cb1971-8"></a>    <span class="dt">vjust =</span> <span class="kw">ifelse</span>(mid_angle<span class="op">&lt;</span>pi<span class="op">/</span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span>mid_angle<span class="op">&gt;</span><span class="dv">3</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1971-9"><a href="ggplotvis.html#cb1971-9"></a>  )</span>
<span id="cb1971-10"><a href="ggplotvis.html#cb1971-10"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d)</span>
<span id="cb1971-11"><a href="ggplotvis.html#cb1971-11"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_arc_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1971-12"><a href="ggplotvis.html#cb1971-12"></a>  <span class="dt">x0 =</span> <span class="dv">0</span>, <span class="dt">y0 =</span> <span class="dv">0</span>, <span class="dt">r0 =</span> <span class="dv">0</span>, <span class="dt">r =</span> <span class="fl">1.0</span>, </span>
<span id="cb1971-13"><a href="ggplotvis.html#cb1971-13"></a>  <span class="dt">start =</span> start_angle,</span>
<span id="cb1971-14"><a href="ggplotvis.html#cb1971-14"></a>  <span class="dt">end =</span> end_angle,</span>
<span id="cb1971-15"><a href="ggplotvis.html#cb1971-15"></a>  <span class="dt">fill =</span> x )) <span class="op">+</span></span>
<span id="cb1971-16"><a href="ggplotvis.html#cb1971-16"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(</span>
<span id="cb1971-17"><a href="ggplotvis.html#cb1971-17"></a>      <span class="dt">x =</span> <span class="fl">1.05</span><span class="op">*</span><span class="kw">sin</span>(mid_angle),</span>
<span id="cb1971-18"><a href="ggplotvis.html#cb1971-18"></a>      <span class="dt">y =</span> <span class="fl">1.05</span><span class="op">*</span><span class="kw">cos</span>(mid_angle),</span>
<span id="cb1971-19"><a href="ggplotvis.html#cb1971-19"></a>      <span class="dt">label =</span> x,</span>
<span id="cb1971-20"><a href="ggplotvis.html#cb1971-20"></a>      <span class="dt">hjust =</span> hjust, <span class="dt">vjust =</span> vjust),</span>
<span id="cb1971-21"><a href="ggplotvis.html#cb1971-21"></a>      <span class="dt">size =</span> <span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb1971-22"><a href="ggplotvis.html#cb1971-22"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb1971-23"><a href="ggplotvis.html#cb1971-23"></a>    <span class="kw">aes</span>(</span>
<span id="cb1971-24"><a href="ggplotvis.html#cb1971-24"></a>      <span class="dt">x =</span> <span class="fl">0.6</span><span class="op">*</span><span class="kw">sin</span>(mid_angle),</span>
<span id="cb1971-25"><a href="ggplotvis.html#cb1971-25"></a>      <span class="dt">y =</span> <span class="fl">0.6</span><span class="op">*</span><span class="kw">cos</span>(mid_angle),</span>
<span id="cb1971-26"><a href="ggplotvis.html#cb1971-26"></a>      <span class="dt">label =</span> freq ),</span>
<span id="cb1971-27"><a href="ggplotvis.html#cb1971-27"></a>    <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb1971-28"><a href="ggplotvis.html#cb1971-28"></a><span class="st">  </span><span class="kw">coord_fixed</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1971-29"><a href="ggplotvis.html#cb1971-29"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>), <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">name=</span><span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1971-30"><a href="ggplotvis.html#cb1971-30"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">name=</span><span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1971-31"><a href="ggplotvis.html#cb1971-31"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop01c-1.png" width="672" /></p>
<p>ggstatsplot包提供了<code>ggpiestats()</code>函数，
可以自动标注比例，
但不能自动标注组标签在饼图边缘。</p>
<p>这样的频数或者比例分布，
当然可以用普通的条形图表示，
如：</p>
<div class="sourceCode" id="cb1972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1972-1"><a href="ggplotvis.html#cb1972-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddstab, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1972-2"><a href="ggplotvis.html#cb1972-2"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> freq ))</span>
<span id="cb1972-3"><a href="ggplotvis.html#cb1972-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1972-4"><a href="ggplotvis.html#cb1972-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Cut&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Freq&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop01d-1.png" width="672" /></p>
<p>这样的图形比较容易在各类之间比较。
也可以做成堆叠的条形图：</p>
<div class="sourceCode" id="cb1973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1973-1"><a href="ggplotvis.html#cb1973-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddstab, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1973-2"><a href="ggplotvis.html#cb1973-2"></a>  <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">fill =</span> x, <span class="dt">y =</span> freq ))</span>
<span id="cb1973-3"><a href="ggplotvis.html#cb1973-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>) <span class="op">+</span></span>
<span id="cb1973-4"><a href="ggplotvis.html#cb1973-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">name =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1973-5"><a href="ggplotvis.html#cb1973-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Cut&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Freq&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop01e-1.png" width="672" /></p>
<p>也可以横向放置，用<code>cood_flip()</code>:</p>
<div class="sourceCode" id="cb1974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1974-1"><a href="ggplotvis.html#cb1974-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddstab, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1974-2"><a href="ggplotvis.html#cb1974-2"></a>  <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">fill =</span> x, <span class="dt">y =</span> freq ))</span>
<span id="cb1974-3"><a href="ggplotvis.html#cb1974-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>) <span class="op">+</span></span>
<span id="cb1974-4"><a href="ggplotvis.html#cb1974-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">name =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb1974-5"><a href="ggplotvis.html#cb1974-5"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1974-6"><a href="ggplotvis.html#cb1974-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Cut&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Freq&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop01f-1.png" width="672" /></p>
<p>可以用<code>geom_text()</code>将各个类别标签和频数的数值直接标在色块上。
堆叠的条形图比较容易看到每个类占总数的比例大小。</p>
</div>
<div id="ggplotvis-prop-mult" class="section level3">
<h3><span class="header-section-number">30.4.2</span> 组间的比例分布的比较</h3>
<p>有时需要比较不同组的某个变量的比例分布。
比如，
我们将钻石按重量分为大和小两种，
在5种不同品质之间比较大小比例，
可以用堆叠的条形图或者并列的条形图。
程序：</p>
<div class="sourceCode" id="cb1975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1975-1"><a href="ggplotvis.html#cb1975-1"></a>ddsmall <span class="op">%&gt;%</span></span>
<span id="cb1975-2"><a href="ggplotvis.html#cb1975-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">size =</span> <span class="kw">factor</span>(</span>
<span id="cb1975-3"><a href="ggplotvis.html#cb1975-3"></a>    <span class="kw">ifelse</span>(carat <span class="op">&gt;=</span><span class="st"> </span><span class="fl">1.0</span>, <span class="st">&quot;big&quot;</span>, <span class="st">&quot;small&quot;</span>), </span>
<span id="cb1975-4"><a href="ggplotvis.html#cb1975-4"></a>    <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;small&quot;</span>, <span class="st">&quot;big&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb1975-5"><a href="ggplotvis.html#cb1975-5"></a><span class="st">  </span><span class="kw">count</span>(cut, size) <span class="op">%&gt;%</span></span>
<span id="cb1975-6"><a href="ggplotvis.html#cb1975-6"></a><span class="st">  </span><span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span></span>
<span id="cb1975-7"><a href="ggplotvis.html#cb1975-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) -&gt;<span class="st"> </span>ddssize</span>
<span id="cb1975-8"><a href="ggplotvis.html#cb1975-8"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddssize, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1975-9"><a href="ggplotvis.html#cb1975-9"></a>  <span class="dt">x =</span> cut, <span class="dt">fill =</span> size, <span class="dt">y =</span> pct ))</span>
<span id="cb1975-10"><a href="ggplotvis.html#cb1975-10"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop02-1.png" width="672" /></p>
<p>可以很容易地在5个组直接比较两种大小各自的比例。
但是，
如果有多余两个的比例要比较，
则堆叠条形中位于中间的比例不易比较。
可以做并列的条形图，如：</p>
<div class="sourceCode" id="cb1976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1976-1"><a href="ggplotvis.html#cb1976-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop02b-1.png" width="672" /></p>
<p>这样可以比较容易地在不同大类之间比较比例，
查看比例的变化趋势。</p>
<p>考虑diamonds数据集中随重量变化，
品质分布的变化。
因为重量是连续变化的，
所以图形需要变成曲线或者阴影图，
每条曲线表示某个品质的累积比例。</p>
<div class="sourceCode" id="cb1977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1977-1"><a href="ggplotvis.html#cb1977-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1977-2"><a href="ggplotvis.html#cb1977-2"></a>  <span class="dt">x =</span> carat, <span class="dt">y =</span> ..count.., <span class="dt">fill =</span> cut, <span class="dt">color =</span> cut))</span>
<span id="cb1977-3"><a href="ggplotvis.html#cb1977-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1977-4"><a href="ggplotvis.html#cb1977-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Carat&quot;</span>, <span class="dt">expand=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb1977-5"><a href="ggplotvis.html#cb1977-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb1977-6"><a href="ggplotvis.html#cb1977-6"></a>    <span class="dt">name =</span> <span class="st">&quot;Relative proportion&quot;</span>,</span>
<span id="cb1977-7"><a href="ggplotvis.html#cb1977-7"></a>    <span class="dt">labels =</span> scales<span class="op">::</span>percent)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop03-1.png" width="672" /></p>
<p>这样的图形仅表现了每个重量级别的品质比例，
无法表现不同重量级别的数量。
为此，
可以每种品质单独画总的重量分布密度图，
但在其中用阴影标出该品质所占比例：</p>
<div class="sourceCode" id="cb1978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1978-1"><a href="ggplotvis.html#cb1978-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1978-2"><a href="ggplotvis.html#cb1978-2"></a>  <span class="dt">x =</span> carat, <span class="dt">y =</span> ..count..))</span>
<span id="cb1978-3"><a href="ggplotvis.html#cb1978-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density_line</span>(<span class="dt">data =</span> <span class="kw">select</span>(diamonds, <span class="op">-</span>cut), <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1978-4"><a href="ggplotvis.html#cb1978-4"></a>  <span class="dt">fill =</span> <span class="st">&quot;All diamonds&quot;</span>), <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></span>
<span id="cb1978-5"><a href="ggplotvis.html#cb1978-5"></a><span class="st">  </span><span class="kw">geom_density_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1978-6"><a href="ggplotvis.html#cb1978-6"></a>    <span class="dt">fill =</span> <span class="st">&quot;Highlighted cut&quot;</span>), <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></span>
<span id="cb1978-7"><a href="ggplotvis.html#cb1978-7"></a><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) <span class="op">+</span></span>
<span id="cb1978-8"><a href="ggplotvis.html#cb1978-8"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop04-1.png" width="672" /></p>
<p>因为程序中用了<code>facet_wrap()</code>分组，
所以密度图（纵轴为个数）本应只有某个品级的数据，
但是用了删除cut变量的方法，
将全集数据的密度图也画出来了。
这个数据集中，
高品质的钻石更多。</p>
</div>
<div id="ggplotvis-prop-nest" class="section level3">
<h3><span class="header-section-number">30.4.3</span> 嵌套比例分布的比较</h3>
<p>堆叠条形图、并列条形图都可以用来表现两重分类的列联表频数数据。
堆叠条形图中每个条形的高度可以用来表现大类频数，
每个条形内色块的大小可以用来表现大类内小类的频数和比例。
不同大类之间的小类频数和比例相对来说不易比较。
并列条形图中每个条形是一个交叉类的频数，
所以在大类之间比较小类频数比较容易，
但是每个大类的频数则表现得较为模糊。</p>
<p>马赛格图是另外一种表现列联表频数的图形，
用色块面积表示每个交叉类的频数。
与堆叠条形图相比，
这里用了条形宽度而不是条形高度表示大类频数。</p>
<div class="sourceCode" id="cb1979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1979-1"><a href="ggplotvis.html#cb1979-1"></a>diamonds <span class="op">%&gt;%</span></span>
<span id="cb1979-2"><a href="ggplotvis.html#cb1979-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">size =</span> <span class="kw">factor</span>(</span>
<span id="cb1979-3"><a href="ggplotvis.html#cb1979-3"></a>    <span class="kw">ifelse</span>(carat <span class="op">&gt;=</span><span class="st"> </span><span class="fl">1.0</span>, <span class="st">&quot;big&quot;</span>, <span class="st">&quot;small&quot;</span>), </span>
<span id="cb1979-4"><a href="ggplotvis.html#cb1979-4"></a>    <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;small&quot;</span>, <span class="st">&quot;big&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb1979-5"><a href="ggplotvis.html#cb1979-5"></a><span class="st">  </span><span class="kw">count</span>(cut, size) <span class="op">%&gt;%</span></span>
<span id="cb1979-6"><a href="ggplotvis.html#cb1979-6"></a><span class="st">  </span><span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span></span>
<span id="cb1979-7"><a href="ggplotvis.html#cb1979-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cutfreq =</span> <span class="kw">sum</span>(n)) <span class="op">%&gt;%</span></span>
<span id="cb1979-8"><a href="ggplotvis.html#cb1979-8"></a><span class="st">  </span><span class="kw">ungroup</span>() -&gt;<span class="st"> </span>ddssize0</span>
<span id="cb1979-9"><a href="ggplotvis.html#cb1979-9"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddssize0, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1979-10"><a href="ggplotvis.html#cb1979-10"></a>  <span class="dt">x =</span> cut, <span class="dt">fill =</span> size, <span class="dt">y =</span> n, <span class="dt">width =</span> cutfreq ))</span>
<span id="cb1979-11"><a href="ggplotvis.html#cb1979-11"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>, </span>
<span id="cb1979-12"><a href="ggplotvis.html#cb1979-12"></a>             <span class="dt">color=</span><span class="st">&quot;white&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb1979-13"><a href="ggplotvis.html#cb1979-13"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="dt">space =</span> <span class="st">&quot;free_x&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop11-1.png" width="672" /></p>
<p>ggplot2中没有专门的马赛克图。
上面的程序用了<code>geom_col()</code>、<code>facet_grid()</code>和<code>width</code>参数实现马赛克图。</p>
<p>与马赛克图类似的一种方法是在大类中再细分小类，
而且细分小类的办法不是单向划分的。
treemapify包的<code>geom_treemap()</code>函数可以做树状分类图。
如：</p>
<div class="sourceCode" id="cb1980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1980-1"><a href="ggplotvis.html#cb1980-1"></a><span class="kw">library</span>(treemapify)</span>
<span id="cb1980-2"><a href="ggplotvis.html#cb1980-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> ddssize0, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1980-3"><a href="ggplotvis.html#cb1980-3"></a>  <span class="dt">subgroup =</span> cut, <span class="dt">fill =</span> <span class="kw">interaction</span>(size, cut), <span class="dt">area =</span> n))</span>
<span id="cb1980-4"><a href="ggplotvis.html#cb1980-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_treemap</span>(<span class="dt">color=</span><span class="st">&quot;white&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span><span class="op">*</span>.pt, <span class="dt">alpha=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb1980-5"><a href="ggplotvis.html#cb1980-5"></a><span class="st">  </span><span class="kw">geom_treemap_subgroup_text</span>(</span>
<span id="cb1980-6"><a href="ggplotvis.html#cb1980-6"></a>    <span class="dt">place =</span> <span class="st">&quot;center&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">grow =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1980-7"><a href="ggplotvis.html#cb1980-7"></a><span class="st">  </span><span class="kw">geom_treemap_text</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1980-8"><a href="ggplotvis.html#cb1980-8"></a>    <span class="dt">label =</span> size), </span>
<span id="cb1980-9"><a href="ggplotvis.html#cb1980-9"></a>    <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb1980-10"><a href="ggplotvis.html#cb1980-10"></a>    <span class="dt">place =</span> <span class="st">&quot;center&quot;</span>, <span class="dt">grow =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb1980-11"><a href="ggplotvis.html#cb1980-11"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-di-diamond-prop11b-1.png" width="672" /></p>
<p>还可以用平行集（parallel sets）方法表现多个分类之间的关系，
以一个分类为主分类染色，
可以看出每个主分类与其他子类的关系。
ggforce包的<code>geom_paralles_sets()</code>函数作这种图。
参见<a href="https://serialmentor.com/dataviz/nested-proportions.html" class="uri">https://serialmentor.com/dataviz/nested-proportions.html</a>。</p>
</div>
</div>
<div id="ggplotvis-mulvar" class="section level2">
<h2><span class="header-section-number">30.5</span> 表现多个变量间的关系</h2>
<p>当数据集中有多个变量中，
我们除了关心每一个变量的类型、取值集合、分布情况，
还关心变量之间的关系，
观测的分组情况等。</p>
<p>为表现两个变量之间的关系，
最常用的是散点图。
多个变量之间可以用散点图矩阵、相关图，
可以在散点图中用符号大小、符号颜色、符号形状表示更多维数。
对于高维数据，
经常需要利用降维方法，
如主成分分析(PCA)对数据降维，
对降维数据作图。</p>
<div id="ggplotvis-mulvar-scatter" class="section level3">
<h3><span class="header-section-number">30.5.1</span> 散点图</h3>
<p>R软件自带的iris数据集中包含了三种鸢尾花的150个样品的测量数据，
每种各50个样品，
每个样品测量了花瓣、花萼的长、宽。
下面画50个setosa样品的花瓣长、宽的散点图，
可以看出，
两种有明显的线性相关关系：</p>
<div class="sourceCode" id="cb1981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1981-1"><a href="ggplotvis.html#cb1981-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb1981-2"><a href="ggplotvis.html#cb1981-2"></a>  <span class="dt">data =</span> <span class="kw">filter</span>(iris, Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>),</span>
<span id="cb1981-3"><a href="ggplotvis.html#cb1981-3"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width))</span>
<span id="cb1981-4"><a href="ggplotvis.html#cb1981-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scat01-1.png" width="672" /></p>
<p>应该有50个点，
但实际只看到23个点。
这是因为许多点重叠在一起了。
加上透明度参数可以使得重叠的点颜色更深：</p>
<div class="sourceCode" id="cb1982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1982-1"><a href="ggplotvis.html#cb1982-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">size =</span> <span class="fl">2.0</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scat01b-1.png" width="672" /></p>
<p>图的效果还是不够明显，
不太好判断重叠了多少个点，
另外如果不同颜色的点重叠，
就无法判断有哪些颜色的点重叠在一起。
如果不做说明，
读者也不一定了解颜色深浅代表重叠点的多少。</p>
<p>当点数很多，如数百、数千个点时，
可以用<code>size</code>参数画更小的点，
这时使用透明度的效果会比较显著。
注意，
透明度是一个0到1之间的数值，
<code>1/3</code>表示重叠3个点会变成不透明，
透明度<code>1/10</code>表示重叠10个点会变成不透明。</p>
<p>在点数较少时如果有重叠，
可以使用<code>geom_jitter()</code>，
使得每个点略有随机偏移，
就可以使得各个点基本上不重叠。
偏移可以是上下左右同时进行，
也可以要求仅上下或者仅左右偏移。
例如：</p>
<div class="sourceCode" id="cb1983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1983-1"><a href="ggplotvis.html#cb1983-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">width=</span><span class="fl">0.05</span>, <span class="dt">height=</span><span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scat01c-1.png" width="672" /></p>
<p><code>geom_jiter()</code>中的<code>width</code>和<code>height</code>是左右和上下抖动的幅度百分比，
以数据间的最小差距为单位，
默认的抖动比例是40%，
一般不超过50%，
否则原来是两个不同坐标值的点可能会看起来是同一坐标值。
比如，
假设x变量的值是精确到小数点后1位的，
取值如1.3, 1.4，
抖动40%，坐标可以变成1.33, 1.46，
如果允许抖动60%，
则1.3可能变成1.36，1.4可能变成1.34，
就无法区分原来不同的值了。</p>
<p>如果做所有的150个样品的散点图，
则三点呈现出分组现象：</p>
<div class="sourceCode" id="cb1984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1984-1"><a href="ggplotvis.html#cb1984-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris,  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1984-2"><a href="ggplotvis.html#cb1984-2"></a>  <span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width))</span>
<span id="cb1984-3"><a href="ggplotvis.html#cb1984-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">width=</span><span class="fl">0.05</span>, <span class="dt">height=</span><span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scat02-1.png" width="672" /></p>
<p>为此，
应该设法在散点图中区分三种不同鸢尾花品种。
将<code>Species</code>映射到color属性即可区分：</p>
<div class="sourceCode" id="cb1985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1985-1"><a href="ggplotvis.html#cb1985-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris,  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1985-2"><a href="ggplotvis.html#cb1985-2"></a>  <span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width,</span>
<span id="cb1985-3"><a href="ggplotvis.html#cb1985-3"></a>  <span class="dt">color =</span> Species))</span>
<span id="cb1985-4"><a href="ggplotvis.html#cb1985-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">width=</span><span class="fl">0.05</span>, <span class="dt">height=</span><span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scat03-1.png" width="672" /></p>
<p>如果希望将花萼长度也添加到图形中，
因为已经有x维、y维和颜色，
只能通过符号大小来添加。
将花萼长度映射到<code>size</code>维：</p>
<div class="sourceCode" id="cb1986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1986-1"><a href="ggplotvis.html#cb1986-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris,  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1986-2"><a href="ggplotvis.html#cb1986-2"></a>  <span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width,</span>
<span id="cb1986-3"><a href="ggplotvis.html#cb1986-3"></a>  <span class="dt">size =</span> Sepal.Length,</span>
<span id="cb1986-4"><a href="ggplotvis.html#cb1986-4"></a>  <span class="dt">color =</span> Species))</span>
<span id="cb1986-5"><a href="ggplotvis.html#cb1986-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scat04-1.png" width="672" /></p>
<p>这样的用符号大小代表一个变量数据的图形称为气泡图(bubble plot)。
符号大小是比较难认读的图形刻度。</p>
</div>
<div id="ggplotvis-mulvar-scatmat" class="section level3">
<h3><span class="header-section-number">30.5.2</span> 散点图矩阵</h3>
<p>多个变量之间的关系经常用散点图矩阵表示。
ggplot2包没有提供专门的散点图矩阵，
基础R图形中提供了pairs函数作散点图矩阵，
GGally包提供了一个<code>ggscatmat()</code>函数作散点图矩阵。</p>
<p>例如，
对iris数据的四个测量值变量作散点图矩阵：</p>
<div class="sourceCode" id="cb1987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1987-1"><a href="ggplotvis.html#cb1987-1"></a><span class="kw">library</span>(GGally)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;GGally&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<pre><code>## 
## 载入程辑包：&#39;GGally&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     nasa</code></pre>
<div class="sourceCode" id="cb1991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1991-1"><a href="ggplotvis.html#cb1991-1"></a><span class="kw">ggscatmat</span>(<span class="dt">data =</span> iris, <span class="dt">columns =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scatmat01-1.png" width="672" /></p>
<p>排列成矩阵的各个小图的下三角位置是两个变量的散点图，
对角线位置是单个变量的核密度估计，
上三角位置是两个变量的相关系数。</p>
<p>可以用color选项增加color映射，
可以用alpha指定透明度。如：</p>
<div class="sourceCode" id="cb1992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1992-1"><a href="ggplotvis.html#cb1992-1"></a><span class="kw">ggscatmat</span>(<span class="dt">data =</span> iris, <span class="dt">columns =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;Species&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-scatmat02-1.png" width="672" /></p>
<p>GGally的<code>ggpairs()</code>函数提供了另一种矩阵图，
可以比较变量两两分布或者关系。
例如，
取iris数据集的花瓣长、花萼长与种类：</p>
<div class="sourceCode" id="cb1993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1993-1"><a href="ggplotvis.html#cb1993-1"></a><span class="kw">ggpairs</span>(</span>
<span id="cb1993-2"><a href="ggplotvis.html#cb1993-2"></a>  <span class="dt">data =</span> iris, </span>
<span id="cb1993-3"><a href="ggplotvis.html#cb1993-3"></a>  <span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;Petal.Length&quot;</span>, <span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Species&quot;</span>))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggvis-mv-iris-scatmat03-1.png" width="672" /></p>
<p>可以看出，对角线位置是单个变量的密度估计或者离散分布条形图，
两个连续变量之间有散点图与相关系数，
连续变量与分类变量之间有按分类变量分组的直方图和盒形图。</p>
</div>
<div id="ggplotvis-mulvar-corrgram" class="section level3">
<h3><span class="header-section-number">30.5.3</span> 相关系数矩阵图</h3>
<p>多个变量之间的相关系数矩阵可以用色块图表示，
ggplot2包没有提供专门的函数，
可以用数据变换和<code>geom_tile()</code>函数实现。
corrgram包提供了corrgram函数作相关系数矩阵图，
见<a href="graph.html#graph-other-corr">28.6.1</a>。</p>
</div>
<div id="ggplotvis-mulvar-dimreduct" class="section level3">
<h3><span class="header-section-number">30.5.4</span> 数据降维</h3>
<p>当数据中有过多的变量时，比如变量达到数百、数千时，
即使是散点图矩阵都信息量过大难以认读。
这时常用主成分分析等降维方法将数据降维到若干个新变量，
对新变量作图。</p>
<p>主成分分析利用变量的协方差阵或者相关阵的特征值分解对原始变量进行线性组合，
产生若干个新变量。
当原始变量为相同单位且可比时，
可以基于协方差阵，
否则应该基于相关阵。
例如，
对iris数据集的4个测量值作主成分分析：</p>
<div class="sourceCode" id="cb1995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1995-1"><a href="ggplotvis.html#cb1995-1"></a>pca1 &lt;-<span class="st"> </span><span class="kw">princomp</span>(iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dt">cor=</span><span class="ot">FALSE</span>)</span>
<span id="cb1995-2"><a href="ggplotvis.html#cb1995-2"></a><span class="kw">summary</span>(pca1)</span></code></pre></div>
<pre><code>## Importance of components:
##                           Comp.1     Comp.2     Comp.3      Comp.4
## Standard deviation     2.0494032 0.49097143 0.27872586 0.153870700
## Proportion of Variance 0.9246187 0.05306648 0.01710261 0.005212184
## Cumulative Proportion  0.9246187 0.97768521 0.99478782 1.000000000</code></pre>
<div class="sourceCode" id="cb1997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1997-1"><a href="ggplotvis.html#cb1997-1"></a>load1 &lt;-<span class="st"> </span><span class="kw">loadings</span>(pca1)</span>
<span id="cb1997-2"><a href="ggplotvis.html#cb1997-2"></a><span class="kw">print</span>(load1)</span></code></pre></div>
<pre><code>## 
## Loadings:
##              Comp.1 Comp.2 Comp.3 Comp.4
## Sepal.Length  0.361  0.657  0.582  0.315
## Sepal.Width          0.730 -0.598 -0.320
## Petal.Length  0.857 -0.173        -0.480
## Petal.Width   0.358        -0.546  0.754
## 
##                Comp.1 Comp.2 Comp.3 Comp.4
## SS loadings      1.00   1.00   1.00   1.00
## Proportion Var   0.25   0.25   0.25   0.25
## Cumulative Var   0.25   0.50   0.75   1.00</code></pre>
<div class="sourceCode" id="cb1999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1999-1"><a href="ggplotvis.html#cb1999-1"></a>ps1 &lt;-<span class="st"> </span><span class="kw">predict</span>(pca1)</span>
<span id="cb1999-2"><a href="ggplotvis.html#cb1999-2"></a>ps1 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(ps1)</span>
<span id="cb1999-3"><a href="ggplotvis.html#cb1999-3"></a>ps1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(iris, ps1)</span></code></pre></div>
<p>前两个主成分解释了原始变量中98%的方差。</p>
<p>作第一和第二主成分的散点图：</p>
<div class="sourceCode" id="cb2000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2000-1"><a href="ggplotvis.html#cb2000-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">as.data.frame</span>(ps1), <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2000-2"><a href="ggplotvis.html#cb2000-2"></a>  <span class="dt">x =</span> Comp<span class="fl">.1</span>, <span class="dt">y =</span> Comp<span class="fl">.2</span>, <span class="dt">color =</span> Species))</span>
<span id="cb2000-3"><a href="ggplotvis.html#cb2000-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">2.0</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-pca01b-1.png" width="672" /></p>
<p>主成分分析取前两个主成分在各原始变量上的载荷可以做矢量图，
用来表示各个原始变量与主成分的关系：</p>
<div class="sourceCode" id="cb2001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2001-1"><a href="ggplotvis.html#cb2001-1"></a>d &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(load1[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])</span>
<span id="cb2001-2"><a href="ggplotvis.html#cb2001-2"></a>d<span class="op">$</span>vlabel &lt;-<span class="st"> </span><span class="kw">rownames</span>(d)</span>
<span id="cb2001-3"><a href="ggplotvis.html#cb2001-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2001-4"><a href="ggplotvis.html#cb2001-4"></a>  <span class="dt">x =</span> Comp<span class="fl">.1</span>, <span class="dt">y =</span> Comp<span class="fl">.2</span>, <span class="dt">label =</span> vlabel))</span>
<span id="cb2001-5"><a href="ggplotvis.html#cb2001-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_segment</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2001-6"><a href="ggplotvis.html#cb2001-6"></a>  <span class="dt">xend =</span> Comp<span class="fl">.1</span>, <span class="dt">yend =</span> Comp<span class="fl">.2</span>),</span>
<span id="cb2001-7"><a href="ggplotvis.html#cb2001-7"></a>  <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">0</span>, </span>
<span id="cb2001-8"><a href="ggplotvis.html#cb2001-8"></a>  <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">angle =</span> <span class="dv">15</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2001-9"><a href="ggplotvis.html#cb2001-9"></a><span class="st">  </span><span class="kw">geom_text_repel</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-pca01c-1.png" width="672" /></p>
<p>可以将降维的散点图与变量的载荷图画在同一坐标系内：</p>
<div class="sourceCode" id="cb2002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2002-1"><a href="ggplotvis.html#cb2002-1"></a>d &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(load1[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])</span>
<span id="cb2002-2"><a href="ggplotvis.html#cb2002-2"></a>d<span class="op">$</span>vlabel &lt;-<span class="st"> </span><span class="kw">rownames</span>(d)</span>
<span id="cb2002-3"><a href="ggplotvis.html#cb2002-3"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb2002-4"><a href="ggplotvis.html#cb2002-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> ps1, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2002-5"><a href="ggplotvis.html#cb2002-5"></a>  <span class="dt">x =</span> Comp<span class="fl">.1</span>, <span class="dt">y =</span> Comp<span class="fl">.2</span>, <span class="dt">color =</span> Species),</span>
<span id="cb2002-6"><a href="ggplotvis.html#cb2002-6"></a>  <span class="dt">size =</span> <span class="fl">2.0</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb2002-7"><a href="ggplotvis.html#cb2002-7"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2002-8"><a href="ggplotvis.html#cb2002-8"></a>  <span class="dt">xend =</span> Comp<span class="fl">.1</span>, <span class="dt">yend =</span> Comp<span class="fl">.2</span>),</span>
<span id="cb2002-9"><a href="ggplotvis.html#cb2002-9"></a>  <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">0</span>, </span>
<span id="cb2002-10"><a href="ggplotvis.html#cb2002-10"></a>  <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">angle =</span> <span class="dv">15</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb2002-11"><a href="ggplotvis.html#cb2002-11"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2002-12"><a href="ggplotvis.html#cb2002-12"></a>  <span class="dt">x =</span> Comp<span class="fl">.1</span>, <span class="dt">y =</span> Comp<span class="fl">.2</span>, <span class="dt">label =</span> vlabel),</span>
<span id="cb2002-13"><a href="ggplotvis.html#cb2002-13"></a>  <span class="dt">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-iris-pca01d-1.png" width="672" /></p>
</div>
<div id="ggplotvis-mulvar-paird" class="section level3">
<h3><span class="header-section-number">30.5.5</span> 成对数据</h3>
<p>成对数据指同一个变量在两个不同时间的测量值，
或者同一个体两个取值基本相同的变量。
作散点图时，
增加<span class="math inline">\(y = x\)</span>直线是显然的一个增强显示。
另外，
还应该强调两个变量之间的差别。</p>
<p>考虑boot扩展包的cd4数据集，
这个数据集包含了20名临床试验受试者在开始时和一年以后的cd4指标测量值。
作这两个指标的散点图：</p>
<div class="sourceCode" id="cb2003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2003-1"><a href="ggplotvis.html#cb2003-1"></a><span class="kw">data</span>(cd4, <span class="dt">package =</span> <span class="st">&quot;boot&quot;</span>)</span>
<span id="cb2003-2"><a href="ggplotvis.html#cb2003-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> cd4, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2003-3"><a href="ggplotvis.html#cb2003-3"></a>  <span class="dt">x =</span> baseline, <span class="dt">y =</span> oneyear))</span>
<span id="cb2003-4"><a href="ggplotvis.html#cb2003-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">2.0</span>) <span class="op">+</span></span>
<span id="cb2003-5"><a href="ggplotvis.html#cb2003-5"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb2003-6"><a href="ggplotvis.html#cb2003-6"></a><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">1.80</span>, <span class="fl">6.40</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">1.80</span>, <span class="fl">6.40</span>))</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-cd4-pair01-1.png" width="672" /></p>
<p>程序中用了<code>geom_abline()</code>作斜线，
用了<code>coord_fixed()</code>指定1:1的宽高比并设定x轴和y轴相同的坐标范围。
可以看出一年后的测量值普遍高于开始时的测量值。</p>
<p>当观测个数较少时，
可以用线段连接每个观测的两个变量值，
并标出每个观测的标签。</p>
<div class="sourceCode" id="cb2004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2004-1"><a href="ggplotvis.html#cb2004-1"></a><span class="kw">data</span>(organdata, <span class="dt">package =</span> <span class="st">&quot;socviz&quot;</span>)</span>
<span id="cb2004-2"><a href="ggplotvis.html#cb2004-2"></a>organdata <span class="op">%&gt;%</span></span>
<span id="cb2004-3"><a href="ggplotvis.html#cb2004-3"></a><span class="st">  </span><span class="kw">select</span>(country, year, donors) <span class="op">%&gt;%</span></span>
<span id="cb2004-4"><a href="ggplotvis.html#cb2004-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> lubridate<span class="op">::</span><span class="kw">year</span>(year)) <span class="op">%&gt;%</span></span>
<span id="cb2004-5"><a href="ggplotvis.html#cb2004-5"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1991</span>, <span class="dv">2002</span>)) -&gt;<span class="st"> </span>dorgans</span>
<span id="cb2004-6"><a href="ggplotvis.html#cb2004-6"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dorgans, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2004-7"><a href="ggplotvis.html#cb2004-7"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> donors))</span>
<span id="cb2004-8"><a href="ggplotvis.html#cb2004-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country)) <span class="op">+</span></span>
<span id="cb2004-9"><a href="ggplotvis.html#cb2004-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">2.0</span>) <span class="op">+</span></span>
<span id="cb2004-10"><a href="ggplotvis.html#cb2004-10"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> <span class="kw">filter</span>(dorgans, year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>),</span>
<span id="cb2004-11"><a href="ggplotvis.html#cb2004-11"></a>            <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2004-12"><a href="ggplotvis.html#cb2004-12"></a>              <span class="dt">x =</span> year, <span class="dt">y =</span> donors,</span>
<span id="cb2004-13"><a href="ggplotvis.html#cb2004-13"></a>              <span class="dt">label =</span> country),</span>
<span id="cb2004-14"><a href="ggplotvis.html#cb2004-14"></a>            <span class="dt">direction =</span> <span class="st">&quot;x&quot;</span>) <span class="op">+</span></span>
<span id="cb2004-15"><a href="ggplotvis.html#cb2004-15"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(</span>
<span id="cb2004-16"><a href="ggplotvis.html#cb2004-16"></a>    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1991</span>, <span class="dv">2002</span>),</span>
<span id="cb2004-17"><a href="ggplotvis.html#cb2004-17"></a>    <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1991</span>, <span class="dv">2005</span>),</span>
<span id="cb2004-18"><a href="ggplotvis.html#cb2004-18"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;1991&quot;</span>, <span class="st">&quot;2002&quot;</span>))</span></code></pre></div>
<p><img src="static/picture/ggvis-mv-organ-pair01-1.png" width="672" /></p>
<p>可以看出，这种图可以表现超过两个变量。</p>
</div>
</div>
<div id="ggplotvis-ts" class="section level2">
<h2><span class="header-section-number">30.6</span> 时间序列图</h2>
<p>某个指标随时间变化的数据称为时间序列，
可以以时间为横坐标、该指标为纵坐标作折线图，
称为时间序列图。
其它有次序的变量也可以用作横轴变量。</p>
<p><code>geom_line()</code>函数会自动按照x轴变量的次序连线，
即使数据中的x变量没有从小到大排列都是如此。
<code>geom_path()</code>则按照数据集中原有次序连线。</p>
<div id="ggplotvis-ts-uni" class="section level3">
<h3><span class="header-section-number">30.6.1</span> 一元时间序列</h3>
<p>R软件中提供了一个示例用的时间序列数据AirPassengers，
是美国泛美航空公司1949-1960的国际航班订票数的月度数据（单位：千人），
12 年144个月的数据。</p>
<p>作其散点图：</p>
<div class="sourceCode" id="cb2005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2005-1"><a href="ggplotvis.html#cb2005-1"></a>dap &lt;-<span class="st"> </span>AirPassengers <span class="op">%&gt;%</span><span class="st"> </span>{</span>
<span id="cb2005-2"><a href="ggplotvis.html#cb2005-2"></a>  <span class="kw">tibble</span>(</span>
<span id="cb2005-3"><a href="ggplotvis.html#cb2005-3"></a>    <span class="dt">time =</span> <span class="kw">as.vector</span>(<span class="kw">time</span>(.)),</span>
<span id="cb2005-4"><a href="ggplotvis.html#cb2005-4"></a>    <span class="dt">passengers =</span> <span class="kw">as.vector</span>(.)) }</span>
<span id="cb2005-5"><a href="ggplotvis.html#cb2005-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dap, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2005-6"><a href="ggplotvis.html#cb2005-6"></a>  <span class="dt">x =</span> time, <span class="dt">y =</span> passengers))</span>
<span id="cb2005-7"><a href="ggplotvis.html#cb2005-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap01-1.png" width="672" /></p>
<p>这样的图形在点数较少时还好，
点数较多时不易分辨出局部随时间的变化情况。
加上连线：</p>
<div class="sourceCode" id="cb2006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2006-1"><a href="ggplotvis.html#cb2006-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb2006-2"><a href="ggplotvis.html#cb2006-2"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap01b-1.png" width="672" /></p>
<p>也可以仅连线，不画散点：</p>
<div class="sourceCode" id="cb2007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2007-1"><a href="ggplotvis.html#cb2007-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap01c-1.png" width="672" /></p>
<p>仅画线的时间序列图更强调变化趋势，
不强调个别数据，
当观测点很多时一般不画出散点。</p>
<p>这里的时间是<code>time()</code>函数返回的以年为单位的浮点数值。
时间序列的时间往往是日期值，
尤其是日数据，
可以用<code>scale_x_date()</code>函数标日期，如：</p>
<div class="sourceCode" id="cb2008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2008-1"><a href="ggplotvis.html#cb2008-1"></a><span class="kw">library</span>(xts)</span>
<span id="cb2008-2"><a href="ggplotvis.html#cb2008-2"></a>dap2 &lt;-<span class="st"> </span>AirPassengers <span class="op">%&gt;%</span></span>
<span id="cb2008-3"><a href="ggplotvis.html#cb2008-3"></a><span class="st">  </span><span class="kw">as.xts</span>() <span class="op">%&gt;%</span><span class="st"> </span>{</span>
<span id="cb2008-4"><a href="ggplotvis.html#cb2008-4"></a>  <span class="kw">tibble</span>(</span>
<span id="cb2008-5"><a href="ggplotvis.html#cb2008-5"></a>    <span class="dt">yearmon =</span> <span class="kw">index</span>(.),</span>
<span id="cb2008-6"><a href="ggplotvis.html#cb2008-6"></a>    <span class="dt">time =</span> <span class="kw">as.Date</span>(yearmon),</span>
<span id="cb2008-7"><a href="ggplotvis.html#cb2008-7"></a>    <span class="dt">passengers =</span> <span class="kw">c</span>(<span class="kw">coredata</span>(.))) }</span>
<span id="cb2008-8"><a href="ggplotvis.html#cb2008-8"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">head</span>(dap2, <span class="dv">6</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">yearmon</th>
<th align="left">time</th>
<th align="right">passengers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1月 1949</td>
<td align="left">1949-01-01</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="left">2月 1949</td>
<td align="left">1949-02-01</td>
<td align="right">118</td>
</tr>
<tr class="odd">
<td align="left">3月 1949</td>
<td align="left">1949-03-01</td>
<td align="right">132</td>
</tr>
<tr class="even">
<td align="left">4月 1949</td>
<td align="left">1949-04-01</td>
<td align="right">129</td>
</tr>
<tr class="odd">
<td align="left">5月 1949</td>
<td align="left">1949-05-01</td>
<td align="right">121</td>
</tr>
<tr class="even">
<td align="left">6月 1949</td>
<td align="left">1949-06-01</td>
<td align="right">135</td>
</tr>
</tbody>
</table>
<p>数据框dap2中的yearmon是年月格式的时间，
time是年月日格式的时间。
先用年月格式的时间作图：</p>
<div class="sourceCode" id="cb2009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2009-1"><a href="ggplotvis.html#cb2009-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dap2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2009-2"><a href="ggplotvis.html#cb2009-2"></a>  <span class="dt">x =</span> yearmon, <span class="dt">y =</span> passengers))</span>
<span id="cb2009-3"><a href="ggplotvis.html#cb2009-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap02a-1.png" width="672" /></p>
<p>ggplot2不支持对年月类型的时间轴进行调整。
为了自定义时间轴，需要使用日期格式的坐标轴，
使用dap2数据框中的time列：</p>
<div class="sourceCode" id="cb2010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2010-1"><a href="ggplotvis.html#cb2010-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dap2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2010-2"><a href="ggplotvis.html#cb2010-2"></a>  <span class="dt">x =</span> time, <span class="dt">y =</span> passengers))</span>
<span id="cb2010-3"><a href="ggplotvis.html#cb2010-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb2010-4"><a href="ggplotvis.html#cb2010-4"></a><span class="st">  </span><span class="kw">scale_x_date</span>(</span>
<span id="cb2010-5"><a href="ggplotvis.html#cb2010-5"></a>    <span class="dt">name =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb2010-6"><a href="ggplotvis.html#cb2010-6"></a>    <span class="dt">date_breaks =</span> <span class="st">&quot;5 years&quot;</span>,</span>
<span id="cb2010-7"><a href="ggplotvis.html#cb2010-7"></a>    <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>,</span>
<span id="cb2010-8"><a href="ggplotvis.html#cb2010-8"></a>    <span class="dt">date_minor_breaks =</span> <span class="st">&quot;1 year&quot;</span>,</span>
<span id="cb2010-9"><a href="ggplotvis.html#cb2010-9"></a>    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) </span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap02a2-1.png" width="672" /></p>
<p>程序中的time变量是Date类型的日期时间，
用<code>date_breaks</code>选项指定日期轴刻度值的频率，
<code>"5 years"</code>就是每5年一个刻度值。
用<code>date_minor_breaks</code>选项指定细刻度的频率。
<code>date_labels</code>是日期刻度的一种格式规定，
比如<code>"%Y"</code>是四位数的年份，<code>"%Y-%m"</code>是年月格式，
等等。
因为是月度数据，
所以刻度线所在的数据点对应该年的1月份。</p>
<p>如果需要人为指定刻度位置，
可以去掉<code>date_breaks</code>参数，
改用<code>breaks</code>参数，如：</p>
<div class="sourceCode" id="cb2011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2011-1"><a href="ggplotvis.html#cb2011-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb2011-2"><a href="ggplotvis.html#cb2011-2"></a><span class="st">  </span><span class="kw">scale_x_date</span>(</span>
<span id="cb2011-3"><a href="ggplotvis.html#cb2011-3"></a>    <span class="dt">name =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb2011-4"><a href="ggplotvis.html#cb2011-4"></a>    <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1950</span>, <span class="dv">1955</span>, <span class="dv">1960</span>)),</span>
<span id="cb2011-5"><a href="ggplotvis.html#cb2011-5"></a>    <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>,</span>
<span id="cb2011-6"><a href="ggplotvis.html#cb2011-6"></a>    <span class="dt">date_minor_breaks =</span> <span class="st">&quot;1 year&quot;</span>,</span>
<span id="cb2011-7"><a href="ggplotvis.html#cb2011-7"></a>    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) </span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap02b-1.png" width="672" /></p>
<p>还可以在线下加阴影，
但这时y轴应为正值变量且坐标范围从0开始，
如：</p>
<div class="sourceCode" id="cb2012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2012-1"><a href="ggplotvis.html#cb2012-1"></a><span class="kw">library</span>(ggridges)</span>
<span id="cb2012-2"><a href="ggplotvis.html#cb2012-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dap2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2012-3"><a href="ggplotvis.html#cb2012-3"></a>  <span class="dt">x =</span> <span class="kw">as.Date</span>(time), <span class="dt">height =</span> passengers, <span class="dt">y =</span> <span class="dv">0</span>))</span>
<span id="cb2012-4"><a href="ggplotvis.html#cb2012-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_ridgeline</span>() <span class="op">+</span></span>
<span id="cb2012-5"><a href="ggplotvis.html#cb2012-5"></a><span class="st">  </span><span class="kw">scale_x_date</span>(</span>
<span id="cb2012-6"><a href="ggplotvis.html#cb2012-6"></a>    <span class="dt">name =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb2012-7"><a href="ggplotvis.html#cb2012-7"></a>    <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1950</span>, <span class="dv">1955</span>, <span class="dv">1960</span>)),</span>
<span id="cb2012-8"><a href="ggplotvis.html#cb2012-8"></a>    <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>,</span>
<span id="cb2012-9"><a href="ggplotvis.html#cb2012-9"></a>    <span class="dt">date_minor_breaks =</span> <span class="st">&quot;1 year&quot;</span>,</span>
<span id="cb2012-10"><a href="ggplotvis.html#cb2012-10"></a>    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) </span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap02c-1.png" width="672" /></p>
<p>上面的程序用了ggridges包的<code>geom_ridgeline()</code>函数，
y轴对应于<code>height</code>维。</p>
<p>有时需要用不同阴影色标出不同的时间段，
可以使用<code>annotate()</code>函数，
指定<code>geom</code>为<code>"rect"</code>，
需要<code>xmin</code>, <code>xmax</code>, <code>ymin</code>, <code>ymax</code>参数，
可用用alpha指定一定透明度，用<code>fill</code>指定填充颜色。
例如，将时间分为1949-1954, 1955-1960两段，
用不同颜色填充：</p>
<div class="sourceCode" id="cb2013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2013-1"><a href="ggplotvis.html#cb2013-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dap2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2013-2"><a href="ggplotvis.html#cb2013-2"></a>  <span class="dt">x =</span> time, <span class="dt">y =</span> passengers))</span>
<span id="cb2013-3"><a href="ggplotvis.html#cb2013-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb2013-4"><a href="ggplotvis.html#cb2013-4"></a><span class="st">  </span><span class="kw">annotate</span>(</span>
<span id="cb2013-5"><a href="ggplotvis.html#cb2013-5"></a>    <span class="dt">geom =</span> <span class="st">&quot;rect&quot;</span>,</span>
<span id="cb2013-6"><a href="ggplotvis.html#cb2013-6"></a>    <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>, </span>
<span id="cb2013-7"><a href="ggplotvis.html#cb2013-7"></a>    <span class="dt">xmin =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1949</span>, <span class="dv">1955</span>)),</span>
<span id="cb2013-8"><a href="ggplotvis.html#cb2013-8"></a>    <span class="dt">xmax =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1955</span>, <span class="dv">1961</span>)),</span>
<span id="cb2013-9"><a href="ggplotvis.html#cb2013-9"></a>    <span class="dt">fill =</span> <span class="kw">c</span>(<span class="st">&quot;lightgreen&quot;</span>, <span class="st">&quot;lightblue&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb2013-10"><a href="ggplotvis.html#cb2013-10"></a><span class="st">  </span><span class="kw">scale_x_date</span>(</span>
<span id="cb2013-11"><a href="ggplotvis.html#cb2013-11"></a>    <span class="dt">name =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb2013-12"><a href="ggplotvis.html#cb2013-12"></a>    <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1949</span>, <span class="dv">1955</span>, <span class="dv">1960</span>)),</span>
<span id="cb2013-13"><a href="ggplotvis.html#cb2013-13"></a>    <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>,</span>
<span id="cb2013-14"><a href="ggplotvis.html#cb2013-14"></a>    <span class="dt">date_minor_breaks =</span> <span class="st">&quot;1 year&quot;</span>,</span>
<span id="cb2013-15"><a href="ggplotvis.html#cb2013-15"></a>    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb2013-16"><a href="ggplotvis.html#cb2013-16"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap02d-1.png" width="672" /></p>
<p>分时间段染色的另一种办法是使用<code>geom_rect()</code>函数，
这时需要有另一个输入数据框，
填充色可以自动映射，
画曲线与染色的函数要分别输入数据内容：</p>
<div class="sourceCode" id="cb2014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2014-1"><a href="ggplotvis.html#cb2014-1"></a>dap2b &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb2014-2"><a href="ggplotvis.html#cb2014-2"></a>  <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>,</span>
<span id="cb2014-3"><a href="ggplotvis.html#cb2014-3"></a>  <span class="dt">xmin =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1949</span>, <span class="dv">1955</span>)),</span>
<span id="cb2014-4"><a href="ggplotvis.html#cb2014-4"></a>  <span class="dt">xmax =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1955</span>, <span class="dv">1961</span>)),</span>
<span id="cb2014-5"><a href="ggplotvis.html#cb2014-5"></a>  <span class="dt">period =</span> <span class="kw">c</span>(<span class="st">&quot;First&quot;</span>, <span class="st">&quot;Second&quot;</span>))</span>
<span id="cb2014-6"><a href="ggplotvis.html#cb2014-6"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>()</span>
<span id="cb2014-7"><a href="ggplotvis.html#cb2014-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data =</span> dap2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2014-8"><a href="ggplotvis.html#cb2014-8"></a>  <span class="dt">x =</span> time, <span class="dt">y =</span> passengers)) <span class="op">+</span></span>
<span id="cb2014-9"><a href="ggplotvis.html#cb2014-9"></a><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> dap2b, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2014-10"><a href="ggplotvis.html#cb2014-10"></a>    <span class="dt">xmin =</span> xmin, </span>
<span id="cb2014-11"><a href="ggplotvis.html#cb2014-11"></a>    <span class="dt">xmax =</span> xmax,</span>
<span id="cb2014-12"><a href="ggplotvis.html#cb2014-12"></a>    <span class="dt">ymin =</span> ymin, <span class="dt">ymax =</span> ymax,</span>
<span id="cb2014-13"><a href="ggplotvis.html#cb2014-13"></a>    <span class="dt">fill =</span> period ), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb2014-14"><a href="ggplotvis.html#cb2014-14"></a><span class="st">  </span><span class="kw">scale_x_date</span>(</span>
<span id="cb2014-15"><a href="ggplotvis.html#cb2014-15"></a>    <span class="dt">name =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb2014-16"><a href="ggplotvis.html#cb2014-16"></a>    <span class="dt">breaks =</span> lubridate<span class="op">::</span><span class="kw">make_date</span>(<span class="kw">c</span>(<span class="dv">1949</span>, <span class="dv">1955</span>, <span class="dv">1960</span>)),</span>
<span id="cb2014-17"><a href="ggplotvis.html#cb2014-17"></a>    <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>,</span>
<span id="cb2014-18"><a href="ggplotvis.html#cb2014-18"></a>    <span class="dt">date_minor_breaks =</span> <span class="st">&quot;1 year&quot;</span>,</span>
<span id="cb2014-19"><a href="ggplotvis.html#cb2014-19"></a>    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb2014-20"><a href="ggplotvis.html#cb2014-20"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-ap02e-1.png" width="672" /></p>
<p>下面作一个日数据的时间序列图。
用quantmod包从雅虎金融下载标普500指数的日数据：</p>
<div class="sourceCode" id="cb2015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2015-1"><a href="ggplotvis.html#cb2015-1"></a><span class="kw">library</span>(quantmod)</span>
<span id="cb2015-2"><a href="ggplotvis.html#cb2015-2"></a>sp &lt;-<span class="st"> </span><span class="kw">getSymbols</span>(</span>
<span id="cb2015-3"><a href="ggplotvis.html#cb2015-3"></a>  <span class="st">&quot;^GSPC&quot;</span>, <span class="dt">src =</span> <span class="st">&quot;yahoo&quot;</span>, <span class="dt">auto.assign =</span> <span class="ot">FALSE</span></span>
<span id="cb2015-4"><a href="ggplotvis.html#cb2015-4"></a>)</span>
<span id="cb2015-5"><a href="ggplotvis.html#cb2015-5"></a><span class="kw">save</span>(sp, <span class="dt">file=</span><span class="st">&quot;sp500.RData&quot;</span>)</span></code></pre></div>
<pre><code>##            GSPC.Open GSPC.High GSPC.Low GSPC.Close GSPC.Volume GSPC.Adjusted
## 2007-01-03   1418.03   1429.42  1407.86    1416.60  3429160000       1416.60
## 2007-01-04   1416.60   1421.84  1408.43    1418.34  3004460000       1418.34
## 2007-01-05   1418.34   1418.34  1405.75    1409.71  2919400000       1409.71
## 2007-01-08   1409.26   1414.98  1403.97    1412.84  2763340000       1412.84
## 2007-01-09   1412.84   1415.61  1405.42    1412.11  3038380000       1412.11
## 2007-01-10   1408.70   1415.99  1405.32    1414.85  2764660000       1414.85</code></pre>
<p>quantmod包也能做时间序列图，
还可以做K线图、叠加各种技术曲线的图形。</p>
<p>用ggplot作标普500近10年的日收盘价时间序列图，
不对坐标轴作调整：</p>
<div class="sourceCode" id="cb2017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2017-1"><a href="ggplotvis.html#cb2017-1"></a>dsp &lt;-<span class="st"> </span>sp[<span class="st">&quot;2010/&quot;</span>] <span class="op">%&gt;%</span></span>
<span id="cb2017-2"><a href="ggplotvis.html#cb2017-2"></a><span class="st">  </span><span class="kw">tibble</span>(</span>
<span id="cb2017-3"><a href="ggplotvis.html#cb2017-3"></a>    <span class="dt">time =</span> <span class="kw">index</span>(.),</span>
<span id="cb2017-4"><a href="ggplotvis.html#cb2017-4"></a>    <span class="dt">sp500 =</span> <span class="kw">coredata</span>(.)[,<span class="st">&quot;GSPC.Close&quot;</span>])</span>
<span id="cb2017-5"><a href="ggplotvis.html#cb2017-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dsp, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2017-6"><a href="ggplotvis.html#cb2017-6"></a>  <span class="dt">x =</span> time, <span class="dt">y =</span> sp500))</span>
<span id="cb2017-7"><a href="ggplotvis.html#cb2017-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-gspc03-1.png" width="672" /></p>
<p>刻度每年：</p>
<div class="sourceCode" id="cb2018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2018-1"><a href="ggplotvis.html#cb2018-1"></a>dsp &lt;-<span class="st"> </span>sp[<span class="st">&quot;2010/&quot;</span>] <span class="op">%&gt;%</span></span>
<span id="cb2018-2"><a href="ggplotvis.html#cb2018-2"></a><span class="st">  </span><span class="kw">tibble</span>(</span>
<span id="cb2018-3"><a href="ggplotvis.html#cb2018-3"></a>    <span class="dt">time =</span> <span class="kw">index</span>(.),</span>
<span id="cb2018-4"><a href="ggplotvis.html#cb2018-4"></a>    <span class="dt">sp500 =</span> <span class="kw">coredata</span>(.)[,<span class="st">&quot;GSPC.Close&quot;</span>])</span>
<span id="cb2018-5"><a href="ggplotvis.html#cb2018-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dsp, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2018-6"><a href="ggplotvis.html#cb2018-6"></a>  <span class="dt">x =</span> time, <span class="dt">y =</span> sp500))</span>
<span id="cb2018-7"><a href="ggplotvis.html#cb2018-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb2018-8"><a href="ggplotvis.html#cb2018-8"></a><span class="st">  </span><span class="kw">scale_x_date</span>(</span>
<span id="cb2018-9"><a href="ggplotvis.html#cb2018-9"></a>    <span class="dt">name =</span> <span class="ot">NULL</span>,</span>
<span id="cb2018-10"><a href="ggplotvis.html#cb2018-10"></a>    <span class="dt">date_breaks =</span> <span class="st">&quot;1 year&quot;</span>,</span>
<span id="cb2018-11"><a href="ggplotvis.html#cb2018-11"></a>    <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>,</span>
<span id="cb2018-12"><a href="ggplotvis.html#cb2018-12"></a>    <span class="dt">date_minor_breaks =</span> <span class="st">&quot;1 year&quot;</span>) </span></code></pre></div>
<p><img src="static/picture/ggvis-ts-gspc03b-1.png" width="672" /></p>
</div>
<div id="ggplotvis-ts-mul" class="section level3">
<h3><span class="header-section-number">30.6.2</span> 多元时间序列</h3>
<p>随时间记录的指标可以有多个。
当这些指标的取值范围相近时，
可以共用一个y轴，
每个指标单独做连线并画在同一坐标系中。
要注意的是，
ggplot作多元时间序列图时需要长表数据而非宽表数据，
纵坐标变量必须保存在数据集的一个变量中，
用另外的变量区分不同的指标。
例如，
北京地区从1949年到1964年的受灾面积与成灾面积（单位：万亩）年数据。</p>
<div class="sourceCode" id="cb2019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2019-1"><a href="ggplotvis.html#cb2019-1"></a>dflood &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(</span>
<span id="cb2019-2"><a href="ggplotvis.html#cb2019-2"></a><span class="dv">1949</span> , <span class="dv">1</span> , <span class="fl">331.12</span> , <span class="fl">243.96</span> ,</span>
<span id="cb2019-3"><a href="ggplotvis.html#cb2019-3"></a><span class="dv">1950</span> , <span class="dv">2</span> , <span class="fl">380.44</span> , <span class="fl">293.90</span> ,</span>
<span id="cb2019-4"><a href="ggplotvis.html#cb2019-4"></a><span class="dv">1951</span> , <span class="dv">3</span> , <span class="fl">59.63</span> , <span class="fl">59.63</span>,</span>
<span id="cb2019-5"><a href="ggplotvis.html#cb2019-5"></a><span class="dv">1952</span> , <span class="dv">4</span> , <span class="fl">37.89</span> , <span class="fl">18.09</span>,</span>
<span id="cb2019-6"><a href="ggplotvis.html#cb2019-6"></a><span class="dv">1953</span> , <span class="dv">5</span> , <span class="fl">103.66</span> ,<span class="fl">72.92</span>,</span>
<span id="cb2019-7"><a href="ggplotvis.html#cb2019-7"></a><span class="dv">1954</span> , <span class="dv">6</span> , <span class="fl">316.67</span> , <span class="fl">244.57</span>,</span>
<span id="cb2019-8"><a href="ggplotvis.html#cb2019-8"></a><span class="dv">1955</span> , <span class="dv">7</span> , <span class="fl">208.72</span> , <span class="fl">155.77</span>,</span>
<span id="cb2019-9"><a href="ggplotvis.html#cb2019-9"></a><span class="dv">1956</span> , <span class="dv">8</span> , <span class="fl">288.79</span> , <span class="fl">255.22</span>,</span>
<span id="cb2019-10"><a href="ggplotvis.html#cb2019-10"></a><span class="dv">1957</span> , <span class="dv">9</span> , <span class="fl">25.00</span> , <span class="fl">0.50</span>,</span>
<span id="cb2019-11"><a href="ggplotvis.html#cb2019-11"></a><span class="dv">1958</span> , <span class="dv">10</span> , <span class="fl">84.72</span> , <span class="fl">48.59</span>,</span>
<span id="cb2019-12"><a href="ggplotvis.html#cb2019-12"></a><span class="dv">1959</span> , <span class="dv">11</span> , <span class="fl">260.89</span> ,<span class="fl">202.96</span>,</span>
<span id="cb2019-13"><a href="ggplotvis.html#cb2019-13"></a><span class="dv">1960</span>, <span class="dv">12</span> , <span class="fl">27.18</span> ,<span class="fl">15.02</span>,</span>
<span id="cb2019-14"><a href="ggplotvis.html#cb2019-14"></a><span class="dv">1961</span>, <span class="dv">13</span> , <span class="fl">20.74</span> ,<span class="fl">17.09</span>,</span>
<span id="cb2019-15"><a href="ggplotvis.html#cb2019-15"></a><span class="dv">1962</span> , <span class="dv">14</span> , <span class="fl">52.99</span> ,<span class="fl">14.66</span>,</span>
<span id="cb2019-16"><a href="ggplotvis.html#cb2019-16"></a><span class="dv">1963</span> , <span class="dv">15</span> , <span class="fl">99.25</span> , <span class="fl">45.61</span>,</span>
<span id="cb2019-17"><a href="ggplotvis.html#cb2019-17"></a><span class="dv">1964</span> , <span class="dv">16</span> , <span class="fl">55.36</span> ,<span class="fl">41.90</span>),</span>
<span id="cb2019-18"><a href="ggplotvis.html#cb2019-18"></a><span class="dt">byrow=</span><span class="ot">TRUE</span>, <span class="dt">ncol=</span><span class="dv">4</span>,</span>
<span id="cb2019-19"><a href="ggplotvis.html#cb2019-19"></a><span class="dt">dimnames=</span><span class="kw">list</span>(<span class="dv">1949</span><span class="op">:</span><span class="dv">1964</span>,</span>
<span id="cb2019-20"><a href="ggplotvis.html#cb2019-20"></a><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;t&quot;</span>, <span class="st">&quot;area1&quot;</span>, <span class="st">&quot;area2&quot;</span>))))</span>
<span id="cb2019-21"><a href="ggplotvis.html#cb2019-21"></a>dflood2 &lt;-<span class="st"> </span>dflood <span class="op">%&gt;%</span></span>
<span id="cb2019-22"><a href="ggplotvis.html#cb2019-22"></a><span class="st">  </span><span class="kw">gather</span>(area1, area2, <span class="dt">key =</span> <span class="st">&quot;类型&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;面积&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb2019-23"><a href="ggplotvis.html#cb2019-23"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">类型</span><span class="st">`</span> =<span class="st"> </span><span class="kw">factor</span>(</span>
<span id="cb2019-24"><a href="ggplotvis.html#cb2019-24"></a>    <span class="st">`</span><span class="dt">类型</span><span class="st">`</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;area1&quot;</span>, <span class="st">&quot;area2&quot;</span>),</span>
<span id="cb2019-25"><a href="ggplotvis.html#cb2019-25"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;受灾面积&quot;</span>, <span class="st">&quot;成灾面积&quot;</span>)))</span>
<span id="cb2019-26"><a href="ggplotvis.html#cb2019-26"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dflood2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2019-27"><a href="ggplotvis.html#cb2019-27"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> <span class="st">`</span><span class="dt">面积</span><span class="st">`</span>, <span class="dt">color =</span> <span class="st">`</span><span class="dt">类型</span><span class="st">`</span>))</span>
<span id="cb2019-28"><a href="ggplotvis.html#cb2019-28"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-flood01-1.png" width="672" /></p>
<p>可以用<code>guides(label.position)</code>指定<code>"top"</code>, <code>"bottom"</code>,
<code>"left"</code>, <code>"right"</code>这样的图例位置，
还可以用<code>theme()</code>函数将图例指定在坐标系内部：</p>
<div class="sourceCode" id="cb2020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2020-1"><a href="ggplotvis.html#cb2020-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb2020-2"><a href="ggplotvis.html#cb2020-2"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb2020-3"><a href="ggplotvis.html#cb2020-3"></a>    <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.98</span>, <span class="fl">0.98</span>),</span>
<span id="cb2020-4"><a href="ggplotvis.html#cb2020-4"></a>    <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)  )</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-flood01b-1.png" width="672" /></p>
<p><code>theme()</code>函数中<code>legend.position</code>给出的是图例框在坐标系内的百分比位置，
<code>legend.justification</code>给出的是图例框坐标的百分比对齐位置，
<code>c(1,1)</code>是将图例框的右上角对齐到给定百分比坐标位置。</p>
<p>也可以去掉图例，
而是用y轴的第二坐标轴（画在右侧）的办法直接标出两个序列的标签。
如：</p>
<div class="sourceCode" id="cb2021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2021-1"><a href="ggplotvis.html#cb2021-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb2021-2"><a href="ggplotvis.html#cb2021-2"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb2021-3"><a href="ggplotvis.html#cb2021-3"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb2021-4"><a href="ggplotvis.html#cb2021-4"></a>    <span class="dt">sec.axis =</span> <span class="kw">dup_axis</span>(</span>
<span id="cb2021-5"><a href="ggplotvis.html#cb2021-5"></a>      <span class="dt">name =</span> <span class="ot">NULL</span>,</span>
<span id="cb2021-6"><a href="ggplotvis.html#cb2021-6"></a>      <span class="dt">breaks =</span> <span class="kw">subset</span>(dflood2, year <span class="op">==</span><span class="st"> </span><span class="dv">1964</span>)[[<span class="st">&quot;面积&quot;</span>]],</span>
<span id="cb2021-7"><a href="ggplotvis.html#cb2021-7"></a>      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;受灾面积&quot;</span>, <span class="st">&quot;成灾面积&quot;</span>)))</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-flood01c-1.png" width="672" /></p>
<p>上面的做法需要将两条曲线的数据合并在一个变量中，
并用一个分组变量区分两条曲线。
如果数据原来在两列中，
可以调用两次<code>geom_line()</code>，
但颜色和图例就需要人为指定了，如：</p>
<div class="sourceCode" id="cb2022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2022-1"><a href="ggplotvis.html#cb2022-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dflood)</span>
<span id="cb2022-2"><a href="ggplotvis.html#cb2022-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2022-3"><a href="ggplotvis.html#cb2022-3"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> area1, <span class="dt">color =</span> <span class="st">&quot;受灾面积&quot;</span>)) <span class="op">+</span></span>
<span id="cb2022-4"><a href="ggplotvis.html#cb2022-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2022-5"><a href="ggplotvis.html#cb2022-5"></a>    <span class="dt">x =</span> year, <span class="dt">y =</span> area2, <span class="dt">color =</span> <span class="st">&quot;成灾面积&quot;</span>)) <span class="op">+</span></span>
<span id="cb2022-6"><a href="ggplotvis.html#cb2022-6"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb2022-7"><a href="ggplotvis.html#cb2022-7"></a>    <span class="dt">name =</span> <span class="ot">NULL</span>,</span>
<span id="cb2022-8"><a href="ggplotvis.html#cb2022-8"></a>    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;受灾面积&quot;</span>, <span class="st">&quot;成灾面积&quot;</span>),</span>
<span id="cb2022-9"><a href="ggplotvis.html#cb2022-9"></a>    <span class="dt">values =</span> <span class="kw">c</span>(</span>
<span id="cb2022-10"><a href="ggplotvis.html#cb2022-10"></a>      <span class="st">&quot;受灾面积&quot;</span> =<span class="st"> &quot;orangered2&quot;</span>,</span>
<span id="cb2022-11"><a href="ggplotvis.html#cb2022-11"></a>      <span class="st">&quot;成灾面积&quot;</span> =<span class="st"> &quot;turquoise&quot;</span>)) <span class="op">+</span></span>
<span id="cb2022-12"><a href="ggplotvis.html#cb2022-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-flood01d-1.png" width="672" /></p>
<p>为了获得适当的图例，
上面的程序在两个<code>geom_line()</code>调用中在<code>aes()</code>中将<code>color</code>映射到了两个序列的名称而不是具体颜色，
然后使用了<code>scale_colormanual()</code>函数，
用<code>breaks</code>参数指定了两个序列的次序，
使得“成灾面积”在前，
“受灾面积”灾后，
与图中两条曲线的上下次序一致；
用了<code>values</code>参数指定了从序列名称到具体颜色的对应关系。</p>
</div>
<div id="ggplotvis-ts-het" class="section level3">
<h3><span class="header-section-number">30.6.3</span> 多个不同类型指标的时间序列</h3>
<p>有时沿时间变化的多个指标是不可比的，
这时就不应将数据画在同一坐标系内，
一般可以画多个小图并上下按时间轴对齐，
<code>facet_wrap()</code>可以做小图。</p>
<p>例如，
考虑我国2013-2017年人均国内生产总值和人均可支配收入数据。</p>
<div class="sourceCode" id="cb2023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2023-1"><a href="ggplotvis.html#cb2023-1"></a>dinc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb2023-2"><a href="ggplotvis.html#cb2023-2"></a>  <span class="dt">year =</span> <span class="dv">2013</span><span class="op">:</span><span class="dv">2017</span>,</span>
<span id="cb2023-3"><a href="ggplotvis.html#cb2023-3"></a>  <span class="st">`</span><span class="dt">人均可支配收入</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">18311</span>, <span class="dv">20167</span>, <span class="dv">21966</span>, <span class="dv">23821</span>, <span class="dv">25974</span>),</span>
<span id="cb2023-4"><a href="ggplotvis.html#cb2023-4"></a>  <span class="st">`</span><span class="dt">人均国内生产总值</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">43852</span>, <span class="dv">47203</span>, <span class="dv">50251</span>, <span class="dv">53935</span>, <span class="dv">59660</span>))</span>
<span id="cb2023-5"><a href="ggplotvis.html#cb2023-5"></a>dinc2 &lt;-<span class="st"> </span>dinc <span class="op">%&gt;%</span></span>
<span id="cb2023-6"><a href="ggplotvis.html#cb2023-6"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">人均可支配收入</span><span class="st">`</span>, <span class="st">`</span><span class="dt">人均国内生产总值</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;指标&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb2023-7"><a href="ggplotvis.html#cb2023-7"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dinc2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2023-8"><a href="ggplotvis.html#cb2023-8"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> value))</span>
<span id="cb2023-9"><a href="ggplotvis.html#cb2023-9"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb2023-10"><a href="ggplotvis.html#cb2023-10"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> `</span><span class="dt">指标</span><span class="st">`</span>, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span></span>
<span id="cb2023-11"><a href="ggplotvis.html#cb2023-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">&quot;数据来源：国家统计局&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-ts-inc01-1.png" width="672" /></p>
<p>上述程序在<code>facet_wrap()</code>中用<code>scales = "free_y"</code>使得两幅小图的纵轴不需要使用相同坐标范围。
横轴默认还使用相同坐标范围并上下对齐。</p>
<p>对二元时间序列<span class="math inline">\((x_t, y_t)\)</span>，
还可以画以<span class="math inline">\((x_t, y_t)\)</span>为节点的轨迹图，
但需要标出关键的时间点的时间。
用<code>geom_path()</code>画轨迹，
用ggrepel包的<code>geom_text_repel()</code>标时间。</p>
</div>
</div>
<div id="ggplotvis-fit" class="section level2">
<h2><span class="header-section-number">30.7</span> 拟合曲线图</h2>
<p>考虑两个变量之间的关系，
将其中的一个作为因变量，
另一个作为自变量，
散点图可以反映其互相影响，
可以用拟合曲线进一步概括两者的关系。
拟合曲线的方法可以是曲线平滑方法如核回归、局部多项式回归、样条平滑，
也可以用一些参数模型如线性回归、二次回归。
对于时间序列，
还经常分解成趋势项、季节项和不规则项。</p>
<div id="ggplotvis-fit-smooth" class="section level3">
<h3><span class="header-section-number">30.7.1</span> 平滑方法</h3>
<p>考虑标普500指数2008年的收盘价。</p>
<p><img src="static/picture/ggvis-fitsm-sp02-1.png" width="672" /></p>
<p>为了平滑上面的曲线，
金融界常用滑动平均方法，
比如，
每10天画计算一个平均值并将该平均值的时间对准在10天时间窗的最后一天。
这样得到的滑动平均线会滞后于原始数据的变化。</p>
<p>先写一个计算滑动平均的函数：</p>
<p>计算10日、22日滑动平均并绘图：</p>
<pre><code>## Warning: Removed 9 row(s) containing missing values (geom_path).</code></pre>
<pre><code>## Warning: Removed 21 row(s) containing missing values (geom_path).</code></pre>
<p><img src="static/picture/ggvis-fitsm-sp03-1.png" width="672" /></p>
<p>将滑动平均结果对齐在时间窗口末尾的优点是可以实时地更新。
对历史数据，
可以将滑动平均结果对齐在时间窗口中间，
如果时间窗口中有偶数个点，
可以选择中间两个点的任何一个，
上面的滑动平均计算程序在偶数个点时选择与中间两个点当中第一个点对齐。
图形如下：</p>
<pre><code>## Warning: Removed 9 row(s) containing missing values (geom_path).</code></pre>
<pre><code>## Warning: Removed 21 row(s) containing missing values (geom_path).</code></pre>
<p><img src="static/picture/ggvis-fitsm-sp04-1.png" width="672" /></p>
<p>滑动平均平滑是金融数据分析中常用的方法，
但是也有明显的缺点。
因为需要多个点生成一个平均值，
所以在序列的开头和末尾有一部分点是没有平均值的。
当时间窗变宽时结果会更光滑，
但有时还是不够光滑，
这与滑动平均作为加窗平滑是等权而且在边缘处为间断有关。</p>
<p>统计学中提出了各种更复杂但效果更好而平滑方法，
比如LOESS(locally estimated scatterplot smoothing，
参见<span class="citation">(Cleveland <a href="#ref-Cleveland1979:LOESS" role="doc-biblioref">1979</a>)</span>)。
这是许多局部多项式回归回归方法中的一个典型代表，
每个<span class="math inline">\(x\)</span>处用附近的点拟合一个局部模型，
距离<span class="math inline">\(x\)</span>越远的点贡献越小。
这样的做法可以得到比滑动平均更平滑的结果。
局部多项式方法得到的结果类似于中心对准而且滑动窗口较宽的滑动平均。</p>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 21 row(s) containing missing values (geom_path).</code></pre>
<p><img src="static/picture/ggvis-fitsm-sp05-1.png" width="672" /></p>
<p><code>geom_smooth()</code>可以对输入的<span class="math inline">\((x,y)\)</span>坐标数据进行平滑，
选项<code>se = FALSE</code>要求不做置信区间。
实际上，
不仅仅是时间序列数据可以添加如此的平滑曲线，
其它的散点图也都可以这样添加平滑曲线。</p>
<p>上图的结果是程序自动选择平滑程度的结果，有些过于平滑了。
可以人为地用参数控制结果的平滑程度。
用参数<code>span</code>控制平滑程度，
<code>span</code>取0到1之间的值，
越大的<code>span</code>值越光滑：</p>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 21 row(s) containing missing values (geom_path).</code></pre>
<p><img src="static/picture/ggvis-fitsm-sp05b-1.png" width="672" /></p>
<p>LOESS方法计算较慢，
所以ggplot2在输入点数超过1000时默认使用mgcv包的<code>gam()</code>函数进行平滑，
对应于<code>method = "gam"</code>。
用gam时可以指定<code>formula = y ~ s(x)</code>，
或者<code>formula = y ~ s(x, bs = "cs")</code>。</p>
<p>要注意的是，
平滑结果不仅依赖于平滑参数的选择，
也依赖于平滑方法和模型的选择，
不同模型可能给出差别很大的结果，
所以使用平滑结果做预测时一定要特别谨慎。</p>
</div>
<div id="ggplotvis-fit-param" class="section level3">
<h3><span class="header-section-number">30.7.2</span> 参数模型方法</h3>
<p>LOESS等平滑方法属于非参数方法，
这些方法本质上没有一个不依赖于数据值的参数模型。
另一类建模和平滑方法是假定<span class="math inline">\(y_i\)</span>与<span class="math inline">\(x_i\)</span>之间服从一定的参数模型，
如线性回归模型
<span class="math display">\[
y_i = a + b x_i + \varepsilon_i
\]</span>
从数据估计模型参数，
然后可以得到模型的拟合值（或称预测值）。</p>
<p><code>geom_smooth()</code>函数已经支持线性回归，
比如对2013-2017人均国内生产总值数据进行平滑：</p>
<div class="sourceCode" id="cb2032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2032-1"><a href="ggplotvis.html#cb2032-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dinc, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2032-2"><a href="ggplotvis.html#cb2032-2"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> <span class="st">`</span><span class="dt">人均国内生产总值</span><span class="st">`</span>))</span>
<span id="cb2032-3"><a href="ggplotvis.html#cb2032-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb2032-4"><a href="ggplotvis.html#cb2032-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb2032-5"><a href="ggplotvis.html#cb2032-5"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size =</span> <span class="fl">1.1</span>, <span class="dt">se=</span><span class="ot">FALSE</span> )</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggvis-fitpar-inc01-1.png" width="672" /></p>
<p>可以用<code>formula = poly(x, 2)</code>将模型变成二次多项式曲线，
如：</p>
<div class="sourceCode" id="cb2034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2034-1"><a href="ggplotvis.html#cb2034-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dinc, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2034-2"><a href="ggplotvis.html#cb2034-2"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> <span class="st">`</span><span class="dt">人均国内生产总值</span><span class="st">`</span>))</span>
<span id="cb2034-3"><a href="ggplotvis.html#cb2034-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb2034-4"><a href="ggplotvis.html#cb2034-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">col =</span> <span class="st">&quot;lm&quot;</span>),</span>
<span id="cb2034-5"><a href="ggplotvis.html#cb2034-5"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size =</span> <span class="fl">1.1</span>, <span class="dt">se=</span><span class="ot">FALSE</span> ) <span class="op">+</span></span>
<span id="cb2034-6"><a href="ggplotvis.html#cb2034-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">col =</span> <span class="st">&quot;quadreg&quot;</span>),</span>
<span id="cb2034-7"><a href="ggplotvis.html#cb2034-7"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">2</span>), </span>
<span id="cb2034-8"><a href="ggplotvis.html#cb2034-8"></a>    <span class="dt">size =</span> <span class="fl">1.1</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb2034-9"><a href="ggplotvis.html#cb2034-9"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb2034-10"><a href="ggplotvis.html#cb2034-10"></a>    <span class="dt">name =</span> <span class="ot">NULL</span>,</span>
<span id="cb2034-11"><a href="ggplotvis.html#cb2034-11"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">`</span><span class="dt">lm</span><span class="st">`</span> =<span class="st"> &quot;blue&quot;</span>, <span class="st">`</span><span class="dt">quadreg</span><span class="st">`</span> =<span class="st"> &quot;cyan&quot;</span>),</span>
<span id="cb2034-12"><a href="ggplotvis.html#cb2034-12"></a>    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;lm&quot;</span>, <span class="st">&quot;quadreg&quot;</span>),</span>
<span id="cb2034-13"><a href="ggplotvis.html#cb2034-13"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;线性模型&quot;</span>, <span class="st">&quot;二次多项式模型&quot;</span>)  ) <span class="op">+</span></span>
<span id="cb2034-14"><a href="ggplotvis.html#cb2034-14"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb2034-15"><a href="ggplotvis.html#cb2034-15"></a>    <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>),</span>
<span id="cb2034-16"><a href="ggplotvis.html#cb2034-16"></a>    <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)  ) <span class="op">+</span></span>
<span id="cb2034-17"><a href="ggplotvis.html#cb2034-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggvis-fitpar-inc02-1.png" width="672" /></p>
<p>与<code>method = "lm"</code>类似的是<code>method = "rlm"</code>，
是稳健线性回归模型，要调用MASS包。</p>
<p><code>geom_smooth()</code>还支持<code>gam()</code>函数能支持的模型。
更一般的模型可以先用统计建模函数建模，
然后在自变量取值范围内取一个网格计算拟合值，
最后将原始数据与拟合曲线画在一起。
这里拟合曲线实际是将网格点对应的拟合值连接成一条折线。</p>
<p>比如，
对上面的数据拟合如下的指数增长模型：
<span class="math display">\[
y_t = A e^{b t} + \varepsilon_t
\]</span></p>
<div class="sourceCode" id="cb2036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2036-1"><a href="ggplotvis.html#cb2036-1"></a>nls.inc &lt;-<span class="st"> </span><span class="kw">nls</span>(</span>
<span id="cb2036-2"><a href="ggplotvis.html#cb2036-2"></a>  <span class="st">`</span><span class="dt">人均国内生产总值</span><span class="st">`</span> <span class="op">~</span><span class="st"> </span>A <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(b <span class="op">*</span><span class="st"> </span>(year<span class="dv">-2000</span>)),</span>
<span id="cb2036-3"><a href="ggplotvis.html#cb2036-3"></a>  <span class="dt">data =</span> dinc,</span>
<span id="cb2036-4"><a href="ggplotvis.html#cb2036-4"></a>  <span class="dt">start =</span> <span class="kw">c</span>(<span class="dt">A =</span> <span class="fl">4E4</span>, <span class="dt">b =</span> <span class="fl">1E-6</span>))</span>
<span id="cb2036-5"><a href="ggplotvis.html#cb2036-5"></a>dinc.pred1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb2036-6"><a href="ggplotvis.html#cb2036-6"></a>  <span class="dt">year =</span> <span class="kw">seq</span>(<span class="dv">2013</span>, <span class="dv">2017</span>, <span class="dt">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb2036-7"><a href="ggplotvis.html#cb2036-7"></a>dinc.pred1 &lt;-<span class="st"> </span>dinc.pred1 <span class="op">%&gt;%</span></span>
<span id="cb2036-8"><a href="ggplotvis.html#cb2036-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">predict</span>(</span>
<span id="cb2036-9"><a href="ggplotvis.html#cb2036-9"></a>      nls.inc, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">year =</span>  year )))</span>
<span id="cb2036-10"><a href="ggplotvis.html#cb2036-10"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dinc, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2036-11"><a href="ggplotvis.html#cb2036-11"></a>  <span class="dt">x =</span> year, <span class="dt">y =</span> <span class="st">`</span><span class="dt">人均国内生产总值</span><span class="st">`</span>))</span>
<span id="cb2036-12"><a href="ggplotvis.html#cb2036-12"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb2036-13"><a href="ggplotvis.html#cb2036-13"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">col =</span> <span class="st">&quot;lm&quot;</span>),</span>
<span id="cb2036-14"><a href="ggplotvis.html#cb2036-14"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size =</span> <span class="fl">1.1</span>, <span class="dt">se=</span><span class="ot">FALSE</span> ) <span class="op">+</span></span>
<span id="cb2036-15"><a href="ggplotvis.html#cb2036-15"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> dinc.pred1, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2036-16"><a href="ggplotvis.html#cb2036-16"></a>    <span class="dt">x =</span> year, <span class="dt">y =</span> pred, <span class="dt">col =</span> <span class="st">&quot;Expmod&quot;</span>  )) <span class="op">+</span></span>
<span id="cb2036-17"><a href="ggplotvis.html#cb2036-17"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb2036-18"><a href="ggplotvis.html#cb2036-18"></a>    <span class="dt">name =</span> <span class="ot">NULL</span>,</span>
<span id="cb2036-19"><a href="ggplotvis.html#cb2036-19"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">`</span><span class="dt">lm</span><span class="st">`</span> =<span class="st"> &quot;blue&quot;</span>, <span class="st">`</span><span class="dt">Expmod</span><span class="st">`</span> =<span class="st"> &quot;cyan&quot;</span>),</span>
<span id="cb2036-20"><a href="ggplotvis.html#cb2036-20"></a>    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;lm&quot;</span>, <span class="st">&quot;Expmod&quot;</span>),</span>
<span id="cb2036-21"><a href="ggplotvis.html#cb2036-21"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;线性模型&quot;</span>, <span class="st">&quot;指数模型&quot;</span>)  ) <span class="op">+</span></span>
<span id="cb2036-22"><a href="ggplotvis.html#cb2036-22"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb2036-23"><a href="ggplotvis.html#cb2036-23"></a>    <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>),</span>
<span id="cb2036-24"><a href="ggplotvis.html#cb2036-24"></a>    <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)  ) <span class="op">+</span></span>
<span id="cb2036-25"><a href="ggplotvis.html#cb2036-25"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggvis-fitpar-inc03-1.png" width="672" /></p>
<p><span class="math inline">\(y = A e^{bx}\)</span>这样的模型可以将y轴改为对数尺度，
这时指数曲线可以表现为直线。
<span class="math inline">\(y = A x^b\)</span>这样的模型可以将x轴和y轴都改为对数尺度，
曲线关系可以表现为直线关系。</p>
</div>
</div>
<div id="ggplotvis-uncert" class="section level2">
<h2><span class="header-section-number">30.8</span> 表现不确定性</h2>
<p>统计数据数据分析的建模结果都有一定的不确定性，
参数估计和模型预测的不确定性经常用置信区间和置信带表现，
绘图时可以画误差条(error bar)或置信带。
这些方法可以比较精确地描绘不确定性大小，
但需要一些概率统计知识才能正确理解。
也可以开发一些更直观的图形用来表现不确定性。</p>
<div id="ggplotvis-uncert-prob" class="section level3">
<h3><span class="header-section-number">30.8.1</span> 表现概率</h3>
<p>不确定性用概率描述，
而概率可以通过多次独立重复试验的频率来理解。
可以用一个饼图来表现概率。</p>
<p>一种容易理解的做法是画100个色块，
用加亮显示部分表示成功部分，
加亮显示部分随机摆放以显示结果的随机性。</p>
<div class="sourceCode" id="cb2038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2038-1"><a href="ggplotvis.html#cb2038-1"></a><span class="co">#dg &lt;- expand.grid(x = 1:10, y = 1:10)</span></span>
<span id="cb2038-2"><a href="ggplotvis.html#cb2038-2"></a><span class="kw">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb2038-3"><a href="ggplotvis.html#cb2038-3"></a>dg &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">ratio =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.4</span>), <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb2038-4"><a href="ggplotvis.html#cb2038-4"></a>dg2 &lt;-<span class="st"> </span>dg <span class="op">%&gt;%</span></span>
<span id="cb2038-5"><a href="ggplotvis.html#cb2038-5"></a><span class="st">  </span><span class="kw">group_by</span>(ratio) <span class="op">%&gt;%</span></span>
<span id="cb2038-6"><a href="ggplotvis.html#cb2038-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value =</span> {</span>
<span id="cb2038-7"><a href="ggplotvis.html#cb2038-7"></a>    n &lt;-<span class="st"> </span><span class="kw">n</span>()</span>
<span id="cb2038-8"><a href="ggplotvis.html#cb2038-8"></a>    i &lt;-<span class="st"> </span><span class="kw">round</span>(n <span class="op">*</span><span class="st"> </span>ratio[<span class="dv">1</span>])</span>
<span id="cb2038-9"><a href="ggplotvis.html#cb2038-9"></a>    <span class="kw">sample</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;S&quot;</span>, i), <span class="kw">rep</span>(<span class="st">&quot;F&quot;</span>, n<span class="op">-</span>i)))</span>
<span id="cb2038-10"><a href="ggplotvis.html#cb2038-10"></a>  }) <span class="op">%&gt;%</span></span>
<span id="cb2038-11"><a href="ggplotvis.html#cb2038-11"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb2038-12"><a href="ggplotvis.html#cb2038-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">paste0</span>(<span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>ratio), <span class="st">&quot;% chance&quot;</span>) )</span>
<span id="cb2038-13"><a href="ggplotvis.html#cb2038-13"></a><span class="co">#set.seed(84524)</span></span>
<span id="cb2038-14"><a href="ggplotvis.html#cb2038-14"></a></span>
<span id="cb2038-15"><a href="ggplotvis.html#cb2038-15"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dg2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2038-16"><a href="ggplotvis.html#cb2038-16"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> value)) <span class="op">+</span></span>
<span id="cb2038-17"><a href="ggplotvis.html#cb2038-17"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb2038-18"><a href="ggplotvis.html#cb2038-18"></a><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">expand =</span> <span class="ot">FALSE</span>, <span class="dt">clip =</span> <span class="st">&quot;off&quot;</span>) <span class="op">+</span></span>
<span id="cb2038-19"><a href="ggplotvis.html#cb2038-19"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">name =</span> <span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb2038-20"><a href="ggplotvis.html#cb2038-20"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb2038-21"><a href="ggplotvis.html#cb2038-21"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb2038-22"><a href="ggplotvis.html#cb2038-22"></a>    <span class="dt">name =</span> <span class="ot">NULL</span>,</span>
<span id="cb2038-23"><a href="ggplotvis.html#cb2038-23"></a>    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;F&quot;</span>),</span>
<span id="cb2038-24"><a href="ggplotvis.html#cb2038-24"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;success   &quot;</span>, <span class="st">&quot;failure&quot;</span>),</span>
<span id="cb2038-25"><a href="ggplotvis.html#cb2038-25"></a>    <span class="dt">values =</span> <span class="kw">c</span>(</span>
<span id="cb2038-26"><a href="ggplotvis.html#cb2038-26"></a>      <span class="st">&quot;S&quot;</span> =<span class="st"> &quot;steelblue4&quot;</span>,</span>
<span id="cb2038-27"><a href="ggplotvis.html#cb2038-27"></a>      <span class="st">&quot;F&quot;</span> =<span class="st"> &quot;steelblue1&quot;</span></span>
<span id="cb2038-28"><a href="ggplotvis.html#cb2038-28"></a>    ),</span>
<span id="cb2038-29"><a href="ggplotvis.html#cb2038-29"></a>    <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">0</span>))</span>
<span id="cb2038-30"><a href="ggplotvis.html#cb2038-30"></a>  ) <span class="op">+</span></span>
<span id="cb2038-31"><a href="ggplotvis.html#cb2038-31"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label) <span class="op">+</span></span>
<span id="cb2038-32"><a href="ggplotvis.html#cb2038-32"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb2038-33"><a href="ggplotvis.html#cb2038-33"></a>    <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb2038-34"><a href="ggplotvis.html#cb2038-34"></a>    <span class="dt">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb2038-35"><a href="ggplotvis.html#cb2038-35"></a>    <span class="dt">legend.justification =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb2038-36"><a href="ggplotvis.html#cb2038-36"></a>    <span class="dt">plot.margin =</span> <span class="kw">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">3.5</span>, <span class="dv">0</span>) <span class="co"># crop plot a little more tightly</span></span>
<span id="cb2038-37"><a href="ggplotvis.html#cb2038-37"></a>  )</span></code></pre></div>
<p><img src="static/picture/ggvis-uncprob-block01-1.png" width="672" /></p>
<p>在只有两种随机结果时上图可以比较直观地表现两种结果的比例和随机性。
在有许多可能结果，甚至于随机结果可以在一个区间内随机取值时，
上面的方法不再有效，
概率分布和概率密度能更准确地描述这种随机取值，
但不一定容易理解。
分布密度下方的阴影面积比例可以代表某个事件的概率，
还可以用密度曲线下面画堆叠的圆的办法更直观地表现不同取值区域的概率大小。</p>
</div>
<div id="ggplotvis-uncert-se" class="section level3">
<h3><span class="header-section-number">30.8.2</span> 表现点估计精度</h3>
<p>统计学中将要了解的分布称为总体，
用参数概括总体的分布，
从总体中抽取的一部分称为样本，
从样本中计算统计量作为总体参数的估计，
标准误差是估计量的精度的度量。
可以用误差条同时画出参数估计值及对应的标准误差，
误差条的两端是点估计加减标准误差。</p>
<p>例如，
iris数据集中setosa品种的花瓣长度均值及标准误差，
同时画了对应的数据值：</p>
<div class="sourceCode" id="cb2039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2039-1"><a href="ggplotvis.html#cb2039-1"></a>d1 &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span></span>
<span id="cb2039-2"><a href="ggplotvis.html#cb2039-2"></a><span class="st">  </span><span class="kw">filter</span>(Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>)</span>
<span id="cb2039-3"><a href="ggplotvis.html#cb2039-3"></a>d1summ &lt;-<span class="st"> </span>d1 <span class="op">%&gt;%</span></span>
<span id="cb2039-4"><a href="ggplotvis.html#cb2039-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mpl =</span> <span class="kw">mean</span>(Petal.Length),</span>
<span id="cb2039-5"><a href="ggplotvis.html#cb2039-5"></a>            <span class="dt">sd =</span> <span class="kw">sd</span>(Petal.Length), </span>
<span id="cb2039-6"><a href="ggplotvis.html#cb2039-6"></a>            <span class="dt">se =</span> sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">n</span>()))</span>
<span id="cb2039-7"><a href="ggplotvis.html#cb2039-7"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d1summ)</span>
<span id="cb2039-8"><a href="ggplotvis.html#cb2039-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(</span>
<span id="cb2039-9"><a href="ggplotvis.html#cb2039-9"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2039-10"><a href="ggplotvis.html#cb2039-10"></a>      <span class="dt">ymin =</span> mpl <span class="op">-</span><span class="st"> </span>se, <span class="dt">ymax =</span> mpl <span class="op">+</span><span class="st"> </span>se, </span>
<span id="cb2039-11"><a href="ggplotvis.html#cb2039-11"></a>      <span class="dt">x =</span> <span class="st">&quot;setosa&quot;</span>),</span>
<span id="cb2039-12"><a href="ggplotvis.html#cb2039-12"></a>    <span class="dt">color =</span> <span class="st">&quot;turquoise4&quot;</span>, <span class="dt">width =</span> <span class="fl">0.05</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb2039-13"><a href="ggplotvis.html#cb2039-13"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb2039-14"><a href="ggplotvis.html#cb2039-14"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2039-15"><a href="ggplotvis.html#cb2039-15"></a>      <span class="dt">y =</span> mpl, </span>
<span id="cb2039-16"><a href="ggplotvis.html#cb2039-16"></a>      <span class="dt">x =</span> <span class="st">&quot;setosa&quot;</span>),</span>
<span id="cb2039-17"><a href="ggplotvis.html#cb2039-17"></a>    <span class="dt">color =</span> <span class="st">&quot;turquoise4&quot;</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb2039-18"><a href="ggplotvis.html#cb2039-18"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">data =</span> d1, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2039-19"><a href="ggplotvis.html#cb2039-19"></a>    <span class="dt">y =</span> Petal.Length, <span class="dt">x =</span> <span class="st">&quot;setosa&quot;</span>), </span>
<span id="cb2039-20"><a href="ggplotvis.html#cb2039-20"></a>    <span class="dt">width =</span> <span class="fl">0.3</span>, <span class="dt">height =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb2039-21"><a href="ggplotvis.html#cb2039-21"></a><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">name =</span> <span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb2039-22"><a href="ggplotvis.html#cb2039-22"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Petal Length&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris01-1.png" width="672" /></p>
<p>这里用了<code>coord_flip()</code>将图形x、y坐标对调，
使得原来纵向的误差条变成横向。
在<code>geom_errorbar()</code>中需要映射ymin, ymax和x维，
分别表示误差条的上下限与x位置。</p>
<p>置信区间也可以类似地画出。
下面对iris数据集中三个品种分别估计花瓣长度均值并画95%置信区间。</p>
<div class="sourceCode" id="cb2040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2040-1"><a href="ggplotvis.html#cb2040-1"></a>d2summ &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span></span>
<span id="cb2040-2"><a href="ggplotvis.html#cb2040-2"></a><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span></span>
<span id="cb2040-3"><a href="ggplotvis.html#cb2040-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mpl =</span> <span class="kw">mean</span>(Petal.Length),</span>
<span id="cb2040-4"><a href="ggplotvis.html#cb2040-4"></a>            <span class="dt">sd =</span> <span class="kw">sd</span>(Petal.Length), </span>
<span id="cb2040-5"><a href="ggplotvis.html#cb2040-5"></a>            <span class="dt">se =</span> sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">n</span>()))</span>
<span id="cb2040-6"><a href="ggplotvis.html#cb2040-6"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d2summ, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Species))</span>
<span id="cb2040-7"><a href="ggplotvis.html#cb2040-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(</span>
<span id="cb2040-8"><a href="ggplotvis.html#cb2040-8"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2040-9"><a href="ggplotvis.html#cb2040-9"></a>      <span class="dt">ymin =</span> mpl <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se, <span class="dt">ymax =</span> mpl <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se),</span>
<span id="cb2040-10"><a href="ggplotvis.html#cb2040-10"></a>    <span class="dt">width =</span> <span class="fl">0.05</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb2040-11"><a href="ggplotvis.html#cb2040-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Petal Length&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris02-1.png" width="672" /></p>
<p>选项<code>width</code>是端线宽度，用坐标系单位，横轴是因子时两个因子的间距为1；
<code>size</code>是线粗细（毫米）</p>
<p>如果不需要端线，可以用<code>geom_linerange()</code>:</p>
<div class="sourceCode" id="cb2041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2041-1"><a href="ggplotvis.html#cb2041-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_linerange</span>(</span>
<span id="cb2041-2"><a href="ggplotvis.html#cb2041-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2041-3"><a href="ggplotvis.html#cb2041-3"></a>      <span class="dt">y =</span> mpl,</span>
<span id="cb2041-4"><a href="ggplotvis.html#cb2041-4"></a>      <span class="dt">ymin =</span> mpl <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se, <span class="dt">ymax =</span> mpl <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se),</span>
<span id="cb2041-5"><a href="ggplotvis.html#cb2041-5"></a>    <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb2041-6"><a href="ggplotvis.html#cb2041-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Petal Length&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris02b-1.png" width="672" /></p>
<p>为了画出中心点，
可以用<code>geom_pointrange()</code>函数：</p>
<div class="sourceCode" id="cb2042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2042-1"><a href="ggplotvis.html#cb2042-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_pointrange</span>(</span>
<span id="cb2042-2"><a href="ggplotvis.html#cb2042-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2042-3"><a href="ggplotvis.html#cb2042-3"></a>      <span class="dt">y =</span> mpl,</span>
<span id="cb2042-4"><a href="ggplotvis.html#cb2042-4"></a>      <span class="dt">ymin =</span> mpl <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se, <span class="dt">ymax =</span> mpl <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se)) <span class="op">+</span></span>
<span id="cb2042-5"><a href="ggplotvis.html#cb2042-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Petal Length&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris02c-1.png" width="672" /></p>
<p>用<code>geom_crossbar()</code>可以画成中心有线的盒形：</p>
<div class="sourceCode" id="cb2043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2043-1"><a href="ggplotvis.html#cb2043-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_crossbar</span>(</span>
<span id="cb2043-2"><a href="ggplotvis.html#cb2043-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2043-3"><a href="ggplotvis.html#cb2043-3"></a>      <span class="dt">y =</span> mpl,</span>
<span id="cb2043-4"><a href="ggplotvis.html#cb2043-4"></a>      <span class="dt">ymin =</span> mpl <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se, <span class="dt">ymax =</span> mpl <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se),</span>
<span id="cb2043-5"><a href="ggplotvis.html#cb2043-5"></a>    <span class="dt">width =</span> <span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb2043-6"><a href="ggplotvis.html#cb2043-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Petal Length&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris02d-1.png" width="672" /></p>
<p>下面画三个置信区间以及数据散点，
并将x轴和y轴对调：</p>
<div class="sourceCode" id="cb2044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2044-1"><a href="ggplotvis.html#cb2044-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_crossbar</span>(</span>
<span id="cb2044-2"><a href="ggplotvis.html#cb2044-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2044-3"><a href="ggplotvis.html#cb2044-3"></a>      <span class="dt">y =</span> mpl,</span>
<span id="cb2044-4"><a href="ggplotvis.html#cb2044-4"></a>      <span class="dt">ymin =</span> mpl <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se, <span class="dt">ymax =</span> mpl <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se),</span>
<span id="cb2044-5"><a href="ggplotvis.html#cb2044-5"></a>    <span class="dt">color =</span> <span class="st">&quot;turquoise4&quot;</span>, <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb2044-6"><a href="ggplotvis.html#cb2044-6"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">data =</span> iris, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2044-7"><a href="ggplotvis.html#cb2044-7"></a>    <span class="dt">y =</span> Petal.Length, <span class="dt">x =</span> Species), </span>
<span id="cb2044-8"><a href="ggplotvis.html#cb2044-8"></a>    <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">width =</span> <span class="fl">0.3</span>, <span class="dt">height =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb2044-9"><a href="ggplotvis.html#cb2044-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Petal Length&quot;</span>) <span class="op">+</span></span>
<span id="cb2044-10"><a href="ggplotvis.html#cb2044-10"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris02e-1.png" width="672" /></p>
<p>置信区间是频率学派统计学的概念，
可以认为在多次独立重复同一置信区间问题时真实参数落入置信区间的比例为给定的置信度，
或者零假设下的参数值落入置信区间是对应的假设检验的接受域。
而贝叶斯学派统计学也有类似概念，
称为credible interval，
这是认为参数作为服从后验分布的随机变量的取值概率为给定置信度最可能取值区间。</p>
<p>误差条比较容易被不了解相关概念的人误认为数据范围或者参数估计取值范围，
所以使用时需要解释其含义。
误差条的一个优势是很容易与其他图形一起使用，
上面的误差条是与散点图一起使用的，
也可以与条形图配合给出条形图表示的比例的误差大小。
例如，
iris数据中三个类别的4个测量值的均值用条形高度表示，
标准误差用误差条表示：</p>
<div class="sourceCode" id="cb2045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2045-1"><a href="ggplotvis.html#cb2045-1"></a>d3summ &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span></span>
<span id="cb2045-2"><a href="ggplotvis.html#cb2045-2"></a><span class="st">  </span><span class="kw">gather</span>(Sepal.Length, Sepal.Width, Petal.Length, Petal.Width,</span>
<span id="cb2045-3"><a href="ggplotvis.html#cb2045-3"></a>         <span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb2045-4"><a href="ggplotvis.html#cb2045-4"></a><span class="st">  </span><span class="kw">group_by</span>(Species, variable) <span class="op">%&gt;%</span></span>
<span id="cb2045-5"><a href="ggplotvis.html#cb2045-5"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb2045-6"><a href="ggplotvis.html#cb2045-6"></a>    <span class="dt">mean =</span> <span class="kw">mean</span>(value), </span>
<span id="cb2045-7"><a href="ggplotvis.html#cb2045-7"></a>    <span class="dt">se =</span> <span class="kw">sd</span>(value) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">n</span>()),</span>
<span id="cb2045-8"><a href="ggplotvis.html#cb2045-8"></a>    <span class="dt">lbar =</span> mean <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se,</span>
<span id="cb2045-9"><a href="ggplotvis.html#cb2045-9"></a>    <span class="dt">hbar =</span> mean <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se)</span>
<span id="cb2045-10"><a href="ggplotvis.html#cb2045-10"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d3summ, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2045-11"><a href="ggplotvis.html#cb2045-11"></a>  <span class="dt">x =</span> variable, <span class="dt">fill =</span> Species, <span class="dt">y =</span> mean))</span>
<span id="cb2045-12"><a href="ggplotvis.html#cb2045-12"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb2045-13"><a href="ggplotvis.html#cb2045-13"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2045-14"><a href="ggplotvis.html#cb2045-14"></a>    <span class="dt">ymin =</span> lbar, <span class="dt">ymax =</span> hbar), </span>
<span id="cb2045-15"><a href="ggplotvis.html#cb2045-15"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="dv">1</span>),</span>
<span id="cb2045-16"><a href="ggplotvis.html#cb2045-16"></a>    <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb2045-17"><a href="ggplotvis.html#cb2045-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Measurements&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Mean and SE&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris03-1.png" width="672" /></p>
<p>这里<code>geom_errorbar()</code>的<code>position</code>参数用了<code>position_dodge()</code>函数说明两个条形之间的距离。
<code>geom_errorbar()</code>的<code>width</code>参数是条形端线的宽度，
如果<code>width=0</code>就没有了端线。</p>
<p>如果仅有一个变量则会比较简单，
比如，
花瓣长度的均值和加减标准误差：</p>
<div class="sourceCode" id="cb2046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2046-1"><a href="ggplotvis.html#cb2046-1"></a>d3b &lt;-<span class="st"> </span>d3summ <span class="op">%&gt;%</span></span>
<span id="cb2046-2"><a href="ggplotvis.html#cb2046-2"></a><span class="st">  </span><span class="kw">filter</span>(variable <span class="op">==</span><span class="st"> &quot;Petal.Length&quot;</span>)</span>
<span id="cb2046-3"><a href="ggplotvis.html#cb2046-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d3b, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2046-4"><a href="ggplotvis.html#cb2046-4"></a>  <span class="dt">x =</span> Species, <span class="dt">y =</span> mean))</span>
<span id="cb2046-5"><a href="ggplotvis.html#cb2046-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb2046-6"><a href="ggplotvis.html#cb2046-6"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2046-7"><a href="ggplotvis.html#cb2046-7"></a>    <span class="dt">ymin =</span> lbar, <span class="dt">ymax =</span> hbar), </span>
<span id="cb2046-8"><a href="ggplotvis.html#cb2046-8"></a>    <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb2046-9"><a href="ggplotvis.html#cb2046-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Species&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Petal Length Mean and SE&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggvis-uncse-iris03b-1.png" width="672" /></p>
<p>为了表现y的误差范围随一个连续的x变量的变化，
可以使用<code>geom_ribbon()</code>函数；
为了表现y的误差范围以及中心值随一个连续的x变量的变化，
可以使用<code>geom_smooth(stat = "identity")</code>。</p>
</div>
<div id="ggplotvis-uncert-cband" class="section level3">
<h3><span class="header-section-number">30.8.3</span> 拟合曲线的置信带</h3>
<p>对成对变量数据<span class="math inline">\((x_i, y_i)\)</span>可以拟合平滑曲线，
同时往往希望给出曲线类似于置信区间或者credible interval。
作为置信区间解释时，
虽然是置信带，
但是置信度是针对每个单独的<span class="math inline">\(x\)</span>值成立的；
如果是贝叶斯置信区间(credible interval)，
则置信带可以理解为在模型参数的后验分布下取值概率为对应置信度的参数所对应的曲线集合。</p>
<p><code>geom_smooth()</code>函数中加<code>se = TRUE</code>就可以做置信带。
例如，对iris数据集中setosa品种的花瓣长、宽作线性回归并加置信带：</p>
<div class="sourceCode" id="cb2047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2047-1"><a href="ggplotvis.html#cb2047-1"></a>diris1 &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span></span>
<span id="cb2047-2"><a href="ggplotvis.html#cb2047-2"></a><span class="st">  </span><span class="kw">filter</span>(Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>)</span>
<span id="cb2047-3"><a href="ggplotvis.html#cb2047-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> diris1, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb2047-4"><a href="ggplotvis.html#cb2047-4"></a>  <span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width))</span>
<span id="cb2047-5"><a href="ggplotvis.html#cb2047-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb2047-6"><a href="ggplotvis.html#cb2047-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb2047-7"><a href="ggplotvis.html#cb2047-7"></a>    <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size =</span> <span class="fl">1.1</span>, <span class="dt">se=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggvis-unccb-iris01-1.png" width="672" /></p>
<p>默认的置信度是0.95，用参数<code>level</code>控制。
<code>geom_smooth()</code>的置信带是逐点意义的。</p>
<p>LOESS等平滑曲线也可以加置信带，如：</p>
<div class="sourceCode" id="cb2049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2049-1"><a href="ggplotvis.html#cb2049-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb2049-2"><a href="ggplotvis.html#cb2049-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(</span>
<span id="cb2049-3"><a href="ggplotvis.html#cb2049-3"></a>    <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">size =</span> <span class="fl">1.1</span>, <span class="dt">se=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggvis-unccb-iris01b-1.png" width="672" /></p>
</div>
<div id="ggplotvis-uncert-dyn" class="section level3">
<h3><span class="header-section-number">30.8.4</span> 随机结果动态演示</h3>
<p>随机结果是概率分布确定但每个结果预先未知的。
在讲课时，
可以用动图（gif或者mp4等格式）动态地演示不同的随机结果。
gganimate扩展包提供了制作动图的功能。</p>

</div>
</div>
</div>



<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Cleveland1979:LOESS">
<p>Cleveland, W. S. 1979. “Robust Locally Weighted Regression and Smoothing Scatterplots.” <em>Journal of the American Statistical Association</em> 74: 829–36.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ggplot2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stat-basics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="static/js/app.min.js"></script>
<script src="static/js/lunr.js"></script>
<script src="static/js/clipboard.min.js"></script>
<script src="static/js/plugin-search.js"></script>
<script src="static/js/plugin-sharing.js"></script>
<script src="static/js/plugin-fontsettings.js"></script>
<script src="static/js/plugin-bookdown.js"></script>
<script src="static/js/jquery.highlight.js"></script>
<script src="static/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Rbook.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
