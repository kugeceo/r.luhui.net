<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>29 ggplot作图入门 | R语言教程</title>
  <meta name="description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="29 ggplot作图入门 | R语言教程" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="29 ggplot作图入门 | R语言教程" />
  
  <meta name="twitter:description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  

<meta name="author" content="李东风" />


<meta name="date" content="2020-12-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="graph.html"/>
<link rel="next" href="ggplotvis.html"/>
<script src="static/js/jquery.min.js"></script>
<link href="static/css/style.css" rel="stylesheet" />
<link href="static/css/plugin-table.css" rel="stylesheet" />
<link href="static/css/plugin-bookdown.css" rel="stylesheet" />
<link href="static/css/plugin-highlight.css" rel="stylesheet" />
<link href="static/css/plugin-search.css" rel="stylesheet" />
<link href="static/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="static/css/plugin-clipboard.css" rel="stylesheet" />






<div style="display:none">
    <script src="http://s11.cnzz.com/z_stat.php?id=610720&web_id=610720" language="JavaScript"></script>
</div>





<script src="static/js/empty-anchor.js"></script>
<script src="static/js/htmlwidgets.js"></script>
<link href="static/css/str_view.css" rel="stylesheet" />
<script src="static/js/str_view.js"></script>
<link href="static/css/wordcloud.css" rel="stylesheet" />
<script src="static/js/wordcloud2-all.js"></script>
<script src="static/js/hover.js"></script>
<script src="static/js/wordcloud2.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="static/js/mathjax.js">
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html">R语言教程</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="part"><span><b>I 介绍</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> R语言介绍</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#intro-hist-char"><i class="fa fa-check"></i><b>1.1</b> R的历史和特点</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#intro-hc-hist"><i class="fa fa-check"></i><b>1.1.1</b> R的历史</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro.html"><a href="intro.html#intro-hc-char"><i class="fa fa-check"></i><b>1.1.2</b> R的特点</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#intro-install"><i class="fa fa-check"></i><b>1.2</b> R的下载与安装</a><ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#intro-ins-down"><i class="fa fa-check"></i><b>1.2.1</b> R的下载</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#intro-ins-install"><i class="fa fa-check"></i><b>1.2.2</b> R软件安装</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#intro-ins-other-soft"><i class="fa fa-check"></i><b>1.2.3</b> 辅助软件</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#intro-ins-packages"><i class="fa fa-check"></i><b>1.3</b> R扩展软件包的安装与管理</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#intro-ins-pack-ins"><i class="fa fa-check"></i><b>1.3.1</b> 安装</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#intro-ins-pack-gitbioc"><i class="fa fa-check"></i><b>1.3.2</b> Github和BioConductor的扩展包</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#intro-ins-pack-upd"><i class="fa fa-check"></i><b>1.3.3</b> 更新扩展包</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#intro-ins-pack-verup"><i class="fa fa-check"></i><b>1.3.4</b> 迁移扩展包</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#intro-ins-pack-renv"><i class="fa fa-check"></i><b>1.3.5</b> 项目私有扩展包目录</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#intro-ruse"><i class="fa fa-check"></i><b>1.4</b> 基本R软件的用法</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#intro-ruse-run"><i class="fa fa-check"></i><b>1.4.1</b> 基本运行</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#intro-ruse-proj"><i class="fa fa-check"></i><b>1.4.2</b> 项目目录</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#intro-rstudio"><i class="fa fa-check"></i><b>1.5</b> RStudio软件</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#intro-rstudio-intro"><i class="fa fa-check"></i><b>1.5.1</b> 介绍</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#intro-rstudio-proj"><i class="fa fa-check"></i><b>1.5.2</b> 项目</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro.html"><a href="intro.html#intro-rstudio-help"><i class="fa fa-check"></i><b>1.5.3</b> 帮助</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro.html"><a href="intro.html#intro-rstudio-shortcuts"><i class="fa fa-check"></i><b>1.5.4</b> 使用技巧</a></li>
<li class="chapter" data-level="1.5.5" data-path="intro.html"><a href="intro.html#intro-rstudio-rmd"><i class="fa fa-check"></i><b>1.5.5</b> Rmd文件</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#intro-ins-ex"><i class="fa fa-check"></i><b>1.6</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-example.html"><a href="intro-example.html"><i class="fa fa-check"></i><b>2</b> R语言入门运行样例</a><ul>
<li class="chapter" data-level="2.1" data-path="intro-example.html"><a href="intro-example.html#i-e-command-line"><i class="fa fa-check"></i><b>2.1</b> 命令行界面</a></li>
<li class="chapter" data-level="2.2" data-path="intro-example.html"><a href="intro-example.html#i-e-arith-op"><i class="fa fa-check"></i><b>2.2</b> 四则运算</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro-example.html"><a href="intro-example.html#i-e-arith-op-poker"><i class="fa fa-check"></i><b>2.2.1</b> 计算例子</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro-example.html"><a href="intro-example.html#i-e-a-o-ex"><i class="fa fa-check"></i><b>2.2.2</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro-example.html"><a href="intro-example.html#i-e-math-func"><i class="fa fa-check"></i><b>2.3</b> 数学函数</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-sqrt"><i class="fa fa-check"></i><b>2.3.1</b> 数学函数——平方根、指数、对数</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-round"><i class="fa fa-check"></i><b>2.3.2</b> 数学函数——取整</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-sin"><i class="fa fa-check"></i><b>2.3.3</b> 数学函数——三角函数</a></li>
<li class="chapter" data-level="2.3.4" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-asin"><i class="fa fa-check"></i><b>2.3.4</b> 数学函数——反三角函数</a></li>
<li class="chapter" data-level="2.3.5" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-dist"><i class="fa fa-check"></i><b>2.3.5</b> 分布函数和分位数函数</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro-example.html"><a href="intro-example.html#i-e-output"><i class="fa fa-check"></i><b>2.4</b> 输出</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro-example.html"><a href="intro-example.html#i-e-o-simple"><i class="fa fa-check"></i><b>2.4.1</b> 简单输出</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro-example.html"><a href="intro-example.html#i-e-o-sink"><i class="fa fa-check"></i><b>2.4.2</b> 用<code>sink()</code>函数作运行记录</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro-example.html"><a href="intro-example.html#i-e-o-ex"><i class="fa fa-check"></i><b>2.4.3</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-example.html"><a href="intro-example.html#i-e-vector"><i class="fa fa-check"></i><b>2.5</b> 向量计算与变量赋值</a></li>
<li class="chapter" data-level="2.6" data-path="intro-example.html"><a href="intro-example.html#i-e-workspace"><i class="fa fa-check"></i><b>2.6</b> 工作空间介绍</a><ul>
<li class="chapter" data-level="2.6.1" data-path="intro-example.html"><a href="intro-example.html#i-e-w-ex"><i class="fa fa-check"></i><b>2.6.1</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="intro-example.html"><a href="intro-example.html#i-e-graph"><i class="fa fa-check"></i><b>2.7</b> 绘图示例</a><ul>
<li class="chapter" data-level="2.7.1" data-path="intro-example.html"><a href="intro-example.html#i-e-g-curve"><i class="fa fa-check"></i><b>2.7.1</b> 函数曲线示例</a></li>
<li class="chapter" data-level="2.7.2" data-path="intro-example.html"><a href="intro-example.html#i-e-g-barplot"><i class="fa fa-check"></i><b>2.7.2</b> 条形图示例</a></li>
<li class="chapter" data-level="2.7.3" data-path="intro-example.html"><a href="intro-example.html#i-e-g-scatter"><i class="fa fa-check"></i><b>2.7.3</b> 散点图示例</a></li>
<li class="chapter" data-level="2.7.4" data-path="intro-example.html"><a href="intro-example.html#i-e-g-demo"><i class="fa fa-check"></i><b>2.7.4</b> R软件自带的图形示例</a></li>
<li class="chapter" data-level="2.7.5" data-path="intro-example.html"><a href="intro-example.html#i-e-g-ex"><i class="fa fa-check"></i><b>2.7.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="intro-example.html"><a href="intro-example.html#i-e-summary"><i class="fa fa-check"></i><b>2.8</b> 汇总统计示例</a><ul>
<li class="chapter" data-level="2.8.1" data-path="intro-example.html"><a href="intro-example.html#i-e-s-table"><i class="fa fa-check"></i><b>2.8.1</b> 表格数据</a></li>
<li class="chapter" data-level="2.8.2" data-path="intro-example.html"><a href="intro-example.html#i-e-s-t-read-table"><i class="fa fa-check"></i><b>2.8.2</b> 读入表格数据</a></li>
<li class="chapter" data-level="2.8.3" data-path="intro-example.html"><a href="intro-example.html#i-e-s-ex"><i class="fa fa-check"></i><b>2.8.3</b> 练习</a></li>
<li class="chapter" data-level="2.8.4" data-path="intro-example.html"><a href="intro-example.html#i-e-s-qual-freq"><i class="fa fa-check"></i><b>2.8.4</b> 分类变量频数统计</a></li>
<li class="chapter" data-level="2.8.5" data-path="intro-example.html"><a href="intro-example.html#i-e-s-num-summ"><i class="fa fa-check"></i><b>2.8.5</b> 数值型变量的统计</a></li>
<li class="chapter" data-level="2.8.6" data-path="intro-example.html"><a href="intro-example.html#i-e-s-ex2"><i class="fa fa-check"></i><b>2.8.6</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="intro-example.html"><a href="intro-example.html#i-e-source"><i class="fa fa-check"></i><b>2.9</b> 运行源程序文件</a><ul>
<li class="chapter" data-level="2.9.1" data-path="intro-example.html"><a href="intro-example.html#i-e-source-enc"><i class="fa fa-check"></i><b>2.9.1</b> 源文件编码</a></li>
<li class="chapter" data-level="2.9.2" data-path="intro-example.html"><a href="intro-example.html#i-e-cwd"><i class="fa fa-check"></i><b>2.9.2</b> 当前工作目录</a></li>
<li class="chapter" data-level="2.9.3" data-path="intro-example.html"><a href="intro-example.html#i-e-source-ex"><i class="fa fa-check"></i><b>2.9.3</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="intro-example.html"><a href="intro-example.html#i-e-appendix-data"><i class="fa fa-check"></i><b>2.10</b> 附录：数据</a><ul>
<li class="chapter" data-level="2.10.1" data-path="intro-example.html"><a href="intro-example.html#i-e-appendix-data-tax"><i class="fa fa-check"></i><b>2.10.1</b> 公司纳税数据样例</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II 数据类型与相应的运算</b></span></li>
<li class="chapter" data-level="3" data-path="prog-type-intro.html"><a href="prog-type-intro.html"><i class="fa fa-check"></i><b>3</b> 常量与变量</a><ul>
<li class="chapter" data-level="3.1" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-const"><i class="fa fa-check"></i><b>3.1</b> 常量</a></li>
<li class="chapter" data-level="3.2" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-cv-var"><i class="fa fa-check"></i><b>3.2</b> 变量</a></li>
<li class="chapter" data-level="3.3" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-type"><i class="fa fa-check"></i><b>3.3</b> R数据类型</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prog-type-num.html"><a href="prog-type-num.html"><i class="fa fa-check"></i><b>4</b> 数值型向量及其运算</a><ul>
<li class="chapter" data-level="4.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-num"><i class="fa fa-check"></i><b>4.1</b> 数值型向量</a></li>
<li class="chapter" data-level="4.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith"><i class="fa fa-check"></i><b>4.2</b> 向量运算</a><ul>
<li class="chapter" data-level="4.2.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-scalar"><i class="fa fa-check"></i><b>4.2.1</b> 标量和标量运算</a></li>
<li class="chapter" data-level="4.2.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-with-scalar"><i class="fa fa-check"></i><b>4.2.2</b> 向量与标量运算</a></li>
<li class="chapter" data-level="4.2.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-eq-len"><i class="fa fa-check"></i><b>4.2.3</b> 等长向量运算</a></li>
<li class="chapter" data-level="4.2.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-uneq-len"><i class="fa fa-check"></i><b>4.2.4</b> 不等长向量的运算</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc"><i class="fa fa-check"></i><b>4.3</b> 向量函数</a><ul>
<li class="chapter" data-level="4.3.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-vector-func"><i class="fa fa-check"></i><b>4.3.1</b> 向量化的函数</a></li>
<li class="chapter" data-level="4.3.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-sort"><i class="fa fa-check"></i><b>4.3.2</b> 排序函数</a></li>
<li class="chapter" data-level="4.3.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-stat"><i class="fa fa-check"></i><b>4.3.3</b> 统计函数</a></li>
<li class="chapter" data-level="4.3.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-seq"><i class="fa fa-check"></i><b>4.3.4</b> 生成规则序列的函数</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-complex"><i class="fa fa-check"></i><b>4.4</b> 复数向量</a></li>
<li class="chapter" data-level="4.5" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-ex"><i class="fa fa-check"></i><b>4.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="prog-type-logi.html"><a href="prog-type-logi.html"><i class="fa fa-check"></i><b>5</b> 逻辑型向量及其运算</a><ul>
<li class="chapter" data-level="5.1" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-logical-vec"><i class="fa fa-check"></i><b>5.1</b> 逻辑型向量与比较运算</a></li>
<li class="chapter" data-level="5.2" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-lvec-logic-op"><i class="fa fa-check"></i><b>5.2</b> 逻辑运算</a></li>
<li class="chapter" data-level="5.3" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-lvec-logic-op-vec"><i class="fa fa-check"></i><b>5.3</b> 逻辑运算函数</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="prog-type-char.html"><a href="prog-type-char.html"><i class="fa fa-check"></i><b>6</b> 字符型数据及其处理</a><ul>
<li class="chapter" data-level="6.1" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char"><i class="fa fa-check"></i><b>6.1</b> 字符型向量</a></li>
<li class="chapter" data-level="6.2" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-paste"><i class="fa fa-check"></i><b>6.2</b> <code>paste()</code>函数</a></li>
<li class="chapter" data-level="6.3" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-toupper"><i class="fa fa-check"></i><b>6.3</b> 转换大小写</a></li>
<li class="chapter" data-level="6.4" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-nchar"><i class="fa fa-check"></i><b>6.4</b> 字符串长度</a></li>
<li class="chapter" data-level="6.5" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-substr"><i class="fa fa-check"></i><b>6.5</b> 取子串</a></li>
<li class="chapter" data-level="6.6" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-asnum"><i class="fa fa-check"></i><b>6.6</b> 类型转换</a></li>
<li class="chapter" data-level="6.7" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-strsplit"><i class="fa fa-check"></i><b>6.7</b> 字符串拆分</a></li>
<li class="chapter" data-level="6.8" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-gsub"><i class="fa fa-check"></i><b>6.8</b> 字符串替换功能</a></li>
<li class="chapter" data-level="6.9" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-regexp"><i class="fa fa-check"></i><b>6.9</b> 正则表达式</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="prog-type-index.html"><a href="prog-type-index.html"><i class="fa fa-check"></i><b>7</b> R向量下标和子集</a><ul>
<li class="chapter" data-level="7.1" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-int"><i class="fa fa-check"></i><b>7.1</b> 正整数下标</a></li>
<li class="chapter" data-level="7.2" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-negint"><i class="fa fa-check"></i><b>7.2</b> 负整数下标</a></li>
<li class="chapter" data-level="7.3" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-all"><i class="fa fa-check"></i><b>7.3</b> 空下标与零下标</a></li>
<li class="chapter" data-level="7.4" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-over"><i class="fa fa-check"></i><b>7.4</b> 下标超界</a></li>
<li class="chapter" data-level="7.5" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-logic"><i class="fa fa-check"></i><b>7.5</b> 逻辑下标</a></li>
<li class="chapter" data-level="7.6" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-which"><i class="fa fa-check"></i><b>7.6</b> <code>which()</code>、<code>which.min()</code>、<code>which.max()</code>函数</a></li>
<li class="chapter" data-level="7.7" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-names"><i class="fa fa-check"></i><b>7.7</b> 元素名</a></li>
<li class="chapter" data-level="7.8" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-mapping"><i class="fa fa-check"></i><b>7.8</b> 用R向量下标作映射</a></li>
<li class="chapter" data-level="7.9" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-set"><i class="fa fa-check"></i><b>7.9</b> 集合运算</a></li>
<li class="chapter" data-level="7.10" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-set-ex"><i class="fa fa-check"></i><b>7.10</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="prog-type-attr.html"><a href="prog-type-attr.html"><i class="fa fa-check"></i><b>8</b> R数据类型的性质</a><ul>
<li class="chapter" data-level="8.1" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-typeof"><i class="fa fa-check"></i><b>8.1</b> 存储模式与基本类型</a></li>
<li class="chapter" data-level="8.2" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-as"><i class="fa fa-check"></i><b>8.2</b> 类型转换与类型升档</a></li>
<li class="chapter" data-level="8.3" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr"><i class="fa fa-check"></i><b>8.3</b> 属性</a><ul>
<li class="chapter" data-level="8.3.1" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-asfun"><i class="fa fa-check"></i><b>8.3.1</b> <code>attributes</code>函数</a></li>
<li class="chapter" data-level="8.3.2" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-attrfun"><i class="fa fa-check"></i><b>8.3.2</b> <code>attr</code>函数</a></li>
<li class="chapter" data-level="8.3.3" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-names"><i class="fa fa-check"></i><b>8.3.3</b> <code>names</code>属性</a></li>
<li class="chapter" data-level="8.3.4" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-dim"><i class="fa fa-check"></i><b>8.3.4</b> <code>dim</code>属性</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-class"><i class="fa fa-check"></i><b>8.4</b> 类属</a></li>
<li class="chapter" data-level="8.5" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-str"><i class="fa fa-check"></i><b>8.5</b> <code>str()</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="prog-type-date.html"><a href="prog-type-date.html"><i class="fa fa-check"></i><b>9</b> R日期时间</a><ul>
<li class="chapter" data-level="9.1" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-intro"><i class="fa fa-check"></i><b>9.1</b> R日期和日期时间类型</a></li>
<li class="chapter" data-level="9.2" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-fromchr"><i class="fa fa-check"></i><b>9.2</b> 从字符串生成日期数据</a></li>
<li class="chapter" data-level="9.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-format"><i class="fa fa-check"></i><b>9.3</b> 日期显示格式</a></li>
<li class="chapter" data-level="9.4" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-comp"><i class="fa fa-check"></i><b>9.4</b> 访问日期时间的组成值</a></li>
<li class="chapter" data-level="9.5" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-round"><i class="fa fa-check"></i><b>9.5</b> 日期舍入计算</a></li>
<li class="chapter" data-level="9.6" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc"><i class="fa fa-check"></i><b>9.6</b> 日期计算</a><ul>
<li class="chapter" data-level="9.6.1" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-dur"><i class="fa fa-check"></i><b>9.6.1</b> 时间长度</a></li>
<li class="chapter" data-level="9.6.2" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-per"><i class="fa fa-check"></i><b>9.6.2</b> 时间周期</a></li>
<li class="chapter" data-level="9.6.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-int"><i class="fa fa-check"></i><b>9.6.3</b> 时间区间</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-baser"><i class="fa fa-check"></i><b>9.7</b> 基本R软件的日期功能</a><ul>
<li class="chapter" data-level="9.7.1" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-gen"><i class="fa fa-check"></i><b>9.7.1</b> 生成日期和日期时间型数据</a></li>
<li class="chapter" data-level="9.7.2" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-comp"><i class="fa fa-check"></i><b>9.7.2</b> 取出日期时间的组成值</a></li>
<li class="chapter" data-level="9.7.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-calc"><i class="fa fa-check"></i><b>9.7.3</b> 日期计算</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-ex"><i class="fa fa-check"></i><b>9.8</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="prog-type-fact.html"><a href="prog-type-fact.html"><i class="fa fa-check"></i><b>10</b> R因子类型</a><ul>
<li class="chapter" data-level="10.1" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-fact"><i class="fa fa-check"></i><b>10.1</b> 因子</a></li>
<li class="chapter" data-level="10.2" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-table"><i class="fa fa-check"></i><b>10.2</b> <code>table()</code>函数</a></li>
<li class="chapter" data-level="10.3" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-tapply"><i class="fa fa-check"></i><b>10.3</b> <code>tapply()</code>函数</a></li>
<li class="chapter" data-level="10.4" data-path="prog-type-fact.html"><a href="prog-type-fact.html#summ-by-forcats"><i class="fa fa-check"></i><b>10.4</b> forcats包的因子函数</a></li>
<li class="chapter" data-level="10.5" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-ex"><i class="fa fa-check"></i><b>10.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="prog-type-list.html"><a href="prog-type-list.html"><i class="fa fa-check"></i><b>11</b> 列表类型</a><ul>
<li class="chapter" data-level="11.1" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list"><i class="fa fa-check"></i><b>11.1</b> 列表</a></li>
<li class="chapter" data-level="11.2" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-access"><i class="fa fa-check"></i><b>11.2</b> 列表元素访问</a></li>
<li class="chapter" data-level="11.3" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-as"><i class="fa fa-check"></i><b>11.3</b> 列表类型转换</a></li>
<li class="chapter" data-level="11.4" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-ex-strsplit"><i class="fa fa-check"></i><b>11.4</b> 返回列表的函数示例–<code>strsplit()</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html"><i class="fa fa-check"></i><b>12</b> R矩阵和数组</a><ul>
<li class="chapter" data-level="12.1" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matrix"><i class="fa fa-check"></i><b>12.1</b> R矩阵</a></li>
<li class="chapter" data-level="12.2" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-subset"><i class="fa fa-check"></i><b>12.2</b> 矩阵子集</a></li>
<li class="chapter" data-level="12.3" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-cbind"><i class="fa fa-check"></i><b>12.3</b> <code>cbind()</code>和<code>rbind()</code>函数</a></li>
<li class="chapter" data-level="12.4" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop"><i class="fa fa-check"></i><b>12.4</b> 矩阵运算</a><ul>
<li class="chapter" data-level="12.4.1" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-arith"><i class="fa fa-check"></i><b>12.4.1</b> 四则运算</a></li>
<li class="chapter" data-level="12.4.2" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-mult"><i class="fa fa-check"></i><b>12.4.2</b> 矩阵乘法</a></li>
<li class="chapter" data-level="12.4.3" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-vecmat"><i class="fa fa-check"></i><b>12.4.3</b> 向量与矩阵相乘</a></li>
<li class="chapter" data-level="12.4.4" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-inprod"><i class="fa fa-check"></i><b>12.4.4</b> 内积</a></li>
<li class="chapter" data-level="12.4.5" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-outer"><i class="fa fa-check"></i><b>12.4.5</b> 外积</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-solve"><i class="fa fa-check"></i><b>12.5</b> 逆矩阵与线性方程组求解</a></li>
<li class="chapter" data-level="12.6" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-apply"><i class="fa fa-check"></i><b>12.6</b> <code>apply()</code>函数</a></li>
<li class="chapter" data-level="12.7" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-array"><i class="fa fa-check"></i><b>12.7</b> 多维数组</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="prog-type-df.html"><a href="prog-type-df.html"><i class="fa fa-check"></i><b>13</b> 数据框</a><ul>
<li class="chapter" data-level="13.1" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-dataframe"><i class="fa fa-check"></i><b>13.1</b> 数据框</a></li>
<li class="chapter" data-level="13.2" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-access"><i class="fa fa-check"></i><b>13.2</b> 数据框内容访问</a></li>
<li class="chapter" data-level="13.3" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-rownames"><i class="fa fa-check"></i><b>13.3</b> 数据框的行名</a></li>
<li class="chapter" data-level="13.4" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-notmatrix"><i class="fa fa-check"></i><b>13.4</b> 数据框与矩阵的区别</a></li>
<li class="chapter" data-level="13.5" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-gl-func"><i class="fa fa-check"></i><b>13.5</b> <code>tidyr::expand_grid()</code>函数</a></li>
<li class="chapter" data-level="13.6" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-tibble"><i class="fa fa-check"></i><b>13.6</b> <code>tibble</code>类型</a></li>
<li class="chapter" data-level="13.7" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-ex"><i class="fa fa-check"></i><b>13.7</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="prog-type-ws.html"><a href="prog-type-ws.html"><i class="fa fa-check"></i><b>14</b> 工作空间和变量赋值</a><ul>
<li class="chapter" data-level="14.1" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws"><i class="fa fa-check"></i><b>14.1</b> 工作空间</a></li>
<li class="chapter" data-level="14.2" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-nlvname"><i class="fa fa-check"></i><b>14.2</b> 非法变量名</a></li>
<li class="chapter" data-level="14.3" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws-asign"><i class="fa fa-check"></i><b>14.3</b> 变量赋值与绑定</a></li>
<li class="chapter" data-level="14.4" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws-env"><i class="fa fa-check"></i><b>14.4</b> 环境</a></li>
</ul></li>
<li class="part"><span><b>III 编程</b></span></li>
<li class="chapter" data-level="15" data-path="prog-io.html"><a href="prog-io.html"><i class="fa fa-check"></i><b>15</b> R输入输出</a><ul>
<li class="chapter" data-level="15.1" data-path="prog-io.html"><a href="prog-io.html#p-io-simple"><i class="fa fa-check"></i><b>15.1</b> 输入输出的简单方法</a><ul>
<li class="chapter" data-level="15.1.1" data-path="prog-io.html"><a href="prog-io.html#p-io-simple-out"><i class="fa fa-check"></i><b>15.1.1</b> 简单的输出</a></li>
<li class="chapter" data-level="15.1.2" data-path="prog-io.html"><a href="prog-io.html#p-io-simple-input"><i class="fa fa-check"></i><b>15.1.2</b> 简单的输入</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv"><i class="fa fa-check"></i><b>15.2</b> 读取CSV文件</a><ul>
<li class="chapter" data-level="15.2.1" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-format"><i class="fa fa-check"></i><b>15.2.1</b> CSV格式</a></li>
<li class="chapter" data-level="15.2.2" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-fromstr"><i class="fa fa-check"></i><b>15.2.2</b> 从字符串读入</a></li>
<li class="chapter" data-level="15.2.3" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-opt"><i class="fa fa-check"></i><b>15.2.3</b> <code>read_csv</code>选项</a></li>
<li class="chapter" data-level="15.2.4" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-enc"><i class="fa fa-check"></i><b>15.2.4</b> 编码设置</a></li>
<li class="chapter" data-level="15.2.5" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-na"><i class="fa fa-check"></i><b>15.2.5</b> 缺失值设置</a></li>
<li class="chapter" data-level="15.2.6" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-colt"><i class="fa fa-check"></i><b>15.2.6</b> 各列类型设置</a></li>
<li class="chapter" data-level="15.2.7" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-fact"><i class="fa fa-check"></i><b>15.2.7</b> 因子类型设置</a></li>
<li class="chapter" data-level="15.2.8" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-date"><i class="fa fa-check"></i><b>15.2.8</b> 读入日期</a></li>
<li class="chapter" data-level="15.2.9" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-funcs"><i class="fa fa-check"></i><b>15.2.9</b> 其它函数</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="prog-io.html"><a href="prog-io.html#p-io-excel"><i class="fa fa-check"></i><b>15.3</b> Excel表访问</a><ul>
<li class="chapter" data-level="15.3.1" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-csv"><i class="fa fa-check"></i><b>15.3.1</b> 借助于文本格式</a></li>
<li class="chapter" data-level="15.3.2" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-clip"><i class="fa fa-check"></i><b>15.3.2</b> 使用剪贴板</a></li>
<li class="chapter" data-level="15.3.3" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-readxl"><i class="fa fa-check"></i><b>15.3.3</b> 利用readxl扩展包</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="prog-io.html"><a href="prog-io.html#p-io-file"><i class="fa fa-check"></i><b>15.4</b> 文件访问</a><ul>
<li class="chapter" data-level="15.4.1" data-path="prog-io.html"><a href="prog-io.html#p-io-file-conn"><i class="fa fa-check"></i><b>15.4.1</b> 连接</a></li>
<li class="chapter" data-level="15.4.2" data-path="prog-io.html"><a href="prog-io.html#p-io-file-text"><i class="fa fa-check"></i><b>15.4.2</b> 文本文件访问</a></li>
<li class="chapter" data-level="15.4.3" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-batch"><i class="fa fa-check"></i><b>15.4.3</b> 文本文件分批读写</a></li>
<li class="chapter" data-level="15.4.4" data-path="prog-io.html"><a href="prog-io.html#p-io-file-bin"><i class="fa fa-check"></i><b>15.4.4</b> 二进制文件访问</a></li>
<li class="chapter" data-level="15.4.5" data-path="prog-io.html"><a href="prog-io.html#p-io-file-textcon"><i class="fa fa-check"></i><b>15.4.5</b> 字符型连接</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="prog-io.html"><a href="prog-io.html#p-io-enc"><i class="fa fa-check"></i><b>15.5</b> 中文编码问题</a><ul>
<li class="chapter" data-level="15.5.1" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-base"><i class="fa fa-check"></i><b>15.5.1</b> 用基本R的读取函数读取</a></li>
<li class="chapter" data-level="15.5.2" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-readr"><i class="fa fa-check"></i><b>15.5.2</b> 用readr包读取</a></li>
<li class="chapter" data-level="15.5.3" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-write"><i class="fa fa-check"></i><b>15.5.3</b> 输出文件的编码</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="prog-io.html"><a href="prog-io.html#p-io-dir"><i class="fa fa-check"></i><b>15.6</b> 目录和文件管理</a></li>
<li class="chapter" data-level="15.7" data-path="prog-io.html"><a href="prog-io.html#p-io-db"><i class="fa fa-check"></i><b>15.7</b> SQL数据库访问</a><ul>
<li class="chapter" data-level="15.7.1" data-path="prog-io.html"><a href="prog-io.html#p-io-db-intro"><i class="fa fa-check"></i><b>15.7.1</b> 介绍</a></li>
<li class="chapter" data-level="15.7.2" data-path="prog-io.html"><a href="prog-io.html#p-io-db-sqlite"><i class="fa fa-check"></i><b>15.7.2</b> SQLite数据库访问</a></li>
<li class="chapter" data-level="15.7.3" data-path="prog-io.html"><a href="prog-io.html#p-io-db-sql"><i class="fa fa-check"></i><b>15.7.3</b> SQL命令简介</a></li>
<li class="chapter" data-level="15.7.4" data-path="prog-io.html"><a href="prog-io.html#p-io-db-oracle"><i class="fa fa-check"></i><b>15.7.4</b> 访问Oracle数据库</a></li>
<li class="chapter" data-level="15.7.5" data-path="prog-io.html"><a href="prog-io.html#p-io-db-mysql"><i class="fa fa-check"></i><b>15.7.5</b> MySQL数据库访问</a></li>
<li class="chapter" data-level="15.7.6" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-rodbc"><i class="fa fa-check"></i><b>15.7.6</b> 利用RODBC访问Access数据库</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="prog-control.html"><a href="prog-control.html"><i class="fa fa-check"></i><b>16</b> 程序控制结构</a><ul>
<li class="chapter" data-level="16.1" data-path="prog-control.html"><a href="prog-control.html#p-con-exp"><i class="fa fa-check"></i><b>16.1</b> 表达式</a></li>
<li class="chapter" data-level="16.2" data-path="prog-control.html"><a href="prog-control.html#p-con-if"><i class="fa fa-check"></i><b>16.2</b> 分支结构</a><ul>
<li class="chapter" data-level="16.2.1" data-path="prog-control.html"><a href="prog-control.html#p-con-logic-index"><i class="fa fa-check"></i><b>16.2.1</b> 用逻辑下标代替分支结构</a></li>
<li class="chapter" data-level="16.2.2" data-path="prog-control.html"><a href="prog-control.html#p-con-ifelsef"><i class="fa fa-check"></i><b>16.2.2</b> <code>ifelse</code>函数</a></li>
<li class="chapter" data-level="16.2.3" data-path="prog-control.html"><a href="prog-control.html#p-con-switch"><i class="fa fa-check"></i><b>16.2.3</b> <code>switch</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="prog-control.html"><a href="prog-control.html#p-con-loop"><i class="fa fa-check"></i><b>16.3</b> 循环结构</a><ul>
<li class="chapter" data-level="16.3.1" data-path="prog-control.html"><a href="prog-control.html#p-con-for"><i class="fa fa-check"></i><b>16.3.1</b> 计数循环</a></li>
<li class="chapter" data-level="16.3.2" data-path="prog-control.html"><a href="prog-control.html#p-con-while"><i class="fa fa-check"></i><b>16.3.2</b> <code>while</code>循环和<code>repeat</code>循环</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="prog-control.html"><a href="prog-control.html#p-con-cond"><i class="fa fa-check"></i><b>16.4</b> R中判断条件</a></li>
<li class="chapter" data-level="16.5" data-path="prog-control.html"><a href="prog-control.html#p-pipe"><i class="fa fa-check"></i><b>16.5</b> 管道控制</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="prog-func.html"><a href="prog-func.html"><i class="fa fa-check"></i><b>17</b> 函数</a><ul>
<li class="chapter" data-level="17.1" data-path="prog-func.html"><a href="prog-func.html#p-func"><i class="fa fa-check"></i><b>17.1</b> 函数基础</a><ul>
<li class="chapter" data-level="17.1.1" data-path="prog-func.html"><a href="prog-func.html#p-func-intro"><i class="fa fa-check"></i><b>17.1.1</b> 介绍</a></li>
<li class="chapter" data-level="17.1.2" data-path="prog-func.html"><a href="prog-func.html#p-func-def"><i class="fa fa-check"></i><b>17.1.2</b> 函数定义</a></li>
<li class="chapter" data-level="17.1.3" data-path="prog-func.html"><a href="prog-func.html#p-func-call"><i class="fa fa-check"></i><b>17.1.3</b> 函数调用</a></li>
<li class="chapter" data-level="17.1.4" data-path="prog-func.html"><a href="prog-func.html#p-func-recursive"><i class="fa fa-check"></i><b>17.1.4</b> 递归调用</a></li>
<li class="chapter" data-level="17.1.5" data-path="prog-func.html"><a href="prog-func.html#p-func-vr"><i class="fa fa-check"></i><b>17.1.5</b> 向量化</a></li>
<li class="chapter" data-level="17.1.6" data-path="prog-func.html"><a href="prog-func.html#p-func-anonymf"><i class="fa fa-check"></i><b>17.1.6</b> 无名函数</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="prog-func.html"><a href="prog-func.html#p-func-space"><i class="fa fa-check"></i><b>17.2</b> 变量作用域</a><ul>
<li class="chapter" data-level="17.2.1" data-path="prog-func.html"><a href="prog-func.html#p-func-global"><i class="fa fa-check"></i><b>17.2.1</b> 全局变量和工作空间</a></li>
<li class="chapter" data-level="17.2.2" data-path="prog-func.html"><a href="prog-func.html#p-func-local"><i class="fa fa-check"></i><b>17.2.2</b> 局部变量</a></li>
<li class="chapter" data-level="17.2.3" data-path="prog-func.html"><a href="prog-func.html#p-func-global-access"><i class="fa fa-check"></i><b>17.2.3</b> 在函数内访问全局变量</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="prog-prof.html"><a href="prog-prof.html"><i class="fa fa-check"></i><b>18</b> R程序效率</a><ul>
<li class="chapter" data-level="18.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-effic"><i class="fa fa-check"></i><b>18.1</b> R的运行效率</a></li>
<li class="chapter" data-level="18.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect"><i class="fa fa-check"></i><b>18.2</b> 向量化编程</a><ul>
<li class="chapter" data-level="18.2.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex1"><i class="fa fa-check"></i><b>18.2.1</b> 示例1</a></li>
<li class="chapter" data-level="18.2.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex2"><i class="fa fa-check"></i><b>18.2.2</b> 示例2</a></li>
<li class="chapter" data-level="18.2.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex3"><i class="fa fa-check"></i><b>18.2.3</b> 示例3</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-loop"><i class="fa fa-check"></i><b>18.3</b> 减少显式循环</a><ul>
<li class="chapter" data-level="18.3.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-replicate"><i class="fa fa-check"></i><b>18.3.1</b> <code>replicate()</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-copy"><i class="fa fa-check"></i><b>18.4</b> 避免制作副本</a></li>
<li class="chapter" data-level="18.5" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun"><i class="fa fa-check"></i><b>18.5</b> R的计算函数</a><ul>
<li class="chapter" data-level="18.5.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-math"><i class="fa fa-check"></i><b>18.5.1</b> 数学函数</a></li>
<li class="chapter" data-level="18.5.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-sum"><i class="fa fa-check"></i><b>18.5.2</b> 概括函数</a></li>
<li class="chapter" data-level="18.5.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-max"><i class="fa fa-check"></i><b>18.5.3</b> 最值</a></li>
<li class="chapter" data-level="18.5.4" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-sort"><i class="fa fa-check"></i><b>18.5.4</b> 排序</a></li>
<li class="chapter" data-level="18.5.5" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-integrate"><i class="fa fa-check"></i><b>18.5.5</b> 一元定积分<code>integrate</code></a></li>
<li class="chapter" data-level="18.5.6" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-uniroot"><i class="fa fa-check"></i><b>18.5.6</b> 一元函数求根<code>uniroot</code></a></li>
<li class="chapter" data-level="18.5.7" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-fft"><i class="fa fa-check"></i><b>18.5.7</b> 离散傅立叶变换<code>fft</code></a></li>
<li class="chapter" data-level="18.5.8" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-filter"><i class="fa fa-check"></i><b>18.5.8</b> 用<code>filter</code>函数作迭代</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu"><i class="fa fa-check"></i><b>18.6</b> 并行计算</a><ul>
<li class="chapter" data-level="18.6.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex1"><i class="fa fa-check"></i><b>18.6.1</b> 例1：完全不互相依赖的并行运算</a></li>
<li class="chapter" data-level="18.6.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex2"><i class="fa fa-check"></i><b>18.6.2</b> 例2：使用相同随机数序列的并行计算</a></li>
<li class="chapter" data-level="18.6.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex3"><i class="fa fa-check"></i><b>18.6.3</b> 例3：使用独立随机数序列的并行计算</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="p-advfunc.html"><a href="p-advfunc.html"><i class="fa fa-check"></i><b>19</b> 函数进阶</a><ul>
<li class="chapter" data-level="19.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-callspe"><i class="fa fa-check"></i><b>19.1</b> 函数调用的各种形式</a></li>
<li class="chapter" data-level="19.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-lex"><i class="fa fa-check"></i><b>19.2</b> 嵌套定义与句法作用域(lexical scoping)</a></li>
<li class="chapter" data-level="19.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-inner"><i class="fa fa-check"></i><b>19.3</b> 辅助嵌套函数</a></li>
<li class="chapter" data-level="19.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-lazy"><i class="fa fa-check"></i><b>19.4</b> 懒惰求值</a></li>
<li class="chapter" data-level="19.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug"><i class="fa fa-check"></i><b>19.5</b> 程序调试</a><ul>
<li class="chapter" data-level="19.5.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-intro"><i class="fa fa-check"></i><b>19.5.1</b> 基本调试策略</a></li>
<li class="chapter" data-level="19.5.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-findfunc"><i class="fa fa-check"></i><b>19.5.2</b> 找到出错的函数</a></li>
<li class="chapter" data-level="19.5.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-browser"><i class="fa fa-check"></i><b>19.5.3</b> 跟踪调试</a></li>
<li class="chapter" data-level="19.5.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-cond"><i class="fa fa-check"></i><b>19.5.4</b> 条件断点</a></li>
<li class="chapter" data-level="19.5.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-debugf"><i class="fa fa-check"></i><b>19.5.5</b> 开启对一个函数的调试</a></li>
<li class="chapter" data-level="19.5.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-opt"><i class="fa fa-check"></i><b>19.5.6</b> 出错调试选项</a></li>
<li class="chapter" data-level="19.5.7" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-stop"><i class="fa fa-check"></i><b>19.5.7</b> <code>stop()</code>、<code>warning()</code>、<code>message()</code></a></li>
<li class="chapter" data-level="19.5.8" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-preventive"><i class="fa fa-check"></i><b>19.5.8</b> 预防性设计</a></li>
<li class="chapter" data-level="19.5.9" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-try"><i class="fa fa-check"></i><b>19.5.9</b> 出错处理机制</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-funcprog"><i class="fa fa-check"></i><b>19.6</b> 函数式编程介绍</a><ul>
<li class="chapter" data-level="19.6.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-pure"><i class="fa fa-check"></i><b>19.6.1</b> 纯函数</a></li>
<li class="chapter" data-level="19.6.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-rec"><i class="fa fa-check"></i><b>19.6.2</b> 副作用和运行环境恢复</a></li>
<li class="chapter" data-level="19.6.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-rsupp"><i class="fa fa-check"></i><b>19.6.3</b> R的函数式编程功能</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-functional"><i class="fa fa-check"></i><b>19.7</b> 泛函</a><ul>
<li class="chapter" data-level="19.7.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-map"><i class="fa fa-check"></i><b>19.7.1</b> <code>purrr::map</code>函数</a></li>
<li class="chapter" data-level="19.7.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-mapv"><i class="fa fa-check"></i><b>19.7.2</b> purrr包中<code>map</code>函数的变种</a></li>
<li class="chapter" data-level="19.7.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-reduce"><i class="fa fa-check"></i><b>19.7.3</b> purrr包中<code>reduce</code>类函数</a></li>
<li class="chapter" data-level="19.7.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-pred"><i class="fa fa-check"></i><b>19.7.4</b> purrr包中使用示性函数的泛函</a></li>
<li class="chapter" data-level="19.7.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-lapp"><i class="fa fa-check"></i><b>19.7.5</b> 基本R的函数式编程支持</a></li>
<li class="chapter" data-level="19.7.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-udef"><i class="fa fa-check"></i><b>19.7.6</b> 自定义泛函</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory"><i class="fa fa-check"></i><b>19.8</b> 函数工厂</a><ul>
<li class="chapter" data-level="19.8.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-clex"><i class="fa fa-check"></i><b>19.8.1</b> 闭包例子</a></li>
<li class="chapter" data-level="19.8.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-lazy"><i class="fa fa-check"></i><b>19.8.2</b> 动态查找和懒惰求值引起的问题</a></li>
<li class="chapter" data-level="19.8.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-mem"><i class="fa fa-check"></i><b>19.8.3</b> 函数工厂的内存负担</a></li>
<li class="chapter" data-level="19.8.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-operator"><i class="fa fa-check"></i><b>19.8.4</b> 函数算子</a></li>
</ul></li>
<li class="chapter" data-level="19.9" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env"><i class="fa fa-check"></i><b>19.9</b> 环境</a><ul>
<li class="chapter" data-level="19.9.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-def"><i class="fa fa-check"></i><b>19.9.1</b> 基本概念</a></li>
<li class="chapter" data-level="19.9.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-recurs"><i class="fa fa-check"></i><b>19.9.2</b> 逐层向上访问环境</a></li>
<li class="chapter" data-level="19.9.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-spec"><i class="fa fa-check"></i><b>19.9.3</b> 特殊环境</a></li>
<li class="chapter" data-level="19.9.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-callst"><i class="fa fa-check"></i><b>19.9.4</b> 调用栈</a></li>
<li class="chapter" data-level="19.9.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-usedt"><i class="fa fa-check"></i><b>19.9.5</b> 将环境用作一般数据结构</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV 制作研究报告和图书</b></span></li>
<li class="chapter" data-level="20" data-path="knitr.html"><a href="knitr.html"><i class="fa fa-check"></i><b>20</b> 用R制作研究报告</a></li>
<li class="chapter" data-level="21" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>21</b> Markdown格式</a><ul>
<li class="chapter" data-level="21.1" data-path="markdown.html"><a href="markdown.html#markdown-intro"><i class="fa fa-check"></i><b>21.1</b> 介绍</a></li>
<li class="chapter" data-level="21.2" data-path="markdown.html"><a href="markdown.html#markdown-app"><i class="fa fa-check"></i><b>21.2</b> Markdown格式文件的应用</a></li>
<li class="chapter" data-level="21.3" data-path="markdown.html"><a href="markdown.html#markdown-format"><i class="fa fa-check"></i><b>21.3</b> markdown格式说明</a><ul>
<li class="chapter" data-level="21.3.1" data-path="markdown.html"><a href="markdown.html#markdown-format-intro"><i class="fa fa-check"></i><b>21.3.1</b> 概述</a></li>
<li class="chapter" data-level="21.3.2" data-path="markdown.html"><a href="markdown.html#markdown-format-paragraph"><i class="fa fa-check"></i><b>21.3.2</b> 段落</a></li>
<li class="chapter" data-level="21.3.3" data-path="markdown.html"><a href="markdown.html#markdown-format-inline"><i class="fa fa-check"></i><b>21.3.3</b> 段内文字格式</a></li>
<li class="chapter" data-level="21.3.4" data-path="markdown.html"><a href="markdown.html#markdown-format-header"><i class="fa fa-check"></i><b>21.3.4</b> 标题和分隔线</a></li>
<li class="chapter" data-level="21.3.5" data-path="markdown.html"><a href="markdown.html#markdown-format-cite"><i class="fa fa-check"></i><b>21.3.5</b> 引用段落</a></li>
<li class="chapter" data-level="21.3.6" data-path="markdown.html"><a href="markdown.html#markdown-format-list"><i class="fa fa-check"></i><b>21.3.6</b> 列表</a></li>
<li class="chapter" data-level="21.3.7" data-path="markdown.html"><a href="markdown.html#markdown-format-code"><i class="fa fa-check"></i><b>21.3.7</b> 源程序</a></li>
<li class="chapter" data-level="21.3.8" data-path="markdown.html"><a href="markdown.html#markdown-format-link"><i class="fa fa-check"></i><b>21.3.8</b> 链接</a></li>
<li class="chapter" data-level="21.3.9" data-path="markdown.html"><a href="markdown.html#markdown-format-fig"><i class="fa fa-check"></i><b>21.3.9</b> 插入图形</a></li>
<li class="chapter" data-level="21.3.10" data-path="markdown.html"><a href="markdown.html#markdown-format-table"><i class="fa fa-check"></i><b>21.3.10</b> 表格</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="markdown.html"><a href="markdown.html#markdown-pandoc"><i class="fa fa-check"></i><b>21.4</b> 附录：pandoc软件介绍</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>22</b> R Markdown文件格式</a><ul>
<li class="chapter" data-level="22.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-intro"><i class="fa fa-check"></i><b>22.1</b> R Markdown文件</a></li>
<li class="chapter" data-level="22.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-compile"><i class="fa fa-check"></i><b>22.2</b> R Markdown文件的编译</a><ul>
<li class="chapter" data-level="22.2.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-compile-proc"><i class="fa fa-check"></i><b>22.2.1</b> 编译的实际过程</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode"><i class="fa fa-check"></i><b>22.3</b> 在R Markdown文件中插入R代码</a></li>
<li class="chapter" data-level="22.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-kable"><i class="fa fa-check"></i><b>22.4</b> 输出表格</a></li>
<li class="chapter" data-level="22.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-graph"><i class="fa fa-check"></i><b>22.5</b> 利用R程序插图</a></li>
<li class="chapter" data-level="22.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-opt"><i class="fa fa-check"></i><b>22.6</b> 代码段选项</a><ul>
<li class="chapter" data-level="22.6.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-outformat"><i class="fa fa-check"></i><b>22.6.1</b> 代码和文本输出结果格式</a></li>
<li class="chapter" data-level="22.6.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-figopt"><i class="fa fa-check"></i><b>22.6.2</b> 图形选项</a></li>
<li class="chapter" data-level="22.6.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-cache"><i class="fa fa-check"></i><b>22.6.3</b> 缓存(cache)选项</a></li>
</ul></li>
<li class="chapter" data-level="22.7" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd--sectionlink"><i class="fa fa-check"></i><b>22.7</b> 章节目录链接问题</a></li>
<li class="chapter" data-level="22.8" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula"><i class="fa fa-check"></i><b>22.8</b> 数学公式</a><ul>
<li class="chapter" data-level="22.8.1" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-intro"><i class="fa fa-check"></i><b>22.8.1</b> 在Markdown中输入数学公式</a></li>
<li class="chapter" data-level="22.8.2" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-type"><i class="fa fa-check"></i><b>22.8.2</b> 数学公式类别</a></li>
<li class="chapter" data-level="22.8.3" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-basic"><i class="fa fa-check"></i><b>22.8.3</b> 基本功能</a></li>
<li class="chapter" data-level="22.8.4" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-accent"><i class="fa fa-check"></i><b>22.8.4</b> 修饰符</a></li>
<li class="chapter" data-level="22.8.5" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-align"><i class="fa fa-check"></i><b>22.8.5</b> 对齐与矩阵</a></li>
<li class="chapter" data-level="22.8.6" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-fonts"><i class="fa fa-check"></i><b>22.8.6</b> 特殊字体</a></li>
</ul></li>
<li class="chapter" data-level="22.9" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-engines"><i class="fa fa-check"></i><b>22.9</b> 其它编程语言引擎</a></li>
<li class="chapter" data-level="22.10" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-interact"><i class="fa fa-check"></i><b>22.10</b> 交互内容</a></li>
<li class="chapter" data-level="22.11" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-attryaml"><i class="fa fa-check"></i><b>22.11</b> 属性设置</a><ul>
<li class="chapter" data-level="22.11.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-yaml"><i class="fa fa-check"></i><b>22.11.1</b> YAML元数据</a></li>
<li class="chapter" data-level="22.11.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-types"><i class="fa fa-check"></i><b>22.11.2</b> 输出格式</a></li>
<li class="chapter" data-level="22.11.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr"><i class="fa fa-check"></i><b>22.11.3</b> 输出格式设置</a></li>
<li class="chapter" data-level="22.11.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-toc"><i class="fa fa-check"></i><b>22.11.4</b> 目录设置</a></li>
<li class="chapter" data-level="22.11.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-numsec"><i class="fa fa-check"></i><b>22.11.5</b> 章节自动编号</a></li>
<li class="chapter" data-level="22.11.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-wordnumsec"><i class="fa fa-check"></i><b>22.11.6</b> Word输出章节自动编号及模板功能</a></li>
<li class="chapter" data-level="22.11.7" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-htmlspecific"><i class="fa fa-check"></i><b>22.11.7</b> HTML特有输出格式设置</a></li>
<li class="chapter" data-level="22.11.8" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-mathjax"><i class="fa fa-check"></i><b>22.11.8</b> 关于数学公式支持的设置</a></li>
<li class="chapter" data-level="22.11.9" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-yml"><i class="fa fa-check"></i><b>22.11.9</b> 输出设置文件</a></li>
</ul></li>
<li class="chapter" data-level="22.12" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex"><i class="fa fa-check"></i><b>22.12</b> LaTeX和PDF输出</a><ul>
<li class="chapter" data-level="22.12.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex-tinytex"><i class="fa fa-check"></i><b>22.12.1</b> TinyTex的安装使用</a></li>
<li class="chapter" data-level="22.12.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex-yaml"><i class="fa fa-check"></i><b>22.12.2</b> Rmd中Latex设置</a></li>
</ul></li>
<li class="chapter" data-level="22.13" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-rticles"><i class="fa fa-check"></i><b>22.13</b> 生成期刊文章</a></li>
<li class="chapter" data-level="22.14" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1"><i class="fa fa-check"></i><b>22.14</b> 附录：经验与问题</a><ul>
<li class="chapter" data-level="22.14.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1-wordtemplate"><i class="fa fa-check"></i><b>22.14.1</b> Word模板制作</a></li>
<li class="chapter" data-level="22.14.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1-math"><i class="fa fa-check"></i><b>22.14.2</b> 数学公式设置补充</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="bookdown.html"><a href="bookdown.html"><i class="fa fa-check"></i><b>23</b> 用bookdown制作图书</a><ul>
<li class="chapter" data-level="23.1" data-path="bookdown.html"><a href="bookdown.html#bookdown-intro"><i class="fa fa-check"></i><b>23.1</b> 介绍</a></li>
<li class="chapter" data-level="23.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-settings"><i class="fa fa-check"></i><b>23.2</b> 一本书的设置</a></li>
<li class="chapter" data-level="23.3" data-path="bookdown.html"><a href="bookdown.html#bookdown-sectioning"><i class="fa fa-check"></i><b>23.3</b> 章节结构</a></li>
<li class="chapter" data-level="23.4" data-path="bookdown.html"><a href="bookdown.html#bookdown-compile"><i class="fa fa-check"></i><b>23.4</b> 书的编译</a></li>
<li class="chapter" data-level="23.5" data-path="bookdown.html"><a href="bookdown.html#bookdown-cref"><i class="fa fa-check"></i><b>23.5</b> 交叉引用</a></li>
<li class="chapter" data-level="23.6" data-path="bookdown.html"><a href="bookdown.html#bookdown-formula"><i class="fa fa-check"></i><b>23.6</b> 数学公式和公式编号</a></li>
<li class="chapter" data-level="23.7" data-path="bookdown.html"><a href="bookdown.html#bookdown-theorem"><i class="fa fa-check"></i><b>23.7</b> 定理类编号</a></li>
<li class="chapter" data-level="23.8" data-path="bookdown.html"><a href="bookdown.html#bookdown-bib"><i class="fa fa-check"></i><b>23.8</b> 文献引用</a></li>
<li class="chapter" data-level="23.9" data-path="bookdown.html"><a href="bookdown.html#bookdown-graph"><i class="fa fa-check"></i><b>23.9</b> 插图</a></li>
<li class="chapter" data-level="23.10" data-path="bookdown.html"><a href="bookdown.html#bookdown-table"><i class="fa fa-check"></i><b>23.10</b> 表格</a><ul>
<li class="chapter" data-level="23.10.1" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-md"><i class="fa fa-check"></i><b>23.10.1</b> Markdown表格</a></li>
<li class="chapter" data-level="23.10.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-kable"><i class="fa fa-check"></i><b>23.10.2</b> 用<code>kable()</code>函数制作表格</a></li>
<li class="chapter" data-level="23.10.3" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-kable"><i class="fa fa-check"></i><b>23.10.3</b> R中其它制作表格的包</a></li>
</ul></li>
<li class="chapter" data-level="23.11" data-path="bookdown.html"><a href="bookdown.html#bookdown-mathjax"><i class="fa fa-check"></i><b>23.11</b> 数学公式的设置</a></li>
<li class="chapter" data-level="23.12" data-path="bookdown.html"><a href="bookdown.html#bookdown-exp"><i class="fa fa-check"></i><b>23.12</b> 使用经验</a></li>
<li class="chapter" data-level="23.13" data-path="bookdown.html"><a href="bookdown.html#bookdown-bugs"><i class="fa fa-check"></i><b>23.13</b> bookdown的一些使用问题</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="rmdsite.html"><a href="rmdsite.html"><i class="fa fa-check"></i><b>24</b> 用R Markdown制作简易网站</a><ul>
<li class="chapter" data-level="24.1" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-intro"><i class="fa fa-check"></i><b>24.1</b> 介绍</a></li>
<li class="chapter" data-level="24.2" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown"><i class="fa fa-check"></i><b>24.2</b> 简易网站制作</a><ul>
<li class="chapter" data-level="24.2.1" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-struct"><i class="fa fa-check"></i><b>24.2.1</b> 网站结构</a></li>
<li class="chapter" data-level="24.2.2" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-build"><i class="fa fa-check"></i><b>24.2.2</b> 编译</a></li>
<li class="chapter" data-level="24.2.3" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-pages"><i class="fa fa-check"></i><b>24.2.3</b> 内容文件</a></li>
<li class="chapter" data-level="24.2.4" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-config"><i class="fa fa-check"></i><b>24.2.4</b> 网站设置</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="rmdsite.html"><a href="rmdsite.html#blogdown"><i class="fa fa-check"></i><b>24.3</b> 用blogdown制作网站</a><ul>
<li class="chapter" data-level="24.3.1" data-path="rmdsite.html"><a href="rmdsite.html#blogd-new"><i class="fa fa-check"></i><b>24.3.1</b> 生成新网站的框架</a></li>
<li class="chapter" data-level="24.3.2" data-path="rmdsite.html"><a href="rmdsite.html#blogd-page"><i class="fa fa-check"></i><b>24.3.2</b> 网页内容文件及其设置</a></li>
<li class="chapter" data-level="24.3.3" data-path="rmdsite.html"><a href="rmdsite.html#blogd-workflow"><i class="fa fa-check"></i><b>24.3.3</b> 初学者的工作流程</a></li>
<li class="chapter" data-level="24.3.4" data-path="rmdsite.html"><a href="rmdsite.html#blogd-config"><i class="fa fa-check"></i><b>24.3.4</b> 网站设置文件</a></li>
<li class="chapter" data-level="24.3.5" data-path="rmdsite.html"><a href="rmdsite.html#blogd-static"><i class="fa fa-check"></i><b>24.3.5</b> 静态文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="slides.html"><a href="slides.html"><i class="fa fa-check"></i><b>25</b> 制作幻灯片</a><ul>
<li class="chapter" data-level="25.1" data-path="slides.html"><a href="slides.html#rmd-slides-intro"><i class="fa fa-check"></i><b>25.1</b> 介绍</a></li>
<li class="chapter" data-level="25.2" data-path="slides.html"><a href="slides.html#rmd-slidy"><i class="fa fa-check"></i><b>25.2</b> Slidy幻灯片</a><ul>
<li class="chapter" data-level="25.2.1" data-path="slides.html"><a href="slides.html#rmd-slidy-format"><i class="fa fa-check"></i><b>25.2.1</b> 文件格式</a></li>
<li class="chapter" data-level="25.2.2" data-path="slides.html"><a href="slides.html#rmd-slidy-compile"><i class="fa fa-check"></i><b>25.2.2</b> 幻灯片编译</a></li>
<li class="chapter" data-level="25.2.3" data-path="slides.html"><a href="slides.html#rmd-slidy-play"><i class="fa fa-check"></i><b>25.2.3</b> 播放控制</a></li>
<li class="chapter" data-level="25.2.4" data-path="slides.html"><a href="slides.html#rmd-slidy-handout"><i class="fa fa-check"></i><b>25.2.4</b> 生成单页HTML</a></li>
<li class="chapter" data-level="25.2.5" data-path="slides.html"><a href="slides.html#rmd-slidy-mathjax"><i class="fa fa-check"></i><b>25.2.5</b> 数学公式处理与输出设置文件</a></li>
<li class="chapter" data-level="25.2.6" data-path="slides.html"><a href="slides.html#rmd-slidy-options"><i class="fa fa-check"></i><b>25.2.6</b> 其它选项</a></li>
<li class="chapter" data-level="25.2.7" data-path="slides.html"><a href="slides.html#rmd-slidy-laser"><i class="fa fa-check"></i><b>25.2.7</b> slidy幻灯片激光笔失效问题的修改</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="slides.html"><a href="slides.html#rmdslides-pp"><i class="fa fa-check"></i><b>25.3</b> MS PowerPoint幻灯片</a></li>
<li class="chapter" data-level="25.4" data-path="slides.html"><a href="slides.html#rmdslides-beamer"><i class="fa fa-check"></i><b>25.4</b> Bearmer幻灯片格式</a></li>
<li class="chapter" data-level="25.5" data-path="slides.html"><a href="slides.html#rmdslides-rpres"><i class="fa fa-check"></i><b>25.5</b> R Presentation格式</a></li>
</ul></li>
<li class="part"><span><b>V 数据整理与汇总</b></span></li>
<li class="chapter" data-level="26" data-path="summary-manip.html"><a href="summary-manip.html"><i class="fa fa-check"></i><b>26</b> 数据整理</a><ul>
<li class="chapter" data-level="26.1" data-path="summary-manip.html"><a href="summary-manip.html#summm-tidyv"><i class="fa fa-check"></i><b>26.1</b> tidyverse系统</a></li>
<li class="chapter" data-level="26.2" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-filter"><i class="fa fa-check"></i><b>26.2</b> 用<code>filter()</code>选择行子集</a></li>
<li class="chapter" data-level="26.3" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-head"><i class="fa fa-check"></i><b>26.3</b> 按行序号选择行子集</a></li>
<li class="chapter" data-level="26.4" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-samplen"><i class="fa fa-check"></i><b>26.4</b> 用<code>sample_n()</code>对观测随机抽样</a></li>
<li class="chapter" data-level="26.5" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-distinct"><i class="fa fa-check"></i><b>26.5</b> 用<code>distinct()</code>去除重复行</a></li>
<li class="chapter" data-level="26.6" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-dropna"><i class="fa fa-check"></i><b>26.6</b> 用<code>drop_na()</code>去除指定的变量有缺失值的行</a></li>
<li class="chapter" data-level="26.7" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-select"><i class="fa fa-check"></i><b>26.7</b> 用<code>select()</code>选择列子集</a></li>
<li class="chapter" data-level="26.8" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-pull"><i class="fa fa-check"></i><b>26.8</b> 取出单个变量为向量</a></li>
<li class="chapter" data-level="26.9" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-arrange"><i class="fa fa-check"></i><b>26.9</b> 用<code>arrange()</code>排序</a></li>
<li class="chapter" data-level="26.10" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-rename"><i class="fa fa-check"></i><b>26.10</b> 用<code>rename()</code>修改变量名</a></li>
<li class="chapter" data-level="26.11" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-mutate"><i class="fa fa-check"></i><b>26.11</b> 用<code>mutate()</code>计算新变量</a></li>
<li class="chapter" data-level="26.12" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-transmute"><i class="fa fa-check"></i><b>26.12</b> 用<code>tranmute()</code>生成新变量的数据框</a></li>
<li class="chapter" data-level="26.13" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-pipe"><i class="fa fa-check"></i><b>26.13</b> 用管道连接多次操作</a></li>
<li class="chapter" data-level="26.14" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer"><i class="fa fa-check"></i><b>26.14</b> 宽表转换为长表</a><ul>
<li class="chapter" data-level="26.14.1" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-pl"><i class="fa fa-check"></i><b>26.14.1</b> <code>pivot_longer</code>函数</a></li>
<li class="chapter" data-level="26.14.2" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-prefixvalue"><i class="fa fa-check"></i><b>26.14.2</b> 从列名中提取数值</a></li>
<li class="chapter" data-level="26.14.3" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-colnamemultclassv"><i class="fa fa-check"></i><b>26.14.3</b> 从列名中提取多个分类变量值</a></li>
<li class="chapter" data-level="26.14.4" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-multvarsmultclassv"><i class="fa fa-check"></i><b>26.14.4</b> 一行中有多个属性的多次观测的情形</a></li>
</ul></li>
<li class="chapter" data-level="26.15" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider"><i class="fa fa-check"></i><b>26.15</b> 长表转换为宽表</a><ul>
<li class="chapter" data-level="26.15.1" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-sepvars"><i class="fa fa-check"></i><b>26.15.1</b> 将多个混在一起的变量拆开</a></li>
<li class="chapter" data-level="26.15.2" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-combtimes"><i class="fa fa-check"></i><b>26.15.2</b> 将多个类别合并到一个观测</a></li>
<li class="chapter" data-level="26.15.3" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-combcross"><i class="fa fa-check"></i><b>26.15.3</b> 将交叉类别合并到一个观测</a></li>
<li class="chapter" data-level="26.15.4" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-mvmest"><i class="fa fa-check"></i><b>26.15.4</b> 多个变量的多种值</a></li>
<li class="chapter" data-level="26.15.5" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-mixed"><i class="fa fa-check"></i><b>26.15.5</b> 长宽转换混合使用</a></li>
</ul></li>
<li class="chapter" data-level="26.16" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-spearate"><i class="fa fa-check"></i><b>26.16</b> 拆分数据列</a></li>
<li class="chapter" data-level="26.17" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-unite"><i class="fa fa-check"></i><b>26.17</b> 合并数据列</a></li>
<li class="chapter" data-level="26.18" data-path="summary-manip.html"><a href="summary-manip.html#summ-trans-combv"><i class="fa fa-check"></i><b>26.18</b> 数据框纵向合并</a></li>
<li class="chapter" data-level="26.19" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-join"><i class="fa fa-check"></i><b>26.19</b> 横向合并</a></li>
<li class="chapter" data-level="26.20" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-semi"><i class="fa fa-check"></i><b>26.20</b> 利用第二个数据集筛选</a></li>
<li class="chapter" data-level="26.21" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-set"><i class="fa fa-check"></i><b>26.21</b> 数据集的集合操作</a></li>
<li class="chapter" data-level="26.22" data-path="summary-manip.html"><a href="summary-manip.html#summ-trans-standard"><i class="fa fa-check"></i><b>26.22</b> 标准化</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="summary-summ.html"><a href="summary-summ.html"><i class="fa fa-check"></i><b>27</b> 数据汇总</a><ul>
<li class="chapter" data-level="27.1" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-summ"><i class="fa fa-check"></i><b>27.1</b> 用dplyr作数据汇总</a></li>
<li class="chapter" data-level="27.2" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-summat"><i class="fa fa-check"></i><b>27.2</b> 多个变量的汇总</a></li>
<li class="chapter" data-level="27.3" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-groupby"><i class="fa fa-check"></i><b>27.3</b> 用dplyr作数据分组汇总</a></li>
<li class="chapter" data-level="27.4" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-crossgroup"><i class="fa fa-check"></i><b>27.4</b> 交叉分类的汇总</a></li>
<li class="chapter" data-level="27.5" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest"><i class="fa fa-check"></i><b>27.5</b> tibble中的列表列</a><ul>
<li class="chapter" data-level="27.5.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-intro"><i class="fa fa-check"></i><b>27.5.1</b> <code>nest</code>和<code>unnest</code></a></li>
<li class="chapter" data-level="27.5.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-groupby"><i class="fa fa-check"></i><b>27.5.2</b> <code>group_by</code>与<code>nest</code>配合</a></li>
<li class="chapter" data-level="27.5.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-summarise"><i class="fa fa-check"></i><b>27.5.3</b> <code>summarise</code>统计量用列表表示</a></li>
<li class="chapter" data-level="27.5.4" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-unnest-grammar"><i class="fa fa-check"></i><b>27.5.4</b> <code>unnest</code>的语法格式</a></li>
<li class="chapter" data-level="27.5.5" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-direct"><i class="fa fa-check"></i><b>27.5.5</b> 直接生成列表类型的列</a></li>
</ul></li>
<li class="chapter" data-level="27.6" data-path="summary-summ.html"><a href="summary-summ.html#summ-base"><i class="fa fa-check"></i><b>27.6</b> 基本R的汇总功能</a><ul>
<li class="chapter" data-level="27.6.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-base-summary"><i class="fa fa-check"></i><b>27.6.1</b> <code>summary()</code>函数</a></li>
<li class="chapter" data-level="27.6.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-cont"><i class="fa fa-check"></i><b>27.6.2</b> 连续型变量概括函数</a></li>
<li class="chapter" data-level="27.6.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-fact"><i class="fa fa-check"></i><b>27.6.3</b> 分类变量概括</a></li>
<li class="chapter" data-level="27.6.4" data-path="summary-summ.html"><a href="summary-summ.html#summ-df"><i class="fa fa-check"></i><b>27.6.4</b> 数据框概括</a></li>
</ul></li>
<li class="chapter" data-level="27.7" data-path="summary-summ.html"><a href="summary-summ.html#summ-by"><i class="fa fa-check"></i><b>27.7</b> 用基本R作分类概括</a><ul>
<li class="chapter" data-level="27.7.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-tapply"><i class="fa fa-check"></i><b>27.7.1</b> 用<code>tapply()</code>分组概括向量</a></li>
<li class="chapter" data-level="27.7.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-aggregate"><i class="fa fa-check"></i><b>27.7.2</b> 用<code>aggregate()</code>分组概括数据框</a></li>
<li class="chapter" data-level="27.7.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-split"><i class="fa fa-check"></i><b>27.7.3</b> 用<code>split()</code>函数分组后概括</a></li>
</ul></li>
<li class="chapter" data-level="27.8" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-plyr"><i class="fa fa-check"></i><b>27.8</b> 用plyr包进行分类概括</a></li>
<li class="chapter" data-level="27.9" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-exer"><i class="fa fa-check"></i><b>27.9</b> 练习</a></li>
</ul></li>
<li class="part"><span><b>VI 绘图</b></span></li>
<li class="chapter" data-level="28" data-path="graph.html"><a href="graph.html"><i class="fa fa-check"></i><b>28</b> 基本R绘图</a><ul>
<li class="chapter" data-level="28.1" data-path="graph.html"><a href="graph.html#graph-ph"><i class="fa fa-check"></i><b>28.1</b> 常用高级图形</a><ul>
<li class="chapter" data-level="28.1.1" data-path="graph.html"><a href="graph.html#graph-ph-barplot"><i class="fa fa-check"></i><b>28.1.1</b> 条形图</a></li>
<li class="chapter" data-level="28.1.2" data-path="graph.html"><a href="graph.html#graph-ph-hist"><i class="fa fa-check"></i><b>28.1.2</b> 直方图和密度估计图</a></li>
<li class="chapter" data-level="28.1.3" data-path="graph.html"><a href="graph.html#graph-ph-boxplot"><i class="fa fa-check"></i><b>28.1.3</b> 盒形图</a></li>
<li class="chapter" data-level="28.1.4" data-path="graph.html"><a href="graph.html#graph-pr-qq"><i class="fa fa-check"></i><b>28.1.4</b> 正态QQ图</a></li>
<li class="chapter" data-level="28.1.5" data-path="graph.html"><a href="graph.html#graph-ph-plot"><i class="fa fa-check"></i><b>28.1.5</b> 散点图</a></li>
<li class="chapter" data-level="28.1.6" data-path="graph.html"><a href="graph.html#graph-ph-curve"><i class="fa fa-check"></i><b>28.1.6</b> 曲线图</a></li>
<li class="chapter" data-level="28.1.7" data-path="graph.html"><a href="graph.html#graph-ph-3d"><i class="fa fa-check"></i><b>28.1.7</b> 三维图</a></li>
<li class="chapter" data-level="28.1.8" data-path="graph.html"><a href="graph.html#graph-ph-rgl"><i class="fa fa-check"></i><b>28.1.8</b> 动态三维图</a></li>
</ul></li>
<li class="chapter" data-level="28.2" data-path="graph.html"><a href="graph.html#graph-pl"><i class="fa fa-check"></i><b>28.2</b> 低级图形函数</a><ul>
<li class="chapter" data-level="28.2.1" data-path="graph.html"><a href="graph.html#graph-pl-abline"><i class="fa fa-check"></i><b>28.2.1</b> <code>abline()</code></a></li>
<li class="chapter" data-level="28.2.2" data-path="graph.html"><a href="graph.html#graph-pl-points"><i class="fa fa-check"></i><b>28.2.2</b> <code>points()</code></a></li>
<li class="chapter" data-level="28.2.3" data-path="graph.html"><a href="graph.html#graph-pl-lines"><i class="fa fa-check"></i><b>28.2.3</b> <code>lines()</code></a></li>
<li class="chapter" data-level="28.2.4" data-path="graph.html"><a href="graph.html#graph-pl-legend"><i class="fa fa-check"></i><b>28.2.4</b> 图例</a></li>
<li class="chapter" data-level="28.2.5" data-path="graph.html"><a href="graph.html#graph-pl-axis"><i class="fa fa-check"></i><b>28.2.5</b> <code>axis()</code></a></li>
<li class="chapter" data-level="28.2.6" data-path="graph.html"><a href="graph.html#graph-pl-text"><i class="fa fa-check"></i><b>28.2.6</b> <code>text()</code></a></li>
<li class="chapter" data-level="28.2.7" data-path="graph.html"><a href="graph.html#graph-pl-locator"><i class="fa fa-check"></i><b>28.2.7</b> <code>locator()</code>和<code>identify()</code></a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="graph.html"><a href="graph.html#graph-par"><i class="fa fa-check"></i><b>28.3</b> 图形参数</a><ul>
<li class="chapter" data-level="28.3.1" data-path="graph.html"><a href="graph.html#graph-par-ex1"><i class="fa fa-check"></i><b>28.3.1</b> 例子：用图形参数解决barplot图形横坐标值过宽</a></li>
<li class="chapter" data-level="28.3.2" data-path="graph.html"><a href="graph.html#graph-par-elem"><i class="fa fa-check"></i><b>28.3.2</b> 图形元素控制</a></li>
<li class="chapter" data-level="28.3.3" data-path="graph.html"><a href="graph.html#graph-par-axis"><i class="fa fa-check"></i><b>28.3.3</b> 坐标轴与坐标刻度</a></li>
<li class="chapter" data-level="28.3.4" data-path="graph.html"><a href="graph.html#graph-par-mar"><i class="fa fa-check"></i><b>28.3.4</b> 图形边空</a></li>
<li class="chapter" data-level="28.3.5" data-path="graph.html"><a href="graph.html#graph-par-mfrow"><i class="fa fa-check"></i><b>28.3.5</b> 一页多图</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="graph.html"><a href="graph.html#graph-pout"><i class="fa fa-check"></i><b>28.4</b> 图形输出</a><ul>
<li class="chapter" data-level="28.4.1" data-path="graph.html"><a href="graph.html#graph-pout-pdf"><i class="fa fa-check"></i><b>28.4.1</b> PDF 输出</a></li>
<li class="chapter" data-level="28.4.2" data-path="graph.html"><a href="graph.html#graph-pout-png"><i class="fa fa-check"></i><b>28.4.2</b> PNG输出</a></li>
</ul></li>
<li class="chapter" data-level="28.5" data-path="graph.html"><a href="graph.html#graph-pzhn"><i class="fa fa-check"></i><b>28.5</b> 包含多种中文字体的图形</a></li>
<li class="chapter" data-level="28.6" data-path="graph.html"><a href="graph.html#graph-other"><i class="fa fa-check"></i><b>28.6</b> 其它图形</a><ul>
<li class="chapter" data-level="28.6.1" data-path="graph.html"><a href="graph.html#graph-other-corr"><i class="fa fa-check"></i><b>28.6.1</b> 相关系数图</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="29" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>29</b> ggplot作图入门</a><ul>
<li class="chapter" data-level="29.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-intro"><i class="fa fa-check"></i><b>29.1</b> 介绍</a></li>
<li class="chapter" data-level="29.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-principles"><i class="fa fa-check"></i><b>29.2</b> 作图的一般原则</a></li>
<li class="chapter" data-level="29.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point"><i class="fa fa-check"></i><b>29.3</b> 散点图：ggplot入门</a><ul>
<li class="chapter" data-level="29.3.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-base"><i class="fa fa-check"></i><b>29.3.1</b> 基本的散点图</a></li>
<li class="chapter" data-level="29.3.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-layers"><i class="fa fa-check"></i><b>29.3.2</b> 逐步改善</a></li>
<li class="chapter" data-level="29.3.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-otheraes"><i class="fa fa-check"></i><b>29.3.3</b> 颜色、符号、线型等映射</a></li>
<li class="chapter" data-level="29.3.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-geomaes"><i class="fa fa-check"></i><b>29.3.4</b> 在geom函数中映射变量</a></li>
<li class="chapter" data-level="29.3.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-contcolor"><i class="fa fa-check"></i><b>29.3.5</b> 连续变量的颜色映射</a></li>
<li class="chapter" data-level="29.3.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-save"><i class="fa fa-check"></i><b>29.3.6</b> 保存图像</a></li>
</ul></li>
<li class="chapter" data-level="29.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right"><i class="fa fa-check"></i><b>29.4</b> 折线图、分组、小图</a><ul>
<li class="chapter" data-level="29.4.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-group"><i class="fa fa-check"></i><b>29.4.1</b> 图形中的分组和折线图</a></li>
<li class="chapter" data-level="29.4.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-facet"><i class="fa fa-check"></i><b>29.4.2</b> 小图(facet)</a></li>
</ul></li>
<li class="chapter" data-level="29.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-bar-trans"><i class="fa fa-check"></i><b>29.5</b> 数据变换与条形图</a><ul>
<li class="chapter" data-level="29.5.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-morebar"><i class="fa fa-check"></i><b>29.5.1</b> 分段与并列条形图</a></li>
<li class="chapter" data-level="29.5.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-bar-morebar"><i class="fa fa-check"></i><b>29.5.2</b> 条形图的其它应用</a></li>
</ul></li>
<li class="chapter" data-level="29.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-hist"><i class="fa fa-check"></i><b>29.6</b> 直方图与密度估计</a></li>
<li class="chapter" data-level="29.7" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm"><i class="fa fa-check"></i><b>29.7</b> 绘图语法介绍</a><ul>
<li class="chapter" data-level="29.7.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm-gramm"><i class="fa fa-check"></i><b>29.7.1</b> 绘图语法</a></li>
<li class="chapter" data-level="29.7.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm-geoms"><i class="fa fa-check"></i><b>29.7.2</b> 图形种类</a></li>
</ul></li>
<li class="chapter" data-level="29.8" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom"><i class="fa fa-check"></i><b>29.8</b> 更多图形种类</a><ul>
<li class="chapter" data-level="29.8.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-continuousvar"><i class="fa fa-check"></i><b>29.8.1</b> 连续变量的分组图形</a></li>
<li class="chapter" data-level="29.8.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-text"><i class="fa fa-check"></i><b>29.8.2</b> 坐标系中的文字</a></li>
<li class="chapter" data-level="29.8.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-textops"><i class="fa fa-check"></i><b>29.8.3</b> 文字选项</a></li>
<li class="chapter" data-level="29.8.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-outliers"><i class="fa fa-check"></i><b>29.8.4</b> 标出特殊点</a></li>
</ul></li>
<li class="chapter" data-level="29.9" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-scale"><i class="fa fa-check"></i><b>29.9</b> 刻度(scale)</a></li>
<li class="chapter" data-level="29.10" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-color"><i class="fa fa-check"></i><b>29.10</b> 如何使用颜色</a><ul>
<li class="chapter" data-level="29.10.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-qual"><i class="fa fa-check"></i><b>29.10.1</b> 名义型变量的颜色</a></li>
<li class="chapter" data-level="29.10.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-tile"><i class="fa fa-check"></i><b>29.10.2</b> 色块图</a></li>
<li class="chapter" data-level="29.10.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-seq"><i class="fa fa-check"></i><b>29.10.3</b> 有序型变量的颜色</a></li>
<li class="chapter" data-level="29.10.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-div"><i class="fa fa-check"></i><b>29.10.4</b> 相异型变量的颜色</a></li>
<li class="chapter" data-level="29.10.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-num"><i class="fa fa-check"></i><b>29.10.5</b> 连续数值变量的颜色</a></li>
</ul></li>
<li class="chapter" data-level="29.11" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs"><i class="fa fa-check"></i><b>29.11</b> 标题、标注、指南、拼接</a><ul>
<li class="chapter" data-level="29.11.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-labs"><i class="fa fa-check"></i><b>29.11.1</b> 标题</a></li>
<li class="chapter" data-level="29.11.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-anno"><i class="fa fa-check"></i><b>29.11.2</b> 标注功能</a></li>
<li class="chapter" data-level="29.11.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-guides"><i class="fa fa-check"></i><b>29.11.3</b> 指南(guides)</a></li>
<li class="chapter" data-level="29.11.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-compfig"><i class="fa fa-check"></i><b>29.11.4</b> 拼接图形</a></li>
</ul></li>
<li class="chapter" data-level="29.12" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine"><i class="fa fa-check"></i><b>29.12</b> 图形定制调整</a><ul>
<li class="chapter" data-level="29.12.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-asasec"><i class="fa fa-check"></i><b>29.12.1</b> 图形逐步调整例子</a></li>
</ul></li>
<li class="chapter" data-level="29.13" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-theme"><i class="fa fa-check"></i><b>29.13</b> 主题</a></li>
<li class="chapter" data-level="29.14" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-ref"><i class="fa fa-check"></i><b>29.14</b> 参考文献</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="ggplotvis.html"><a href="ggplotvis.html"><i class="fa fa-check"></i><b>30</b> ggplot的各种图形</a><ul>
<li class="chapter" data-level="30.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-intro"><i class="fa fa-check"></i><b>30.1</b> 介绍</a></li>
<li class="chapter" data-level="30.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount"><i class="fa fa-check"></i><b>30.2</b> 表现数量</a><ul>
<li class="chapter" data-level="30.2.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-bar"><i class="fa fa-check"></i><b>30.2.1</b> 条形图</a></li>
<li class="chapter" data-level="30.2.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-point"><i class="fa fa-check"></i><b>30.2.2</b> 点图</a></li>
<li class="chapter" data-level="30.2.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-heatmap"><i class="fa fa-check"></i><b>30.2.3</b> 热力图</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist"><i class="fa fa-check"></i><b>30.3</b> 表现分布</a><ul>
<li class="chapter" data-level="30.3.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-suni-hist"><i class="fa fa-check"></i><b>30.3.1</b> 单个一元分布的直方图与密度估计图</a></li>
<li class="chapter" data-level="30.3.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-muni"><i class="fa fa-check"></i><b>30.3.2</b> 多个一元分布的直方图和密度图形</a></li>
<li class="chapter" data-level="30.3.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-cdf"><i class="fa fa-check"></i><b>30.3.3</b> 经验分布函数图</a></li>
<li class="chapter" data-level="30.3.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-qqplot"><i class="fa fa-check"></i><b>30.3.4</b> QQ图</a></li>
<li class="chapter" data-level="30.3.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-boxplot"><i class="fa fa-check"></i><b>30.3.5</b> 盒形图</a></li>
<li class="chapter" data-level="30.3.6" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-violin"><i class="fa fa-check"></i><b>30.3.6</b> 小提琴图</a></li>
<li class="chapter" data-level="30.3.7" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-mdens"><i class="fa fa-check"></i><b>30.3.7</b> 多个密度的其它画法</a></li>
<li class="chapter" data-level="30.3.8" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-2d"><i class="fa fa-check"></i><b>30.3.8</b> 二元分布直方图和等值线图</a></li>
</ul></li>
<li class="chapter" data-level="30.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop"><i class="fa fa-check"></i><b>30.4</b> 表现比例</a><ul>
<li class="chapter" data-level="30.4.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-uni"><i class="fa fa-check"></i><b>30.4.1</b> 单个分布</a></li>
<li class="chapter" data-level="30.4.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-mult"><i class="fa fa-check"></i><b>30.4.2</b> 组间的比例分布的比较</a></li>
<li class="chapter" data-level="30.4.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-nest"><i class="fa fa-check"></i><b>30.4.3</b> 嵌套比例分布的比较</a></li>
</ul></li>
<li class="chapter" data-level="30.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar"><i class="fa fa-check"></i><b>30.5</b> 表现多个变量间的关系</a><ul>
<li class="chapter" data-level="30.5.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-scatter"><i class="fa fa-check"></i><b>30.5.1</b> 散点图</a></li>
<li class="chapter" data-level="30.5.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-scatmat"><i class="fa fa-check"></i><b>30.5.2</b> 散点图矩阵</a></li>
<li class="chapter" data-level="30.5.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-corrgram"><i class="fa fa-check"></i><b>30.5.3</b> 相关系数矩阵图</a></li>
<li class="chapter" data-level="30.5.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-dimreduct"><i class="fa fa-check"></i><b>30.5.4</b> 数据降维</a></li>
<li class="chapter" data-level="30.5.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-paird"><i class="fa fa-check"></i><b>30.5.5</b> 成对数据</a></li>
</ul></li>
<li class="chapter" data-level="30.6" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts"><i class="fa fa-check"></i><b>30.6</b> 时间序列图</a><ul>
<li class="chapter" data-level="30.6.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-uni"><i class="fa fa-check"></i><b>30.6.1</b> 一元时间序列</a></li>
<li class="chapter" data-level="30.6.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-mul"><i class="fa fa-check"></i><b>30.6.2</b> 多元时间序列</a></li>
<li class="chapter" data-level="30.6.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-het"><i class="fa fa-check"></i><b>30.6.3</b> 多个不同类型指标的时间序列</a></li>
</ul></li>
<li class="chapter" data-level="30.7" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit"><i class="fa fa-check"></i><b>30.7</b> 拟合曲线图</a><ul>
<li class="chapter" data-level="30.7.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit-smooth"><i class="fa fa-check"></i><b>30.7.1</b> 平滑方法</a></li>
<li class="chapter" data-level="30.7.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit-param"><i class="fa fa-check"></i><b>30.7.2</b> 参数模型方法</a></li>
</ul></li>
<li class="chapter" data-level="30.8" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert"><i class="fa fa-check"></i><b>30.8</b> 表现不确定性</a><ul>
<li class="chapter" data-level="30.8.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-prob"><i class="fa fa-check"></i><b>30.8.1</b> 表现概率</a></li>
<li class="chapter" data-level="30.8.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-se"><i class="fa fa-check"></i><b>30.8.2</b> 表现点估计精度</a></li>
<li class="chapter" data-level="30.8.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-cband"><i class="fa fa-check"></i><b>30.8.3</b> 拟合曲线的置信带</a></li>
<li class="chapter" data-level="30.8.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-dyn"><i class="fa fa-check"></i><b>30.8.4</b> 随机结果动态演示</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII 统计模型</b></span></li>
<li class="chapter" data-level="31" data-path="stat-basics.html"><a href="stat-basics.html"><i class="fa fa-check"></i><b>31</b> R初等统计分析</a><ul>
<li class="chapter" data-level="31.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-distr"><i class="fa fa-check"></i><b>31.1</b> 概率分布</a></li>
<li class="chapter" data-level="31.2" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-mle"><i class="fa fa-check"></i><b>31.2</b> 最大似然估计</a><ul>
<li class="chapter" data-level="31.2.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-mle-norm1"><i class="fa fa-check"></i><b>31.2.1</b> 一元正态分布参数最大似然估计</a></li>
</ul></li>
<li class="chapter" data-level="31.3" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest"><i class="fa fa-check"></i><b>31.3</b> 假设检验和置信区间</a><ul>
<li class="chapter" data-level="31.3.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-mu"><i class="fa fa-check"></i><b>31.3.1</b> 均值的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.2" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-prop"><i class="fa fa-check"></i><b>31.3.2</b> 比例的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.3" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-sigma"><i class="fa fa-check"></i><b>31.3.3</b> 方差的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.4" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-gof"><i class="fa fa-check"></i><b>31.3.4</b> 拟合优度检验</a></li>
<li class="chapter" data-level="31.3.5" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-gof-vcd"><i class="fa fa-check"></i><b>31.3.5</b> 检验分布类型</a></li>
<li class="chapter" data-level="31.3.6" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-indepcont"><i class="fa fa-check"></i><b>31.3.6</b> 列联表独立性卡方检验</a></li>
<li class="chapter" data-level="31.3.7" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-npar"><i class="fa fa-check"></i><b>31.3.7</b> 非参数检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="32" data-path="stat-reg.html"><a href="stat-reg.html"><i class="fa fa-check"></i><b>32</b> R相关与回归</a><ul>
<li class="chapter" data-level="32.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor"><i class="fa fa-check"></i><b>32.1</b> 相关分析</a><ul>
<li class="chapter" data-level="32.1.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-prop"><i class="fa fa-check"></i><b>32.1.1</b> 相关系数的性质</a></li>
<li class="chapter" data-level="32.1.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-caus"><i class="fa fa-check"></i><b>32.1.2</b> 相关与因果</a></li>
<li class="chapter" data-level="32.1.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-magn"><i class="fa fa-check"></i><b>32.1.3</b> 相关系数大小</a></li>
<li class="chapter" data-level="32.1.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-test"><i class="fa fa-check"></i><b>32.1.4</b> 相关系数的检验</a></li>
<li class="chapter" data-level="32.1.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-vcorr"><i class="fa fa-check"></i><b>32.1.5</b> 相关阵</a></li>
</ul></li>
<li class="chapter" data-level="32.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp"><i class="fa fa-check"></i><b>32.2</b> 一元回归分析</a><ul>
<li class="chapter" data-level="32.2.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-model"><i class="fa fa-check"></i><b>32.2.1</b> 模型</a></li>
<li class="chapter" data-level="32.2.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-ls"><i class="fa fa-check"></i><b>32.2.2</b> 最小二乘法</a></li>
<li class="chapter" data-level="32.2.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-test"><i class="fa fa-check"></i><b>32.2.3</b> 回归有效性</a></li>
<li class="chapter" data-level="32.2.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-prog"><i class="fa fa-check"></i><b>32.2.4</b> R程序</a></li>
<li class="chapter" data-level="32.2.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-diag"><i class="fa fa-check"></i><b>32.2.5</b> 回归诊断</a></li>
<li class="chapter" data-level="32.2.6" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-ci"><i class="fa fa-check"></i><b>32.2.6</b> 预测区间</a></li>
<li class="chapter" data-level="32.2.7" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-control"><i class="fa fa-check"></i><b>32.2.7</b> 控制</a></li>
</ul></li>
<li class="chapter" data-level="32.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu"><i class="fa fa-check"></i><b>32.3</b> 多元线性回归</a><ul>
<li class="chapter" data-level="32.3.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-mod"><i class="fa fa-check"></i><b>32.3.1</b> 模型</a></li>
<li class="chapter" data-level="32.3.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-est"><i class="fa fa-check"></i><b>32.3.2</b> 参数估计</a></li>
<li class="chapter" data-level="32.3.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-rcode"><i class="fa fa-check"></i><b>32.3.3</b> R的多元回归程序</a></li>
<li class="chapter" data-level="32.3.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-test"><i class="fa fa-check"></i><b>32.3.4</b> 模型的检验</a></li>
<li class="chapter" data-level="32.3.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-subset"><i class="fa fa-check"></i><b>32.3.5</b> 回归自变量筛选</a></li>
<li class="chapter" data-level="32.3.6" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-dum"><i class="fa fa-check"></i><b>32.3.6</b> 哑变量与变截距项的模型</a></li>
<li class="chapter" data-level="32.3.7" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-resid"><i class="fa fa-check"></i><b>32.3.7</b> 残差诊断</a></li>
<li class="chapter" data-level="32.3.8" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-colin"><i class="fa fa-check"></i><b>32.3.8</b> 多重共线性</a></li>
<li class="chapter" data-level="32.3.9" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-lev"><i class="fa fa-check"></i><b>32.3.9</b> 强影响点分析</a></li>
<li class="chapter" data-level="32.3.10" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-overfit"><i class="fa fa-check"></i><b>32.3.10</b> 过度拟合示例</a></li>
<li class="chapter" data-level="32.3.11" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-comp-inset"><i class="fa fa-check"></i><b>32.3.11</b> 嵌套模型的比较</a></li>
<li class="chapter" data-level="32.3.12" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-pred"><i class="fa fa-check"></i><b>32.3.12</b> 拟合与预测</a></li>
<li class="chapter" data-level="32.3.13" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-curve"><i class="fa fa-check"></i><b>32.3.13</b> 利用线性回归模型做曲线拟合</a></li>
<li class="chapter" data-level="32.3.14" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-group"><i class="fa fa-check"></i><b>32.3.14</b> 分组建立多个模型</a></li>
</ul></li>
<li class="chapter" data-level="32.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-npar"><i class="fa fa-check"></i><b>32.4</b> 非参数回归</a><ul>
<li class="chapter" data-level="32.4.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-npar-mod"><i class="fa fa-check"></i><b>32.4.1</b> 模型</a></li>
<li class="chapter" data-level="32.4.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-spl1d"><i class="fa fa-check"></i><b>32.4.2</b> 样条平滑</a></li>
<li class="chapter" data-level="32.4.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-loess"><i class="fa fa-check"></i><b>32.4.3</b> 局部多项式曲线平滑</a></li>
<li class="chapter" data-level="32.4.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-bs"><i class="fa fa-check"></i><b>32.4.4</b> 样条函数变换</a></li>
<li class="chapter" data-level="32.4.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-gam"><i class="fa fa-check"></i><b>32.4.5</b> 线性可加模型</a></li>
</ul></li>
<li class="chapter" data-level="32.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog"><i class="fa fa-check"></i><b>32.5</b> Logistic回归</a><ul>
<li class="chapter" data-level="32.5.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog-mod"><i class="fa fa-check"></i><b>32.5.1</b> 模型</a></li>
<li class="chapter" data-level="32.5.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog-rcode"><i class="fa fa-check"></i><b>32.5.2</b> R程序</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="33" data-path="stat-tsa.html"><a href="stat-tsa.html"><i class="fa fa-check"></i><b>33</b> R时间序列分析</a><ul>
<li class="chapter" data-level="33.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-defs"><i class="fa fa-check"></i><b>33.1</b> 基本概念</a></li>
<li class="chapter" data-level="33.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype"><i class="fa fa-check"></i><b>33.2</b> 时间序列数据类型</a><ul>
<li class="chapter" data-level="33.2.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype-ts"><i class="fa fa-check"></i><b>33.2.1</b> ts类型</a></li>
<li class="chapter" data-level="33.2.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype-xts"><i class="fa fa-check"></i><b>33.2.2</b> xts类型与常用函数</a></li>
</ul></li>
<li class="chapter" data-level="33.3" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-basicstat"><i class="fa fa-check"></i><b>33.3</b> 基本分析与作图</a></li>
<li class="chapter" data-level="33.4" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima"><i class="fa fa-check"></i><b>33.4</b> ARIMA建模和模拟</a><ul>
<li class="chapter" data-level="33.4.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-def"><i class="fa fa-check"></i><b>33.4.1</b> 模型公式</a></li>
<li class="chapter" data-level="33.4.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-sim"><i class="fa fa-check"></i><b>33.4.2</b> 模拟</a></li>
<li class="chapter" data-level="33.4.3" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-armod"><i class="fa fa-check"></i><b>33.4.3</b> AR建模</a></li>
<li class="chapter" data-level="33.4.4" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-armamod"><i class="fa fa-check"></i><b>33.4.4</b> ARMA建模</a></li>
<li class="chapter" data-level="33.4.5" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-diag"><i class="fa fa-check"></i><b>33.4.5</b> 模型诊断</a></li>
<li class="chapter" data-level="33.4.6" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-lbtest"><i class="fa fa-check"></i><b>33.4.6</b> 白噪声检验</a></li>
<li class="chapter" data-level="33.4.7" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-sparse"><i class="fa fa-check"></i><b>33.4.7</b> 稀疏系数估计</a></li>
<li class="chapter" data-level="33.4.8" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-adftest"><i class="fa fa-check"></i><b>33.4.8</b> 单位根检验</a></li>
<li class="chapter" data-level="33.4.9" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-cfuncs"><i class="fa fa-check"></i><b>33.4.9</b> ARMA模型的一些自定义函数</a></li>
</ul></li>
<li class="chapter" data-level="33.5" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-spectra"><i class="fa fa-check"></i><b>33.5</b> 谱密度估计</a></li>
<li class="chapter" data-level="33.6" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-garch"><i class="fa fa-check"></i><b>33.6</b> GARCH类模型</a></li>
<li class="chapter" data-level="33.7" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-mtsa"><i class="fa fa-check"></i><b>33.7</b> 多元时间序列基础统计</a></li>
<li class="chapter" data-level="33.8" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-var"><i class="fa fa-check"></i><b>33.8</b> VAR模型</a></li>
<li class="chapter" data-level="33.9" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-coint"><i class="fa fa-check"></i><b>33.9</b> 协整分析</a></li>
<li class="chapter" data-level="33.10" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-causal"><i class="fa fa-check"></i><b>33.10</b> 因果性检验</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="stat-learning.html"><a href="stat-learning.html"><i class="fa fa-check"></i><b>34</b> 统计学习介绍</a><ul>
<li class="chapter" data-level="34.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro"><i class="fa fa-check"></i><b>34.1</b> 统计学习的基本概念和一般步骤</a><ul>
<li class="chapter" data-level="34.1.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro-basic"><i class="fa fa-check"></i><b>34.1.1</b> 统计学习的基本概念和方法</a></li>
<li class="chapter" data-level="34.1.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro-biasvar"><i class="fa fa-check"></i><b>34.1.2</b> 偏差与方差折衷</a></li>
<li class="chapter" data-level="34.1.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-cv"><i class="fa fa-check"></i><b>34.1.3</b> 交叉验证</a></li>
<li class="chapter" data-level="34.1.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-steps"><i class="fa fa-check"></i><b>34.1.4</b> 一般步骤</a></li>
</ul></li>
<li class="chapter" data-level="34.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters"><i class="fa fa-check"></i><b>34.2</b> Hitters数据分析</a><ul>
<li class="chapter" data-level="34.2.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-subset"><i class="fa fa-check"></i><b>34.2.1</b> 回归自变量选择</a></li>
<li class="chapter" data-level="34.2.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-ridge"><i class="fa fa-check"></i><b>34.2.2</b> 岭回归</a></li>
<li class="chapter" data-level="34.2.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-lasso"><i class="fa fa-check"></i><b>34.2.3</b> Lasso回归</a></li>
<li class="chapter" data-level="34.2.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-simpt"><i class="fa fa-check"></i><b>34.2.4</b> 树回归的简单演示</a></li>
<li class="chapter" data-level="34.2.5" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-tree"><i class="fa fa-check"></i><b>34.2.5</b> 树回归</a></li>
<li class="chapter" data-level="34.2.6" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-bag"><i class="fa fa-check"></i><b>34.2.6</b> 装袋法</a></li>
<li class="chapter" data-level="34.2.7" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-rf"><i class="fa fa-check"></i><b>34.2.7</b> 随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart"><i class="fa fa-check"></i><b>34.3</b> Heart数据分析</a><ul>
<li class="chapter" data-level="34.3.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-tree"><i class="fa fa-check"></i><b>34.3.1</b> 树回归</a></li>
<li class="chapter" data-level="34.3.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-bag"><i class="fa fa-check"></i><b>34.3.2</b> 用装袋法</a></li>
<li class="chapter" data-level="34.3.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-rf"><i class="fa fa-check"></i><b>34.3.3</b> 用随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-car"><i class="fa fa-check"></i><b>34.4</b> 汽车销量数据分析</a><ul>
<li class="chapter" data-level="34.4.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-car-tree"><i class="fa fa-check"></i><b>34.4.1</b> 判别树</a></li>
<li class="chapter" data-level="34.4.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-car-rf"><i class="fa fa-check"></i><b>34.4.2</b> 随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.5" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston"><i class="fa fa-check"></i><b>34.5</b> 波士顿郊区房价数据</a><ul>
<li class="chapter" data-level="34.5.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-tree"><i class="fa fa-check"></i><b>34.5.1</b> 回归树</a></li>
<li class="chapter" data-level="34.5.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-bag"><i class="fa fa-check"></i><b>34.5.2</b> 装袋法</a></li>
<li class="chapter" data-level="34.5.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-rf"><i class="fa fa-check"></i><b>34.5.3</b> 随机森林</a></li>
<li class="chapter" data-level="34.5.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-boost"><i class="fa fa-check"></i><b>34.5.4</b> 提升法</a></li>
</ul></li>
<li class="chapter" data-level="34.6" data-path="stat-learning.html"><a href="stat-learning.html#statl-svm"><i class="fa fa-check"></i><b>34.6</b> 支持向量机方法</a><ul>
<li class="chapter" data-level="34.6.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-svm-heart"><i class="fa fa-check"></i><b>34.6.1</b> 支持向量机用于Heart数据</a></li>
</ul></li>
<li class="chapter" data-level="34.7" data-path="stat-learning.html"><a href="stat-learning.html#statl-app"><i class="fa fa-check"></i><b>34.7</b> 附录</a><ul>
<li class="chapter" data-level="34.7.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-hitters"><i class="fa fa-check"></i><b>34.7.1</b> Hitters数据</a></li>
<li class="chapter" data-level="34.7.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-heart"><i class="fa fa-check"></i><b>34.7.2</b> Heart数据</a></li>
<li class="chapter" data-level="34.7.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-car"><i class="fa fa-check"></i><b>34.7.3</b> CarSeats数据</a></li>
<li class="chapter" data-level="34.7.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-boston"><i class="fa fa-check"></i><b>34.7.4</b> Boston数据</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="35" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>35</b> 随机模拟</a><ul>
<li class="chapter" data-level="35.1" data-path="simulation.html"><a href="simulation.html#simint"><i class="fa fa-check"></i><b>35.1</b> 随机数</a></li>
<li class="chapter" data-level="35.2" data-path="simulation.html"><a href="simulation.html#simsamp"><i class="fa fa-check"></i><b>35.2</b> <code>sample()</code>函数</a></li>
<li class="chapter" data-level="35.3" data-path="simulation.html"><a href="simulation.html#simexamp"><i class="fa fa-check"></i><b>35.3</b> 随机模拟示例</a><ul>
<li class="chapter" data-level="35.3.1" data-path="simulation.html"><a href="simulation.html#simexamp-expect"><i class="fa fa-check"></i><b>35.3.1</b> 估计期望值</a></li>
<li class="chapter" data-level="35.3.2" data-path="simulation.html"><a href="simulation.html#simexamp-lm"><i class="fa fa-check"></i><b>35.3.2</b> 线性回归模拟</a></li>
<li class="chapter" data-level="35.3.3" data-path="simulation.html"><a href="simulation.html#simexamp-kde"><i class="fa fa-check"></i><b>35.3.3</b> 核密度的bootstrap置信区间</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VIII 特殊应用</b></span></li>
<li class="chapter" data-level="36" data-path="text.html"><a href="text.html"><i class="fa fa-check"></i><b>36</b> R语言的文本处理</a><ul>
<li class="chapter" data-level="36.1" data-path="text.html"><a href="text.html#text-simple"><i class="fa fa-check"></i><b>36.1</b> 简单的文本处理</a><ul>
<li class="chapter" data-level="36.1.1" data-path="text.html"><a href="text.html#text-simple-const"><i class="fa fa-check"></i><b>36.1.1</b> 字符型常量与字符型向量</a></li>
<li class="chapter" data-level="36.1.2" data-path="text.html"><a href="text.html#text-paste"><i class="fa fa-check"></i><b>36.1.2</b> 字符串连接、重复</a></li>
<li class="chapter" data-level="36.1.3" data-path="text.html"><a href="text.html#text-formatout"><i class="fa fa-check"></i><b>36.1.3</b> 格式化输出</a></li>
<li class="chapter" data-level="36.1.4" data-path="text.html"><a href="text.html#text-length"><i class="fa fa-check"></i><b>36.1.4</b> 字符串长度</a></li>
<li class="chapter" data-level="36.1.5" data-path="text.html"><a href="text.html#text-substring"><i class="fa fa-check"></i><b>36.1.5</b> 取子串</a></li>
<li class="chapter" data-level="36.1.6" data-path="text.html"><a href="text.html#text-convert"><i class="fa fa-check"></i><b>36.1.6</b> 字符串变换</a></li>
<li class="chapter" data-level="36.1.7" data-path="text.html"><a href="text.html#text-simp-find"><i class="fa fa-check"></i><b>36.1.7</b> 简单匹配与查找</a></li>
<li class="chapter" data-level="36.1.8" data-path="text.html"><a href="text.html#text-simple-gsub"><i class="fa fa-check"></i><b>36.1.8</b> 字符串替换</a></li>
<li class="chapter" data-level="36.1.9" data-path="text.html"><a href="text.html#text-simple-strsplit"><i class="fa fa-check"></i><b>36.1.9</b> 字符串拆分</a></li>
</ul></li>
<li class="chapter" data-level="36.2" data-path="text.html"><a href="text.html#text-file"><i class="fa fa-check"></i><b>36.2</b> 文本文件读写</a></li>
<li class="chapter" data-level="36.3" data-path="text.html"><a href="text.html#text-regex"><i class="fa fa-check"></i><b>36.3</b> 正则表达式</a><ul>
<li class="chapter" data-level="36.3.1" data-path="text.html"><a href="text.html#text-regex-strview"><i class="fa fa-check"></i><b>36.3.1</b> 字面匹配与匹配显示</a></li>
<li class="chapter" data-level="36.3.2" data-path="text.html"><a href="text.html#text-regex-ignore"><i class="fa fa-check"></i><b>36.3.2</b> 不区分大小写匹配和<code>regex</code>函数</a></li>
<li class="chapter" data-level="36.3.3" data-path="text.html"><a href="text.html#text-regex-dot"><i class="fa fa-check"></i><b>36.3.3</b> 用句点匹配单个字符</a></li>
<li class="chapter" data-level="36.3.4" data-path="text.html"><a href="text.html#text-regex-set"><i class="fa fa-check"></i><b>36.3.4</b> 匹配一组字符中的某一个</a></li>
<li class="chapter" data-level="36.3.5" data-path="text.html"><a href="text.html#text-regex-metalit"><i class="fa fa-check"></i><b>36.3.5</b> 原样匹配元字符</a></li>
<li class="chapter" data-level="36.3.6" data-path="text.html"><a href="text.html#text-regex-space"><i class="fa fa-check"></i><b>36.3.6</b> 匹配空白</a></li>
<li class="chapter" data-level="36.3.7" data-path="text.html"><a href="text.html#text-regex-digit"><i class="fa fa-check"></i><b>36.3.7</b> 匹配数字</a></li>
<li class="chapter" data-level="36.3.8" data-path="text.html"><a href="text.html#text-regex-alnum"><i class="fa fa-check"></i><b>36.3.8</b> 匹配字母、数字、下划线</a></li>
<li class="chapter" data-level="36.3.9" data-path="text.html"><a href="text.html#text-regex-hex"><i class="fa fa-check"></i><b>36.3.9</b> 十六进制和八进制数</a></li>
<li class="chapter" data-level="36.3.10" data-path="text.html"><a href="text.html#text-regex-posix"><i class="fa fa-check"></i><b>36.3.10</b> POSIX字符类</a></li>
<li class="chapter" data-level="36.3.11" data-path="text.html"><a href="text.html#text-regex-start"><i class="fa fa-check"></i><b>36.3.11</b> 匹配开头和末尾</a></li>
<li class="chapter" data-level="36.3.12" data-path="text.html"><a href="text.html#text-regex-wordb"><i class="fa fa-check"></i><b>36.3.12</b> 单词边界</a></li>
<li class="chapter" data-level="36.3.13" data-path="text.html"><a href="text.html#text-regex-repeat"><i class="fa fa-check"></i><b>36.3.13</b> 重复匹配</a></li>
<li class="chapter" data-level="36.3.14" data-path="text.html"><a href="text.html#text-regex-lazy"><i class="fa fa-check"></i><b>36.3.14</b> 贪婪匹配和懒惰匹配</a></li>
<li class="chapter" data-level="36.3.15" data-path="text.html"><a href="text.html#text-regex-smlines"><i class="fa fa-check"></i><b>36.3.15</b> 句点全匹配与多行模式</a></li>
<li class="chapter" data-level="36.3.16" data-path="text.html"><a href="text.html#text-regex-alt"><i class="fa fa-check"></i><b>36.3.16</b> 备择模式</a></li>
<li class="chapter" data-level="36.3.17" data-path="text.html"><a href="text.html#text-regex-group"><i class="fa fa-check"></i><b>36.3.17</b> 分组与捕获</a></li>
</ul></li>
<li class="chapter" data-level="36.4" data-path="text.html"><a href="text.html#text-stringr-funcs"><i class="fa fa-check"></i><b>36.4</b> stringr包的正则表达式函数</a><ul>
<li class="chapter" data-level="36.4.1" data-path="text.html"><a href="text.html#text-stringr-funcs-strview"><i class="fa fa-check"></i><b>36.4.1</b> <code>str_view()</code>函数</a></li>
<li class="chapter" data-level="36.4.2" data-path="text.html"><a href="text.html#text-stringr-funcs-regex"><i class="fa fa-check"></i><b>36.4.2</b> <code>regex()</code>函数</a></li>
<li class="chapter" data-level="36.4.3" data-path="text.html"><a href="text.html#text-stringr-funcs-detect"><i class="fa fa-check"></i><b>36.4.3</b> 检查那些元素能够匹配</a></li>
<li class="chapter" data-level="36.4.4" data-path="text.html"><a href="text.html#text-stringr-funcs-replace"><i class="fa fa-check"></i><b>36.4.4</b> 替换</a></li>
<li class="chapter" data-level="36.4.5" data-path="text.html"><a href="text.html#text-stringr-funcs-subset"><i class="fa fa-check"></i><b>36.4.5</b> 返回匹配的元素</a></li>
<li class="chapter" data-level="36.4.6" data-path="text.html"><a href="text.html#text-stringr-funcs-extract"><i class="fa fa-check"></i><b>36.4.6</b> 提取匹配内容</a></li>
<li class="chapter" data-level="36.4.7" data-path="text.html"><a href="text.html#text-stringr-funcs-match"><i class="fa fa-check"></i><b>36.4.7</b> 提取分组捕获内容</a></li>
<li class="chapter" data-level="36.4.8" data-path="text.html"><a href="text.html#text-stringr-funcs-locate"><i class="fa fa-check"></i><b>36.4.8</b> 定位匹配位置</a></li>
</ul></li>
<li class="chapter" data-level="36.5" data-path="text.html"><a href="text.html#text-regex-bfuncs"><i class="fa fa-check"></i><b>36.5</b> 利用基本R函数进行正则表达式处理</a><ul>
<li class="chapter" data-level="36.5.1" data-path="text.html"><a href="text.html#text-regex-bfuncs-igcase"><i class="fa fa-check"></i><b>36.5.1</b> 不区分大小写匹配</a></li>
<li class="chapter" data-level="36.5.2" data-path="text.html"><a href="text.html#text-regex-bfuncs-dotp"><i class="fa fa-check"></i><b>36.5.2</b> 匹配单个字符</a></li>
<li class="chapter" data-level="36.5.3" data-path="text.html"><a href="text.html#text-regex-bfuncs-setp"><i class="fa fa-check"></i><b>36.5.3</b> 匹配一组字符中的某一个</a></li>
<li class="chapter" data-level="36.5.4" data-path="text.html"><a href="text.html#text-regex-bfuncs-metalit"><i class="fa fa-check"></i><b>36.5.4</b> 原样匹配元字符</a></li>
<li class="chapter" data-level="36.5.5" data-path="text.html"><a href="text.html#text-regex-bfuncs-digit"><i class="fa fa-check"></i><b>36.5.5</b> 匹配数字</a></li>
<li class="chapter" data-level="36.5.6" data-path="text.html"><a href="text.html#text-regex-bfuncs-start"><i class="fa fa-check"></i><b>36.5.6</b> 匹配开头和末尾</a></li>
<li class="chapter" data-level="36.5.7" data-path="text.html"><a href="text.html#text-regex-bfuncs-alnum"><i class="fa fa-check"></i><b>36.5.7</b> 匹配字母、数字、下划线</a></li>
<li class="chapter" data-level="36.5.8" data-path="text.html"><a href="text.html#text-regex-bfuncs-hex"><i class="fa fa-check"></i><b>36.5.8</b> 十六进制和八进制数</a></li>
<li class="chapter" data-level="36.5.9" data-path="text.html"><a href="text.html#text-regex-bfuncs-posix"><i class="fa fa-check"></i><b>36.5.9</b> POSIX字符类</a></li>
<li class="chapter" data-level="36.5.10" data-path="text.html"><a href="text.html#text-regex-bfuncs-plus"><i class="fa fa-check"></i><b>36.5.10</b> 加号重复匹配</a></li>
<li class="chapter" data-level="36.5.11" data-path="text.html"><a href="text.html#text-regex-bfuncs-ast"><i class="fa fa-check"></i><b>36.5.11</b> 星号和问号重复匹配</a></li>
<li class="chapter" data-level="36.5.12" data-path="text.html"><a href="text.html#text-regex-bfuncs-repnum"><i class="fa fa-check"></i><b>36.5.12</b> 计数重复</a></li>
<li class="chapter" data-level="36.5.13" data-path="text.html"><a href="text.html#text-regex-bfuncs-lazy"><i class="fa fa-check"></i><b>36.5.13</b> 贪婪匹配和懒惰匹配</a></li>
<li class="chapter" data-level="36.5.14" data-path="text.html"><a href="text.html#text-regex-bfuncs-wordb"><i class="fa fa-check"></i><b>36.5.14</b> 单词边界</a></li>
<li class="chapter" data-level="36.5.15" data-path="text.html"><a href="text.html#text-regex-bfuncs-sm"><i class="fa fa-check"></i><b>36.5.15</b> 句点全匹配与多行模式</a></li>
<li class="chapter" data-level="36.5.16" data-path="text.html"><a href="text.html#text-regex-bfuncs-alt"><i class="fa fa-check"></i><b>36.5.16</b> 备择模式</a></li>
<li class="chapter" data-level="36.5.17" data-path="text.html"><a href="text.html#text-regex-bfuncs-group"><i class="fa fa-check"></i><b>36.5.17</b> 分组与捕获</a></li>
</ul></li>
<li class="chapter" data-level="36.6" data-path="text.html"><a href="text.html#text-regexex"><i class="fa fa-check"></i><b>36.6</b> 正则表达式应用例子</a><ul>
<li class="chapter" data-level="36.6.1" data-path="text.html"><a href="text.html#text-regexex-pre"><i class="fa fa-check"></i><b>36.6.1</b> 数据预处理</a></li>
<li class="chapter" data-level="36.6.2" data-path="text.html"><a href="text.html#text-regexex-excelmore"><i class="fa fa-check"></i><b>36.6.2</b> 不规则Excel文件处理</a></li>
<li class="chapter" data-level="36.6.3" data-path="text.html"><a href="text.html#text-regexex-wordfreq"><i class="fa fa-check"></i><b>36.6.3</b> 字频统计</a></li>
<li class="chapter" data-level="36.6.4" data-path="text.html"><a href="text.html#text-regexex-digits"><i class="fa fa-check"></i><b>36.6.4</b> 数字验证</a></li>
<li class="chapter" data-level="36.6.5" data-path="text.html"><a href="text.html#text-regexex-digfn"><i class="fa fa-check"></i><b>36.6.5</b> 文件名中的数字提取</a></li>
</ul></li>
<li class="chapter" data-level="36.7" data-path="text.html"><a href="text.html#text-webscape"><i class="fa fa-check"></i><b>36.7</b> 网站数据获取</a></li>
<li class="chapter" data-level="36.8" data-path="text.html"><a href="text.html#text-jiebaR"><i class="fa fa-check"></i><b>36.8</b> 中文分词与词频</a></li>
</ul></li>
<li class="part"><span><b>IX 用Rcpp访问C++代码</b></span></li>
<li class="chapter" data-level="37" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>37</b> Rcpp介绍</a><ul>
<li class="chapter" data-level="37.1" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-use"><i class="fa fa-check"></i><b>37.1</b> Rcpp的用途</a></li>
<li class="chapter" data-level="37.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp"><i class="fa fa-check"></i><b>37.2</b> Rcpp入门样例</a><ul>
<li class="chapter" data-level="37.2.1" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex1"><i class="fa fa-check"></i><b>37.2.1</b> 用<code>cppFunction()</code>转换简单的C++函数—Fibnacci例子</a></li>
<li class="chapter" data-level="37.2.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex2"><i class="fa fa-check"></i><b>37.2.2</b> 用<code>sourceCpp()</code>转换C++程序—正负交替迭代例子</a></li>
<li class="chapter" data-level="37.2.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex3"><i class="fa fa-check"></i><b>37.2.3</b> 用<code>sourceCpp()</code>转换C++源文件中的程序—正负交替迭代例子</a></li>
<li class="chapter" data-level="37.2.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex4"><i class="fa fa-check"></i><b>37.2.4</b> 用<code>sourceCpp()</code>转换C++源程序文件—卷积例子</a></li>
<li class="chapter" data-level="37.2.5" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-rmdconv"><i class="fa fa-check"></i><b>37.2.5</b> 在Rmd文件中使用C++源程序文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="38" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html"><i class="fa fa-check"></i><b>38</b> R与C++的类型转换</a><ul>
<li class="chapter" data-level="38.1" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-wrap"><i class="fa fa-check"></i><b>38.1</b> 用<code>wrap()</code>把C++变量返回到R中</a></li>
<li class="chapter" data-level="38.2" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-as"><i class="fa fa-check"></i><b>38.2</b> 用<code>as()</code>函数把R变量转换为C++类型</a></li>
<li class="chapter" data-level="38.3" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-implicit"><i class="fa fa-check"></i><b>38.3</b> <code>as()</code>和<code>wrap()</code>的隐含调用</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="rcpp-attr.html"><a href="rcpp-attr.html"><i class="fa fa-check"></i><b>39</b> Rcpp 属性</a><ul>
<li class="chapter" data-level="39.1" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-intro"><i class="fa fa-check"></i><b>39.1</b> Rcpp属性介绍</a></li>
<li class="chapter" data-level="39.2" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-export"><i class="fa fa-check"></i><b>39.2</b> 在C++源程序中指定要导出的C++函数</a></li>
<li class="chapter" data-level="39.3" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-sourcecpp"><i class="fa fa-check"></i><b>39.3</b> 在R中编译链接C++代码</a></li>
<li class="chapter" data-level="39.4" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc"><i class="fa fa-check"></i><b>39.4</b> Rcpp属性的其它功能</a><ul>
<li class="chapter" data-level="39.4.1" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-default"><i class="fa fa-check"></i><b>39.4.1</b> 自变量有缺省值的函数</a></li>
<li class="chapter" data-level="39.4.2" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-interrupt"><i class="fa fa-check"></i><b>39.4.2</b> 允许用户中断</a></li>
<li class="chapter" data-level="39.4.3" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-rinclude"><i class="fa fa-check"></i><b>39.4.3</b> 把R代码写在C++源文件中</a></li>
<li class="chapter" data-level="39.4.4" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-rand"><i class="fa fa-check"></i><b>39.4.4</b> 在C++中调用R的随机数发生器</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="40" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html"><i class="fa fa-check"></i><b>40</b> Rcpp提供的C++数据类型</a><ul>
<li class="chapter" data-level="40.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-robject"><i class="fa fa-check"></i><b>40.1</b> RObject类</a></li>
<li class="chapter" data-level="40.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec"><i class="fa fa-check"></i><b>40.2</b> IntegerVector类</a><ul>
<li class="chapter" data-level="40.2.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec-ex1"><i class="fa fa-check"></i><b>40.2.1</b> IntegerVector示例1：返回完全数</a></li>
<li class="chapter" data-level="40.2.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec-ex2"><i class="fa fa-check"></i><b>40.2.2</b> IntegerVector示例2：输入整数向量</a></li>
</ul></li>
<li class="chapter" data-level="40.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num"><i class="fa fa-check"></i><b>40.3</b> NumericVector类</a><ul>
<li class="chapter" data-level="40.3.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex1"><i class="fa fa-check"></i><b>40.3.1</b> 示例1：计算元素<span class="math inline">\(p\)</span>次方的和</a></li>
<li class="chapter" data-level="40.3.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex2"><i class="fa fa-check"></i><b>40.3.2</b> 示例2：<code>clone</code>函数</a></li>
<li class="chapter" data-level="40.3.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex3"><i class="fa fa-check"></i><b>40.3.3</b> 示例3：向量子集</a></li>
</ul></li>
<li class="chapter" data-level="40.4" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat"><i class="fa fa-check"></i><b>40.4</b> NumericMatrix类</a><ul>
<li class="chapter" data-level="40.4.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex1"><i class="fa fa-check"></i><b>40.4.1</b> 示例1：计算矩阵各列模的最大值</a></li>
<li class="chapter" data-level="40.4.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex2"><i class="fa fa-check"></i><b>40.4.2</b> 示例2：把输入矩阵制作副本计算元素平方根</a></li>
<li class="chapter" data-level="40.4.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex3"><i class="fa fa-check"></i><b>40.4.3</b> 示例3：访问列子集</a></li>
</ul></li>
<li class="chapter" data-level="40.5" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-other"><i class="fa fa-check"></i><b>40.5</b> Rcpp的其它向量类</a><ul>
<li class="chapter" data-level="40.5.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-logic"><i class="fa fa-check"></i><b>40.5.1</b> Rcpp的LogicalVector类</a></li>
<li class="chapter" data-level="40.5.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-char"><i class="fa fa-check"></i><b>40.5.2</b> Rcpp的CharacterVector类型</a></li>
</ul></li>
<li class="chapter" data-level="40.6" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types"><i class="fa fa-check"></i><b>40.6</b> Rcpp提供的其它数据类型</a><ul>
<li class="chapter" data-level="40.6.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-named"><i class="fa fa-check"></i><b>40.6.1</b> Named类型</a></li>
<li class="chapter" data-level="40.6.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-list"><i class="fa fa-check"></i><b>40.6.2</b> List类型</a></li>
<li class="chapter" data-level="40.6.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-df"><i class="fa fa-check"></i><b>40.6.3</b> Rcpp的DataFrame类</a></li>
<li class="chapter" data-level="40.6.4" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-func"><i class="fa fa-check"></i><b>40.6.4</b> Rcpp的Function类</a></li>
<li class="chapter" data-level="40.6.5" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-environ"><i class="fa fa-check"></i><b>40.6.5</b> Rcpp的Environment类</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="41" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html"><i class="fa fa-check"></i><b>41</b> Rcpp糖</a><ul>
<li class="chapter" data-level="41.1" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-examp"><i class="fa fa-check"></i><b>41.1</b> 简单示例</a></li>
<li class="chapter" data-level="41.2" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop"><i class="fa fa-check"></i><b>41.2</b> 向量化的运算符</a><ul>
<li class="chapter" data-level="41.2.1" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-arith"><i class="fa fa-check"></i><b>41.2.1</b> 向量化的四则运算</a></li>
<li class="chapter" data-level="41.2.2" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-binop"><i class="fa fa-check"></i><b>41.2.2</b> 向量化的二元逻辑运算</a></li>
<li class="chapter" data-level="41.2.3" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-uop"><i class="fa fa-check"></i><b>41.2.3</b> 向量化的一元运算符</a></li>
</ul></li>
<li class="chapter" data-level="41.3" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-mathfunc"><i class="fa fa-check"></i><b>41.3</b> 用Rcpp访问数学函数</a></li>
<li class="chapter" data-level="41.4" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-any"><i class="fa fa-check"></i><b>41.4</b> 返回单一逻辑值的函数</a></li>
<li class="chapter" data-level="41.5" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-expfunc"><i class="fa fa-check"></i><b>41.5</b> 返回糖表达式的函数</a></li>
<li class="chapter" data-level="41.6" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-diff"><i class="fa fa-check"></i><b>41.6</b> R与Rcpp不同语法示例</a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="rcpp-package.html"><a href="rcpp-package.html"><i class="fa fa-check"></i><b>42</b> 用Rcpp帮助制作R扩展包</a><ul>
<li class="chapter" data-level="42.1" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-wo"><i class="fa fa-check"></i><b>42.1</b> 不用扩展包共享C++代码的方法</a></li>
<li class="chapter" data-level="42.2" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen"><i class="fa fa-check"></i><b>42.2</b> 生成扩展包</a><ul>
<li class="chapter" data-level="42.2.1" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-exist"><i class="fa fa-check"></i><b>42.2.1</b> 利用已有基于Rcpp属性的源程序制作扩展包</a></li>
<li class="chapter" data-level="42.2.2" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-desc"><i class="fa fa-check"></i><b>42.2.2</b> DESCRIPTION文件</a></li>
<li class="chapter" data-level="42.2.3" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-namespace"><i class="fa fa-check"></i><b>42.2.3</b> NAMESPACE文件</a></li>
</ul></li>
<li class="chapter" data-level="42.3" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-recomp"><i class="fa fa-check"></i><b>42.3</b> 重新编译</a></li>
<li class="chapter" data-level="42.4" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-interface"><i class="fa fa-check"></i><b>42.4</b> 建立C++用的接口界面</a></li>
</ul></li>
<li class="part"><span><b>X 编程例子</b></span></li>
<li class="chapter" data-level="43" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>43</b> R编程例子</a><ul>
<li class="chapter" data-level="43.1" data-path="examples.html"><a href="examples.html#examples-rlang"><i class="fa fa-check"></i><b>43.1</b> R语言</a><ul>
<li class="chapter" data-level="43.1.1" data-path="examples.html"><a href="examples.html#examples-rlang-inverse"><i class="fa fa-check"></i><b>43.1.1</b> 用向量作逆变换</a></li>
<li class="chapter" data-level="43.1.2" data-path="examples.html"><a href="examples.html#examples-rlang-fibonacci"><i class="fa fa-check"></i><b>43.1.2</b> 斐波那契数列计算</a></li>
<li class="chapter" data-level="43.1.3" data-path="examples.html"><a href="examples.html#examples-rlang-permutation"><i class="fa fa-check"></i><b>43.1.3</b> 穷举所有排列</a></li>
<li class="chapter" data-level="43.1.4" data-path="examples.html"><a href="examples.html#examples-rlang-repgroup"><i class="fa fa-check"></i><b>43.1.4</b> 可重复分组方式穷举</a></li>
<li class="chapter" data-level="43.1.5" data-path="examples.html"><a href="examples.html#examples-rlang-runs"><i class="fa fa-check"></i><b>43.1.5</b> 升降连计数</a></li>
</ul></li>
<li class="chapter" data-level="43.2" data-path="examples.html"><a href="examples.html#examples-prob"><i class="fa fa-check"></i><b>43.2</b> 概率</a><ul>
<li class="chapter" data-level="43.2.1" data-path="examples.html"><a href="examples.html#examples-prob-thsage"><i class="fa fa-check"></i><b>43.2.1</b> 智者千虑必有一失</a></li>
<li class="chapter" data-level="43.2.2" data-path="examples.html"><a href="examples.html#examples-prob-coupleseats"><i class="fa fa-check"></i><b>43.2.2</b> 圆桌夫妇座位问题</a></li>
</ul></li>
<li class="chapter" data-level="43.3" data-path="examples.html"><a href="examples.html#examples-scicomp"><i class="fa fa-check"></i><b>43.3</b> 科学计算</a><ul>
<li class="chapter" data-level="43.3.1" data-path="examples.html"><a href="examples.html#examples-scicomp-citylink"><i class="fa fa-check"></i><b>43.3.1</b> 城市间最短路径</a></li>
<li class="chapter" data-level="43.3.2" data-path="examples.html"><a href="examples.html#examples-scicomp-daub"><i class="fa fa-check"></i><b>43.3.2</b> Daubechies小波函数计算</a></li>
<li class="chapter" data-level="43.3.3" data-path="examples.html"><a href="examples.html#examples-scicomp-heating"><i class="fa fa-check"></i><b>43.3.3</b> 房间加热温度变化</a></li>
</ul></li>
<li class="chapter" data-level="43.4" data-path="examples.html"><a href="examples.html#examples-statcomp"><i class="fa fa-check"></i><b>43.4</b> 统计计算</a><ul>
<li class="chapter" data-level="43.4.1" data-path="examples.html"><a href="examples.html#examples-statcomp-kernden"><i class="fa fa-check"></i><b>43.4.1</b> 核回归与核密度估计</a></li>
<li class="chapter" data-level="43.4.2" data-path="examples.html"><a href="examples.html#examples-statcomp-mcquad2d"><i class="fa fa-check"></i><b>43.4.2</b> 二维随机模拟积分</a></li>
<li class="chapter" data-level="43.4.3" data-path="examples.html"><a href="examples.html#examples-statcomp-hidfreq"><i class="fa fa-check"></i><b>43.4.3</b> 潜周期估计</a></li>
<li class="chapter" data-level="43.4.4" data-path="examples.html"><a href="examples.html#examples-statcomp-armaest"><i class="fa fa-check"></i><b>43.4.4</b> ARMA(1,1)模型估计</a></li>
<li class="chapter" data-level="43.4.5" data-path="examples.html"><a href="examples.html#examples-statcomp-varprop"><i class="fa fa-check"></i><b>43.4.5</b> VAR模型平稳性</a></li>
<li class="chapter" data-level="43.4.6" data-path="examples.html"><a href="examples.html#examples-statcomp-storereliab"><i class="fa fa-check"></i><b>43.4.6</b> 贮存可靠性评估</a></li>
</ul></li>
<li class="chapter" data-level="43.5" data-path="examples.html"><a href="examples.html#examples-datatreat"><i class="fa fa-check"></i><b>43.5</b> 数据处理</a><ul>
<li class="chapter" data-level="43.5.1" data-path="examples.html"><a href="examples.html#examples-datatreat-subscore"><i class="fa fa-check"></i><b>43.5.1</b> 小题分题型分数汇总</a></li>
<li class="chapter" data-level="43.5.2" data-path="examples.html"><a href="examples.html#examples-datatreat-cluslab"><i class="fa fa-check"></i><b>43.5.2</b> 类别编号重排</a></li>
</ul></li>
<li class="chapter" data-level="43.6" data-path="examples.html"><a href="examples.html#examples-texttr"><i class="fa fa-check"></i><b>43.6</b> 文本处理</a><ul>
<li class="chapter" data-level="43.6.1" data-path="examples.html"><a href="examples.html#examples-texttr-hongloument"><i class="fa fa-check"></i><b>43.6.1</b> 用R语言下载处理《红楼梦》htm文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://www.math.pku.edu.cn/teachers/lidf/" target="blank">编著：李东风</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R语言教程</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2" class="section level1">
<h1><span class="header-section-number">29</span> ggplot作图入门</h1>
<div id="ggplot2-intro" class="section level2">
<h2><span class="header-section-number">29.1</span> 介绍</h2>
<p>Hadley Wickem的ggplot2包是R的一个作图用的扩展包，
它实现了“图形的语法”，
将一个作图任务分解为若干个子任务，
只要完成各个子任务就可以完成作图。
在作常用的图形时，
只需要两个步骤：
首先将图形所展现的数据输入到<code>ggplot()</code>函数中，
然后调用某个<code>geom_xxx()</code>函数，
指定图形类型，如散点图、曲线图、盒形图等。</p>
<p>如果需要进一步控制图形细节，
只要继续调用其它函数，
就可以控制变量值的表现方式(scale)、图例、配色等。
这使得我们很容易做出基本的图形，
在有需要时再深入学习，
做出更为满意的图形。</p>
<p>与基本R中的作图系统相比，
ggplot2的作图有规律可循，
作图结果直接达到出版印刷质量，
除了可以按照一些既定模式做出常见种类的图形，
也很容易将不同图形种类组合在一起，
或者设计新颖的图形。
基本R的作图结果通常不够美观，
如果要将不同种类图形组合在一起比较困难，
对设计新的图形类型支持也不够好。</p>
<p>ggplot2的作图一般步骤为：</p>
<ul>
<li>准备数据，一般为数据框，
且一般为长表，
即每个观测时间占一行，
每个观测变量占一列。</li>
<li>将数据输入到<code>ggplot()</code>函数中，
并指定参与作图的每个变量分别映射到哪些图形特性，
比如映射为x坐标、y坐标、颜色、形状等。
这些映射称为aesthetic mappings或aesthetics。</li>
<li>选择一个合适的图形类型，
函数名以<code>geom_</code>开头，
如<code>geom_point()</code>表示散点图。
图形类型简称为geom。
将<code>ggplot()</code>部分与<code>geom_xxx()</code>部分用加号连接。
到此已经可以作图，下面的步骤是进一步的细化设定。</li>
<li>设定适当的坐标系统，
如<code>coord_cartesian()</code>, <code>scale_x_log10()</code>等。
仍用加号连接。</li>
<li>设定标题和图例位置等，如<code>labs()</code>。
仍用加号连接。</li>
</ul>
<p>这个流程的一个大致的模板为：</p>
<div class="sourceCode" id="cb1709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1709-1"><a href="ggplot2.html#cb1709-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="op">&lt;</span>输入数据框<span class="op">&gt;</span>,</span>
<span id="cb1709-2"><a href="ggplot2.html#cb1709-2"></a>  <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="op">&lt;</span>维度<span class="op">&gt;=</span><span class="er">&lt;</span>变量名<span class="op">&gt;</span>,</span>
<span id="cb1709-3"><a href="ggplot2.html#cb1709-3"></a>    <span class="op">&lt;</span>维度<span class="op">&gt;=</span><span class="er">&lt;</span>变量名<span class="op">&gt;</span>, <span class="op">&lt;</span>...<span class="op">&gt;</span>))</span>
<span id="cb1709-4"><a href="ggplot2.html#cb1709-4"></a>p <span class="op">+</span><span class="st"> </span>geom_<span class="op">&lt;</span>图形类型<span class="op">&gt;</span>(<span class="op">&lt;</span>...<span class="op">&gt;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1709-5"><a href="ggplot2.html#cb1709-5"></a><span class="st">  </span>scale_<span class="op">&lt;</span>映射<span class="op">&gt;</span>_<span class="op">&lt;</span>类型<span class="op">&gt;</span>(<span class="op">&lt;</span>...<span class="op">&gt;</span>) <span class="op">+</span></span>
<span id="cb1709-6"><a href="ggplot2.html#cb1709-6"></a><span class="st">  </span>coord_<span class="op">&lt;</span>类型<span class="op">&gt;</span>(<span class="op">&lt;</span>...<span class="op">&gt;</span>) <span class="op">+</span></span>
<span id="cb1709-7"><a href="ggplot2.html#cb1709-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="op">&lt;</span>...<span class="op">&gt;</span>)</span></code></pre></div>
<p>其中<code>&lt;...&gt;</code>表示额外的选项。
变量<code>p</code>包含做出的图形的所有数据与设定，
变量名可以任意取。</p>
<p>本章内容主要来自：</p>
<ul>
<li>Healy, Kieran (2018).
Data Visualization: A Practical Introduction.
Princeton University Press.
<a href="https://socviz.co/index.html" class="uri">https://socviz.co/index.html</a>
这本书讲了R的ggplot的使用，
也讲了一些可视化的一般性原则。</li>
<li>Claus O. Wilke(2019).
Fundamentals of Data Visualization.
O’Reilly Media.
<a href="https://serialmentor.com/dataviz/" class="uri">https://serialmentor.com/dataviz/</a>
这本书虽然也使用R的ggplot2包，
但正文中没有代码，
主要讲作图有哪些考虑、各种图形类型。
代码在github上可下载。</li>
<li>Winston Chang(2018).
R Graphics Cookbook.
O’Relly Media.
网站：<a href="https://r-graphics.org/" class="uri">https://r-graphics.org/</a>
为第二版。
讲了各种图的R程序。</li>
<li>Wickham, Hadley (2016).
Ggplot2: Elegant graphics for data analysis.
New York: Springer.</li>
<li>RStudio的ggplot2概览：
<a href="data-visualization-2.1.pdf">data-visualization-2.1.pdf</a></li>
<li>ggplot2的扩展汇集：<a href="http://www.ggplot2-exts.org/gallery/" class="uri">http://www.ggplot2-exts.org/gallery/</a></li>
</ul>
<p>Wickham的书主要需要安装tidyverse扩展包，
安装时会自动安装其它一些有关扩展包。
Healy的的书需要通过如下程序安装socviz软件包：</p>
<div class="sourceCode" id="cb1710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1710-1"><a href="ggplot2.html#cb1710-1"></a>devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;kjhealy/socviz&quot;</span>)</span></code></pre></div>
<p>后续的例子中用到一些数据集:</p>
<ul>
<li>来自gapminder扩展包的gapminder数据集，
有若干个国家不同年份的一些数据，
包括所属洲、期望寿命、人口数、人均GDP。
有1704个观测和6个变量。</li>
<li>socviz包的<code>gss_sm</code>数据集，是2016年美国一般社会调查数据的部分内容。
有2867个观测，32个变量。
社会调查数据的变量主要取属性值，
比如无序分类、有序分类、分组的数值、整数值等。</li>
<li>socviz包的organdata数据集，
是17个OECD国家历年的器官捐献情况以及一些其它记录。</li>
<li>socviz扩展包的<code>elections_historic</code>数据集。
包括美国历次总统大选当选人、所属党派、支持比例等。</li>
<li>socviz扩展包的asasec数据集。
这是美国社会学学会(ASA)的各分会2005年到2015年的一些数据。</li>
<li>ggplot2包中的<code>midwest</code>数据集包含了美国中西部的一些县的统计数据，
如面积等。</li>
<li>来自ggplot2包的钻石数据集。</li>
</ul>
<p>gapminder的头部：</p>
<div class="sourceCode" id="cb1711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1711-1"><a href="ggplot2.html#cb1711-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb1711-2"><a href="ggplot2.html#cb1711-2"></a><span class="kw">head</span>(gapminder, <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## # A tibble: 20 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## 11 Afghanistan Asia       2002    42.1 25268405      727.
## 12 Afghanistan Asia       2007    43.8 31889923      975.
## 13 Albania     Europe     1952    55.2  1282697     1601.
## 14 Albania     Europe     1957    59.3  1476505     1942.
## 15 Albania     Europe     1962    64.8  1728137     2313.
## 16 Albania     Europe     1967    66.2  1984060     2760.
## 17 Albania     Europe     1972    67.7  2263554     3313.
## 18 Albania     Europe     1977    68.9  2509048     3533.
## 19 Albania     Europe     1982    70.4  2780097     3631.
## 20 Albania     Europe     1987    72    3075321     3739.</code></pre>
<p><code>gss_sm</code>的头部：</p>
<div class="sourceCode" id="cb1713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1713-1"><a href="ggplot2.html#cb1713-1"></a><span class="kw">head</span>(gss_sm, <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## # A tibble: 20 x 32
##     year    id ballot   age childs  sibs degree race  sex   region income16
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;   
##  1  2016     1      1    47      3     2 Bache~ White Male  New E~ $170000~
##  2  2016     2      2    61      0     3 High ~ White Male  New E~ $50000 ~
##  3  2016     3      3    72      2     3 Bache~ White Male  New E~ $75000 ~
##  4  2016     4      1    43      4     3 High ~ White Fema~ New E~ $170000~
##  5  2016     5      3    55      2     2 Gradu~ White Fema~ New E~ $170000~
##  6  2016     6      2    53      2     2 Junio~ White Fema~ New E~ $60000 ~
##  7  2016     7      1    50      2     2 High ~ White Male  New E~ $170000~
##  8  2016     8      3    23      3     6 High ~ Other Fema~ Middl~ $30000 ~
##  9  2016     9      1    45      3     5 High ~ Black Male  Middl~ $60000 ~
## 10  2016    10      3    71      4     1 Junio~ White Male  Middl~ $60000 ~
## 11  2016    11      2    33      5     4 High ~ Black Fema~ Middl~ under $~
## 12  2016    12      1    86      4     4 High ~ White Fema~ Middl~ under $~
## 13  2016    13      2    32      3     3 High ~ Black Male  Middl~ $8 000 ~
## 14  2016    14      3    60      5     6 High ~ Black Fema~ Middl~ $12500 ~
## 15  2016    15      2    76      7     0 Lt Hi~ White Male  New E~ $40000 ~
## 16  2016    16      3    33      2     1 High ~ White Fema~ New E~ $50000 ~
## 17  2016    17      3    56      6     3 High ~ White Male  New E~ $50000 ~
## 18  2016    18      2    62      5     8 Lt Hi~ Other Fema~ New E~ $5 000 ~
## 19  2016    19      2    31      0     2 Gradu~ Black Male  New E~ $35000 ~
## 20  2016    20      1    43      2     0 High ~ Black Male  New E~ $25000 ~
## # ... with 21 more variables: relig &lt;fct&gt;, marital &lt;fct&gt;, padeg &lt;fct&gt;,
## #   madeg &lt;fct&gt;, partyid &lt;fct&gt;, polviews &lt;fct&gt;, happy &lt;fct&gt;, partners &lt;fct&gt;,
## #   grass &lt;fct&gt;, zodiac &lt;fct&gt;, pres12 &lt;dbl&gt;, wtssall &lt;dbl&gt;, income_rc &lt;fct&gt;,
## #   agegrp &lt;fct&gt;, ageq &lt;fct&gt;, siblings &lt;fct&gt;, kids &lt;fct&gt;, religion &lt;fct&gt;,
## #   bigregion &lt;fct&gt;, partners_rc &lt;fct&gt;, obama &lt;dbl&gt;</code></pre>
</div>
<div id="ggplot2-principles" class="section level2">
<h2><span class="header-section-number">29.2</span> 作图的一般原则</h2>
<p>关于什么是好的图形和坏的图形，
William S. Cleveland，
Edward R. Tufte等人有很多的研究。</p>
<p>坏的图形可能有如下缺点：</p>
<ul>
<li>坏的品味。统计图形应该用尽可能少的图形元素表示尽可能多的数据，
从打印图形而言，即数据量与所用墨水比例越大越好。
没有必要的颜色、三维形态经常会影响读者对图形的认读。
这是Edward R. Tufte的观点，
但是过于极端也不好。</li>
<li>坏的数据。
即使图形本身的做法没有问题，
选择了错误的或者不合适的数据也会误导读者，
甚至于用错误数据做的很专业的图形会比粗陋的图形更能误导读者。</li>
<li>坏的感知。
不好的颜色选择、三维形状、坐标轴范围、宽高比都有可能对读者的认知有影响。</li>
</ul>
<p>作图时应考虑的一些因素：</p>
<ul>
<li><p>数值型变量的不同值可以表示为：</p>
<ul>
<li>同一坐标轴上的不同位置、</li>
<li>不同轴上的位置、</li>
<li>不同长度、</li>
<li>不同角度或者斜率、</li>
<li>不同面积、</li>
<li>三维空间中的不同位置、</li>
<li>颜色的不同明暗度、</li>
<li>不同颜色饱和度、</li>
<li>曲线的不同曲率、</li>
<li>三维体积，</li>
</ul>
<p>这些表示的选择项越往后越难以被读者正确辨识。
使用颜色时，应该使用渐变的明暗度或者渐变色。</p></li>
<li><p>分类变量的不同值可以表示为：</p>
<ul>
<li>不同分组、</li>
<li>不同颜色、</li>
<li>三维动态、</li>
<li>不同符号。</li>
</ul>
<p>这些表示的选择项越往后越难辨识。
使用颜色时，应该使用明显不同的颜色而不应该使用渐变色。</p></li>
<li><p>对于最少是零的变量，
是否应该以零作为坐标轴的最低值需要考虑，
但没有一定的规则。
同一组数据在不同的坐标范围或者长宽比下曲线的斜率会有很大差别。</p></li>
</ul>
</div>
<div id="ggplot2-point" class="section level2">
<h2><span class="header-section-number">29.3</span> 散点图：ggplot入门</h2>
<div id="ggplot2-point-base" class="section level3">
<h3><span class="header-section-number">29.3.1</span> 基本的散点图</h3>
<p>以gapminder数据集作为输入数据，
做出简单的散点图，
并逐步进行改善。
这个数据集有多个国家在多个年份的期望寿命与人均GDP值，
作期望寿命对人均GDP的散点图，
每个国家的每个年份作为一个点。
散点图最重要的映射是x轴与y轴两个维度。</p>
<p>首先调用<code>ggplot()</code>函数，
指定数据集，
将人均GDP映射到x轴，
将期望寿命映射到y轴，
结果保存为一个R变量：</p>
<div class="sourceCode" id="cb1715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1715-1"><a href="ggplot2.html#cb1715-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</span>
<span id="cb1715-2"><a href="ggplot2.html#cb1715-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1715-3"><a href="ggplot2.html#cb1715-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1715-4"><a href="ggplot2.html#cb1715-4"></a>    <span class="dt">y =</span> lifeExp))</span></code></pre></div>
<p>x、y轴是最常见的映射，
也可以将变量映射为颜色、符号、线型等，
这时不需要指定具体的颜色、符号、线型，
而是将变量映射为这些图形元素类型。</p>
<p><code>ggplot()</code>的调用中，
可以省略<code>data =</code>, <code>mapping =</code>, <code>x =</code>, <code>y =</code>，
写成：</p>
<div class="sourceCode" id="cb1716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1716-1"><a href="ggplot2.html#cb1716-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp))</span></code></pre></div>
<p>在如上指定了数据和映射后，
只要用<code>geom_xxx()</code>指定一个图形类型，
并与<code>ggplot()</code>的结果用加号连接就可以作图了，如：</p>
<div class="sourceCode" id="cb1717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1717-1"><a href="ggplot2.html#cb1717-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-start-gapminder-point01b-1.png" width="672" /></p>
<p>实际上，上面的程序等同于调用<code>print(p + geom_point())</code>。
在R函数中或者在循环中需要显式地调用<code>print()</code>，
否则不会显示结果。
当载入了tidyverse系统时可以写成
<code>(p + geom_point()) %&gt;% print()</code>。</p>
</div>
<div id="ggplot2-point-layers" class="section level3">
<h3><span class="header-section-number">29.3.2</span> 逐步改善</h3>
<p>指定数据集、指定映射、选择适当的图形类型就可以做出基本的图形，
随后可以逐步对坐标系、坐标系刻度、标签与图例、配色等进行改善。
实际上，ggplot2包已经提供了十分合理的预设值，
用户只要进行一些必要的改动即可。</p>
<p>作图步骤之间用加号连接，这是ggplot包特有的语法。
例如，
用相同的映射做出拟合曲线图：</p>
<div class="sourceCode" id="cb1718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1718-1"><a href="ggplot2.html#cb1718-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point01c-1.png" width="672" /></p>
<p>用相同的映射做出散点图并叠加拟合曲线图：</p>
<div class="sourceCode" id="cb1720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1720-1"><a href="ggplot2.html#cb1720-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point01d-1.png" width="672" /></p>
<p><code>geom_smooth()</code>的默认设置调用了<code>gam()</code>函数来拟合曲线，
可以用<code>geom_smooth()</code>的参数选择不同的拟合方法，
如直线拟合：</p>
<div class="sourceCode" id="cb1722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1722-1"><a href="ggplot2.html#cb1722-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point01e-1.png" width="672" /></p>
<p>注意<code>geom_xxx()</code>函数计算所需的变量值是从<code>ggplot()</code>函数保存在变量<code>p</code>中的信息提取的。</p>
<p>在以上的所有图形中，
x轴变量（人均GDP）分布非正态，严重右偏，
使得大多数散点重叠地分布在直角坐标系的左下角。
将x轴用对数刻度可以改善，
函数为<code>scale_x_log10()</code>:</p>
<div class="sourceCode" id="cb1724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1724-1"><a href="ggplot2.html#cb1724-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1724-2"><a href="ggplot2.html#cb1724-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;gam&quot;</span>) <span class="op">+</span></span>
<span id="cb1724-3"><a href="ggplot2.html#cb1724-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point01f-1.png" width="672" /></p>
<p>广义可加模型拟合的曲线基本是一条直线。
注意，
对数刻度实际上是对原始数据进行对数变换，
而<code>geom_smooth()</code>的拟合计算是在对数变换之后进行的。</p>
<p>刚刚的图形的横坐标轴刻度不太友好，
可以调用scales扩展包的适当函数进行改善，
作为<code>scale_x_log10()</code>的<code>labels</code>选项：</p>
<div class="sourceCode" id="cb1726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1726-1"><a href="ggplot2.html#cb1726-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1726-2"><a href="ggplot2.html#cb1726-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;gam&quot;</span>) <span class="op">+</span></span>
<span id="cb1726-3"><a href="ggplot2.html#cb1726-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point01g-1.png" width="672" /></p>
<p><code>scale_xxx()</code>的<code>labels</code>选项指定如何标出坐标刻度数字，
参数值是一个函数对象，
如果scales包中找不到适当的功能，
可以自定义一个函数将数值转换为字符串。
scales包提供了<code>comma</code>, <code>date</code>, <code>dollar</code>, <code>math</code>,
<code>number</code>, <code>ordinal</code>, <code>pvalue</code>, <code>scientific</code>,
<code>time</code>等坐标刻度值转换函数。</p>
</div>
<div id="ggplot2-point-otheraes" class="section level3">
<h3><span class="header-section-number">29.3.3</span> 颜色、符号、线型等映射</h3>
<p>在<code>ggplot()</code>函数的<code>mapping</code>参数的<code>aes()</code>设定中将变量映射到x、y轴，
颜色、符号、线型等图形元素类型，
也可以作为图形设置将某些图形元素设置为固定值。</p>
<p>例如，
用不同颜色表示不同大洲，
就是将<code>continent</code>变量映射到<code>color</code>:</p>
<div class="sourceCode" id="cb1728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1728-1"><a href="ggplot2.html#cb1728-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder,</span>
<span id="cb1728-2"><a href="ggplot2.html#cb1728-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1728-3"><a href="ggplot2.html#cb1728-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1728-4"><a href="ggplot2.html#cb1728-4"></a>    <span class="dt">y =</span> lifeExp,</span>
<span id="cb1728-5"><a href="ggplot2.html#cb1728-5"></a>    <span class="dt">color =</span> continent))</span></code></pre></div>
<p>程序中仅指定了将大洲映射到颜色维，
并不具体指定所用的颜色。</p>
<p>作带有局部多项式曲线拟合的散点图：</p>
<div class="sourceCode" id="cb1729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1729-1"><a href="ggplot2.html#cb1729-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1729-2"><a href="ggplot2.html#cb1729-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb1729-3"><a href="ggplot2.html#cb1729-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point02b-1.png" width="672" /></p>
<p>可以看出，
不同散点用了不同颜色表示其continent变量的值，
五个大洲分别进行了曲线拟合，
曲线使用了不同颜色但置信域颜色相同，
使得难以认读。
在图形右侧自动生成了颜色与continent变量值的对应关系图例。</p>
<p>下面的图形仍分不同大洲作曲线拟合，
并将置信区间阴影的颜色也用不同大洲区分，
方法是在<code>aes()</code>中将<code>color</code>和<code>fill</code>都指定为变量<code>continent</code>:</p>
<div class="sourceCode" id="cb1731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1731-1"><a href="ggplot2.html#cb1731-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder,</span>
<span id="cb1731-2"><a href="ggplot2.html#cb1731-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1731-3"><a href="ggplot2.html#cb1731-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1731-4"><a href="ggplot2.html#cb1731-4"></a>    <span class="dt">y =</span> lifeExp,</span>
<span id="cb1731-5"><a href="ggplot2.html#cb1731-5"></a>    <span class="dt">color =</span> continent,</span>
<span id="cb1731-6"><a href="ggplot2.html#cb1731-6"></a>    <span class="dt">fill =</span> continent))</span>
<span id="cb1731-7"><a href="ggplot2.html#cb1731-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1731-8"><a href="ggplot2.html#cb1731-8"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb1731-9"><a href="ggplot2.html#cb1731-9"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point03-1.png" width="672" /></p>
<p>尝试将颜色指定为一个固定值，如：</p>
<div class="sourceCode" id="cb1733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1733-1"><a href="ggplot2.html#cb1733-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder,</span>
<span id="cb1733-2"><a href="ggplot2.html#cb1733-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1733-3"><a href="ggplot2.html#cb1733-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1733-4"><a href="ggplot2.html#cb1733-4"></a>    <span class="dt">y =</span> lifeExp,</span>
<span id="cb1733-5"><a href="ggplot2.html#cb1733-5"></a>    <span class="dt">color =</span> <span class="st">&quot;chartreuse4&quot;</span>))</span>
<span id="cb1733-6"><a href="ggplot2.html#cb1733-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1733-7"><a href="ggplot2.html#cb1733-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb1733-8"><a href="ggplot2.html#cb1733-8"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point04-bad-1.png" width="672" /></p>
<p>我们发现，
散点并没有使用草绿色，
而且图形右侧有一个<code>chartreuse4</code>图例。
这是因为，
<code>aes()</code>仅用来指定变量与图形元素类型的映射，
所以实际上是生成了一个仅有一个常数值<code>"chartreuse4"</code>的新变量，
用颜色表示这个新变量。
为了指定固定颜色，
应将<code>color=</code>作为<code>geom_xxx()</code>函数的选项，
而不是放在<code>aes()</code>映射中，
如：</p>
<div class="sourceCode" id="cb1735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1735-1"><a href="ggplot2.html#cb1735-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder,</span>
<span id="cb1735-2"><a href="ggplot2.html#cb1735-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1735-3"><a href="ggplot2.html#cb1735-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1735-4"><a href="ggplot2.html#cb1735-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1735-5"><a href="ggplot2.html#cb1735-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">color=</span><span class="st">&quot;chartreuse4&quot;</span>) <span class="op">+</span></span>
<span id="cb1735-6"><a href="ggplot2.html#cb1735-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb1735-7"><a href="ggplot2.html#cb1735-7"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point05-1.png" width="672" /></p>
<p><code>geom_xxx()</code>函数接受许多关于颜色、透明度、符号、线型的设置参数。
比如，
下面的程序指定了散点的透明度，
以及拟合直线的粗细：</p>
<div class="sourceCode" id="cb1737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1737-1"><a href="ggplot2.html#cb1737-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb1737-2"><a href="ggplot2.html#cb1737-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">color=</span><span class="st">&quot;cadetblue1&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb1737-3"><a href="ggplot2.html#cb1737-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point05b-1.png" width="672" /></p>
<p>程序中<code>size</code>指定了线的以毫米为单位的粗细，
<code>se = FALSE</code>关闭了置信区间显示。
用<code>alpha =</code>设置了透明度，
取0和1之间的值，
数值越小越透明。
在有许多个点时适当设置透明度可以比较好地显示出重叠的点，
重叠点越多点的颜色越深。
虽然这里设置了固定的透明度，
也可以在<code>aes()</code>中将透明度<code>alpha</code>映射到某个变量，
使得该变量值大小用点的透明度表示。</p>
<p>画线时可以用<code>linetype</code>参数指定线型，
0表示实线，
1到6分别表示不同的虚线线型。</p>
<p>下面用<code>labs()</code>函数给图形加上适当的标题：</p>
<div class="sourceCode" id="cb1739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1739-1"><a href="ggplot2.html#cb1739-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder,</span>
<span id="cb1739-2"><a href="ggplot2.html#cb1739-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1739-3"><a href="ggplot2.html#cb1739-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1739-4"><a href="ggplot2.html#cb1739-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1739-5"><a href="ggplot2.html#cb1739-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb1739-6"><a href="ggplot2.html#cb1739-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;gam&quot;</span>) <span class="op">+</span></span>
<span id="cb1739-7"><a href="ggplot2.html#cb1739-7"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1739-8"><a href="ggplot2.html#cb1739-8"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1739-9"><a href="ggplot2.html#cb1739-9"></a>    <span class="dt">x =</span> <span class="st">&quot;人均GDP&quot;</span>,</span>
<span id="cb1739-10"><a href="ggplot2.html#cb1739-10"></a>    <span class="dt">y =</span> <span class="st">&quot;期望寿命（年数）&quot;</span>,</span>
<span id="cb1739-11"><a href="ggplot2.html#cb1739-11"></a>    <span class="dt">title =</span> <span class="st">&quot;经济增长与期望寿命&quot;</span>,</span>
<span id="cb1739-12"><a href="ggplot2.html#cb1739-12"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;数据点为每个国家每年&quot;</span>,</span>
<span id="cb1739-13"><a href="ggplot2.html#cb1739-13"></a>    <span class="dt">caption =</span> <span class="st">&quot;数据来源: gapminder&quot;</span>  )</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point06-1.png" width="672" /></p>
<p>可以看出，
<code>labs()</code>规定了上方的标题、小标题，
x轴、y轴的标题，
右下方的标注(caption)。
坐标轴刻度数值的规定则需要在<code>scale_xxx()</code>函数中给出。</p>
</div>
<div id="ggplot2-point-geomaes" class="section level3">
<h3><span class="header-section-number">29.3.4</span> 在geom函数中映射变量</h3>
<p>在前面的一个例图中，
在<code>ggplot()</code>函数中将<code>color</code>和<code>fill</code>映射到了<code>continent</code>变量，
使得不仅散点颜色代表了不同大洲，
还使得每个大洲单独拟合了曲线。
如果希望所有大洲拟合同一条曲线怎么办？</p>
<p>在必要时，
可以在<code>geom_xxx()</code>函数中用<code>mapping = aes(&lt;...&gt;)</code>单独指定变量映射。
例如，
下面的程序在<code>geom_point()</code>中将不同大洲映射为不同颜色，
而不影响<code>geom_smooth()</code>中的颜色以及分组：</p>
<div class="sourceCode" id="cb1741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1741-1"><a href="ggplot2.html#cb1741-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder,</span>
<span id="cb1741-2"><a href="ggplot2.html#cb1741-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1741-3"><a href="ggplot2.html#cb1741-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1741-4"><a href="ggplot2.html#cb1741-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1741-5"><a href="ggplot2.html#cb1741-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span></span>
<span id="cb1741-6"><a href="ggplot2.html#cb1741-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb1741-7"><a href="ggplot2.html#cb1741-7"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point07-1.png" width="672" /></p>
<p>也可以将一个分类变量映射到不同绘图符号。
例如，取gapminder 2007年数据子集，
将大洲映射到符号(shape)：</p>
<div class="sourceCode" id="cb1743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1743-1"><a href="ggplot2.html#cb1743-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>),</span>
<span id="cb1743-2"><a href="ggplot2.html#cb1743-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1743-3"><a href="ggplot2.html#cb1743-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1743-4"><a href="ggplot2.html#cb1743-4"></a>    <span class="dt">y =</span> lifeExp, </span>
<span id="cb1743-5"><a href="ggplot2.html#cb1743-5"></a>    <span class="dt">shape =</span> continent))</span>
<span id="cb1743-6"><a href="ggplot2.html#cb1743-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></span>
<span id="cb1743-7"><a href="ggplot2.html#cb1743-7"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<p><img src="static/picture/ggplot2-start-gapminder-point08-1.png" width="672" /></p>
<p>这种映射仅适用于点数比较少的情况，
还用了<code>size</code>参数指定符号的大小（单位：毫米）。
如果所有点使用同一符号并需要指定符号，
可以在<code>geom_point()</code>中用<code>shape</code>参数指定，
可以用0到25的整数值表示，
比如19为实心点，
也可以用字符串符号名称表示，
如<code>"circle"</code>表示实心点。
参见ggplot2帮助目录中的vignette ggplot2: ggplot2-specs。</p>
<p>注意，
绘图时参与映射的分类变量会自动产生分类效果，
<code>color</code>映射与<code>fill</code>映射到分类变量时常常会起到与添加<code>group</code>维相同的作用，
但为了逻辑清晰起见，
需要分组时还应该显式地映射<code>group</code>维。</p>
</div>
<div id="ggplot2-point-contcolor" class="section level3">
<h3><span class="header-section-number">29.3.5</span> 连续变量的颜色映射</h3>
<p>也可以将连续变量映射为渐变色。
除了表示二元函数的等值线图以外这种方法并不利于读者认读。</p>
<p>例如，
将人口数取自然对数映射为渐变色：</p>
<div class="sourceCode" id="cb1744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1744-1"><a href="ggplot2.html#cb1744-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder,</span>
<span id="cb1744-2"><a href="ggplot2.html#cb1744-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1744-3"><a href="ggplot2.html#cb1744-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1744-4"><a href="ggplot2.html#cb1744-4"></a>    <span class="dt">y =</span> lifeExp,</span>
<span id="cb1744-5"><a href="ggplot2.html#cb1744-5"></a>    <span class="dt">color =</span> <span class="kw">log</span>(pop)))</span>
<span id="cb1744-6"><a href="ggplot2.html#cb1744-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1744-7"><a href="ggplot2.html#cb1744-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb1744-8"><a href="ggplot2.html#cb1744-8"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels=</span>scales<span class="op">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-start-gapminder-point11-1.png" width="672" /></p>
<p>这里不同散点的颜色是连续变化的，
右侧的图例仅显示了有限的一些代表值。</p>
</div>
<div id="ggplot2-point-save" class="section level3">
<h3><span class="header-section-number">29.3.6</span> 保存图像</h3>
<p>如果使用Rmarkdown制作图文，
图像会自动进入编译的结果（如PDF、Word、HTML）中，
图像大小、输出大小可以用Rmarkdown的设置调整。</p>
<p>为了将最近生成的图形保存为PNG格式，用命令如</p>
<div class="sourceCode" id="cb1746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1746-1"><a href="ggplot2.html#cb1746-1"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span><span class="st">&quot;文件名.png&quot;</span>)</span></code></pre></div>
<p>保存为PDF格式：</p>
<div class="sourceCode" id="cb1747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1747-1"><a href="ggplot2.html#cb1747-1"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span><span class="st">&quot;文件名.pdf&quot;</span>)</span></code></pre></div>
<p>可以将制作的图形保存到了一个R变量中，
在<code>ggsave()</code>中可以用<code>plot=</code>参数指定，如</p>
<div class="sourceCode" id="cb1748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1748-1"><a href="ggplot2.html#cb1748-1"></a>ggout01 &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span>
<span id="cb1748-2"><a href="ggplot2.html#cb1748-2"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span><span class="st">&quot;文件名.pdf&quot;</span>, <span class="dt">plot=</span>ggout01)</span></code></pre></div>
<p>在<code>ggsave()</code>中可以用<code>scale =</code>指定放大比例，
用<code>height =</code>指定高度，
用<code>width =</code>指定宽度，用<code>units =</code>指定高度和宽度的单位，如：</p>
<div class="sourceCode" id="cb1749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1749-1"><a href="ggplot2.html#cb1749-1"></a><span class="kw">ggsave</span>(<span class="dt">filename=</span><span class="st">&quot;文件名.pdf&quot;</span>, <span class="dt">plot=</span>ggout01,</span>
<span id="cb1749-2"><a href="ggplot2.html#cb1749-2"></a>       <span class="dt">height=</span><span class="dv">12</span>, <span class="dt">width=</span><span class="dv">8</span>, <span class="dt">units=</span><span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<p>单位可以是in, cm, mm。</p>
</div>
</div>
<div id="ggplot2-right" class="section level2">
<h2><span class="header-section-number">29.4</span> 折线图、分组、小图</h2>
<div id="ggplot2-right-group" class="section level3">
<h3><span class="header-section-number">29.4.1</span> 图形中的分组和折线图</h3>
<p>考虑gapminder数据集中每个国家的期望寿命随时间（年）的变化。
用<code>geom_line()</code>可以画折线图。
因为有许多国家，所以仅指定x、y变量无法得到所需图形，如：</p>
<div class="sourceCode" id="cb1750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1750-1"><a href="ggplot2.html#cb1750-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</span>
<span id="cb1750-2"><a href="ggplot2.html#cb1750-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1750-3"><a href="ggplot2.html#cb1750-3"></a>    <span class="dt">x =</span> year, </span>
<span id="cb1750-4"><a href="ggplot2.html#cb1750-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1750-5"><a href="ggplot2.html#cb1750-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-group01-1.png" width="672" /></p>
<p>没有得出我们希望的每个国家一条曲线的效果。
这是因为程序中没有指定需要按照国家分组，
使得同一年的不同国家的坐标连成了一条竖线。</p>
<p>要注意的是，
<code>geom_line()</code>会自动将x坐标从小到大排序，
然后再连接相邻的点。
如果希望按输入数据的次序连接相邻的点，
需要用<code>geom_path()</code>函数。</p>
<p>为了解决上图的问题，
加入按照国家分组的设定。
实际上，
分组(<code>group</code>)与<code>x</code>、<code>y</code>、<code>color</code>、<code>fill</code>一样可以映射到一个变量，
但仅能映射到分类变量。
上述程序的改进如下：</p>
<div class="sourceCode" id="cb1751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1751-1"><a href="ggplot2.html#cb1751-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</span>
<span id="cb1751-2"><a href="ggplot2.html#cb1751-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1751-3"><a href="ggplot2.html#cb1751-3"></a>    <span class="dt">x =</span> year, </span>
<span id="cb1751-4"><a href="ggplot2.html#cb1751-4"></a>    <span class="dt">y =</span> lifeExp,</span>
<span id="cb1751-5"><a href="ggplot2.html#cb1751-5"></a>    <span class="dt">group =</span> country))</span>
<span id="cb1751-6"><a href="ggplot2.html#cb1751-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-group01b-1.png" width="672" /></p>
<p>结果图形中每一条曲线对应一个国家。
为了查探其中最下方的不稳定曲线是哪一个国家，使用筛选观测的功能：</p>
<div class="sourceCode" id="cb1752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1752-1"><a href="ggplot2.html#cb1752-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1752-2"><a href="ggplot2.html#cb1752-2"></a><span class="st">  </span><span class="kw">filter</span>(lifeExp <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>, year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1990</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   country continent  year lifeExp     pop gdpPercap
##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
## 1 Rwanda  Africa     1992    23.6 7290203      737.</code></pre>
<p>该国家为Rwanda。</p>
<p>如果需要按照两个或多个分类变量交叉分组，
可以给<code>group</code>维指定<code>interaction(...)</code>，
其中<code>...</code>是分类变量表。</p>
<p><code>geom_line()</code>用来绘制从左向右连接的折线。
比如，
仅绘制<code>Rwanda</code>的期望寿命时间序列：</p>
<div class="sourceCode" id="cb1754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1754-1"><a href="ggplot2.html#cb1754-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>),</span>
<span id="cb1754-2"><a href="ggplot2.html#cb1754-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1754-3"><a href="ggplot2.html#cb1754-3"></a>    <span class="dt">x =</span> year, </span>
<span id="cb1754-4"><a href="ggplot2.html#cb1754-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1754-5"><a href="ggplot2.html#cb1754-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-gap-line01-1.png" width="672" /></p>
<p>如果需要每个点画出散点符号，
可以同时使用<code>geom_point()</code>，如：</p>
<div class="sourceCode" id="cb1755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1755-1"><a href="ggplot2.html#cb1755-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb1755-2"><a href="ggplot2.html#cb1755-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-gap-line01b-1.png" width="672" /></p>
<p>用<code>geom_area()</code>作类似图形，
但在折线下方填充颜色：</p>
<div class="sourceCode" id="cb1756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1756-1"><a href="ggplot2.html#cb1756-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>),</span>
<span id="cb1756-2"><a href="ggplot2.html#cb1756-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1756-3"><a href="ggplot2.html#cb1756-3"></a>    <span class="dt">x =</span> year, </span>
<span id="cb1756-4"><a href="ggplot2.html#cb1756-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1756-5"><a href="ggplot2.html#cb1756-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&quot;darkseagreen1&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-gap-area01-1.png" width="672" /></p>
<p>这种图形的纵坐标应该从0开始，
使得阴影部分的大小与纵坐标值成比例，
这也是ggplot2的默认做法。</p>
<p>连线图还有一个问题，
就是如果x坐标不是数值型变量而是因子或者字符型，
则两点之间不会相连。
比如，将gapminder的Rwanda子集中的year转换成因子，再画折线图：</p>
<div class="sourceCode" id="cb1757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1757-1"><a href="ggplot2.html#cb1757-1"></a>d &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1757-2"><a href="ggplot2.html#cb1757-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1757-3"><a href="ggplot2.html#cb1757-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year, <span class="dt">levels =</span> <span class="kw">seq</span>(<span class="dv">1952</span>, <span class="dv">2007</span>, <span class="dt">by=</span><span class="dv">5</span>)))</span>
<span id="cb1757-4"><a href="ggplot2.html#cb1757-4"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1757-5"><a href="ggplot2.html#cb1757-5"></a>    <span class="dt">x =</span> year, </span>
<span id="cb1757-6"><a href="ggplot2.html#cb1757-6"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1757-7"><a href="ggplot2.html#cb1757-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<pre><code>## geom_path: Each group consists of only one observation. Do you need to adjust
## the group aesthetic?</code></pre>
<p><img src="static/picture/ggplot2-right-gap-line02-1.png" width="672" /></p>
<p>没有得到应有的结果。
这是因为因子<code>year</code>起到了分组作用，
相当于每个年份为一组，
连线只能在组内连，
但每组仅有一个观测。
这时，
显式地指定<code>group</code>变量可以解决问题：</p>
<div class="sourceCode" id="cb1759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1759-1"><a href="ggplot2.html#cb1759-1"></a>d &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1759-2"><a href="ggplot2.html#cb1759-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1759-3"><a href="ggplot2.html#cb1759-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">factor</span>(year, <span class="dt">levels =</span> <span class="kw">seq</span>(<span class="dv">1952</span>, <span class="dv">2007</span>, <span class="dt">by=</span><span class="dv">5</span>)))</span>
<span id="cb1759-4"><a href="ggplot2.html#cb1759-4"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1759-5"><a href="ggplot2.html#cb1759-5"></a>    <span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">group =</span> country))</span>
<span id="cb1759-6"><a href="ggplot2.html#cb1759-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-gap-line0b-1.png" width="672" /></p>
<p>对于折线图，
可以在<code>geom_line()</code>函数中用<code>color</code>参数指定颜色，
用<code>linetype</code>参数指定线型，
用<code>size</code>参数指定以毫米为单位的粗细。
线型包括：</p>
<ul>
<li>0：不画线；</li>
<li>1：实线；</li>
<li>2：dashed；</li>
<li>3：dotted；</li>
<li>4：dotdash；</li>
<li>5：longdash；</li>
<li>6：twodash。</li>
</ul>
<div id="ggplot2-right-group-listtib" class="section level4">
<h4><span class="header-section-number">29.4.1.1</span> 找出期望寿命增长不稳定的国家</h4>
<p>我们编程找出寿命增长不稳定的国家。
这部分内容与作图关系不大，可以跳过。
对每个国家做线性回归，
以期望寿命为因变量，
以年份为自变量，
找出残差方差很大的，以及直线斜率为负的国家。</p>
<div class="sourceCode" id="cb1760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1760-1"><a href="ggplot2.html#cb1760-1"></a>extract_lmr &lt;-<span class="st"> </span><span class="cf">function</span>(lmr){</span>
<span id="cb1760-2"><a href="ggplot2.html#cb1760-2"></a>  summ =<span class="st"> </span><span class="kw">summary</span>(lmr)</span>
<span id="cb1760-3"><a href="ggplot2.html#cb1760-3"></a>  <span class="kw">tibble</span>(</span>
<span id="cb1760-4"><a href="ggplot2.html#cb1760-4"></a>    <span class="dt">sigma =</span> summ<span class="op">$</span>sigma,</span>
<span id="cb1760-5"><a href="ggplot2.html#cb1760-5"></a>    <span class="dt">rate =</span> lmr<span class="op">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb1760-6"><a href="ggplot2.html#cb1760-6"></a>  )</span>
<span id="cb1760-7"><a href="ggplot2.html#cb1760-7"></a>}</span>
<span id="cb1760-8"><a href="ggplot2.html#cb1760-8"></a></span>
<span id="cb1760-9"><a href="ggplot2.html#cb1760-9"></a>lmres &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1760-10"><a href="ggplot2.html#cb1760-10"></a><span class="st">  </span><span class="kw">select</span>(country, year, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb1760-11"><a href="ggplot2.html#cb1760-11"></a><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></span>
<span id="cb1760-12"><a href="ggplot2.html#cb1760-12"></a><span class="st">  </span><span class="kw">nest</span>(<span class="dt">data =</span> <span class="kw">c</span>(year, lifeExp)) <span class="op">%&gt;%</span></span>
<span id="cb1760-13"><a href="ggplot2.html#cb1760-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lmr =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span>year, <span class="dt">data =</span> .x))) <span class="op">%&gt;%</span></span>
<span id="cb1760-14"><a href="ggplot2.html#cb1760-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">info =</span> <span class="kw">map</span>(lmr, extract_lmr)) <span class="op">%&gt;%</span></span>
<span id="cb1760-15"><a href="ggplot2.html#cb1760-15"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data, <span class="op">-</span>lmr) <span class="op">%&gt;%</span></span>
<span id="cb1760-16"><a href="ggplot2.html#cb1760-16"></a><span class="st">  </span><span class="kw">unnest</span>(info) <span class="op">%&gt;%</span></span>
<span id="cb1760-17"><a href="ggplot2.html#cb1760-17"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(sigma))</span>
<span id="cb1760-18"><a href="ggplot2.html#cb1760-18"></a><span class="kw">summary</span>(lmres)</span></code></pre></div>
<pre><code>##         country        sigma             rate         
##  Afghanistan:  1   Min.   :0.2118   Min.   :-0.09302  
##  Albania    :  1   1st Qu.:0.7111   1st Qu.: 0.20832  
##  Algeria    :  1   Median :1.2843   Median : 0.32145  
##  Angola     :  1   Mean   :1.6587   Mean   : 0.32590  
##  Argentina  :  1   3rd Qu.:1.9272   3rd Qu.: 0.44948  
##  Australia  :  1   Max.   :7.2054   Max.   : 0.77218  
##  (Other)    :136</code></pre>
<div class="sourceCode" id="cb1762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1762-1"><a href="ggplot2.html#cb1762-1"></a><span class="kw">head</span>(lmres, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
## # Groups:   country [10]
##    country      sigma    rate
##    &lt;fct&gt;        &lt;dbl&gt;   &lt;dbl&gt;
##  1 Zimbabwe      7.21 -0.0930
##  2 Swaziland     6.64  0.0951
##  3 Rwanda        6.56 -0.0458
##  4 Botswana      6.11  0.0607
##  5 Lesotho       5.93  0.0956
##  6 Cambodia      5.63  0.396 
##  7 Namibia       4.96  0.231 
##  8 South Africa  4.74  0.169 
##  9 Zambia        4.53 -0.0604
## 10 Kenya         4.38  0.207</code></pre>
<p>这些排名靠前的国家都是期望寿命增长不稳定的。</p>
</div>
</div>
<div id="ggplot2-right-facet" class="section level3">
<h3><span class="header-section-number">29.4.2</span> 小图(facet)</h3>
<p>前面所有国家的图包含了过多的曲线，
使得图形表现得很拥挤。
可以将一个作图区域拆分成若干个小块，
称为小图（facet），
按照某一个或两个分类变量的不同值将数据分为若干个子集，
每个数据子集分别在小图上作图。</p>
<p>对于上面的例子，
可以将每个大洲的图形分别放置在一个小图上。
小图不是一种变量映射，
而是一种图形摆放方法，
所以不设置在<code>aes()</code>函数内，
而是用<code>facet_wrap()</code>函数规定。
这种功能与<code>group</code>映射的功能有些重复，
所以有时需要与<code>group</code>映射配合使用，
有时则不需要。
程序如：</p>
<div class="sourceCode" id="cb1764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1764-1"><a href="ggplot2.html#cb1764-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</span>
<span id="cb1764-2"><a href="ggplot2.html#cb1764-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1764-3"><a href="ggplot2.html#cb1764-3"></a>    <span class="dt">x =</span> year, </span>
<span id="cb1764-4"><a href="ggplot2.html#cb1764-4"></a>    <span class="dt">y =</span> lifeExp,</span>
<span id="cb1764-5"><a href="ggplot2.html#cb1764-5"></a>    <span class="dt">group =</span> country))</span>
<span id="cb1764-6"><a href="ggplot2.html#cb1764-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-facet01-1.png" width="672" /></p>
<p>区分不同小图的标签写在每个小图的上方。
可以用<code>facet_wrap()</code>参数<code>strip_position</code>和参数<code>switch</code>调整标签的上下左右。</p>
<p>小图之间默认公用了横坐标和纵坐标且坐标范围保持一致。
如果不保持一致，
读者可能会有误解。
但是x轴或y轴映射为分类变量且不同小图的分类完全不同时，
可以令各小图中该轴的取值不统一。
<code>facet_wrap()</code>选项<code>scales</code>默认为<code>"fixed"</code>，
即所有小图的x轴、y轴都范围一致，
取<code>"free_x"</code>则允许各小图的x轴不统一，
<code>"free_y"</code>允许各小图的y轴不统一，
<code>"free"</code>允许各小图的x轴和y轴都不统一。</p>
<p>在<code>facet_wrap()</code>中可以用<code>ncol</code>参数指定小图的列数，
用<code>nrow</code>指定小图的行数。
各个小图的次序应该设定为一定的合理次序，
比如用来分类的变量本身有序，
或者令各小图中的数据值有一定的增减次序。</p>
<p>下面的程序将曲线颜色变浅，
对每个大洲增加了拟合曲线，
增加了适当的标题和坐标轴标签。
注意，这时不能使用统一的<code>group = country</code>映射，
否则拟合曲线就是对每个国家都单独有一条拟合曲线，
而不是每幅小图中仅有一条拟合曲线。
办法是仅在<code>geom_line()</code>中给出<code>group = country</code>的映射，
但在<code>geom_smooth()</code>中则不用<code>group</code>维。
程序如下：</p>
<div class="sourceCode" id="cb1765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1765-1"><a href="ggplot2.html#cb1765-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</span>
<span id="cb1765-2"><a href="ggplot2.html#cb1765-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1765-3"><a href="ggplot2.html#cb1765-3"></a>    <span class="dt">x =</span> year, </span>
<span id="cb1765-4"><a href="ggplot2.html#cb1765-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1765-5"><a href="ggplot2.html#cb1765-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">color =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb1765-6"><a href="ggplot2.html#cb1765-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">color=</span><span class="st">&quot;cyan&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="fl">1.1</span>) <span class="op">+</span></span>
<span id="cb1765-7"><a href="ggplot2.html#cb1765-7"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent, <span class="dt">ncol =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1765-8"><a href="ggplot2.html#cb1765-8"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1765-9"><a href="ggplot2.html#cb1765-9"></a>    <span class="dt">x =</span> <span class="st">&quot;年份&quot;</span>,</span>
<span id="cb1765-10"><a href="ggplot2.html#cb1765-10"></a>    <span class="dt">y =</span> <span class="st">&quot;期望寿命&quot;</span>,</span>
<span id="cb1765-11"><a href="ggplot2.html#cb1765-11"></a>    <span class="dt">title =</span> <span class="st">&quot;五个大洲各国期望寿命变化趋势&quot;</span></span>
<span id="cb1765-12"><a href="ggplot2.html#cb1765-12"></a>    )</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-right-facet01b-1.png" width="672" /></p>
<p>注意<code>group = country</code>的设置从<code>ggplot()</code>函数中转移到了<code>geom_line()</code>函数中，
否则就意味着拟合线也需要按照国家分组，
而不是按大洲分组。</p>
<p><code>facet_wrap()</code>主要适用于按照一个分类变量的值将不同观测在不同小图中表现，
可以人为指定小图的行数和列数。
如果需要按照两个分类变量交叉分组分配小图，
可以用<code>facet_grid()</code>函数。</p>
<p>例如，
对<code>gss_sm</code>数据集，作小孩个数对年龄的散点图：</p>
<div class="sourceCode" id="cb1767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1767-1"><a href="ggplot2.html#cb1767-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gss_sm,</span>
<span id="cb1767-2"><a href="ggplot2.html#cb1767-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1767-3"><a href="ggplot2.html#cb1767-3"></a>    <span class="dt">x =</span> age,</span>
<span id="cb1767-4"><a href="ggplot2.html#cb1767-4"></a>    <span class="dt">y =</span> childs))</span>
<span id="cb1767-5"><a href="ggplot2.html#cb1767-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-right-facet-gss01-1.png" width="672" /></p>
<p>有过多的重叠点。
将观测按照性别(sex)和种族(race)交叉分组，
分配到不同的小图上：</p>
<div class="sourceCode" id="cb1769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1769-1"><a href="ggplot2.html#cb1769-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb1769-2"><a href="ggplot2.html#cb1769-2"></a><span class="st">  </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>race)</span></code></pre></div>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-right-facet-gss01b-1.png" width="672" /></p>
<p>交叉分组时作小图时，
<code>sex ~ race</code>这种写法使得不同性别对应到不同行，
不同种族对应到不同列。
在图形中增加拟合曲线：</p>
<div class="sourceCode" id="cb1771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1771-1"><a href="ggplot2.html#cb1771-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb1771-2"><a href="ggplot2.html#cb1771-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb1771-3"><a href="ggplot2.html#cb1771-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>race)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 18 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-right-facet-gss01c-1.png" width="672" /></p>
<p>这里虽然没有映射<code>group</code>维，
但还是按性别和种族对数据集分成了6个子集，
每个小图中仅有一个自己的数据。</p>
</div>
</div>
<div id="ggplot2-bar-trans" class="section level2">
<h2><span class="header-section-number">29.5</span> 数据变换与条形图</h2>
<p>有些<code>geom_xxx()</code>函数直接按照数据值作图，
如<code>geom_point()</code>、<code>geom_line()</code>，
而<code>geom_smooth()</code>这样的函数则会按照某种算法计算并对计算结果作图。
<code>geom_xxx()</code>都有默认的<code>stat_xxx()</code>函数用来计算，
也可以人为指定不同的统计规则。</p>
<p>考虑条形图的例子。
ggplot2中的条形图函数<code>geom_bar()</code>可以对一个分类变量自动统计频数，
并作频数条形图。
比如对<code>gss_sm</code>数据集的bigregion变量作频数条形图：</p>
<div class="sourceCode" id="cb1775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1775-1"><a href="ggplot2.html#cb1775-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gss_sm,</span>
<span id="cb1775-2"><a href="ggplot2.html#cb1775-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> bigregion))</span>
<span id="cb1775-3"><a href="ggplot2.html#cb1775-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-gss01-1.png" width="672" /></p>
<p>结果是每个大区的受访者人数的条形图。
图形中<code>x</code>映射是用户指定的，
而<code>y</code>轴则是自动计算的频数。
实际上，
<code>geom_bar()</code>自动调用了统计函数<code>stat_freq()</code>对每个大区计算频数，
生成新变量<code>count</code>和<code>prop</code>。
<code>geom_bar()</code>默认使用<code>count</code>(频数)。</p>
<p>虽然ggplot2能够自动统计频数，
但最好还是预先统计好频数，
仅用ggplot2绘图。
所以，上例可以用tidyverse的<code>count</code>和ggplot2的<code>geom_col</code>改写成：</p>
<div class="sourceCode" id="cb1776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1776-1"><a href="ggplot2.html#cb1776-1"></a>df1 &lt;-<span class="st"> </span>gss_sm <span class="op">%&gt;%</span></span>
<span id="cb1776-2"><a href="ggplot2.html#cb1776-2"></a><span class="st">  </span><span class="kw">select</span>(bigregion) <span class="op">%&gt;%</span></span>
<span id="cb1776-3"><a href="ggplot2.html#cb1776-3"></a><span class="st">  </span><span class="kw">count</span>(bigregion) <span class="op">%&gt;%</span></span>
<span id="cb1776-4"><a href="ggplot2.html#cb1776-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ratio =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</span>
<span id="cb1776-5"><a href="ggplot2.html#cb1776-5"></a></span>
<span id="cb1776-6"><a href="ggplot2.html#cb1776-6"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df1,</span>
<span id="cb1776-7"><a href="ggplot2.html#cb1776-7"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> bigregion, <span class="dt">y =</span> n))</span>
<span id="cb1776-8"><a href="ggplot2.html#cb1776-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1776-9"><a href="ggplot2.html#cb1776-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-gss02-1.png" width="672" /></p>
<p>下面的程序将纵坐标改成了比例：</p>
<div class="sourceCode" id="cb1777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1777-1"><a href="ggplot2.html#cb1777-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df1,</span>
<span id="cb1777-2"><a href="ggplot2.html#cb1777-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> bigregion, <span class="dt">y =</span> ratio))</span>
<span id="cb1777-3"><a href="ggplot2.html#cb1777-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1777-4"><a href="ggplot2.html#cb1777-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Ratio&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-gss02b-1.png" width="672" /></p>
<p>下面的例子作<code>gss_sm</code>数据集中<code>religion</code>变量的频数条形图，
并给不同的条形自动分配不同的颜色，
方法是指定<code>fill = religion</code>：</p>
<div class="sourceCode" id="cb1778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1778-1"><a href="ggplot2.html#cb1778-1"></a>df2 &lt;-<span class="st"> </span>gss_sm <span class="op">%&gt;%</span></span>
<span id="cb1778-2"><a href="ggplot2.html#cb1778-2"></a><span class="st">  </span><span class="kw">select</span>(religion) <span class="op">%&gt;%</span></span>
<span id="cb1778-3"><a href="ggplot2.html#cb1778-3"></a><span class="st">  </span><span class="kw">count</span>(religion)</span></code></pre></div>
<pre><code>## Warning: Factor `religion` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<div class="sourceCode" id="cb1780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1780-1"><a href="ggplot2.html#cb1780-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df2,</span>
<span id="cb1780-2"><a href="ggplot2.html#cb1780-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1780-3"><a href="ggplot2.html#cb1780-3"></a>    <span class="dt">x =</span> religion, </span>
<span id="cb1780-4"><a href="ggplot2.html#cb1780-4"></a>    <span class="dt">y =</span> n, </span>
<span id="cb1780-5"><a href="ggplot2.html#cb1780-5"></a>    <span class="dt">fill =</span> religion))</span>
<span id="cb1780-6"><a href="ggplot2.html#cb1780-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1780-7"><a href="ggplot2.html#cb1780-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-gss03-1.png" width="672" /></p>
<p>因为将<code>religion</code>同时映射到<code>x</code>维与<code>fill</code>维，
所以对应<code>fill</code>维在图形右侧出现了图例，
这是多余的。
调用<code>guides(fill = FALSE)</code>可以人为指定不做关于填充色的图例：</p>
<div class="sourceCode" id="cb1781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1781-1"><a href="ggplot2.html#cb1781-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1781-2"><a href="ggplot2.html#cb1781-2"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb1781-3"><a href="ggplot2.html#cb1781-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-gss03b-1.png" width="672" /></p>
<p>从可视化理论的角度看，
上图中的不同颜色是多余的，
用同一颜色更能强度数据本身。</p>
<div id="ggplot2-right-morebar" class="section level3">
<h3><span class="header-section-number">29.5.1</span> 分段与并列条形图</h3>
<p>上面的条形图展现了单个分类变量的频数分布。
两个分类变量的交叉频数分布可以用分段条形图或者并列条形图表现。</p>
<p>例如，对<code>gss_sm</code>数据集，
按照bigregion分组计算频数，
每组内再按照religion计算频数，
用tidyverse统计后作图如下：</p>
<div class="sourceCode" id="cb1782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1782-1"><a href="ggplot2.html#cb1782-1"></a>df3 &lt;-<span class="st"> </span>gss_sm <span class="op">%&gt;%</span></span>
<span id="cb1782-2"><a href="ggplot2.html#cb1782-2"></a><span class="st">  </span><span class="kw">select</span>(bigregion, religion) <span class="op">%&gt;%</span></span>
<span id="cb1782-3"><a href="ggplot2.html#cb1782-3"></a><span class="st">  </span><span class="kw">group_by</span>(bigregion, religion) <span class="op">%&gt;%</span></span>
<span id="cb1782-4"><a href="ggplot2.html#cb1782-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb1782-5"><a href="ggplot2.html#cb1782-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ratio =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span></span>
<span id="cb1782-6"><a href="ggplot2.html#cb1782-6"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## Warning: Factor `religion` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<div class="sourceCode" id="cb1784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1784-1"><a href="ggplot2.html#cb1784-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df3,</span>
<span id="cb1784-2"><a href="ggplot2.html#cb1784-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1784-3"><a href="ggplot2.html#cb1784-3"></a>    <span class="dt">x =</span> bigregion, </span>
<span id="cb1784-4"><a href="ggplot2.html#cb1784-4"></a>    <span class="dt">y =</span> n,</span>
<span id="cb1784-5"><a href="ggplot2.html#cb1784-5"></a>    <span class="dt">fill =</span> religion))</span>
<span id="cb1784-6"><a href="ggplot2.html#cb1784-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-barseg-gss01-1.png" width="672" /></p>
<p>这样的图形可以很容易地比较大类(这里是bigregion)的频数比例，
但大类内的小类(这里是religion)可以比较容易地在大类内部比较，
但是在大类之间比较则较困难。
如果仅有两个小类，
则小类在大类之间的比较也没有问题。</p>
<p>另一种做法是将大类的高度拉平，
图形仅表示每一大类内部小类的比例，
没有大类频数信息，
也不能比较两个大类之间的小类频数，
但可以大致地在大类之间比较小类的比例：</p>
<div class="sourceCode" id="cb1785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1785-1"><a href="ggplot2.html#cb1785-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1785-2"><a href="ggplot2.html#cb1785-2"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-barseg-gss01b-1.png" width="672" /></p>
<p>上面的程序在<code>geom_col()</code>中用了<code>position = "fill"</code>选项。</p>
<p>并排的条形图可以表现每个交叉类的频数，
可以比较容易地比较每个大类内部的小类比例以及小类的频数，
但是不容易比较大类的比例：</p>
<div class="sourceCode" id="cb1786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1786-1"><a href="ggplot2.html#cb1786-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-barseg-gss01c-1.png" width="672" /></p>
<p>将上图中的纵轴改为大类内的比例（每个大区的比例之和等于1）：</p>
<div class="sourceCode" id="cb1787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1787-1"><a href="ggplot2.html#cb1787-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df3,</span>
<span id="cb1787-2"><a href="ggplot2.html#cb1787-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1787-3"><a href="ggplot2.html#cb1787-3"></a>    <span class="dt">x =</span> bigregion, </span>
<span id="cb1787-4"><a href="ggplot2.html#cb1787-4"></a>    <span class="dt">y =</span> ratio,</span>
<span id="cb1787-5"><a href="ggplot2.html#cb1787-5"></a>    <span class="dt">fill =</span> religion))</span>
<span id="cb1787-6"><a href="ggplot2.html#cb1787-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-barseg-gss01d-1.png" width="672" /></p>
<p>为了在不同大区之间比较宗教比例分布，
可以借助于小图，
将每个大区分配到一个小图：</p>
<div class="sourceCode" id="cb1788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1788-1"><a href="ggplot2.html#cb1788-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df3, </span>
<span id="cb1788-2"><a href="ggplot2.html#cb1788-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> religion, <span class="dt">y =</span> ratio, <span class="dt">fill=</span>religion))</span>
<span id="cb1788-3"><a href="ggplot2.html#cb1788-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb1788-4"><a href="ggplot2.html#cb1788-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="ot">NULL</span>, <span class="dt">y=</span><span class="st">&quot;比例&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1788-5"><a href="ggplot2.html#cb1788-5"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1788-6"><a href="ggplot2.html#cb1788-6"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span><span class="st"> </span>bigregion) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1788-7"><a href="ggplot2.html#cb1788-7"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-barseg-gss02-1.png" width="672" /></p>
<p>有时用来绘图的数据已经是一个频数表，
比如泰坦尼克号乘客生存与性别的频数表：</p>
<div class="sourceCode" id="cb1789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1789-1"><a href="ggplot2.html#cb1789-1"></a>titanic</span></code></pre></div>
<pre><code>##       fate    sex    n percent
## 1 perished   male 1364    62.0
## 2 perished female  126     5.7
## 3 survived   male  367    16.7
## 4 survived female  344    15.6</code></pre>
<p>这是一个长表格式的列联表，
对于<code>table()</code>生成的列联表可以用<code>as.data.frame</code>将其转换为长表格式。</p>
<p>作fate为大组的sex的并排条形图：</p>
<div class="sourceCode" id="cb1791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1791-1"><a href="ggplot2.html#cb1791-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>titanic, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1791-2"><a href="ggplot2.html#cb1791-2"></a>  <span class="dt">x =</span> fate, <span class="dt">y =</span> n, <span class="dt">fill =</span> sex))</span>
<span id="cb1791-3"><a href="ggplot2.html#cb1791-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-titanic02-1.png" width="672" /></p>
<p>也可以按照性别分成大组：</p>
<div class="sourceCode" id="cb1792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1792-1"><a href="ggplot2.html#cb1792-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>titanic, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1792-2"><a href="ggplot2.html#cb1792-2"></a>  <span class="dt">x =</span> sex, <span class="dt">y =</span> n, <span class="dt">fill =</span> fate))</span>
<span id="cb1792-3"><a href="ggplot2.html#cb1792-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-titanic03-1.png" width="672" /></p>
<p>用<code>theme()</code>函数的<code>legend.position</code>参数可以指定图例的位置，如：</p>
<div class="sourceCode" id="cb1793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1793-1"><a href="ggplot2.html#cb1793-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb1793-2"><a href="ggplot2.html#cb1793-2"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-titanic03b-1.png" width="672" /></p>
<p>做成堆叠形式：</p>
<div class="sourceCode" id="cb1794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1794-1"><a href="ggplot2.html#cb1794-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-titanic03c-1.png" width="672" /></p>
<p><code>position = "stack"</code>也是<code>geom_col()</code>函数的默认选项。</p>
<p>实际上，
还可以用适当程序将存亡状态以及频数直接标在条形的色块内，
<code>geom_text()</code>函数可以在指定坐标位置标注指定的文字标签，
见<a href="ggplot2.html#ggplot2-moregeom-text">29.8.2</a>。</p>
<p>datasets包的Titanic数据集包含了泰坦尼克号乘客更详细的信息。
我们按照存亡结果和舱位等级分小图作男女频数条形图：</p>
<div class="sourceCode" id="cb1795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1795-1"><a href="ggplot2.html#cb1795-1"></a>titanic2 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Titanic) <span class="op">%&gt;%</span></span>
<span id="cb1795-2"><a href="ggplot2.html#cb1795-2"></a><span class="st">  </span><span class="kw">group_by</span>(Class, Sex, Survived) <span class="op">%&gt;%</span></span>
<span id="cb1795-3"><a href="ggplot2.html#cb1795-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">sum</span>(Freq)) <span class="op">%&gt;%</span></span>
<span id="cb1795-4"><a href="ggplot2.html#cb1795-4"></a><span class="st">  </span><span class="kw">filter</span>(Class <span class="op">!=</span><span class="st"> &quot;Crew&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1795-5"><a href="ggplot2.html#cb1795-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Survived =</span> <span class="kw">factor</span>(</span>
<span id="cb1795-6"><a href="ggplot2.html#cb1795-6"></a>    Survived, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>), </span>
<span id="cb1795-7"><a href="ggplot2.html#cb1795-7"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;survived&quot;</span>, <span class="st">&quot;perished&quot;</span>)))</span>
<span id="cb1795-8"><a href="ggplot2.html#cb1795-8"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> titanic2, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1795-9"><a href="ggplot2.html#cb1795-9"></a>  <span class="dt">x =</span> Sex, <span class="dt">y =</span> n, <span class="dt">fill =</span> Sex))</span>
<span id="cb1795-10"><a href="ggplot2.html#cb1795-10"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1795-11"><a href="ggplot2.html#cb1795-11"></a><span class="st">  </span><span class="kw">facet_grid</span>(Class <span class="op">~</span><span class="st"> </span>Survived) <span class="op">+</span></span>
<span id="cb1795-12"><a href="ggplot2.html#cb1795-12"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-bar-titanic04-1.png" width="672" /></p>
<p>这里将<code>fill</code>映射到了Sex，
使得表示男女的条形填充了不同的颜色。
如果不满意上面的颜色，
可以用<code>scale_fill_manual()</code>函数人为地指定颜色、对应离散值和图例标签。
R扩展包colourpicker提供了很好交互图形界面用来挑选颜色。</p>
</div>
<div id="ggplot2-bar-morebar" class="section level3">
<h3><span class="header-section-number">29.5.2</span> 条形图的其它应用</h3>
<p><code>geom_col()</code>不仅限于画频数或者比例的条形图，
此函数可以将一般用折线图表现的内容画成条形图，
但一定要注意一点：y坐标轴必须从0开始，
这也是<code>geom_col()</code>和<code>geom_bar()</code>函数默认的设置。
如果坐标轴不从零开始，
则条形的长度就不能正确表示对应的y变量数值。</p>
<p>举一个用条形图表示不是频数和比例的量的例子。
socviz包的<code>oecd_sum</code>数据集包含各年的美国以及OECD国家的期望寿命：</p>
<div class="sourceCode" id="cb1796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1796-1"><a href="ggplot2.html#cb1796-1"></a>oecd_sum</span></code></pre></div>
<pre><code>## # A tibble: 57 x 5
## # Groups:   year [57]
##     year other   usa  diff hi_lo
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1  1960  68.6  69.9 1.3   Below
##  2  1961  69.2  70.4 1.2   Below
##  3  1962  68.9  70.2 1.30  Below
##  4  1963  69.1  70   0.9   Below
##  5  1964  69.5  70.3 0.800 Below
##  6  1965  69.6  70.3 0.7   Below
##  7  1966  69.9  70.3 0.400 Below
##  8  1967  70.1  70.7 0.6   Below
##  9  1968  70.1  70.4 0.3   Below
## 10  1969  70.1  70.6 0.5   Below
## # ... with 47 more rows</code></pre>
<p>我们用<code>geom_col()</code>作<code>diff</code>变量的条形图，
并按照<code>hi_lo</code>变量对正负差值分别使用不同颜色：</p>
<div class="sourceCode" id="cb1798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1798-1"><a href="ggplot2.html#cb1798-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> oecd_sum,</span>
<span id="cb1798-2"><a href="ggplot2.html#cb1798-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1798-3"><a href="ggplot2.html#cb1798-3"></a>      <span class="dt">x =</span> year, </span>
<span id="cb1798-4"><a href="ggplot2.html#cb1798-4"></a>      <span class="dt">y =</span> diff,</span>
<span id="cb1798-5"><a href="ggplot2.html#cb1798-5"></a>      <span class="dt">fill =</span> hi_lo))</span>
<span id="cb1798-6"><a href="ggplot2.html#cb1798-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1798-7"><a href="ggplot2.html#cb1798-7"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span><span class="co"># 正负号的不同颜色不使用图例标注</span></span>
<span id="cb1798-8"><a href="ggplot2.html#cb1798-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>,</span>
<span id="cb1798-9"><a href="ggplot2.html#cb1798-9"></a>       <span class="dt">y =</span> <span class="st">&quot;期望寿命差值&quot;</span>,</span>
<span id="cb1798-10"><a href="ggplot2.html#cb1798-10"></a>       <span class="dt">title =</span> <span class="st">&quot;美国期望寿命差值&quot;</span>,</span>
<span id="cb1798-11"><a href="ggplot2.html#cb1798-11"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;1960-2015年美国与OECD国家期望寿命差值&quot;</span>,</span>
<span id="cb1798-12"><a href="ggplot2.html#cb1798-12"></a>       <span class="dt">caption=</span><span class="st">&quot;来自socviz扩展包&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (position_stack).</code></pre>
<p><img src="static/picture/ggplot2-right-bar-oecd02-1.png" width="672" /></p>
</div>
</div>
<div id="ggplot2-hist" class="section level2">
<h2><span class="header-section-number">29.6</span> 直方图与密度估计</h2>
<p>条形图(barplot)反映分类变量的频数分布或者比例，
直方图(histogram)反映连续取值的数值变量的分布。
<code>geom_histogram()</code>作直方图，
可以自动选取合适的分组个数，
也可以人为指定分组个数。</p>
<p>ggplot2包中的<code>midwest</code>数据集包含了美国中西部的一些县的统计数据，
如面积（单位：平方英里）。
下面的程序对连续取值的数值型变量area作频数直方图，
自动确定分组个数：</p>
<div class="sourceCode" id="cb1800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1800-1"><a href="ggplot2.html#cb1800-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest,</span>
<span id="cb1800-2"><a href="ggplot2.html#cb1800-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> area))</span>
<span id="cb1800-3"><a href="ggplot2.html#cb1800-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggplot2-right-hist-midwest01-1.png" width="672" /></p>
<p>上面图形的纵坐标是频数(count)，是每个组的频数。
<code>geom_histogram()</code>默认调用<code>stat_bin()</code>进行分组及频数统计。
直方图的形状比较依赖于分组数与分组起始点位置，
可以用<code>bins</code>参数控制分组数，
用<code>binwidth</code>参数控制分组宽度，
用<code>center</code>或者<code>boundary</code>参数控制组中心或者组边界对齐位置，
如：</p>
<div class="sourceCode" id="cb1802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1802-1"><a href="ggplot2.html#cb1802-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-hist-midwest01b-1.png" width="672" /></p>
<p>可以利用<code>fill</code>映射将构成直方图的观测按照某个分类变量分组，
然后每个条形内部按照该分类变量的值分段染色，
段内各颜色的长度代表该条形所在组某一类的频数，
如：</p>
<div class="sourceCode" id="cb1803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1803-1"><a href="ggplot2.html#cb1803-1"></a>midwest_sub &lt;-<span class="st"> </span>midwest <span class="op">%&gt;%</span></span>
<span id="cb1803-2"><a href="ggplot2.html#cb1803-2"></a><span class="st">  </span><span class="kw">filter</span>(state <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OH&quot;</span>, <span class="st">&quot;WI&quot;</span>))</span>
<span id="cb1803-3"><a href="ggplot2.html#cb1803-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>midwest_sub,</span>
<span id="cb1803-4"><a href="ggplot2.html#cb1803-4"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> area, <span class="dt">fill =</span> state))</span>
<span id="cb1803-5"><a href="ggplot2.html#cb1803-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-hist-midwest02-1.png" width="672" /></p>
<p>可见面积较小的县主要来自OH州，
面积较大的县主要来自WI州。</p>
<p><code>geom_density()</code>可以对连续变量绘制密度估计曲线，如：</p>
<div class="sourceCode" id="cb1804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1804-1"><a href="ggplot2.html#cb1804-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest,</span>
<span id="cb1804-2"><a href="ggplot2.html#cb1804-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> area))</span>
<span id="cb1804-3"><a href="ggplot2.html#cb1804-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-hist-midwest03-1.png" width="672" /></p>
<p>下面的程序写法制作每个州的各县的面积密度估计，
画在同一坐标系中：</p>
<div class="sourceCode" id="cb1805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1805-1"><a href="ggplot2.html#cb1805-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest,</span>
<span id="cb1805-2"><a href="ggplot2.html#cb1805-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1805-3"><a href="ggplot2.html#cb1805-3"></a>      <span class="dt">x =</span> area, </span>
<span id="cb1805-4"><a href="ggplot2.html#cb1805-4"></a>      <span class="dt">color =</span> state,</span>
<span id="cb1805-5"><a href="ggplot2.html#cb1805-5"></a>      <span class="dt">fill =</span> state))</span>
<span id="cb1805-6"><a href="ggplot2.html#cb1805-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-hist-midwest04-1.png" width="672" /></p>
<p>可以看出，IN与MI州各县的面积偏小。
WI州各县的面积较大。</p>
<p>上面的图形可以借助于<code>geom_line(stat = "density")</code>改成仅有多条曲线：</p>
<div class="sourceCode" id="cb1806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1806-1"><a href="ggplot2.html#cb1806-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest,</span>
<span id="cb1806-2"><a href="ggplot2.html#cb1806-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1806-3"><a href="ggplot2.html#cb1806-3"></a>      <span class="dt">x =</span> area, </span>
<span id="cb1806-4"><a href="ggplot2.html#cb1806-4"></a>      <span class="dt">color =</span> state))</span>
<span id="cb1806-5"><a href="ggplot2.html#cb1806-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&quot;density&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-right-hist-midwest05-1.png" width="672" /></p>
<p><code>geom_density()</code>的纵轴是密度估计。
为了能够将直方图与密度估计画在同一坐标系中，
需要将直方图的纵轴也改为密度估计，如：</p>
<div class="sourceCode" id="cb1807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1807-1"><a href="ggplot2.html#cb1807-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> midwest,</span>
<span id="cb1807-2"><a href="ggplot2.html#cb1807-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> area))</span>
<span id="cb1807-3"><a href="ggplot2.html#cb1807-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> ..density..), <span class="dt">alpha =</span> <span class="fl">0.6</span>) <span class="op">+</span></span>
<span id="cb1807-4"><a href="ggplot2.html#cb1807-4"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="fl">1.1</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="static/picture/ggplot2-right-hist-midwest06-1.png" width="672" /></p>
<p>进一步地，
<code>geom_freqpoly()</code>将直方图做成折线格式；
<code>geom_bin2d()</code>作二维的直方图，用不同颜色代表密度；
<code>geom_density_2d()</code>作二维密度估计等值线图。</p>
</div>
<div id="ggplot2-gramm" class="section level2">
<h2><span class="header-section-number">29.7</span> 绘图语法介绍</h2>
<div id="ggplot2-gramm-gramm" class="section level3">
<h3><span class="header-section-number">29.7.1</span> 绘图语法</h3>
<p>ggplot2的不仅仅是能够做一些固定格式的图形，
而是按照一种图形语法构建图形。
小图功能可以将数据集分成若干子集作多幅小图，
每幅小图中，
有可以分层，
每层有不同类型的图，
各层叠加显示在一起。
所以，分层语法作图结构如下：</p>
<ul>
<li>有一个主要的数据集，
以及从数据集变量到坐标位置、颜色、填充、大小、符号等的映射关系(aesthetics);</li>
<li>有一到多个图层，
比如散点图和平滑曲线图层，
每个图层有几何对象、必要的统计变换、位置调整，
还可以有额外的数据集以及额外的映射关系；</li>
<li>对每个映射关系有一个刻度(scaling)，
对x、y维，一般需要线性变换，偶尔用到对数变换之类的其它变换，
颜色、填充等维度需要一些复杂的对应关系。
无特殊需要时只要使用默认刻度；</li>
<li>有一个坐标系统，
如直角坐标系、极坐标系、球面坐标系等，
一般只要使用默认的坐标系统；</li>
<li>可以划分小图(facetting)。</li>
</ul>
<p>利用绘图语法既可以做出常见的统计图形，
也可以做出各种新颖的图形，
当然，
就像语法正确的语句不一定有意义，
用绘图语法做得新颖图形不一定有实际意义，
还是要按照可视化的一般原则做出能说服读者的图形。</p>
</div>
<div id="ggplot2-gramm-geoms" class="section level3">
<h3><span class="header-section-number">29.7.2</span> 图形种类</h3>
<p><code>geom_xxx()</code>提供了各种基本图形。
列表如下：</p>
<ul>
<li>基础图形：
<ul>
<li><code>geom_blank()</code>不画图，可以按映射的变量设定坐标范围；</li>
<li><code>geom_point()</code>每个观测为一个散点；</li>
<li><code>geom_hline()</code>, <code>geom_vline()</code>, <code>geom_abline()</code>画线；</li>
<li><code>geom_path()</code>每个观测提供<span class="math inline">\((x,y)\)</span>坐标，在相邻观测之间连线；</li>
<li><code>geom_ribbon()</code>需要x和ymin, ymax维，在从小到大排序后的相邻观测之间连接阴影区域；</li>
<li><code>geom_segment()</code>需要x, y和xend, yend，为每个观测画一条线段；</li>
<li><code>geom_rect()</code>需要xmin, xmax, ymin, ymax，为每个观测画一个长方形，可有填充色；</li>
<li><code>geom_polygon()</code>需要x, y，将相邻观测连续并连接成一个闭合的多边形，中间填充颜色；</li>
<li><code>geom_text()</code>需要x, y和lable，每个观测画一条文字标签。</li>
</ul></li>
<li>单变量图层：
<ul>
<li><code>geom_bar()</code>, <code>geom_col()</code>作条形图；</li>
<li><code>geom_histogram()</code>对连续变量x作直方图；</li>
<li><code>geom_density()</code>对连续变量x作一元密度估计曲线；</li>
<li><code>geom_dotplot()</code>用原点作直方图；</li>
<li><code>geom_freqpoly()</code>用折线作直方图。</li>
</ul></li>
<li>两变量图形：
<ul>
<li>两个连续变量x, y：
<ul>
<li><code>geom_point()</code>散点图；</li>
<li><code>geom_quantile()</code>拟合分位数回归曲线；</li>
<li><code>geom_rug()</code>在坐标轴处画数值对应的短须线；</li>
<li><code>geom_smooth()</code>画各种拟合曲线；</li>
<li><code>geom_text()</code>在指定的x, y位置画label给出的文字标签；</li>
</ul></li>
<li>显示二元分布:
<ul>
<li><code>geom_bin2d()</code>作长方形分块的二维直方图；</li>
<li><code>geom_density2d()</code>作二元密度估计等值线图；</li>
<li><code>geom_hex()</code>作正六边形分块的二维直方图。</li>
</ul></li>
<li>两个变量中有分类变量时：
<ul>
<li><code>geom_count()</code>：重叠点越多画点越大；</li>
<li><code>geom_jitter()</code>: 随机扰动散点位置避免重叠，数值变量有重叠时也可以用；</li>
</ul></li>
<li>一个连续变量和一个分类变量：
<ul>
<li><code>geom_col()</code>作条形图，对分类变量的每个值画一个条形，长度与连续变量值成比例；</li>
<li><code>geom_boxplot()</code>对每个类做一个盒形图；</li>
<li><code>geom_violin()</code>对每个类做一个小提琴图。</li>
</ul></li>
<li>一个时间变量和一个连续变量：
<ul>
<li><code>geom_area()</code>作阴影曲线图，曲线下方填充阴影色；</li>
<li><code>geom_line()</code>作折线图，在相邻两个时间之间连接线段；</li>
<li><code>geom_step()</code>作阶梯函数图，在相邻两个时间之间连接阶梯函数线。</li>
</ul></li>
<li>不确定性：
<ul>
<li><code>geom_crossbar()</code>对每个观测输入的x, y, ymin, ymax画中间有线的纵向条形；</li>
<li><code>geom_errbar()</code>对每个观测输入的x, ymin, ymax画纵向误差条；</li>
<li><code>geom_linerange()</code>对每个观测输入的x, ymin, ymax画一条竖线；</li>
<li><code>geom_pointrnage()</code>对每个观测输入的x, y, ymin, ymax画一条中间有点的竖线。</li>
</ul></li>
<li>地图：
<ul>
<li><code>geom_map()</code>: 用区域边界坐标数据画边界线地图。</li>
</ul></li>
</ul></li>
<li>三个变量：
<ul>
<li><code>geom_contour()</code>: 用输入的x, y, z数据画等值线图。</li>
<li><code>geom_tile()</code>用输入的x, y位置, width, height大小和指定的fill维画长方形色块填充图。</li>
<li><code>geom_raster()</code>是<code>geom_tile()</code>的长方形大小相同时的快速版本。</li>
</ul></li>
</ul>
</div>
</div>
<div id="ggplot2-moregeom" class="section level2">
<h2><span class="header-section-number">29.8</span> 更多图形种类</h2>
<div id="ggplot2-moregeom-continuousvar" class="section level3">
<h3><span class="header-section-number">29.8.1</span> 连续变量的分组图形</h3>
<p>选用socviz包的organdata数据集，
这是17个OECD国家历年的器官捐献情况以及一些其他变量的记录。
其中前6列的一些抽样数据：</p>
<div class="sourceCode" id="cb1809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1809-1"><a href="ggplot2.html#cb1809-1"></a>organdata <span class="op">%&gt;%</span></span>
<span id="cb1809-2"><a href="ggplot2.html#cb1809-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) <span class="op">%&gt;%</span></span>
<span id="cb1809-3"><a href="ggplot2.html#cb1809-3"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 6
##    country       year       donors   pop pop_dens   gdp
##    &lt;chr&gt;         &lt;date&gt;      &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 Netherlands   1992-01-01   15.1 15184    36.6  19285
##  2 Finland       NA           NA      NA    NA       NA
##  3 Denmark       1999-01-01   14.3  5322    12.4  26985
##  4 Finland       1992-01-01   19.4  5042     1.49 16943
##  5 Belgium       1999-01-01   25.2 10226    30.9  24521
##  6 Belgium       1993-01-01   21   10085    30.5  19733
##  7 Belgium       1991-01-01   21   10005    30.2  18796
##  8 United States NA           NA      NA    NA       NA
##  9 Austria       NA           NA    7678     9.16 18914
## 10 Italy         1994-01-01    7.9 57204    19.0  19903</code></pre>
<p>变量donors是每百万人中器官捐献数。
作donors对year的散点图：</p>
<div class="sourceCode" id="cb1811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1811-1"><a href="ggplot2.html#cb1811-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1811-2"><a href="ggplot2.html#cb1811-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1811-3"><a href="ggplot2.html#cb1811-3"></a>      <span class="dt">x =</span> year,</span>
<span id="cb1811-4"><a href="ggplot2.html#cb1811-4"></a>      <span class="dt">y =</span> donors))</span>
<span id="cb1811-5"><a href="ggplot2.html#cb1811-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ02-1.png" width="672" /></p>
<p>每年有多个数值，
是不同国家的捐献数。
这个图形不能反映一种时间趋势，
不太有用。</p>
<p>可以对每个国家画一条折线图：</p>
<div class="sourceCode" id="cb1813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1813-1"><a href="ggplot2.html#cb1813-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1813-2"><a href="ggplot2.html#cb1813-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1813-3"><a href="ggplot2.html#cb1813-3"></a>      <span class="dt">x =</span> year,</span>
<span id="cb1813-4"><a href="ggplot2.html#cb1813-4"></a>      <span class="dt">y =</span> donors,</span>
<span id="cb1813-5"><a href="ggplot2.html#cb1813-5"></a>      <span class="dt">color =</span> country))</span>
<span id="cb1813-6"><a href="ggplot2.html#cb1813-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 34 row(s) containing missing values (geom_path).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ03-1.png" width="672" /></p>
<p>共有17个国家，每个国家做了器官捐赠率随时间变化的折线图。
用小图的方法将其分配到不同的小图：</p>
<div class="sourceCode" id="cb1815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1815-1"><a href="ggplot2.html#cb1815-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1815-2"><a href="ggplot2.html#cb1815-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1815-3"><a href="ggplot2.html#cb1815-3"></a>      <span class="dt">x =</span> year,</span>
<span id="cb1815-4"><a href="ggplot2.html#cb1815-4"></a>      <span class="dt">y =</span> donors))</span>
<span id="cb1815-5"><a href="ggplot2.html#cb1815-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb1815-6"><a href="ggplot2.html#cb1815-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>country, <span class="dt">ncol=</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ04-1.png" width="960" /></p>
<p>用<code>geom_boxplot()</code>可以做盒形图，
能够画出连续型变量的主要分位数，表现变量分布，如：</p>
<div class="sourceCode" id="cb1817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1817-1"><a href="ggplot2.html#cb1817-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1817-2"><a href="ggplot2.html#cb1817-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> donors))</span>
<span id="cb1817-3"><a href="ggplot2.html#cb1817-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ05-1.png" width="672" /></p>
<p>这是所有国家所有年的捐献率分布情况。
类似函数还有<code>geom_violin()</code>。</p>
<p>每个国家的捐献率单独做盒形图并且放在同一坐标系中：</p>
<div class="sourceCode" id="cb1819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1819-1"><a href="ggplot2.html#cb1819-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1819-2"><a href="ggplot2.html#cb1819-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> donors, <span class="dt">x =</span> country))</span>
<span id="cb1819-3"><a href="ggplot2.html#cb1819-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ06-1.png" width="672" /></p>
<p>这个图形很好地比较了不同国家的历年捐献率的分布，
比如，
Spain的捐献率最高。
为了将图形中的各个国家按照捐献率的某个统计量排序，
可以使用stats包的<code>reorder()</code>函数，
调整因子的水平次序。
为了能够比较容易地标出国家名称，
交换x轴与y轴的作用，
如：</p>
<div class="sourceCode" id="cb1821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1821-1"><a href="ggplot2.html#cb1821-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1821-2"><a href="ggplot2.html#cb1821-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1821-3"><a href="ggplot2.html#cb1821-3"></a>      <span class="dt">y =</span> donors, </span>
<span id="cb1821-4"><a href="ggplot2.html#cb1821-4"></a>      <span class="dt">x =</span> <span class="kw">reorder</span>(country, donors, median, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)))</span>
<span id="cb1821-5"><a href="ggplot2.html#cb1821-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1821-6"><a href="ggplot2.html#cb1821-6"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1821-7"><a href="ggplot2.html#cb1821-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;捐献率(单位: 百万分之一)&quot;</span>,</span>
<span id="cb1821-8"><a href="ggplot2.html#cb1821-8"></a>       <span class="dt">x =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ07-1.png" width="672" /></p>
<p>这里盒形图是横向的，
如果仍然纵向作图，
国家名称在横轴，
许多个国家名称就会重叠在一起，
只好仅显示其中一部分名称。</p>
<p>当每组（这里是每个国家）的观测个数很少时，
也可以做成散点图，如：</p>
<div class="sourceCode" id="cb1823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1823-1"><a href="ggplot2.html#cb1823-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1823-2"><a href="ggplot2.html#cb1823-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1823-3"><a href="ggplot2.html#cb1823-3"></a>      <span class="dt">y =</span> donors, </span>
<span id="cb1823-4"><a href="ggplot2.html#cb1823-4"></a>      <span class="dt">x =</span> <span class="kw">reorder</span>(country, donors, median, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)))</span>
<span id="cb1823-5"><a href="ggplot2.html#cb1823-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1823-6"><a href="ggplot2.html#cb1823-6"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1823-7"><a href="ggplot2.html#cb1823-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;捐献率(单位: 百万分之一)&quot;</span>,</span>
<span id="cb1823-8"><a href="ggplot2.html#cb1823-8"></a>       <span class="dt">x =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ08-1.png" width="672" /></p>
<p>因为有的观测点完全重叠，
所以用了<code>alpha</code>参数指定一定的透明度，
重叠越多的点显示的颜色越深。
但是，
如果两个不同颜色的点完全重叠，
半透明不能显示两个不同颜色的效果。</p>
<p>在作这样的散点图时，
为了避免重叠的点，
可以将<code>geom_point()</code>改为<code>geom_jitter()</code>，如:</p>
<div class="sourceCode" id="cb1825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1825-1"><a href="ggplot2.html#cb1825-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1825-2"><a href="ggplot2.html#cb1825-2"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1825-3"><a href="ggplot2.html#cb1825-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;捐献率(单位: 百万分之一)&quot;</span>,</span>
<span id="cb1825-4"><a href="ggplot2.html#cb1825-4"></a>       <span class="dt">x =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ08b-1.png" width="672" /></p>
<p>上图的点的扰动过大了，
使得不同国家的区分不明显了。
作扰动的散点图时，
可以用<code>width</code>指定左右扰动范围，
用<code>height</code>指定上下扰动范围，
这里只需要指定左右扰动范围，
因为坐标轴对调所以就变成了上下扰动：</p>
<div class="sourceCode" id="cb1827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1827-1"><a href="ggplot2.html#cb1827-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">height =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1827-2"><a href="ggplot2.html#cb1827-2"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1827-3"><a href="ggplot2.html#cb1827-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;捐献率(单位: 百万分之一)&quot;</span>,</span>
<span id="cb1827-4"><a href="ggplot2.html#cb1827-4"></a>       <span class="dt">x =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ08c-1.png" width="672" /></p>
<p><code>geom_boxplot()</code>也支持<code>color</code>, <code>fill</code>维度。
organdata中的变量<code>world</code>是一个国家的福利类型，
用不同填充色表示<code>world</code>变量：</p>
<div class="sourceCode" id="cb1829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1829-1"><a href="ggplot2.html#cb1829-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1829-2"><a href="ggplot2.html#cb1829-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1829-3"><a href="ggplot2.html#cb1829-3"></a>      <span class="dt">y =</span> donors, </span>
<span id="cb1829-4"><a href="ggplot2.html#cb1829-4"></a>      <span class="dt">x =</span> <span class="kw">reorder</span>(country, donors, median, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb1829-5"><a href="ggplot2.html#cb1829-5"></a>      <span class="dt">fill =</span> world))</span>
<span id="cb1829-6"><a href="ggplot2.html#cb1829-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1829-7"><a href="ggplot2.html#cb1829-7"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1829-8"><a href="ggplot2.html#cb1829-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;捐献率(单位: 百万分之一)&quot;</span>,</span>
<span id="cb1829-9"><a href="ggplot2.html#cb1829-9"></a>       <span class="dt">x =</span> <span class="ot">NULL</span>,</span>
<span id="cb1829-10"><a href="ggplot2.html#cb1829-10"></a>       <span class="dt">fill =</span> <span class="st">&quot;福利类型&quot;</span>) <span class="op">+</span></span>
<span id="cb1829-11"><a href="ggplot2.html#cb1829-11"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="static/picture/ggplot2-moregeo-organ09-1.png" width="672" /></p>
<p>下面做不同国家的平均捐赠率的图形。
首先得到统计数据：</p>
<div class="sourceCode" id="cb1831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1831-1"><a href="ggplot2.html#cb1831-1"></a>organdata2 &lt;-<span class="st"> </span>organdata <span class="op">%&gt;%</span></span>
<span id="cb1831-2"><a href="ggplot2.html#cb1831-2"></a><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></span>
<span id="cb1831-3"><a href="ggplot2.html#cb1831-3"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb1831-4"><a href="ggplot2.html#cb1831-4"></a>    <span class="dt">donors_n =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(donors)),</span>
<span id="cb1831-5"><a href="ggplot2.html#cb1831-5"></a>    <span class="dt">donors_mean =</span> <span class="kw">mean</span>(donors, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb1831-6"><a href="ggplot2.html#cb1831-6"></a>    <span class="dt">donors_sd =</span> <span class="kw">sd</span>(donors, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb1831-7"><a href="ggplot2.html#cb1831-7"></a>    <span class="dt">donors_se =</span> donors_sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(donors_n))</span>
<span id="cb1831-8"><a href="ggplot2.html#cb1831-8"></a>organdata2</span></code></pre></div>
<pre><code>## # A tibble: 17 x 5
##    country        donors_n donors_mean donors_sd donors_se
##    &lt;chr&gt;             &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Australia            12        10.6     1.14      0.330
##  2 Austria              12        23.5     2.42      0.697
##  3 Belgium              12        21.9     1.94      0.559
##  4 Canada               12        14.0     0.751     0.217
##  5 Denmark              12        13.1     1.47      0.424
##  6 Finland              12        18.4     1.53      0.441
##  7 France               12        16.8     1.60      0.461
##  8 Germany              12        13.0     0.611     0.176
##  9 Ireland              12        19.8     2.48      0.715
## 10 Italy                12        11.1     4.28      1.23 
## 11 Netherlands          12        13.7     1.55      0.448
## 12 Norway               12        15.4     1.11      0.320
## 13 Spain                12        28.1     4.96      1.43 
## 14 Sweden               12        13.1     1.75      0.506
## 15 Switzerland          12        14.2     1.71      0.493
## 16 United Kingdom       12        13.5     0.775     0.224
## 17 United States        12        20.0     1.33      0.383</code></pre>
<p>用条形图表现不同国家的平均捐献率：</p>
<div class="sourceCode" id="cb1833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1833-1"><a href="ggplot2.html#cb1833-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata2,</span>
<span id="cb1833-2"><a href="ggplot2.html#cb1833-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1833-3"><a href="ggplot2.html#cb1833-3"></a>      <span class="dt">x =</span> <span class="kw">reorder</span>(country, donors_mean), </span>
<span id="cb1833-4"><a href="ggplot2.html#cb1833-4"></a>      <span class="dt">y =</span> donors_mean))</span>
<span id="cb1833-5"><a href="ggplot2.html#cb1833-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb1833-6"><a href="ggplot2.html#cb1833-6"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1833-7"><a href="ggplot2.html#cb1833-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">&quot;平均捐赠率(单位: 百万分之一)&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-organ20b-1.png" width="672" /></p>
<p>这样的图形也可以做成点图，
称为Cleveland点图。
不需要再颠倒横纵坐标，
直接规定x轴为平均捐赠率即可：</p>
<div class="sourceCode" id="cb1834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1834-1"><a href="ggplot2.html#cb1834-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata2,</span>
<span id="cb1834-2"><a href="ggplot2.html#cb1834-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1834-3"><a href="ggplot2.html#cb1834-3"></a>      <span class="dt">y =</span> <span class="kw">reorder</span>(country, donors_mean), </span>
<span id="cb1834-4"><a href="ggplot2.html#cb1834-4"></a>      <span class="dt">x =</span> donors_mean))</span>
<span id="cb1834-5"><a href="ggplot2.html#cb1834-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1834-6"><a href="ggplot2.html#cb1834-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="ot">NULL</span>, <span class="dt">x =</span> <span class="st">&quot;平均捐赠率(单位: 百万分之一)&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-organ20c-1.png" width="672" /></p>
<p>organdata数据集中变量<code>consent_law</code>是关于一个国家中器官捐赠是必须告知还是默认捐赠的区别。
为了在上面的点图中用不同颜色区分这两种做法，
需要在分组汇总阶段就将<code>consent_law</code>也作为分组变量。
这是因为<code>summarize()</code>函数会自动舍弃分组变量和统计结果之外的原有变量。</p>
<div class="sourceCode" id="cb1835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1835-1"><a href="ggplot2.html#cb1835-1"></a>organdata3 &lt;-<span class="st"> </span>organdata <span class="op">%&gt;%</span></span>
<span id="cb1835-2"><a href="ggplot2.html#cb1835-2"></a><span class="st">  </span><span class="kw">group_by</span>(consent_law, country) <span class="op">%&gt;%</span></span>
<span id="cb1835-3"><a href="ggplot2.html#cb1835-3"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb1835-4"><a href="ggplot2.html#cb1835-4"></a>    <span class="dt">donors_n =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(donors)),</span>
<span id="cb1835-5"><a href="ggplot2.html#cb1835-5"></a>    <span class="dt">donors_mean =</span> <span class="kw">mean</span>(donors, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb1835-6"><a href="ggplot2.html#cb1835-6"></a>    <span class="dt">donors_sd =</span> <span class="kw">sd</span>(donors, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb1835-7"><a href="ggplot2.html#cb1835-7"></a>    <span class="dt">donors_se =</span> donors_sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(donors_n)) <span class="op">%&gt;%</span></span>
<span id="cb1835-8"><a href="ggplot2.html#cb1835-8"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb1835-9"><a href="ggplot2.html#cb1835-9"></a>organdata3</span></code></pre></div>
<pre><code>## # A tibble: 17 x 6
##    consent_law country        donors_n donors_mean donors_sd donors_se
##    &lt;chr&gt;       &lt;chr&gt;             &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 Informed    Australia            12        10.6     1.14      0.330
##  2 Informed    Canada               12        14.0     0.751     0.217
##  3 Informed    Denmark              12        13.1     1.47      0.424
##  4 Informed    Germany              12        13.0     0.611     0.176
##  5 Informed    Ireland              12        19.8     2.48      0.715
##  6 Informed    Netherlands          12        13.7     1.55      0.448
##  7 Informed    United Kingdom       12        13.5     0.775     0.224
##  8 Informed    United States        12        20.0     1.33      0.383
##  9 Presumed    Austria              12        23.5     2.42      0.697
## 10 Presumed    Belgium              12        21.9     1.94      0.559
## 11 Presumed    Finland              12        18.4     1.53      0.441
## 12 Presumed    France               12        16.8     1.60      0.461
## 13 Presumed    Italy                12        11.1     4.28      1.23 
## 14 Presumed    Norway               12        15.4     1.11      0.320
## 15 Presumed    Spain                12        28.1     4.96      1.43 
## 16 Presumed    Sweden               12        13.1     1.75      0.506
## 17 Presumed    Switzerland          12        14.2     1.71      0.493</code></pre>
<div class="sourceCode" id="cb1837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1837-1"><a href="ggplot2.html#cb1837-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata3,</span>
<span id="cb1837-2"><a href="ggplot2.html#cb1837-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1837-3"><a href="ggplot2.html#cb1837-3"></a>      <span class="dt">y =</span> <span class="kw">reorder</span>(country, donors_mean), </span>
<span id="cb1837-4"><a href="ggplot2.html#cb1837-4"></a>      <span class="dt">x =</span> donors_mean,</span>
<span id="cb1837-5"><a href="ggplot2.html#cb1837-5"></a>      <span class="dt">color =</span> consent_law))</span>
<span id="cb1837-6"><a href="ggplot2.html#cb1837-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb1837-7"><a href="ggplot2.html#cb1837-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="ot">NULL</span>, <span class="dt">x =</span> <span class="st">&quot;平均捐赠率(单位: 百万分之一)&quot;</span>) <span class="op">+</span></span>
<span id="cb1837-8"><a href="ggplot2.html#cb1837-8"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-organ31-1.png" width="672" /></p>
<p>平均捐赠率最高的三个国家都是不需告知预先假定同意的。</p>
<p>也可以将两种告知规定分成两个小图：</p>
<div class="sourceCode" id="cb1838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1838-1"><a href="ggplot2.html#cb1838-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata3,</span>
<span id="cb1838-2"><a href="ggplot2.html#cb1838-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1838-3"><a href="ggplot2.html#cb1838-3"></a>      <span class="dt">y =</span> <span class="kw">reorder</span>(country, donors_mean), </span>
<span id="cb1838-4"><a href="ggplot2.html#cb1838-4"></a>      <span class="dt">x =</span> donors_mean))</span>
<span id="cb1838-5"><a href="ggplot2.html#cb1838-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb1838-6"><a href="ggplot2.html#cb1838-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>consent_law, <span class="dt">ncol=</span><span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1838-7"><a href="ggplot2.html#cb1838-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="ot">NULL</span>, <span class="dt">x =</span> <span class="st">&quot;平均捐赠率(单位: 百万分之一)&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-organ32-1.png" width="672" /></p>
<p>因为纵轴是分类变量，程序中的<code>scales = "free_y"</code>使得纵轴仅对存在的类留出空间。
用了<code>ncol = 1</code>使得两种告知规定的小图上下排列，
便于比较横坐标值。</p>
<p>当每个类别仅有一个数值时，
一般推荐使用Cleveland点图，
而不是条形图或者折线图。
Cleveland点图总是将类别值绘制在y轴，
将要比较的数量值用x坐标表示，
并将各类按照数量值大小次序排列。</p>
<p>可以表示平均值的点图上增加一条线，
表示误差大小，所用函数为<code>geom_pointrange()</code>。
这个函数仅支持对y轴加误差线，
所以需要用交换坐标轴的办法将分类变量放在y轴。
比如，
画出近似95%置信区间范围：</p>
<div class="sourceCode" id="cb1839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1839-1"><a href="ggplot2.html#cb1839-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata3,</span>
<span id="cb1839-2"><a href="ggplot2.html#cb1839-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1839-3"><a href="ggplot2.html#cb1839-3"></a>      <span class="dt">x =</span> <span class="kw">reorder</span>(country, donors_mean), </span>
<span id="cb1839-4"><a href="ggplot2.html#cb1839-4"></a>      <span class="dt">y =</span> donors_mean))</span>
<span id="cb1839-5"><a href="ggplot2.html#cb1839-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_pointrange</span>(</span>
<span id="cb1839-6"><a href="ggplot2.html#cb1839-6"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">ymin =</span> donors_mean <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>donors_se,</span>
<span id="cb1839-7"><a href="ggplot2.html#cb1839-7"></a>                  <span class="dt">ymax =</span> donors_mean <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>donors_se)) <span class="op">+</span></span>
<span id="cb1839-8"><a href="ggplot2.html#cb1839-8"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb1839-9"><a href="ggplot2.html#cb1839-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>consent_law, <span class="dt">ncol=</span><span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1839-10"><a href="ggplot2.html#cb1839-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">&quot;平均捐赠率(单位: 百万分之一)及95%置信区间&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-organ33-1.png" width="672" /></p>
<p>类似的函数还有<code>geom_linerange()</code>、<code>geom_crossbar()</code>、<code>geom_errorbar()</code>。</p>
</div>
<div id="ggplot2-moregeom-text" class="section level3">
<h3><span class="header-section-number">29.8.2</span> 坐标系中的文字</h3>
<p>类似于散点图，
可以将指定的文字绘制在指定的坐标位置，
使用<code>geom_text(mapping = aes(label = 字符型变量))</code>。</p>
<p>例如，gapminder数据集中各大洲的平均寿命与平均gdp的文字散点图：</p>
<div class="sourceCode" id="cb1840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1840-1"><a href="ggplot2.html#cb1840-1"></a>gapminder2 &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1840-2"><a href="ggplot2.html#cb1840-2"></a><span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span></span>
<span id="cb1840-3"><a href="ggplot2.html#cb1840-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">lifeExp =</span> <span class="kw">mean</span>(lifeExp, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), </span>
<span id="cb1840-4"><a href="ggplot2.html#cb1840-4"></a>            <span class="dt">gdpPercap =</span> <span class="kw">mean</span>(gdpPercap))</span>
<span id="cb1840-5"><a href="ggplot2.html#cb1840-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>gapminder2,</span>
<span id="cb1840-6"><a href="ggplot2.html#cb1840-6"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1840-7"><a href="ggplot2.html#cb1840-7"></a>      <span class="dt">x =</span> gdpPercap, </span>
<span id="cb1840-8"><a href="ggplot2.html#cb1840-8"></a>      <span class="dt">y =</span> lifeExp,</span>
<span id="cb1840-9"><a href="ggplot2.html#cb1840-9"></a>      <span class="dt">label =</span> continent))</span>
<span id="cb1840-10"><a href="ggplot2.html#cb1840-10"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-gap01-1.png" width="672" /></p>
<p>可以同时绘制散点：</p>
<div class="sourceCode" id="cb1841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1841-1"><a href="ggplot2.html#cb1841-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>() <span class="op">+</span></span>
<span id="cb1841-2"><a href="ggplot2.html#cb1841-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-gap01b-1.png" width="672" /></p>
<p>ggrepel扩展包提供了增强的图形文本功能。
<code>geom_text_repel()</code>提供了与<code>geom_text()</code>类似的功能。</p>
<p>考虑socviz扩展包的<code>elections_historic</code>数据集，
这是美国历次总统选举情况数据。
部分数据显示：</p>
<div class="sourceCode" id="cb1842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1842-1"><a href="ggplot2.html#cb1842-1"></a>elections_historic <span class="op">%&gt;%</span></span>
<span id="cb1842-2"><a href="ggplot2.html#cb1842-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 6
##     year winner                 win_party ec_pct popular_pct popular_margin
##    &lt;int&gt; &lt;chr&gt;                  &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
##  1  1824 John Quincy Adams      D.-R.      0.322       0.309        -0.104 
##  2  1828 Andrew Jackson         Dem.       0.682       0.559         0.122 
##  3  1832 Andrew Jackson         Dem.       0.766       0.547         0.178 
##  4  1836 Martin Van Buren       Dem.       0.578       0.508         0.142 
##  5  1840 William Henry Harrison Whig       0.796       0.529         0.0605
##  6  1844 James Polk             Dem.       0.618       0.495         0.0145
##  7  1848 Zachary Taylor         Whig       0.562       0.473         0.0479
##  8  1852 Franklin Pierce        Dem.       0.858       0.508         0.0695
##  9  1856 James Buchanan         Dem.       0.588       0.453         0.122 
## 10  1860 Abraham Lincoln        Rep.       0.594       0.396         0.101</code></pre>
<p>取<code>popular_pct</code>(popular投票支持率)为横坐标，
取<code>ec_pct</code>(election college投票支持率)为纵坐标，
将历次结果标在坐标系中：</p>
<div class="sourceCode" id="cb1844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1844-1"><a href="ggplot2.html#cb1844-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> elections_historic,</span>
<span id="cb1844-2"><a href="ggplot2.html#cb1844-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1844-3"><a href="ggplot2.html#cb1844-3"></a>      <span class="dt">x =</span> popular_pct,</span>
<span id="cb1844-4"><a href="ggplot2.html#cb1844-4"></a>      <span class="dt">y =</span> ec_pct,</span>
<span id="cb1844-5"><a href="ggplot2.html#cb1844-5"></a>      <span class="dt">label =</span> winner_label))</span>
<span id="cb1844-6"><a href="ggplot2.html#cb1844-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-elect02-1.png" width="672" /></p>
<p>因为点比较多，文字也比较长，有很多重叠。
ggrepel包的<code>geom_text_repel()</code>则很好地处理了这个问题：</p>
<div class="sourceCode" id="cb1845"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1845-1"><a href="ggplot2.html#cb1845-1"></a><span class="kw">library</span>(ggrepel)</span></code></pre></div>
<pre><code>## Warning: 程辑包&#39;ggrepel&#39;是用R版本3.6.3 来建造的</code></pre>
<div class="sourceCode" id="cb1847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1847-1"><a href="ggplot2.html#cb1847-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text_repel</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-elect02b-1.png" width="672" /></p>
<p>可以看出，其解决重叠问题的方式是用短线指向实际的坐标位置。
在Rmd文件中，
还是有少量的重叠，
可以通过在R代码段选项中增大<code>fig.width</code>和<code>fig.height</code>参数实现，
下面的代码段用了选项<code>fig.width=20, fig.height=16</code>：</p>
<div class="sourceCode" id="cb1848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1848-1"><a href="ggplot2.html#cb1848-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text_repel</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-elect02c-1.png" width="1920" /></p>
<p>可以用<code>scale_x_continuous()</code>和<code>scale_y_continuous()</code>将坐标轴的比例值转换成百分数，
用<code>geom_hline(yintercept)</code>添加横线，
用<code>geom_vline(xintercept)</code>添加竖线，
适当地用标注改善图形：</p>
<div class="sourceCode" id="cb1849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1849-1"><a href="ggplot2.html#cb1849-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">1.4</span>, <span class="dt">col =</span> <span class="st">&quot;gray80&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1849-2"><a href="ggplot2.html#cb1849-2"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">1.4</span>, <span class="dt">col =</span> <span class="st">&quot;gray80&quot;</span>) <span class="op">+</span></span>
<span id="cb1849-3"><a href="ggplot2.html#cb1849-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1849-4"><a href="ggplot2.html#cb1849-4"></a><span class="st">  </span><span class="kw">geom_text_repel</span>() <span class="op">+</span></span>
<span id="cb1849-5"><a href="ggplot2.html#cb1849-5"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1849-6"><a href="ggplot2.html#cb1849-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></span>
<span id="cb1849-7"><a href="ggplot2.html#cb1849-7"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1849-8"><a href="ggplot2.html#cb1849-8"></a>    <span class="dt">x =</span> <span class="st">&quot;Winner&#39;s share of Popular Vote&quot;</span>,</span>
<span id="cb1849-9"><a href="ggplot2.html#cb1849-9"></a>    <span class="dt">y =</span> <span class="st">&quot;Winner&#39;s share of Electoral College Votes&quot;</span>,</span>
<span id="cb1849-10"><a href="ggplot2.html#cb1849-10"></a>    <span class="dt">title =</span> <span class="st">&quot;Presidential Elections: Popular &amp; Electoral College Margins&quot;</span>,</span>
<span id="cb1849-11"><a href="ggplot2.html#cb1849-11"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;1824-2016&quot;</span>,</span>
<span id="cb1849-12"><a href="ggplot2.html#cb1849-12"></a>    <span class="dt">caption =</span> <span class="st">&quot;Data for 2016 are provisional.&quot;</span></span>
<span id="cb1849-13"><a href="ggplot2.html#cb1849-13"></a>  )</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-elect02d-1.png" width="1920" /></p>
<p>为了画斜线，可以用<code>geom_abline()</code>函数。</p>
</div>
<div id="ggplot2-moregeom-textops" class="section level3">
<h3><span class="header-section-number">29.8.3</span> 文字选项</h3>
<p>用<code>geom_text()</code>添加文字时，
可以使用一些图形选项。</p>
<p>可以用<code>size</code>选项（不是aes映射）指定字符大小，
单位为毫米。如：</p>
<div class="sourceCode" id="cb1850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1850-1"><a href="ggplot2.html#cb1850-1"></a>d &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb1850-2"><a href="ggplot2.html#cb1850-2"></a>  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,</span>
<span id="cb1850-3"><a href="ggplot2.html#cb1850-3"></a>  <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1850-4"><a href="ggplot2.html#cb1850-4"></a>  <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;较小&quot;</span>, <span class="st">&quot;较大&quot;</span>))</span>
<span id="cb1850-5"><a href="ggplot2.html#cb1850-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>()</span>
<span id="cb1850-6"><a href="ggplot2.html#cb1850-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> d[<span class="dv">1</span>,], <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1850-7"><a href="ggplot2.html#cb1850-7"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">label =</span> label), <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></span>
<span id="cb1850-8"><a href="ggplot2.html#cb1850-8"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> d[<span class="dv">2</span>,], <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1850-9"><a href="ggplot2.html#cb1850-9"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">label =</span> label), <span class="dt">size =</span> <span class="dv">8</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-opt01-1.png" width="672" /></p>
<p>文字的大小是按毫米计算的，
不是按照坐标系中单位计算的，
而且放大或者缩小坐标系时文字大小不变。
程序不自动判断文字是否超出坐标系边界，
所以有时需要人为将坐标范围适当放大。</p>
<p>可以用<code>family</code>选项选择不同的字体种类，
在所有操作系统与绘图输出中都可选的种类包括<code>"sans"</code>(这是缺省值，等线字体)、<code>"serif"</code>(有笔画粗细的字体)、<code>"mono"</code>(类似于打字机字体)。<code>family</code>可以作为选项，也可以作为映射，如：</p>
<div class="sourceCode" id="cb1851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1851-1"><a href="ggplot2.html#cb1851-1"></a>d &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb1851-2"><a href="ggplot2.html#cb1851-2"></a>  <span class="dt">x =</span> <span class="dv">1</span>,</span>
<span id="cb1851-3"><a href="ggplot2.html#cb1851-3"></a>  <span class="dt">y =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">1</span>,</span>
<span id="cb1851-4"><a href="ggplot2.html#cb1851-4"></a>  <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;sans默认字体&quot;</span>, <span class="st">&quot;serif等线字体&quot;</span>, <span class="st">&quot;mono字体&quot;</span>),</span>
<span id="cb1851-5"><a href="ggplot2.html#cb1851-5"></a>  <span class="dt">family =</span> <span class="kw">c</span>(<span class="st">&quot;sans&quot;</span>, <span class="st">&quot;serif&quot;</span>, <span class="st">&quot;mono&quot;</span>))</span>
<span id="cb1851-6"><a href="ggplot2.html#cb1851-6"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>()</span>
<span id="cb1851-7"><a href="ggplot2.html#cb1851-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1851-8"><a href="ggplot2.html#cb1851-8"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">label =</span> label, <span class="dt">family =</span> family), <span class="dt">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-text-opt02-1.png" width="672" /></p>
<p>要使用其它字体则比较复杂，
可参考扩展包showtext和extrafonts。</p>
<p>在R Markdown文件中作图使用中文字体要更麻烦一些，
很容易变成乱码，需要在文件开始设置：</p>
<div class="sourceCode" id="cb1852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1852-1"><a href="ggplot2.html#cb1852-1"></a><span class="kw">pdf.options</span>(<span class="dt">height=</span><span class="dv">10</span><span class="op">/</span><span class="fl">2.54</span>, <span class="dt">width=</span><span class="dv">10</span><span class="op">/</span><span class="fl">2.54</span>, <span class="dt">family=</span><span class="st">&quot;GB1&quot;</span>) <span class="co"># </span></span></code></pre></div>
<p>其中<code>height</code>和<code>width</code>选项可以修改为其它高度、宽度值。
如果还是有乱码，
可以在作图的代码段中指定选项<code>dev="png"</code>，
使用栅格图而不是PDF默认的矢量图作为输出。</p>
<p>可以用<code>fontface</code>映射或选项指定<code>"plain"</code>(缺省值)、<code>"bold"</code>(粗体)、<code>"italic"</code>(斜体)。</p>
<p>可以用<code>hjust</code>映射或选项指定文字的横向对齐方式，
包括<code>"left"</code>、<code>"center"</code>、<code>"right"</code>、<code>"inward"</code>、<code>"outward"</code>。
可以用<code>vjust</code>映射或选项指定文字的纵向对齐方式，
可取<code>"bottom"</code>、<code>"middle"</code>、<code>"top"</code>、<code>"inward"</code>、<code>"outward"</code>。
默认为居中对齐。
<code>"inward"</code>可以使文字向中心移动，
避免边界的文字出界。</p>
<p>可以用angle映射或选项指定文字的旋转方向。</p>
<p>可以用<code>nudge_x</code>和<code>nudge_y</code>选项指定对每条标签文字的横向和纵向微调，
单位是坐标系中的单位。</p>
<p>可以用选项<code>check_overlap = TRUE</code>要求重叠的文字不全显示出来，
使得结果不重叠。</p>
<p><code>geom_text()</code>函数的一个变种是<code>geom_label()</code>，
标签文字会有一个圆角的背景框，
可以指定填充颜色。</p>
</div>
<div id="ggplot2-moregeom-outliers" class="section level3">
<h3><span class="header-section-number">29.8.4</span> 标出特殊点</h3>
<p>在坐标系中标注文字的功能更经常用来标出图形中的特殊点。</p>
<p>考虑organdata中各国的平均捐赠率数据。
作平均捐赠率对平均gdp的散点图：</p>
<div class="sourceCode" id="cb1853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1853-1"><a href="ggplot2.html#cb1853-1"></a>organdata4 &lt;-<span class="st"> </span>organdata <span class="op">%&gt;%</span></span>
<span id="cb1853-2"><a href="ggplot2.html#cb1853-2"></a><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></span>
<span id="cb1853-3"><a href="ggplot2.html#cb1853-3"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb1853-4"><a href="ggplot2.html#cb1853-4"></a>    <span class="dt">donors_mean =</span> <span class="kw">mean</span>(donors, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb1853-5"><a href="ggplot2.html#cb1853-5"></a>    <span class="dt">gdp_mean =</span> <span class="kw">mean</span>(gdp, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb1853-6"><a href="ggplot2.html#cb1853-6"></a>  )</span>
<span id="cb1853-7"><a href="ggplot2.html#cb1853-7"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata4,</span>
<span id="cb1853-8"><a href="ggplot2.html#cb1853-8"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> gdp_mean, <span class="dt">y =</span> donors_mean))</span>
<span id="cb1853-9"><a href="ggplot2.html#cb1853-9"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1853-10"><a href="ggplot2.html#cb1853-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;平均GDP&quot;</span>, </span>
<span id="cb1853-11"><a href="ggplot2.html#cb1853-11"></a>       <span class="dt">y =</span> <span class="st">&quot;平均器官捐赠率(单位：百万分之一)&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-outlier-organ01-1.png" width="672" /></p>
<p>如果需要标出其中的特殊点，
就要生成一个数据子集，
并在<code>geom_text()</code>中指定输入数据为此子集：</p>
<div class="sourceCode" id="cb1854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1854-1"><a href="ggplot2.html#cb1854-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1854-2"><a href="ggplot2.html#cb1854-2"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">subset</span>(organdata4, gdp_mean <span class="op">&gt;</span><span class="st"> </span><span class="dv">27500</span> <span class="op">|</span><span class="st"> </span>donors_mean <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>),</span>
<span id="cb1854-3"><a href="ggplot2.html#cb1854-3"></a>            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">label =</span> country)) <span class="op">+</span></span>
<span id="cb1854-4"><a href="ggplot2.html#cb1854-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;平均GDP&quot;</span>, </span>
<span id="cb1854-5"><a href="ggplot2.html#cb1854-5"></a>       <span class="dt">y =</span> <span class="st">&quot;平均器官捐赠率(单位：百万分之一)&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-outlier-organ01b-1.png" width="672" /></p>
<p>上面标的文字有超出边界的问题，
可以在<code>geom_text()</code>中加选项<code>hjust = "inward"</code>:</p>
<div class="sourceCode" id="cb1855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1855-1"><a href="ggplot2.html#cb1855-1"></a><span class="kw">library</span>(ggrepel)</span>
<span id="cb1855-2"><a href="ggplot2.html#cb1855-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1855-3"><a href="ggplot2.html#cb1855-3"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">subset</span>(organdata4, gdp_mean <span class="op">&gt;</span><span class="st"> </span><span class="dv">27500</span> <span class="op">|</span><span class="st"> </span>donors_mean <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>),</span>
<span id="cb1855-4"><a href="ggplot2.html#cb1855-4"></a>            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">label =</span> country),</span>
<span id="cb1855-5"><a href="ggplot2.html#cb1855-5"></a>            <span class="dt">hjust =</span> <span class="st">&quot;inward&quot;</span>) <span class="op">+</span></span>
<span id="cb1855-6"><a href="ggplot2.html#cb1855-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;平均GDP&quot;</span>, </span>
<span id="cb1855-7"><a href="ggplot2.html#cb1855-7"></a>       <span class="dt">y =</span> <span class="st">&quot;平均器官捐赠率(单位：百万分之一)&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-moregeo-outlier-organ01c-1.png" width="672" /></p>
</div>
</div>
<div id="ggplot2-auxfuncs-scale" class="section level2">
<h2><span class="header-section-number">29.9</span> 刻度(scale)</h2>
<p>在<code>ggplot()</code>的<code>mapping</code>参数中指定<code>x</code>维、<code>y</code>维、<code>color</code>维等，
实际上每一维度都有一个对应的默认刻度(scale)，
即将数据值映射到图形中的映射方法。
如果需要修改刻度对应的变换或者标度方法，
可以调用相应的<code>scale_xxx()</code>函数。</p>
<p>刻度在绘图过程中依次起到三个作用：</p>
<ul>
<li>某些刻度对原始数据进行变换，比如对数变换；</li>
<li>如果有多个图层，比如即有散点图又有曲线拟合，
各图层的坐标范围要统一考虑，
如果不人为指定范围会自动设定范围使得各个图层的元素都可以容纳在刻度范围内；</li>
<li>将数据变量映射到具体的位置、颜色、填充色、大小、符号等。</li>
</ul>
<p>可以映射的维度包括<code>x</code>、<code>y</code>、<code>color</code>、<code>fill</code>、<code>shape</code>、<code>size</code>等。
其中<code>x</code>、<code>y</code>维度多用于表示连续变量，
但是也可以用于分类变量，
如Cleveland点图就是将<code>y</code>维度分配给一个分类变量。
<code>color</code>、<code>fill</code>可以用于连续变量，
用于有序变量，
也可以用于无序的分类变量。
<code>shape</code>只能用于无序的分类变量。</p>
<p>数值或者不同类别可以用平面上的不同位置表示，
一般使用直角坐标系，
有有一对相互垂直的x轴和y轴，
但也可以有其他选择，
比如y轴可以不与x轴垂直，
某个轴的刻度可以不是线性的而是经过对数变换的，
可以用极坐标系，等等。
普通的直角坐标系不需要用<code>scale_xxx()</code>函数。</p>
<p>直角坐标系中的位置有x坐标与y坐标，
可以分别代表两个变量，
这两个变量经常是不同单位的，
比如，
身高与体重。
这时，
x轴与y轴的数值之间没有可比性，
两个轴的数值范围与轴的实际长度只要不过于极端就没有什么关系。
但是，
应该尽可能使用比较合适的高宽比。</p>
<p>如果两个轴的变量含义相同，
最好使用完全相同的坐标轴范围与坐标轴长度，
使得水平与垂直方向上的等长距离在对应的坐标轴上也代表相等的距离。
用<code>coord_fixed()</code>函数指定两个轴的单位为1:1长度的坐标系，
其中参数xlim和ylim可以用来指定坐标范围。
也可以用ratio参数指定一个其他的宽高比。
如</p>
<div class="sourceCode" id="cb1856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1856-1"><a href="ggplot2.html#cb1856-1"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1856-2"><a href="ggplot2.html#cb1856-2"></a>  t &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length.out=</span><span class="dv">100</span>)</span>
<span id="cb1856-3"><a href="ggplot2.html#cb1856-3"></a>)</span>
<span id="cb1856-4"><a href="ggplot2.html#cb1856-4"></a>d<span class="op">$</span>x &lt;-<span class="st"> </span><span class="kw">cos</span>(d<span class="op">$</span>t)</span>
<span id="cb1856-5"><a href="ggplot2.html#cb1856-5"></a>d<span class="op">$</span>y &lt;-<span class="st"> </span><span class="kw">sin</span>(d<span class="op">$</span>t)</span>
<span id="cb1856-6"><a href="ggplot2.html#cb1856-6"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1856-7"><a href="ggplot2.html#cb1856-7"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y))</span>
<span id="cb1856-8"><a href="ggplot2.html#cb1856-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_path</span>() <span class="op">+</span></span>
<span id="cb1856-9"><a href="ggplot2.html#cb1856-9"></a><span class="st">  </span><span class="kw">coord_fixed</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-scale-fixed01-1.png" width="672" /></p>
<p>上面的程序中，
<code>geom_path()</code>按照输入数据集的次序将坐标点连接在一起。
如果改用<code>geom_line()</code>，
会将数据先按照<code>x</code>坐标值排序然后再顺序相连。
可以看出，
结果是一个正圆；
如果不使用<code>coord_fixed()</code>，结果不一定是正圆。</p>
<p>在<code>coord_fixed()</code>函数中，
还可以用<code>expand = FALSE</code>要求坐标轴范围严格等于数据范围或xlim和ylim的规定，
否则会比数据范围略宽一些。</p>
<p><code>scale_x_log10()</code>和<code>scale_y_log10()</code>可以将x轴或者y轴用对数刻度，
这实际上是将数据做常用对数变换，
但是相应的坐标轴刻度的数值还标成变换之前的原始值。
对数轴方向相同的距离代表相差相同的倍数。
经济、金融数据常常需要用对数刻度。</p>
<p>对数轴最好用来代表比例，
尤其是使用条形图时，
应该从1开始而不是从0开始。</p>
<p>下图是我国2000-2015年的居民消费水平（元）,
可以看出，
增长是指数型的：</p>
<div class="sourceCode" id="cb1857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1857-1"><a href="ggplot2.html#cb1857-1"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1857-2"><a href="ggplot2.html#cb1857-2"></a>  <span class="dt">x =</span> <span class="dv">2000</span><span class="op">:</span><span class="dv">2015</span>,</span>
<span id="cb1857-3"><a href="ggplot2.html#cb1857-3"></a>  <span class="dt">y =</span> <span class="kw">c</span>(3721L, 3987L, 4301L, 4606L, 5138L, 5771L, 6416L, 7572L, 8707L, </span>
<span id="cb1857-4"><a href="ggplot2.html#cb1857-4"></a>9514L, 10919L, 13134L, 14699L, 16190L, 17778L, 19308L))</span>
<span id="cb1857-5"><a href="ggplot2.html#cb1857-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1857-6"><a href="ggplot2.html#cb1857-6"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y))</span>
<span id="cb1857-7"><a href="ggplot2.html#cb1857-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-scale-log01-1.png" width="672" /></p>
<p>将y轴用对数刻度，则散点可以呈现为线性：</p>
<div class="sourceCode" id="cb1858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1858-1"><a href="ggplot2.html#cb1858-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1858-2"><a href="ggplot2.html#cb1858-2"></a><span class="st">  </span><span class="kw">scale_y_log10</span>()</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-scale-log01b-1.png" width="672" /></p>
<p>用<code>geom_smooth()</code>添加线性拟合线：</p>
<div class="sourceCode" id="cb1859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1859-1"><a href="ggplot2.html#cb1859-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1859-2"><a href="ggplot2.html#cb1859-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1859-3"><a href="ggplot2.html#cb1859-3"></a><span class="st">  </span><span class="kw">scale_y_log10</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-auxfuncs-scale-log01c-1.png" width="672" /></p>
<p>注意<code>geom_smooth(method="lm")</code>在计算拟合时会自动采用<code>log10(y)</code>的值。</p>
<p><code>scale_x_sqrt()</code>和<code>scale_y_sqrt()</code>与对数轴类似，
做的是平方根变换。
对于面积值，
这种变换有一定意义。</p>
<p>用<code>coord_polar()</code>指定极坐标系，
用<code>theta="x"</code>或者<code>theta="y"</code>指定那一维映射到极角。
如：</p>
<div class="sourceCode" id="cb1861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1861-1"><a href="ggplot2.html#cb1861-1"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1861-2"><a href="ggplot2.html#cb1861-2"></a>  x &lt;-<span class="st"> </span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>)<span class="op">/</span><span class="dv">12</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>pi, </span>
<span id="cb1861-3"><a href="ggplot2.html#cb1861-3"></a>  y &lt;-<span class="st"> </span><span class="dv">11</span><span class="op">:</span><span class="dv">22</span></span>
<span id="cb1861-4"><a href="ggplot2.html#cb1861-4"></a>)</span>
<span id="cb1861-5"><a href="ggplot2.html#cb1861-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1861-6"><a href="ggplot2.html#cb1861-6"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y))</span>
<span id="cb1861-7"><a href="ggplot2.html#cb1861-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb1861-8"><a href="ggplot2.html#cb1861-8"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi)) <span class="op">+</span></span>
<span id="cb1861-9"><a href="ggplot2.html#cb1861-9"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">22</span>)) <span class="op">+</span></span>
<span id="cb1861-10"><a href="ggplot2.html#cb1861-10"></a><span class="st">  </span><span class="kw">coord_polar</span>(<span class="dt">theta=</span><span class="st">&quot;x&quot;</span>, <span class="dt">start=</span><span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span>, <span class="dt">direction=</span><span class="op">-</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-scale-polar01-1.png" width="672" /></p>
<p>上图中y轴为极径的刻度，
圆周上的数字表示极角刻度。
程序中<code>start</code>指定极角为0的射线与12点方向的夹角弧度，
<code>direction=1</code>表示顺时针计算角度，
<code>direction=-1</code>表示逆时针。
<code>scale_continuous_x()</code>和<code>scale_continuous_y()</code>指定了两个维度的坐标范围。</p>
<p>用<code>scale_xxx()</code>函数指定非默认的刻度，
一般模式为<code>scale_映射维度_类型()</code>，
“类型”包括<code>continuous</code>、<code>discrete</code>、<code>log10</code>等。
可以用来人为指定坐标轴的刻度值，
修改<code>color</code>或者<code>fill</code>维度所利用的颜色表，等等，
用其中的参数指定这些内容。
注意坐标轴的标签（标题）用<code>labs()</code>函数指定，
而不是用<code>scale_xxx()</code>函数指定。</p>
<p>例如，
在organdata中，
作<code>donors</code>对<code>roads</code>(每十万人的道路交通事故死亡率)的散点图，
并按<code>world</code>(不同福利类型)对散点染色，
x、y、color这三个维度都用了默认的刻度:</p>
<div class="sourceCode" id="cb1862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1862-1"><a href="ggplot2.html#cb1862-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> organdata,</span>
<span id="cb1862-2"><a href="ggplot2.html#cb1862-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1862-3"><a href="ggplot2.html#cb1862-3"></a>      <span class="dt">x =</span> roads,</span>
<span id="cb1862-4"><a href="ggplot2.html#cb1862-4"></a>      <span class="dt">y =</span> donors,</span>
<span id="cb1862-5"><a href="ggplot2.html#cb1862-5"></a>      <span class="dt">color =</span> world ))</span>
<span id="cb1862-6"><a href="ggplot2.html#cb1862-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-auxfuncs-scale-organ01-1.png" width="672" /></p>
<p>这里有三个维度：连续型的<code>x</code>、<code>y</code>维度与无序分类值的<code>color</code>维度。
<code>color</code>维度既可以取连续型，
也可以取有序或者无序的分类型。
<code>x</code>、<code>y</code>维度有自动的坐标轴，
<code>color</code>维度有图例在图形右侧。
如果没有特殊要求，不必调用<code>scale_xxx()</code>函数。</p>
<p>下面将<code>y</code>轴的刻度值进行人为的规定，
将<code>color</code>维的标签人为指定：</p>
<div class="sourceCode" id="cb1864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1864-1"><a href="ggplot2.html#cb1864-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1864-2"><a href="ggplot2.html#cb1864-2"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(</span>
<span id="cb1864-3"><a href="ggplot2.html#cb1864-3"></a>    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">25</span>),</span>
<span id="cb1864-4"><a href="ggplot2.html#cb1864-4"></a>    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;百万分之五&quot;</span>, <span class="st">&quot;百万分之十五&quot;</span>, <span class="st">&quot;百万分二十五&quot;</span>)  ) <span class="op">+</span></span>
<span id="cb1864-5"><a href="ggplot2.html#cb1864-5"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">labels =</span> <span class="kw">c</span>(</span>
<span id="cb1864-6"><a href="ggplot2.html#cb1864-6"></a>    <span class="st">&quot;社团主义&quot;</span>, <span class="st">&quot;自由&quot;</span>, <span class="st">&quot;社会民主&quot;</span>, <span class="st">&quot;无分类&quot;</span>  ))</span></code></pre></div>
<pre><code>## Warning: Removed 34 rows containing missing values (geom_point).</code></pre>
<p><img src="static/picture/ggplot2-auxfuncs-scale-organ01b-1.png" width="672" /></p>
<p>在<code>scale_维度_contiuous()</code>函数中，
可以用<code>breaks</code>指定坐标刻度标线的坐标数值表，
用<code>minor_breaks</code>指定细刻度的坐标数值表，
用<code>labels</code>指定在坐标刻度标线处标出的坐标值标签字符串表，
用<code>limits</code>指定坐标系的范围（两个数的向量），
用<code>expand</code>指定在将坐标轴范围比数据的范围在两侧分别扩充多少，
取<code>c(0,0)</code>要求不扩充，默认会左右各扩充5%。</p>
<p>ggplot2的散点图默认使用灰色背景并带有白色的网格线。
<code>theme()</code>函数的<code>panel.background</code>可以指定背景色，
<code>panel.grid</code>、<code>panel.grid.xxx</code>可以指定网格线做法。</p>
</div>
<div id="ggplot2-refine-color" class="section level2">
<h2><span class="header-section-number">29.10</span> 如何使用颜色</h2>
<p>可以用颜色来表示分组，
比如，
不同组的散点用不同颜色，
多条曲线用不同颜色；
可以用颜色表示数值，
用颜色深浅表示绝对值大小；
可以用颜色来突出某些要强调的图形元素。</p>
<p>将变量值映射为颜色，
可以分为如下四种情况：</p>
<ul>
<li>无序的分类变量；</li>
<li>有序的分类变量，仅有大小次序，没有正反；</li>
<li>有序的分类变量，有正有反；</li>
<li>连续数值变量。</li>
</ul>
<div id="ggplot2-refine-qual" class="section level3">
<h3><span class="header-section-number">29.10.1</span> 名义型变量的颜色</h3>
<p>将无序的分类值映射到颜色，
应该使用完全不相像、很容易区分的颜色，
各个颜色应该没有明显次序、没有哪一个与其他明显不同。
可以用RColorBrewer扩展包提供的调色盘，
ggsci包也提供了一些调色盘。</p>
<p>在ggplot2中用<code>scale_color_brewer(palette)</code>和<code>scale_fill_brewer(palette)</code>选择RColorBrewer中的调色盘。
图<a href="ggplot2.html#fig:ggplot2-refine-color-brewer01">29.1</a>为无序分类适用的调色盘。
称这样的调色盘为名义型(qualitative)。</p>
<p>色盲的人会分辨不出某些颜色，
比如红绿色盲的人无法分辨红色和绿色，
蓝绿色盲的人无法分辨蓝色和绿色。
男性中有8%的人有色盲，
所以绘图时应该考虑到这个问题。
<span class="citation">(Wilke <a href="#ref-Wilke2019:visualization" role="doc-biblioref">2019</a>)</span>提供了8种对色盲也可区分的颜色：</p>
<table>
<caption><span id="tab:ggplot2-refine-colorqua-Wilke">表29.1: </span>8种对色盲可区分的颜色</caption>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">black</td>
<td align="left">#000000</td>
</tr>
<tr class="even">
<td align="left">orange</td>
<td align="left">#E69F00</td>
</tr>
<tr class="odd">
<td align="left">sky blue</td>
<td align="left">#56B4E9</td>
</tr>
<tr class="even">
<td align="left">bluish green</td>
<td align="left">#009E73</td>
</tr>
<tr class="odd">
<td align="left">yellow</td>
<td align="left">#F0E442</td>
</tr>
<tr class="even">
<td align="left">blue</td>
<td align="left">#0072B2</td>
</tr>
<tr class="odd">
<td align="left">vermilion</td>
<td align="left">#D55E00</td>
</tr>
<tr class="even">
<td align="left">reddish purple</td>
<td align="left">#CC79A7</td>
</tr>
</tbody>
</table>
<div class="figure"><span id="fig:ggplot2-refine-color-brewer01"></span>
<img src="static/picture/ggplot2-brewerqual-1.png" alt="无序分类适用的调色板" width="60%" />
<p class="caption">
图29.1: 无序分类适用的调色板
</p>
</div>
<p>例如，
作gapminder数据集中各国在2007年期望寿命对人均GDP的散点图，
不同大洲使用不同的颜色，
指定ColorBrewer的Set1调色板：</p>
<div class="sourceCode" id="cb1866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1866-1"><a href="ggplot2.html#cb1866-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>),</span>
<span id="cb1866-2"><a href="ggplot2.html#cb1866-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1866-3"><a href="ggplot2.html#cb1866-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1866-4"><a href="ggplot2.html#cb1866-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1866-5"><a href="ggplot2.html#cb1866-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span></span>
<span id="cb1866-6"><a href="ggplot2.html#cb1866-6"></a><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-refine-color-gap01-1.png" width="672" /></p>
<p>使用颜色进行强调时，
可以将要强调的点、线、条形用鲜明的颜色，
而非强调的用褪色的颜色。
最简单的做法是仅对要强调的内容指定一个鲜明的颜色。</p>
</div>
<div id="ggplot2-refine-tile" class="section level3">
<h3><span class="header-section-number">29.10.2</span> 色块图</h3>
<p><code>geom_tile()</code>、<code>geom_rect()</code>、<code>geom_raster()</code>可以用颜色画长方块。
<code>geom_tile()</code>指定每个长方块的中心位置(x和y)、宽度(width)和高度，
<code>geom_rect()</code>指定每个长方块的四个角的左右和上限坐标(xmin, xmax, ymin, ymax)，
<code>geom_raster()</code>是<code>geom_tile()</code>在长方块大小相同时的快速版本。</p>
<p>例如，表<a href="ggplot2.html#tab:ggplot2-refine-colorqua-Wilke">29.1</a>中的颜色图：</p>
<div class="sourceCode" id="cb1867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1867-1"><a href="ggplot2.html#cb1867-1"></a>d &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb1867-2"><a href="ggplot2.html#cb1867-2"></a>  <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">2</span>), </span>
<span id="cb1867-3"><a href="ggplot2.html#cb1867-3"></a>  <span class="dt">y =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">each=</span><span class="dv">4</span>),</span>
<span id="cb1867-4"><a href="ggplot2.html#cb1867-4"></a>  <span class="dt">fill =</span> dcolorqua<span class="op">$</span>code,</span>
<span id="cb1867-5"><a href="ggplot2.html#cb1867-5"></a>  <span class="dt">label =</span> dcolorqua<span class="op">$</span>name)</span>
<span id="cb1867-6"><a href="ggplot2.html#cb1867-6"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1867-7"><a href="ggplot2.html#cb1867-7"></a>  <span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">fill =</span> fill, <span class="dt">label =</span> label))</span>
<span id="cb1867-8"><a href="ggplot2.html#cb1867-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_raster</span>() <span class="op">+</span></span>
<span id="cb1867-9"><a href="ggplot2.html#cb1867-9"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb1867-10"><a href="ggplot2.html#cb1867-10"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-refine-color-tile01-1.png" width="672" /></p>
</div>
<div id="ggplot2-refine-seq" class="section level3">
<h3><span class="header-section-number">29.10.3</span> 有序型变量的颜色</h3>
<p>将连续的或者有序的值映射到颜色，
应该使用渐变色，
如果都是正值，
可以使用从浅到深或者从深到浅的颜色，
并且应该使用同一个颜色，只是深浅程度不同。
图<a href="ggplot2.html#fig:ggplot2-refine-color-brewer02">29.2</a>为单向的有序分类适用的调色板。
称这样的调色板为有序型(sequential)。</p>
<div class="figure"><span id="fig:ggplot2-refine-color-brewer02"></span>
<img src="static/picture/ggplot2-brewerseq-1.png" alt="有序单向分类适用的调色板" width="60%" />
<p class="caption">
图29.2: 有序单向分类适用的调色板
</p>
</div>
</div>
<div id="ggplot2-refine-div" class="section level3">
<h3><span class="header-section-number">29.10.4</span> 相异型变量的颜色</h3>
<p>如果颜色代表有正有负的数值（比如反对、中立、支持），
则应该以浅色为接近零值，
正值与负值分别用两个不同的颜色。
另外，
如果要代表的数值有明显的中间值，
为了强调较低的值与较高的值的对比，
也可以使用这样的颜色刻度。
图<a href="ggplot2.html#fig:ggplot2-refine-color-brewer03">29.3</a>为有正有负的有序分类适用的调色板。
称这样的调色板为相异型(diverging)。
相异型的渐变色有可能对色盲的人不可辨识，
<code>Colorbrewer::PiYG</code>刻度对色盲人群也可以分辨。</p>
<div class="figure"><span id="fig:ggplot2-refine-color-brewer03"></span>
<img src="static/picture/ggplot2-brewerdiv-1.png" alt="有序正负分类适用的调色板" width="60%" />
<p class="caption">
图29.3: 有序正负分类适用的调色板
</p>
</div>
</div>
<div id="ggplot2-refine-num" class="section level3">
<h3><span class="header-section-number">29.10.5</span> 连续数值变量的颜色</h3>
<p>可以将数值变量映射到颜色(color或者fill维)，
ggplot2可以自动选择映射关系，
也可以用<code>scale_color_gradient()</code>或<code>scale_color_gradient()</code>函数自己指定一个渐变色，
只需要指定渐变色的<code>low</code>和<code>high</code>两段颜色，
一般需要用颜色代码表示，
R扩展包colorpicker可以帮助挑选颜色。</p>
<p>对于只取非负值的变量，
对应的渐变色应该是仅从前到深或者从深到浅的，
使用默认参数调用<code>scale_color_gradient()</code>产生这种效果；
对于有正有负的变量，
就应该使用两种截然不同的颜色表示正负值，
用浅色表示接近0的值，
使用默认参数调用<code>scale_color_gradient2()</code>产生这种效果。</p>
</div>
</div>
<div id="ggplot2-auxfuncs" class="section level2">
<h2><span class="header-section-number">29.11</span> 标题、标注、指南、拼接</h2>
<p>除了<code>ggplot()</code>指定数据与映射，
<code>geom_xxx()</code>作图，
还可以用许多辅助函数增强图形。</p>
<ul>
<li><code>labs()</code>可以设置适当的标题和标签。</li>
<li><code>annotate()</code>函数可以直接在坐标系内进行文字、符号、线段、箭头、长方形的绘制。</li>
<li><code>guides()</code>函数可以控制图例的取舍以及做法。</li>
<li><code>theme()</code>函数可以控制一些整体的选项如背景色、字体类型、图例的摆放位置等。</li>
</ul>
<p>在需要修改图形时，
如果修改会影响到相应的<code>geom_xxx()</code>的主要结果，
一般需要在<code>ggplot()</code>或者该<code>geom_xxx()</code>函数中将适当的变量映射为某一维度，
或者用<code>scale_xxx()</code>函数进行变换。
如果仅仅是一些显示效果的修改，
则一般作为<code>geom_xxx()</code>的选项，
或者调用<code>labs()</code>、<code>theme()</code>、<code>guides()</code>完成。</p>
<div id="ggplot2-auxfuncs-labs" class="section level3">
<h3><span class="header-section-number">29.11.1</span> 标题</h3>
<p>函数<code>labs()</code>可以用来指定图形上方的标题(title)、副标题(subtitle)、右下方的标注(caption)、左上方的标签以及坐标轴标题和其它维的名称。
例如：</p>
<div class="sourceCode" id="cb1868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1868-1"><a href="ggplot2.html#cb1868-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</span>
<span id="cb1868-2"><a href="ggplot2.html#cb1868-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1868-3"><a href="ggplot2.html#cb1868-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1868-4"><a href="ggplot2.html#cb1868-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1868-5"><a href="ggplot2.html#cb1868-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1868-6"><a href="ggplot2.html#cb1868-6"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1868-7"><a href="ggplot2.html#cb1868-7"></a>    <span class="dt">title =</span> <span class="st">&quot;各国各年度人均GDP与期望寿命的关系&quot;</span>,</span>
<span id="cb1868-8"><a href="ggplot2.html#cb1868-8"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;1952-2007&quot;</span>,</span>
<span id="cb1868-9"><a href="ggplot2.html#cb1868-9"></a>    <span class="dt">tag =</span> <span class="st">&quot;散点图&quot;</span>,</span>
<span id="cb1868-10"><a href="ggplot2.html#cb1868-10"></a>    <span class="dt">caption =</span> <span class="st">&quot;数据来源：gapminder&quot;</span>,</span>
<span id="cb1868-11"><a href="ggplot2.html#cb1868-11"></a>    <span class="dt">x =</span> <span class="st">&quot;人均GDP(单位：美元)&quot;</span>,</span>
<span id="cb1868-12"><a href="ggplot2.html#cb1868-12"></a>    <span class="dt">y =</span> <span class="st">&quot;期望寿命&quot;</span></span>
<span id="cb1868-13"><a href="ggplot2.html#cb1868-13"></a>  )</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-labs01-1.png" width="672" /></p>
<p>在<code>labs()</code>中用<code>x=</code>、<code>y=</code>、<code>color=</code>之类的选项指定坐标轴的标签或者其它维的名称，
如果该维用了<code>scale_xxx()</code>函数，
则应该则<code>scale_xxx()</code>函数中用<code>name=</code>指定轴标签（名字）。
数值型的维度除非是显然的应在标签中包含单位。
<code>labs()</code>中或者<code>scale_xxx(name=)</code>中如果指定文字为<code>NULL</code>则取消该标题或标签，
但是取消坐标轴标签必须是取消标签后含义也显而易见，
没有任何疑问的情况。</p>
<p><code>labs()</code>只是提供了这些标题功能，
一般并不会同时使用这些功能。
在出版图书内，
图形下方一般伴随有图形说明，
这时一般就不再使用标题、副标题、标签、标注，
而只需写在图的伴随说明文字中，
当然，坐标轴标签一般还是需要的。</p>
<p>有一点要注意，
默认的标题、坐标轴标签、图例标签中的文字往往偏小，
如果单独放大这些图形来看并没有问题，
但是作为插图放在书中或者网页中就偏小了。
可以用<code>theme()</code>函数调整字体大小。</p>
</div>
<div id="ggplot2-auxfuncs-anno" class="section level3">
<h3><span class="header-section-number">29.11.2</span> 标注功能</h3>
<p>通过<code>annotate(geom = "text")</code>调用<code>geom_text()</code>的功能，
可以在一个散点图中标注多行文字，
多行之间用<code>"\n"</code>分开：</p>
<div class="sourceCode" id="cb1869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1869-1"><a href="ggplot2.html#cb1869-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder,</span>
<span id="cb1869-2"><a href="ggplot2.html#cb1869-2"></a>  <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1869-3"><a href="ggplot2.html#cb1869-3"></a>    <span class="dt">x =</span> gdpPercap,</span>
<span id="cb1869-4"><a href="ggplot2.html#cb1869-4"></a>    <span class="dt">y =</span> lifeExp))</span>
<span id="cb1869-5"><a href="ggplot2.html#cb1869-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1869-6"><a href="ggplot2.html#cb1869-6"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;gam&quot;</span>) <span class="op">+</span></span>
<span id="cb1869-7"><a href="ggplot2.html#cb1869-7"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1869-8"><a href="ggplot2.html#cb1869-8"></a><span class="st">  </span><span class="kw">annotate</span>(</span>
<span id="cb1869-9"><a href="ggplot2.html#cb1869-9"></a>    <span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb1869-10"><a href="ggplot2.html#cb1869-10"></a>    <span class="dt">x =</span> <span class="fl">1E2</span>, <span class="dt">y =</span> <span class="dv">85</span>, <span class="dt">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb1869-11"><a href="ggplot2.html#cb1869-11"></a>    <span class="dt">label=</span><span class="st">&quot;期望寿命与人均GDP的对数值呈线性关系，</span><span class="ch">\n</span><span class="st">建议建立相应的线性回归模型。&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="static/picture/ggplot2-auxfuncs-anno-gap01-1.png" width="672" /></p>
<p>在<code>annotate()</code>中选<code>geom = "rect"</code>，
给出长方形的左右和上限界限，
可以将上面图形中最右侧偏低的点用长方形填充标出。
可以在<code>annotate()</code>中选<code>geom = "line"</code>画线，
需要给出线的起点和终点坐标，
可以<code>arrow</code>选项要求画箭头，
用<code>arrow()</code>函数给出箭头的大小、角度等设置，
如：</p>
<div class="sourceCode" id="cb1871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1871-1"><a href="ggplot2.html#cb1871-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1871-2"><a href="ggplot2.html#cb1871-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;gam&quot;</span>) <span class="op">+</span></span>
<span id="cb1871-3"><a href="ggplot2.html#cb1871-3"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb1871-4"><a href="ggplot2.html#cb1871-4"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb1871-5"><a href="ggplot2.html#cb1871-5"></a>           <span class="dt">xmin =</span> <span class="fl">5.5E4</span>, <span class="dt">xmax =</span> <span class="fl">1.2E5</span>,</span>
<span id="cb1871-6"><a href="ggplot2.html#cb1871-6"></a>           <span class="dt">ymin =</span> <span class="dv">54</span>, <span class="dt">ymax =</span> <span class="dv">71</span>,</span>
<span id="cb1871-7"><a href="ggplot2.html#cb1871-7"></a>           <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1871-8"><a href="ggplot2.html#cb1871-8"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb1871-9"><a href="ggplot2.html#cb1871-9"></a>           <span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">5.9E4</span>, <span class="fl">3.16E4</span>),</span>
<span id="cb1871-10"><a href="ggplot2.html#cb1871-10"></a>           <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">53</span>,  <span class="dv">40</span>),</span>
<span id="cb1871-11"><a href="ggplot2.html#cb1871-11"></a>           <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">angle =</span> <span class="dv">20</span>, <span class="dt">length =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>))) <span class="op">+</span></span>
<span id="cb1871-12"><a href="ggplot2.html#cb1871-12"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb1871-13"><a href="ggplot2.html#cb1871-13"></a>           <span class="dt">x =</span> <span class="fl">3.16E4</span>, <span class="dt">y =</span> <span class="dv">38</span>,</span>
<span id="cb1871-14"><a href="ggplot2.html#cb1871-14"></a>           <span class="dt">label =</span> <span class="st">&quot;这些国家的期望寿命低于预期&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="static/picture/ggplot2-auxfuncs-anno-gap01b-1.png" width="672" /></p>
<p>这样标注的缺点是坐标都需要读图并试错摆放。</p>
<p>上述被标注的国家是：</p>
<div class="sourceCode" id="cb1873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1873-1"><a href="ggplot2.html#cb1873-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb1873-2"><a href="ggplot2.html#cb1873-2"></a><span class="st">  </span><span class="kw">filter</span>(gdpPercap <span class="op">&gt;</span><span class="st"> </span><span class="fl">5.5E4</span> <span class="op">&amp;</span><span class="st"> </span>gdpPercap <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.2E5</span>,</span>
<span id="cb1873-3"><a href="ggplot2.html#cb1873-3"></a>         lifeExp <span class="op">&gt;</span><span class="st"> </span><span class="dv">54</span> <span class="op">&amp;</span><span class="st"> </span>lifeExp <span class="op">&lt;</span><span class="st"> </span><span class="dv">71</span>) <span class="op">%&gt;%</span></span>
<span id="cb1873-4"><a href="ggplot2.html#cb1873-4"></a><span class="st">  </span><span class="kw">select</span>(country, gdpPercap, lifeExp)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country gdpPercap lifeExp
##   &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;
## 1 Kuwait    108382.    55.6
## 2 Kuwait    113523.    58.0
## 3 Kuwait     95458.    60.5
## 4 Kuwait     80895.    64.6
## 5 Kuwait    109348.    67.7
## 6 Kuwait     59265.    69.3</code></pre>
<p>可以用<code>geom_hline()</code>、<code>geom_vline()</code>和<code>geom_abline()</code>画横线、竖线、斜线。
ggplot2的默认主题会自动画参考线，
可以用<code>theme()</code>函数指定参考线画法。</p>
</div>
<div id="ggplot2-auxfuncs-guides" class="section level3">
<h3><span class="header-section-number">29.11.3</span> 指南(guides)</h3>
<p>对于颜色、填充色等维度，
会自动生成图例。
用<code>guides(color = FALSE)</code>这样的方法可以取消指定维度的图例。</p>
<p><code>theme()</code>可以调整一些整体的设置，
如背景色、字体、图例的摆放位置。
用<code>theme()</code>的<code>legend.position</code>改变图例的位置，
如<code>theme(legend.position = "top")</code>可以将图例放置在上方，
默认是放置在右侧的。
可取值有<code>"none"</code>、<code>"left"</code>、<code>"right"</code>、<code>"bottom"</code>、<code>"top"</code>，如：</p>
<div class="sourceCode" id="cb1875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1875-1"><a href="ggplot2.html#cb1875-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1875-2"><a href="ggplot2.html#cb1875-2"></a>  <span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width, <span class="dt">color =</span> Species))</span>
<span id="cb1875-3"><a href="ggplot2.html#cb1875-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb1875-4"><a href="ggplot2.html#cb1875-4"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-guide-iris01-1.png" width="672" /></p>
<p>图例位置<code>legend.position</code>还可以指定在作图区域内部用两个百分比数字给定，
同时可以用<code>legend.just</code>指定位置对准图例框的哪一个角，也是用两个百分比数字，
比如放在左上角内部：</p>
<div class="sourceCode" id="cb1876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1876-1"><a href="ggplot2.html#cb1876-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span></span>
<span id="cb1876-2"><a href="ggplot2.html#cb1876-2"></a><span class="st">  </span><span class="kw">theme</span>(</span>
<span id="cb1876-3"><a href="ggplot2.html#cb1876-3"></a>    <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.02</span>, <span class="fl">0.98</span>),</span>
<span id="cb1876-4"><a href="ggplot2.html#cb1876-4"></a>    <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)  )</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-guide-iris01b-1.png" width="672" /></p>
<p>某一维的图例做法可以在相应的<code>scale_xxx()</code>函数中用<code>guide=</code>指定，
或者在<code>guides()</code>中用<code>维名称=指南</code>方法指定，
如<code>guides(fill = "guides")</code>或者<code>guides(fill = "colorbar")</code>。
指定的指南还可以是<code>guide_legend()</code>或者<code>guide_colorbar()</code>的结果，
在这两个函数中可以用多个选项指定指南或颜色条的具体做法。</p>
<p>有一个directlabels包，
可以巧妙地将各类的图例直接就进标在坐标系内部。</p>
</div>
<div id="ggplot2-auxfuncs-compfig" class="section level3">
<h3><span class="header-section-number">29.11.4</span> 拼接图形</h3>
<p><code>facet_wrap()</code>和<code>facet_grid()</code>可以按照某一个或两个分类变量的值将输入数据集分为若干个子集，
将每个子集分别在一个小图上绘图。
有时还需要将几幅不同图形拼在一起，
这些图形可以是同一数据的不同类型图形，
也可以是完全无关的图形。</p>
<p>在拼接图形时，
各个小图应该具有类似的风格，
即背景、配色、字体等应该尽可能一致，
上下和左右的坐标轴应尽可能对齐，
小图的标签应该尽可能不显眼。</p>
<p>cowplot包提供了拼接图形的办法，
使用时先将每个小图分别赋值给一个R变量，
然后用<code>plot_grid()</code>函数摆放在一幅图中。</p>
<p>例如，
19个学生的性别、年龄、身高、体重数据：</p>
<div class="sourceCode" id="cb1877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1877-1"><a href="ggplot2.html#cb1877-1"></a><span class="kw">library</span>(cowplot)</span>
<span id="cb1877-2"><a href="ggplot2.html#cb1877-2"></a>dclass &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</span>
<span id="cb1877-3"><a href="ggplot2.html#cb1877-3"></a>  <span class="st">&quot;class.csv&quot;</span>, </span>
<span id="cb1877-4"><a href="ggplot2.html#cb1877-4"></a>  <span class="dt">col_types=</span><span class="kw">cols</span>(</span>
<span id="cb1877-5"><a href="ggplot2.html#cb1877-5"></a>  <span class="dt">.default =</span> <span class="kw">col_double</span>(),</span>
<span id="cb1877-6"><a href="ggplot2.html#cb1877-6"></a>  <span class="dt">name=</span><span class="kw">col_character</span>(),</span>
<span id="cb1877-7"><a href="ggplot2.html#cb1877-7"></a>  <span class="dt">sex=</span><span class="kw">col_factor</span>(<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>))</span>
<span id="cb1877-8"><a href="ggplot2.html#cb1877-8"></a>))</span>
<span id="cb1877-9"><a href="ggplot2.html#cb1877-9"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dclass, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> sex, <span class="dt">fill =</span> sex)) <span class="op">+</span></span>
<span id="cb1877-10"><a href="ggplot2.html#cb1877-10"></a><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb1877-11"><a href="ggplot2.html#cb1877-11"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb1877-12"><a href="ggplot2.html#cb1877-12"></a>    <span class="dt">guide =</span> <span class="ot">FALSE</span>,</span>
<span id="cb1877-13"><a href="ggplot2.html#cb1877-13"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;F&quot;</span> =<span class="st"> &quot;chocolate1&quot;</span>, </span>
<span id="cb1877-14"><a href="ggplot2.html#cb1877-14"></a>               <span class="st">&quot;M&quot;</span> =<span class="st"> &quot;skyblue1&quot;</span>)  ) </span>
<span id="cb1877-15"><a href="ggplot2.html#cb1877-15"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dclass, <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1877-16"><a href="ggplot2.html#cb1877-16"></a>  <span class="dt">x =</span> height, <span class="dt">y =</span> weight, <span class="dt">color =</span> sex)) <span class="op">+</span></span>
<span id="cb1877-17"><a href="ggplot2.html#cb1877-17"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb1877-18"><a href="ggplot2.html#cb1877-18"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(</span>
<span id="cb1877-19"><a href="ggplot2.html#cb1877-19"></a>    <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;F&quot;</span> =<span class="st"> &quot;chocolate1&quot;</span>, </span>
<span id="cb1877-20"><a href="ggplot2.html#cb1877-20"></a>               <span class="st">&quot;M&quot;</span> =<span class="st"> &quot;skyblue1&quot;</span>)  )</span>
<span id="cb1877-21"><a href="ggplot2.html#cb1877-21"></a>  </span>
<span id="cb1877-22"><a href="ggplot2.html#cb1877-22"></a><span class="kw">plot_grid</span>(</span>
<span id="cb1877-23"><a href="ggplot2.html#cb1877-23"></a>  p1, p2, <span class="dt">labels =</span> <span class="st">&quot;auto&quot;</span>, </span>
<span id="cb1877-24"><a href="ggplot2.html#cb1877-24"></a>  <span class="dt">rel_widths =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.6</span>), </span>
<span id="cb1877-25"><a href="ggplot2.html#cb1877-25"></a>  <span class="dt">align =</span> <span class="st">&quot;h&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/ggplot2-auxfuncs-compfig-class01-1.png" width="672" /></p>
<p><code>plot_grid()</code>中用<code>rel_widths</code>指定了左右图的相对比例，
默认是均分的。
当图形上下排列时，可以用<code>rel_height</code>指定上下排的比例。
程序中用了<code>align = "h"</code>使得左右图上下对齐，
<code>align</code>默认取<code>"none"</code>，
也可以取<code>"h"</code>、<code>"v"</code>或<code>"hv"</code>。
可以用<code>ncol</code>指定图的列数，
用<code>nrow</code>指定图的行数。</p>
<p>还可以通过嵌套调用<code>plot_grid()</code>方式实现非网格的排列。</p>
</div>
</div>
<div id="ggplot2-refine" class="section level2">
<h2><span class="header-section-number">29.12</span> 图形定制调整</h2>
<p>ggplot2的默认设置一般能够满足我们的要求，
只有在有特殊的图形类型需求或者制作出版用的图形时，
才需要对图形进行定制调整。
图形调整可以包括：</p>
<ul>
<li>配色、位置摆放等审美方面的调整；</li>
<li>面向目标出版物或者目标读者的调整；</li>
<li>增加有意义的标注；</li>
<li>调整整体的观感。</li>
</ul>
<div id="ggplot2-refine-asasec" class="section level3">
<h3><span class="header-section-number">29.12.1</span> 图形逐步调整例子</h3>
<p>socviz扩展包的asasec数据集是美国社会学学会(ASA)的各分会2005年到2015年的一些数据，
其中的财务数据(Beginning, Revenues, Expenses, Ending)虽然各年都有值，
但实际是用2015年的值填进去的。</p>
<p>作2014年收入对会员数的散点图与拟合曲线，
每个散点是一个分会：</p>
<div class="sourceCode" id="cb1878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1878-1"><a href="ggplot2.html#cb1878-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(asasec, Year <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>),</span>
<span id="cb1878-2"><a href="ggplot2.html#cb1878-2"></a>    <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb1878-3"><a href="ggplot2.html#cb1878-3"></a>      <span class="dt">x =</span> Members, </span>
<span id="cb1878-4"><a href="ggplot2.html#cb1878-4"></a>      <span class="dt">y =</span> Revenues,</span>
<span id="cb1878-5"><a href="ggplot2.html#cb1878-5"></a>      <span class="dt">label =</span> Sname))</span>
<span id="cb1878-6"><a href="ggplot2.html#cb1878-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb1878-7"><a href="ggplot2.html#cb1878-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-refine-asasec01-1.png" width="672" /></p>
<p>程序中的映射<code>label = Sname</code>暂时不起作用，
在<code>geom_text()</code>中才需要这一维度。</p>
<p>下面按照有无期刊染色，
将平滑方法改为线性回归：</p>
<div class="sourceCode" id="cb1880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1880-1"><a href="ggplot2.html#cb1880-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> Journal)) <span class="op">+</span></span>
<span id="cb1880-2"><a href="ggplot2.html#cb1880-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-refine-asasec01b-1.png" width="672" /></p>
<p>注意<code>color = Journal</code>的映射仅对<code>geom_point()</code>有效，
如果写在<code>ggplot()</code>中，
就对<code>geom_smooth()</code>也有效了。</p>
<p>下面标出异常值：</p>
<div class="sourceCode" id="cb1882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1882-1"><a href="ggplot2.html#cb1882-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> Journal)) <span class="op">+</span></span>
<span id="cb1882-2"><a href="ggplot2.html#cb1882-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span></span>
<span id="cb1882-3"><a href="ggplot2.html#cb1882-3"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> <span class="kw">subset</span>(asasec, Year <span class="op">==</span><span class="st"> </span><span class="dv">2014</span> <span class="op">&amp;</span><span class="st"> </span>Revenues <span class="op">&gt;</span><span class="st"> </span><span class="dv">7000</span>))</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-refine-asasec01c-1.png" width="672" /></p>
<p>下面用<code>labs()</code>调整标题、用<code>scale_y_continuous()</code>调整y轴刻度标法、用<code>theme()</code>调整图例位置：</p>
<div class="sourceCode" id="cb1884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1884-1"><a href="ggplot2.html#cb1884-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> Journal)) <span class="op">+</span></span>
<span id="cb1884-2"><a href="ggplot2.html#cb1884-2"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span></span>
<span id="cb1884-3"><a href="ggplot2.html#cb1884-3"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> <span class="kw">subset</span>(asasec, Year <span class="op">==</span><span class="st"> </span><span class="dv">2014</span> <span class="op">&amp;</span><span class="st"> </span>Revenues <span class="op">&gt;</span><span class="st"> </span><span class="dv">7000</span>)) <span class="op">+</span></span>
<span id="cb1884-4"><a href="ggplot2.html#cb1884-4"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb1884-5"><a href="ggplot2.html#cb1884-5"></a>    <span class="dt">title =</span> <span class="st">&quot;ASA分会&quot;</span>,</span>
<span id="cb1884-6"><a href="ggplot2.html#cb1884-6"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;2014年&quot;,</span></span>
<span id="cb1884-7"><a href="ggplot2.html#cb1884-7"></a><span class="st">    x = &quot;</span>分会会员数<span class="st">&quot;,</span></span>
<span id="cb1884-8"><a href="ggplot2.html#cb1884-8"></a><span class="st">    y = &quot;</span>收益<span class="st">&quot;,</span></span>
<span id="cb1884-9"><a href="ggplot2.html#cb1884-9"></a><span class="st">    color = &quot;</span>分会有无期刊<span class="st">&quot;,</span></span>
<span id="cb1884-10"><a href="ggplot2.html#cb1884-10"></a><span class="st">    caption = &quot;</span>数据来源：ASA年报<span class="st">&quot;  ) +</span></span>
<span id="cb1884-11"><a href="ggplot2.html#cb1884-11"></a><span class="st">  scale_y_continuous(labels = scales::dollar) +</span></span>
<span id="cb1884-12"><a href="ggplot2.html#cb1884-12"></a><span class="st">  theme(legend.position = &quot;</span>bottom<span class="st">&quot;)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="static/picture/ggplot2-refine-asasec01d-1.png" width="672" /></p>
</div>
</div>
<div id="ggplot2-theme" class="section level2">
<h2><span class="header-section-number">29.13</span> 主题</h2>
<p>ggplot2包作图可以实现内容与设计的分离，
这里内容就是指数据、映射、统计、图形类型等方面，
而设计就是指背景色、颜色表、字体、坐标轴做法、图例位置等的安排。
将作图任务分解为内容与设计两个方面，
可以让数据科学家不必关心设计有关的元素，
而设计可以让专门的艺术设计人才来处理。
这种工作分配已经在图书出版、网站、游戏开发等行业发挥了重要作用。</p>
<p><code>theme()</code>函数用来指定设计元素，称为主题(theme)，
而且可以单独开发R扩展包来提供适当的主题。
ggthemes扩展包是一个这样的包。</p>
<p><code>theme(legend.position)</code>可以用来选择图例位置。
<code>theme_set()</code>可以改变后续ggplot2作图的主题（配色、字体等）。
如<code>theme_set(theme_bw())</code>, <code>theme_set(theme_dark())</code>等。
对单次绘图，
可以直接用加号连接<code>theme_gray()</code>等这些主题函数。
主题包括<code>theme_gray()</code>（默认主题）、
<code>theme_minimal()</code>、<code>theme_classic()</code>等。
ggthemes扩展包提供了更多的主题选择。</p>
<p><code>theme()</code>函数还可以直接指定颜色、字体、大小等设置。</p>
</div>
<div id="ggplot2-ref" class="section level2">
<h2><span class="header-section-number">29.14</span> 参考文献</h2>
<ul>
<li>Cleveland, W. S. (1993).
The elements of graphing data.
Hobart Press.</li>
<li>Cleveland, W. S. (1994).
Visualizing data.
Hobart Press.</li>
<li>Cleveland, W. S., &amp; McGill, R. (1984).
Graphical perception: Theory, experimentation, and application to the development of graphical methods.
Journal of the American Statistical Association, 79, 531–534.</li>
<li>Cleveland, W. S., &amp; McGill, R. (1987).
Graphical perception: The visual decoding of quantitative information on graphical displays of data.
Journal of the Royal Statistical Society Series A, 150, 192–229.</li>
<li>Edward R. Tufte((1983)
The Visual Display of Quantitative Information</li>
<li>Tufte, E. R. (1983).
The visual display of quantitative information.
Cheshire, CT: Graphics Press.</li>
<li>Tufte, E. R. (1990).
Envisioning information.
Cheshire, CT: Graphics Press.</li>
<li>Tufte, E. R. (1997).
Visual explanations: Images and quantities, evidence and narrative.
Cheshire, CT: Graphics Press.</li>
<li>Wickham, H. (2016).
Ggplot2: Elegant graphics for data analysis.
New York: Springer.</li>
<li>Wickham, H., &amp; Chang, W. (2018).
Ggplot2: Create elegant data visualisations using the grammar of graphics.</li>
<li>Wilkinson, L. (2005).
The grammar of graphics (Second).
New York: Springer.</li>
</ul>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Wilke2019:visualization">
<p>Wilke, Claus O. 2019. <em>Fundamentals of Data Visualization: A Primer on Making Informative and Compelling Figures</em>. O’Reilly Media. <a href="https://serialmentor.com/dataviz/">https://serialmentor.com/dataviz/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="graph.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplotvis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="static/js/app.min.js"></script>
<script src="static/js/lunr.js"></script>
<script src="static/js/clipboard.min.js"></script>
<script src="static/js/plugin-search.js"></script>
<script src="static/js/plugin-sharing.js"></script>
<script src="static/js/plugin-fontsettings.js"></script>
<script src="static/js/plugin-bookdown.js"></script>
<script src="static/js/jquery.highlight.js"></script>
<script src="static/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Rbook.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
