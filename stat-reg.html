<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>32 R相关与回归 | R语言教程</title>
  <meta name="description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="32 R相关与回归 | R语言教程" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="32 R相关与回归 | R语言教程" />
  
  <meta name="twitter:description" content="李东风在北京大学数学科学学院开设本科生《统计软件》教材。采用R的bookdown制作，输出格式为bookdown::gitbook." />
  

<meta name="author" content="李东风" />


<meta name="date" content="2020-12-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="stat-basics.html"/>
<link rel="next" href="stat-tsa.html"/>
<script src="static/js/jquery.min.js"></script>
<link href="static/css/style.css" rel="stylesheet" />
<link href="static/css/plugin-table.css" rel="stylesheet" />
<link href="static/css/plugin-bookdown.css" rel="stylesheet" />
<link href="static/css/plugin-highlight.css" rel="stylesheet" />
<link href="static/css/plugin-search.css" rel="stylesheet" />
<link href="static/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="static/css/plugin-clipboard.css" rel="stylesheet" />






<div style="display:none">
    <script src="http://s11.cnzz.com/z_stat.php?id=610720&web_id=610720" language="JavaScript"></script>
</div>





<script src="static/js/empty-anchor.js"></script>
<script src="static/js/htmlwidgets.js"></script>
<link href="static/css/str_view.css" rel="stylesheet" />
<script src="static/js/str_view.js"></script>
<link href="static/css/wordcloud.css" rel="stylesheet" />
<script src="static/js/wordcloud2-all.js"></script>
<script src="static/js/hover.js"></script>
<script src="static/js/wordcloud2.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="static/js/mathjax.js">
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html">R语言教程</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="part"><span><b>I 介绍</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> R语言介绍</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#intro-hist-char"><i class="fa fa-check"></i><b>1.1</b> R的历史和特点</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#intro-hc-hist"><i class="fa fa-check"></i><b>1.1.1</b> R的历史</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro.html"><a href="intro.html#intro-hc-char"><i class="fa fa-check"></i><b>1.1.2</b> R的特点</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#intro-install"><i class="fa fa-check"></i><b>1.2</b> R的下载与安装</a><ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#intro-ins-down"><i class="fa fa-check"></i><b>1.2.1</b> R的下载</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#intro-ins-install"><i class="fa fa-check"></i><b>1.2.2</b> R软件安装</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#intro-ins-other-soft"><i class="fa fa-check"></i><b>1.2.3</b> 辅助软件</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#intro-ins-packages"><i class="fa fa-check"></i><b>1.3</b> R扩展软件包的安装与管理</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#intro-ins-pack-ins"><i class="fa fa-check"></i><b>1.3.1</b> 安装</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#intro-ins-pack-gitbioc"><i class="fa fa-check"></i><b>1.3.2</b> Github和BioConductor的扩展包</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#intro-ins-pack-upd"><i class="fa fa-check"></i><b>1.3.3</b> 更新扩展包</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#intro-ins-pack-verup"><i class="fa fa-check"></i><b>1.3.4</b> 迁移扩展包</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#intro-ins-pack-renv"><i class="fa fa-check"></i><b>1.3.5</b> 项目私有扩展包目录</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#intro-ruse"><i class="fa fa-check"></i><b>1.4</b> 基本R软件的用法</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#intro-ruse-run"><i class="fa fa-check"></i><b>1.4.1</b> 基本运行</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#intro-ruse-proj"><i class="fa fa-check"></i><b>1.4.2</b> 项目目录</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#intro-rstudio"><i class="fa fa-check"></i><b>1.5</b> RStudio软件</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#intro-rstudio-intro"><i class="fa fa-check"></i><b>1.5.1</b> 介绍</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#intro-rstudio-proj"><i class="fa fa-check"></i><b>1.5.2</b> 项目</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro.html"><a href="intro.html#intro-rstudio-help"><i class="fa fa-check"></i><b>1.5.3</b> 帮助</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro.html"><a href="intro.html#intro-rstudio-shortcuts"><i class="fa fa-check"></i><b>1.5.4</b> 使用技巧</a></li>
<li class="chapter" data-level="1.5.5" data-path="intro.html"><a href="intro.html#intro-rstudio-rmd"><i class="fa fa-check"></i><b>1.5.5</b> Rmd文件</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#intro-ins-ex"><i class="fa fa-check"></i><b>1.6</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-example.html"><a href="intro-example.html"><i class="fa fa-check"></i><b>2</b> R语言入门运行样例</a><ul>
<li class="chapter" data-level="2.1" data-path="intro-example.html"><a href="intro-example.html#i-e-command-line"><i class="fa fa-check"></i><b>2.1</b> 命令行界面</a></li>
<li class="chapter" data-level="2.2" data-path="intro-example.html"><a href="intro-example.html#i-e-arith-op"><i class="fa fa-check"></i><b>2.2</b> 四则运算</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro-example.html"><a href="intro-example.html#i-e-arith-op-poker"><i class="fa fa-check"></i><b>2.2.1</b> 计算例子</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro-example.html"><a href="intro-example.html#i-e-a-o-ex"><i class="fa fa-check"></i><b>2.2.2</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro-example.html"><a href="intro-example.html#i-e-math-func"><i class="fa fa-check"></i><b>2.3</b> 数学函数</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-sqrt"><i class="fa fa-check"></i><b>2.3.1</b> 数学函数——平方根、指数、对数</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-round"><i class="fa fa-check"></i><b>2.3.2</b> 数学函数——取整</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-sin"><i class="fa fa-check"></i><b>2.3.3</b> 数学函数——三角函数</a></li>
<li class="chapter" data-level="2.3.4" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-asin"><i class="fa fa-check"></i><b>2.3.4</b> 数学函数——反三角函数</a></li>
<li class="chapter" data-level="2.3.5" data-path="intro-example.html"><a href="intro-example.html#i-e-m-f-dist"><i class="fa fa-check"></i><b>2.3.5</b> 分布函数和分位数函数</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro-example.html"><a href="intro-example.html#i-e-output"><i class="fa fa-check"></i><b>2.4</b> 输出</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro-example.html"><a href="intro-example.html#i-e-o-simple"><i class="fa fa-check"></i><b>2.4.1</b> 简单输出</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro-example.html"><a href="intro-example.html#i-e-o-sink"><i class="fa fa-check"></i><b>2.4.2</b> 用<code>sink()</code>函数作运行记录</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro-example.html"><a href="intro-example.html#i-e-o-ex"><i class="fa fa-check"></i><b>2.4.3</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-example.html"><a href="intro-example.html#i-e-vector"><i class="fa fa-check"></i><b>2.5</b> 向量计算与变量赋值</a></li>
<li class="chapter" data-level="2.6" data-path="intro-example.html"><a href="intro-example.html#i-e-workspace"><i class="fa fa-check"></i><b>2.6</b> 工作空间介绍</a><ul>
<li class="chapter" data-level="2.6.1" data-path="intro-example.html"><a href="intro-example.html#i-e-w-ex"><i class="fa fa-check"></i><b>2.6.1</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="intro-example.html"><a href="intro-example.html#i-e-graph"><i class="fa fa-check"></i><b>2.7</b> 绘图示例</a><ul>
<li class="chapter" data-level="2.7.1" data-path="intro-example.html"><a href="intro-example.html#i-e-g-curve"><i class="fa fa-check"></i><b>2.7.1</b> 函数曲线示例</a></li>
<li class="chapter" data-level="2.7.2" data-path="intro-example.html"><a href="intro-example.html#i-e-g-barplot"><i class="fa fa-check"></i><b>2.7.2</b> 条形图示例</a></li>
<li class="chapter" data-level="2.7.3" data-path="intro-example.html"><a href="intro-example.html#i-e-g-scatter"><i class="fa fa-check"></i><b>2.7.3</b> 散点图示例</a></li>
<li class="chapter" data-level="2.7.4" data-path="intro-example.html"><a href="intro-example.html#i-e-g-demo"><i class="fa fa-check"></i><b>2.7.4</b> R软件自带的图形示例</a></li>
<li class="chapter" data-level="2.7.5" data-path="intro-example.html"><a href="intro-example.html#i-e-g-ex"><i class="fa fa-check"></i><b>2.7.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="intro-example.html"><a href="intro-example.html#i-e-summary"><i class="fa fa-check"></i><b>2.8</b> 汇总统计示例</a><ul>
<li class="chapter" data-level="2.8.1" data-path="intro-example.html"><a href="intro-example.html#i-e-s-table"><i class="fa fa-check"></i><b>2.8.1</b> 表格数据</a></li>
<li class="chapter" data-level="2.8.2" data-path="intro-example.html"><a href="intro-example.html#i-e-s-t-read-table"><i class="fa fa-check"></i><b>2.8.2</b> 读入表格数据</a></li>
<li class="chapter" data-level="2.8.3" data-path="intro-example.html"><a href="intro-example.html#i-e-s-ex"><i class="fa fa-check"></i><b>2.8.3</b> 练习</a></li>
<li class="chapter" data-level="2.8.4" data-path="intro-example.html"><a href="intro-example.html#i-e-s-qual-freq"><i class="fa fa-check"></i><b>2.8.4</b> 分类变量频数统计</a></li>
<li class="chapter" data-level="2.8.5" data-path="intro-example.html"><a href="intro-example.html#i-e-s-num-summ"><i class="fa fa-check"></i><b>2.8.5</b> 数值型变量的统计</a></li>
<li class="chapter" data-level="2.8.6" data-path="intro-example.html"><a href="intro-example.html#i-e-s-ex2"><i class="fa fa-check"></i><b>2.8.6</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="intro-example.html"><a href="intro-example.html#i-e-source"><i class="fa fa-check"></i><b>2.9</b> 运行源程序文件</a><ul>
<li class="chapter" data-level="2.9.1" data-path="intro-example.html"><a href="intro-example.html#i-e-source-enc"><i class="fa fa-check"></i><b>2.9.1</b> 源文件编码</a></li>
<li class="chapter" data-level="2.9.2" data-path="intro-example.html"><a href="intro-example.html#i-e-cwd"><i class="fa fa-check"></i><b>2.9.2</b> 当前工作目录</a></li>
<li class="chapter" data-level="2.9.3" data-path="intro-example.html"><a href="intro-example.html#i-e-source-ex"><i class="fa fa-check"></i><b>2.9.3</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="intro-example.html"><a href="intro-example.html#i-e-appendix-data"><i class="fa fa-check"></i><b>2.10</b> 附录：数据</a><ul>
<li class="chapter" data-level="2.10.1" data-path="intro-example.html"><a href="intro-example.html#i-e-appendix-data-tax"><i class="fa fa-check"></i><b>2.10.1</b> 公司纳税数据样例</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II 数据类型与相应的运算</b></span></li>
<li class="chapter" data-level="3" data-path="prog-type-intro.html"><a href="prog-type-intro.html"><i class="fa fa-check"></i><b>3</b> 常量与变量</a><ul>
<li class="chapter" data-level="3.1" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-const"><i class="fa fa-check"></i><b>3.1</b> 常量</a></li>
<li class="chapter" data-level="3.2" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-cv-var"><i class="fa fa-check"></i><b>3.2</b> 变量</a></li>
<li class="chapter" data-level="3.3" data-path="prog-type-intro.html"><a href="prog-type-intro.html#p-t-type"><i class="fa fa-check"></i><b>3.3</b> R数据类型</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prog-type-num.html"><a href="prog-type-num.html"><i class="fa fa-check"></i><b>4</b> 数值型向量及其运算</a><ul>
<li class="chapter" data-level="4.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-num"><i class="fa fa-check"></i><b>4.1</b> 数值型向量</a></li>
<li class="chapter" data-level="4.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith"><i class="fa fa-check"></i><b>4.2</b> 向量运算</a><ul>
<li class="chapter" data-level="4.2.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-scalar"><i class="fa fa-check"></i><b>4.2.1</b> 标量和标量运算</a></li>
<li class="chapter" data-level="4.2.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-with-scalar"><i class="fa fa-check"></i><b>4.2.2</b> 向量与标量运算</a></li>
<li class="chapter" data-level="4.2.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-eq-len"><i class="fa fa-check"></i><b>4.2.3</b> 等长向量运算</a></li>
<li class="chapter" data-level="4.2.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-arith-vec-uneq-len"><i class="fa fa-check"></i><b>4.2.4</b> 不等长向量的运算</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc"><i class="fa fa-check"></i><b>4.3</b> 向量函数</a><ul>
<li class="chapter" data-level="4.3.1" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-vector-func"><i class="fa fa-check"></i><b>4.3.1</b> 向量化的函数</a></li>
<li class="chapter" data-level="4.3.2" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-sort"><i class="fa fa-check"></i><b>4.3.2</b> 排序函数</a></li>
<li class="chapter" data-level="4.3.3" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-stat"><i class="fa fa-check"></i><b>4.3.3</b> 统计函数</a></li>
<li class="chapter" data-level="4.3.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-seq"><i class="fa fa-check"></i><b>4.3.4</b> 生成规则序列的函数</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-complex"><i class="fa fa-check"></i><b>4.4</b> 复数向量</a></li>
<li class="chapter" data-level="4.5" data-path="prog-type-num.html"><a href="prog-type-num.html#p-t-vfunc-ex"><i class="fa fa-check"></i><b>4.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="prog-type-logi.html"><a href="prog-type-logi.html"><i class="fa fa-check"></i><b>5</b> 逻辑型向量及其运算</a><ul>
<li class="chapter" data-level="5.1" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-logical-vec"><i class="fa fa-check"></i><b>5.1</b> 逻辑型向量与比较运算</a></li>
<li class="chapter" data-level="5.2" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-lvec-logic-op"><i class="fa fa-check"></i><b>5.2</b> 逻辑运算</a></li>
<li class="chapter" data-level="5.3" data-path="prog-type-logi.html"><a href="prog-type-logi.html#p-t-lvec-logic-op-vec"><i class="fa fa-check"></i><b>5.3</b> 逻辑运算函数</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="prog-type-char.html"><a href="prog-type-char.html"><i class="fa fa-check"></i><b>6</b> 字符型数据及其处理</a><ul>
<li class="chapter" data-level="6.1" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char"><i class="fa fa-check"></i><b>6.1</b> 字符型向量</a></li>
<li class="chapter" data-level="6.2" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-paste"><i class="fa fa-check"></i><b>6.2</b> <code>paste()</code>函数</a></li>
<li class="chapter" data-level="6.3" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-toupper"><i class="fa fa-check"></i><b>6.3</b> 转换大小写</a></li>
<li class="chapter" data-level="6.4" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-nchar"><i class="fa fa-check"></i><b>6.4</b> 字符串长度</a></li>
<li class="chapter" data-level="6.5" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-substr"><i class="fa fa-check"></i><b>6.5</b> 取子串</a></li>
<li class="chapter" data-level="6.6" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-asnum"><i class="fa fa-check"></i><b>6.6</b> 类型转换</a></li>
<li class="chapter" data-level="6.7" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-strsplit"><i class="fa fa-check"></i><b>6.7</b> 字符串拆分</a></li>
<li class="chapter" data-level="6.8" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-gsub"><i class="fa fa-check"></i><b>6.8</b> 字符串替换功能</a></li>
<li class="chapter" data-level="6.9" data-path="prog-type-char.html"><a href="prog-type-char.html#p-t-char-regexp"><i class="fa fa-check"></i><b>6.9</b> 正则表达式</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="prog-type-index.html"><a href="prog-type-index.html"><i class="fa fa-check"></i><b>7</b> R向量下标和子集</a><ul>
<li class="chapter" data-level="7.1" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-int"><i class="fa fa-check"></i><b>7.1</b> 正整数下标</a></li>
<li class="chapter" data-level="7.2" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-negint"><i class="fa fa-check"></i><b>7.2</b> 负整数下标</a></li>
<li class="chapter" data-level="7.3" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-all"><i class="fa fa-check"></i><b>7.3</b> 空下标与零下标</a></li>
<li class="chapter" data-level="7.4" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-over"><i class="fa fa-check"></i><b>7.4</b> 下标超界</a></li>
<li class="chapter" data-level="7.5" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-logic"><i class="fa fa-check"></i><b>7.5</b> 逻辑下标</a></li>
<li class="chapter" data-level="7.6" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-which"><i class="fa fa-check"></i><b>7.6</b> <code>which()</code>、<code>which.min()</code>、<code>which.max()</code>函数</a></li>
<li class="chapter" data-level="7.7" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-names"><i class="fa fa-check"></i><b>7.7</b> 元素名</a></li>
<li class="chapter" data-level="7.8" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-mapping"><i class="fa fa-check"></i><b>7.8</b> 用R向量下标作映射</a></li>
<li class="chapter" data-level="7.9" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-subset-set"><i class="fa fa-check"></i><b>7.9</b> 集合运算</a></li>
<li class="chapter" data-level="7.10" data-path="prog-type-index.html"><a href="prog-type-index.html#p-t-set-ex"><i class="fa fa-check"></i><b>7.10</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="prog-type-attr.html"><a href="prog-type-attr.html"><i class="fa fa-check"></i><b>8</b> R数据类型的性质</a><ul>
<li class="chapter" data-level="8.1" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-typeof"><i class="fa fa-check"></i><b>8.1</b> 存储模式与基本类型</a></li>
<li class="chapter" data-level="8.2" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-as"><i class="fa fa-check"></i><b>8.2</b> 类型转换与类型升档</a></li>
<li class="chapter" data-level="8.3" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr"><i class="fa fa-check"></i><b>8.3</b> 属性</a><ul>
<li class="chapter" data-level="8.3.1" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-asfun"><i class="fa fa-check"></i><b>8.3.1</b> <code>attributes</code>函数</a></li>
<li class="chapter" data-level="8.3.2" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-attrfun"><i class="fa fa-check"></i><b>8.3.2</b> <code>attr</code>函数</a></li>
<li class="chapter" data-level="8.3.3" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-names"><i class="fa fa-check"></i><b>8.3.3</b> <code>names</code>属性</a></li>
<li class="chapter" data-level="8.3.4" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-attr-dim"><i class="fa fa-check"></i><b>8.3.4</b> <code>dim</code>属性</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-class"><i class="fa fa-check"></i><b>8.4</b> 类属</a></li>
<li class="chapter" data-level="8.5" data-path="prog-type-attr.html"><a href="prog-type-attr.html#p-t-modes-str"><i class="fa fa-check"></i><b>8.5</b> <code>str()</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="prog-type-date.html"><a href="prog-type-date.html"><i class="fa fa-check"></i><b>9</b> R日期时间</a><ul>
<li class="chapter" data-level="9.1" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-intro"><i class="fa fa-check"></i><b>9.1</b> R日期和日期时间类型</a></li>
<li class="chapter" data-level="9.2" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-fromchr"><i class="fa fa-check"></i><b>9.2</b> 从字符串生成日期数据</a></li>
<li class="chapter" data-level="9.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-format"><i class="fa fa-check"></i><b>9.3</b> 日期显示格式</a></li>
<li class="chapter" data-level="9.4" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-comp"><i class="fa fa-check"></i><b>9.4</b> 访问日期时间的组成值</a></li>
<li class="chapter" data-level="9.5" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-round"><i class="fa fa-check"></i><b>9.5</b> 日期舍入计算</a></li>
<li class="chapter" data-level="9.6" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc"><i class="fa fa-check"></i><b>9.6</b> 日期计算</a><ul>
<li class="chapter" data-level="9.6.1" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-dur"><i class="fa fa-check"></i><b>9.6.1</b> 时间长度</a></li>
<li class="chapter" data-level="9.6.2" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-per"><i class="fa fa-check"></i><b>9.6.2</b> 时间周期</a></li>
<li class="chapter" data-level="9.6.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-calc-int"><i class="fa fa-check"></i><b>9.6.3</b> 时间区间</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="prog-type-date.html"><a href="prog-type-date.html#prog-type-dt-baser"><i class="fa fa-check"></i><b>9.7</b> 基本R软件的日期功能</a><ul>
<li class="chapter" data-level="9.7.1" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-gen"><i class="fa fa-check"></i><b>9.7.1</b> 生成日期和日期时间型数据</a></li>
<li class="chapter" data-level="9.7.2" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-comp"><i class="fa fa-check"></i><b>9.7.2</b> 取出日期时间的组成值</a></li>
<li class="chapter" data-level="9.7.3" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-baser-calc"><i class="fa fa-check"></i><b>9.7.3</b> 日期计算</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="prog-type-date.html"><a href="prog-type-date.html#p-t-date-ex"><i class="fa fa-check"></i><b>9.8</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="prog-type-fact.html"><a href="prog-type-fact.html"><i class="fa fa-check"></i><b>10</b> R因子类型</a><ul>
<li class="chapter" data-level="10.1" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-fact"><i class="fa fa-check"></i><b>10.1</b> 因子</a></li>
<li class="chapter" data-level="10.2" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-table"><i class="fa fa-check"></i><b>10.2</b> <code>table()</code>函数</a></li>
<li class="chapter" data-level="10.3" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-tapply"><i class="fa fa-check"></i><b>10.3</b> <code>tapply()</code>函数</a></li>
<li class="chapter" data-level="10.4" data-path="prog-type-fact.html"><a href="prog-type-fact.html#summ-by-forcats"><i class="fa fa-check"></i><b>10.4</b> forcats包的因子函数</a></li>
<li class="chapter" data-level="10.5" data-path="prog-type-fact.html"><a href="prog-type-fact.html#p-t-factor-ex"><i class="fa fa-check"></i><b>10.5</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="prog-type-list.html"><a href="prog-type-list.html"><i class="fa fa-check"></i><b>11</b> 列表类型</a><ul>
<li class="chapter" data-level="11.1" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list"><i class="fa fa-check"></i><b>11.1</b> 列表</a></li>
<li class="chapter" data-level="11.2" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-access"><i class="fa fa-check"></i><b>11.2</b> 列表元素访问</a></li>
<li class="chapter" data-level="11.3" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-as"><i class="fa fa-check"></i><b>11.3</b> 列表类型转换</a></li>
<li class="chapter" data-level="11.4" data-path="prog-type-list.html"><a href="prog-type-list.html#p-t-list-ex-strsplit"><i class="fa fa-check"></i><b>11.4</b> 返回列表的函数示例–<code>strsplit()</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html"><i class="fa fa-check"></i><b>12</b> R矩阵和数组</a><ul>
<li class="chapter" data-level="12.1" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matrix"><i class="fa fa-check"></i><b>12.1</b> R矩阵</a></li>
<li class="chapter" data-level="12.2" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-subset"><i class="fa fa-check"></i><b>12.2</b> 矩阵子集</a></li>
<li class="chapter" data-level="12.3" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-cbind"><i class="fa fa-check"></i><b>12.3</b> <code>cbind()</code>和<code>rbind()</code>函数</a></li>
<li class="chapter" data-level="12.4" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop"><i class="fa fa-check"></i><b>12.4</b> 矩阵运算</a><ul>
<li class="chapter" data-level="12.4.1" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-arith"><i class="fa fa-check"></i><b>12.4.1</b> 四则运算</a></li>
<li class="chapter" data-level="12.4.2" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-mult"><i class="fa fa-check"></i><b>12.4.2</b> 矩阵乘法</a></li>
<li class="chapter" data-level="12.4.3" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-vecmat"><i class="fa fa-check"></i><b>12.4.3</b> 向量与矩阵相乘</a></li>
<li class="chapter" data-level="12.4.4" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-inprod"><i class="fa fa-check"></i><b>12.4.4</b> 内积</a></li>
<li class="chapter" data-level="12.4.5" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-matop-outer"><i class="fa fa-check"></i><b>12.4.5</b> 外积</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-solve"><i class="fa fa-check"></i><b>12.5</b> 逆矩阵与线性方程组求解</a></li>
<li class="chapter" data-level="12.6" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-apply"><i class="fa fa-check"></i><b>12.6</b> <code>apply()</code>函数</a></li>
<li class="chapter" data-level="12.7" data-path="prog-type-matrix.html"><a href="prog-type-matrix.html#p-t-array-array"><i class="fa fa-check"></i><b>12.7</b> 多维数组</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="prog-type-df.html"><a href="prog-type-df.html"><i class="fa fa-check"></i><b>13</b> 数据框</a><ul>
<li class="chapter" data-level="13.1" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-dataframe"><i class="fa fa-check"></i><b>13.1</b> 数据框</a></li>
<li class="chapter" data-level="13.2" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-access"><i class="fa fa-check"></i><b>13.2</b> 数据框内容访问</a></li>
<li class="chapter" data-level="13.3" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-rownames"><i class="fa fa-check"></i><b>13.3</b> 数据框的行名</a></li>
<li class="chapter" data-level="13.4" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-notmatrix"><i class="fa fa-check"></i><b>13.4</b> 数据框与矩阵的区别</a></li>
<li class="chapter" data-level="13.5" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-gl-func"><i class="fa fa-check"></i><b>13.5</b> <code>tidyr::expand_grid()</code>函数</a></li>
<li class="chapter" data-level="13.6" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-tibble"><i class="fa fa-check"></i><b>13.6</b> <code>tibble</code>类型</a></li>
<li class="chapter" data-level="13.7" data-path="prog-type-df.html"><a href="prog-type-df.html#p-t-df-ex"><i class="fa fa-check"></i><b>13.7</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="prog-type-ws.html"><a href="prog-type-ws.html"><i class="fa fa-check"></i><b>14</b> 工作空间和变量赋值</a><ul>
<li class="chapter" data-level="14.1" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws"><i class="fa fa-check"></i><b>14.1</b> 工作空间</a></li>
<li class="chapter" data-level="14.2" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-nlvname"><i class="fa fa-check"></i><b>14.2</b> 非法变量名</a></li>
<li class="chapter" data-level="14.3" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws-asign"><i class="fa fa-check"></i><b>14.3</b> 变量赋值与绑定</a></li>
<li class="chapter" data-level="14.4" data-path="prog-type-ws.html"><a href="prog-type-ws.html#p-t-ws-env"><i class="fa fa-check"></i><b>14.4</b> 环境</a></li>
</ul></li>
<li class="part"><span><b>III 编程</b></span></li>
<li class="chapter" data-level="15" data-path="prog-io.html"><a href="prog-io.html"><i class="fa fa-check"></i><b>15</b> R输入输出</a><ul>
<li class="chapter" data-level="15.1" data-path="prog-io.html"><a href="prog-io.html#p-io-simple"><i class="fa fa-check"></i><b>15.1</b> 输入输出的简单方法</a><ul>
<li class="chapter" data-level="15.1.1" data-path="prog-io.html"><a href="prog-io.html#p-io-simple-out"><i class="fa fa-check"></i><b>15.1.1</b> 简单的输出</a></li>
<li class="chapter" data-level="15.1.2" data-path="prog-io.html"><a href="prog-io.html#p-io-simple-input"><i class="fa fa-check"></i><b>15.1.2</b> 简单的输入</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv"><i class="fa fa-check"></i><b>15.2</b> 读取CSV文件</a><ul>
<li class="chapter" data-level="15.2.1" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-format"><i class="fa fa-check"></i><b>15.2.1</b> CSV格式</a></li>
<li class="chapter" data-level="15.2.2" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-fromstr"><i class="fa fa-check"></i><b>15.2.2</b> 从字符串读入</a></li>
<li class="chapter" data-level="15.2.3" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-opt"><i class="fa fa-check"></i><b>15.2.3</b> <code>read_csv</code>选项</a></li>
<li class="chapter" data-level="15.2.4" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-enc"><i class="fa fa-check"></i><b>15.2.4</b> 编码设置</a></li>
<li class="chapter" data-level="15.2.5" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-na"><i class="fa fa-check"></i><b>15.2.5</b> 缺失值设置</a></li>
<li class="chapter" data-level="15.2.6" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-colt"><i class="fa fa-check"></i><b>15.2.6</b> 各列类型设置</a></li>
<li class="chapter" data-level="15.2.7" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-fact"><i class="fa fa-check"></i><b>15.2.7</b> 因子类型设置</a></li>
<li class="chapter" data-level="15.2.8" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-date"><i class="fa fa-check"></i><b>15.2.8</b> 读入日期</a></li>
<li class="chapter" data-level="15.2.9" data-path="prog-io.html"><a href="prog-io.html#p-io-read-csv-funcs"><i class="fa fa-check"></i><b>15.2.9</b> 其它函数</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="prog-io.html"><a href="prog-io.html#p-io-excel"><i class="fa fa-check"></i><b>15.3</b> Excel表访问</a><ul>
<li class="chapter" data-level="15.3.1" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-csv"><i class="fa fa-check"></i><b>15.3.1</b> 借助于文本格式</a></li>
<li class="chapter" data-level="15.3.2" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-clip"><i class="fa fa-check"></i><b>15.3.2</b> 使用剪贴板</a></li>
<li class="chapter" data-level="15.3.3" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-readxl"><i class="fa fa-check"></i><b>15.3.3</b> 利用readxl扩展包</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="prog-io.html"><a href="prog-io.html#p-io-file"><i class="fa fa-check"></i><b>15.4</b> 文件访问</a><ul>
<li class="chapter" data-level="15.4.1" data-path="prog-io.html"><a href="prog-io.html#p-io-file-conn"><i class="fa fa-check"></i><b>15.4.1</b> 连接</a></li>
<li class="chapter" data-level="15.4.2" data-path="prog-io.html"><a href="prog-io.html#p-io-file-text"><i class="fa fa-check"></i><b>15.4.2</b> 文本文件访问</a></li>
<li class="chapter" data-level="15.4.3" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-batch"><i class="fa fa-check"></i><b>15.4.3</b> 文本文件分批读写</a></li>
<li class="chapter" data-level="15.4.4" data-path="prog-io.html"><a href="prog-io.html#p-io-file-bin"><i class="fa fa-check"></i><b>15.4.4</b> 二进制文件访问</a></li>
<li class="chapter" data-level="15.4.5" data-path="prog-io.html"><a href="prog-io.html#p-io-file-textcon"><i class="fa fa-check"></i><b>15.4.5</b> 字符型连接</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="prog-io.html"><a href="prog-io.html#p-io-enc"><i class="fa fa-check"></i><b>15.5</b> 中文编码问题</a><ul>
<li class="chapter" data-level="15.5.1" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-base"><i class="fa fa-check"></i><b>15.5.1</b> 用基本R的读取函数读取</a></li>
<li class="chapter" data-level="15.5.2" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-readr"><i class="fa fa-check"></i><b>15.5.2</b> 用readr包读取</a></li>
<li class="chapter" data-level="15.5.3" data-path="prog-io.html"><a href="prog-io.html#p-io-enc-write"><i class="fa fa-check"></i><b>15.5.3</b> 输出文件的编码</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="prog-io.html"><a href="prog-io.html#p-io-dir"><i class="fa fa-check"></i><b>15.6</b> 目录和文件管理</a></li>
<li class="chapter" data-level="15.7" data-path="prog-io.html"><a href="prog-io.html#p-io-db"><i class="fa fa-check"></i><b>15.7</b> SQL数据库访问</a><ul>
<li class="chapter" data-level="15.7.1" data-path="prog-io.html"><a href="prog-io.html#p-io-db-intro"><i class="fa fa-check"></i><b>15.7.1</b> 介绍</a></li>
<li class="chapter" data-level="15.7.2" data-path="prog-io.html"><a href="prog-io.html#p-io-db-sqlite"><i class="fa fa-check"></i><b>15.7.2</b> SQLite数据库访问</a></li>
<li class="chapter" data-level="15.7.3" data-path="prog-io.html"><a href="prog-io.html#p-io-db-sql"><i class="fa fa-check"></i><b>15.7.3</b> SQL命令简介</a></li>
<li class="chapter" data-level="15.7.4" data-path="prog-io.html"><a href="prog-io.html#p-io-db-oracle"><i class="fa fa-check"></i><b>15.7.4</b> 访问Oracle数据库</a></li>
<li class="chapter" data-level="15.7.5" data-path="prog-io.html"><a href="prog-io.html#p-io-db-mysql"><i class="fa fa-check"></i><b>15.7.5</b> MySQL数据库访问</a></li>
<li class="chapter" data-level="15.7.6" data-path="prog-io.html"><a href="prog-io.html#p-io-excel-rodbc"><i class="fa fa-check"></i><b>15.7.6</b> 利用RODBC访问Access数据库</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="prog-control.html"><a href="prog-control.html"><i class="fa fa-check"></i><b>16</b> 程序控制结构</a><ul>
<li class="chapter" data-level="16.1" data-path="prog-control.html"><a href="prog-control.html#p-con-exp"><i class="fa fa-check"></i><b>16.1</b> 表达式</a></li>
<li class="chapter" data-level="16.2" data-path="prog-control.html"><a href="prog-control.html#p-con-if"><i class="fa fa-check"></i><b>16.2</b> 分支结构</a><ul>
<li class="chapter" data-level="16.2.1" data-path="prog-control.html"><a href="prog-control.html#p-con-logic-index"><i class="fa fa-check"></i><b>16.2.1</b> 用逻辑下标代替分支结构</a></li>
<li class="chapter" data-level="16.2.2" data-path="prog-control.html"><a href="prog-control.html#p-con-ifelsef"><i class="fa fa-check"></i><b>16.2.2</b> <code>ifelse</code>函数</a></li>
<li class="chapter" data-level="16.2.3" data-path="prog-control.html"><a href="prog-control.html#p-con-switch"><i class="fa fa-check"></i><b>16.2.3</b> <code>switch</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="prog-control.html"><a href="prog-control.html#p-con-loop"><i class="fa fa-check"></i><b>16.3</b> 循环结构</a><ul>
<li class="chapter" data-level="16.3.1" data-path="prog-control.html"><a href="prog-control.html#p-con-for"><i class="fa fa-check"></i><b>16.3.1</b> 计数循环</a></li>
<li class="chapter" data-level="16.3.2" data-path="prog-control.html"><a href="prog-control.html#p-con-while"><i class="fa fa-check"></i><b>16.3.2</b> <code>while</code>循环和<code>repeat</code>循环</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="prog-control.html"><a href="prog-control.html#p-con-cond"><i class="fa fa-check"></i><b>16.4</b> R中判断条件</a></li>
<li class="chapter" data-level="16.5" data-path="prog-control.html"><a href="prog-control.html#p-pipe"><i class="fa fa-check"></i><b>16.5</b> 管道控制</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="prog-func.html"><a href="prog-func.html"><i class="fa fa-check"></i><b>17</b> 函数</a><ul>
<li class="chapter" data-level="17.1" data-path="prog-func.html"><a href="prog-func.html#p-func"><i class="fa fa-check"></i><b>17.1</b> 函数基础</a><ul>
<li class="chapter" data-level="17.1.1" data-path="prog-func.html"><a href="prog-func.html#p-func-intro"><i class="fa fa-check"></i><b>17.1.1</b> 介绍</a></li>
<li class="chapter" data-level="17.1.2" data-path="prog-func.html"><a href="prog-func.html#p-func-def"><i class="fa fa-check"></i><b>17.1.2</b> 函数定义</a></li>
<li class="chapter" data-level="17.1.3" data-path="prog-func.html"><a href="prog-func.html#p-func-call"><i class="fa fa-check"></i><b>17.1.3</b> 函数调用</a></li>
<li class="chapter" data-level="17.1.4" data-path="prog-func.html"><a href="prog-func.html#p-func-recursive"><i class="fa fa-check"></i><b>17.1.4</b> 递归调用</a></li>
<li class="chapter" data-level="17.1.5" data-path="prog-func.html"><a href="prog-func.html#p-func-vr"><i class="fa fa-check"></i><b>17.1.5</b> 向量化</a></li>
<li class="chapter" data-level="17.1.6" data-path="prog-func.html"><a href="prog-func.html#p-func-anonymf"><i class="fa fa-check"></i><b>17.1.6</b> 无名函数</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="prog-func.html"><a href="prog-func.html#p-func-space"><i class="fa fa-check"></i><b>17.2</b> 变量作用域</a><ul>
<li class="chapter" data-level="17.2.1" data-path="prog-func.html"><a href="prog-func.html#p-func-global"><i class="fa fa-check"></i><b>17.2.1</b> 全局变量和工作空间</a></li>
<li class="chapter" data-level="17.2.2" data-path="prog-func.html"><a href="prog-func.html#p-func-local"><i class="fa fa-check"></i><b>17.2.2</b> 局部变量</a></li>
<li class="chapter" data-level="17.2.3" data-path="prog-func.html"><a href="prog-func.html#p-func-global-access"><i class="fa fa-check"></i><b>17.2.3</b> 在函数内访问全局变量</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="prog-prof.html"><a href="prog-prof.html"><i class="fa fa-check"></i><b>18</b> R程序效率</a><ul>
<li class="chapter" data-level="18.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-effic"><i class="fa fa-check"></i><b>18.1</b> R的运行效率</a></li>
<li class="chapter" data-level="18.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect"><i class="fa fa-check"></i><b>18.2</b> 向量化编程</a><ul>
<li class="chapter" data-level="18.2.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex1"><i class="fa fa-check"></i><b>18.2.1</b> 示例1</a></li>
<li class="chapter" data-level="18.2.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex2"><i class="fa fa-check"></i><b>18.2.2</b> 示例2</a></li>
<li class="chapter" data-level="18.2.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-vect-ex3"><i class="fa fa-check"></i><b>18.2.3</b> 示例3</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-loop"><i class="fa fa-check"></i><b>18.3</b> 减少显式循环</a><ul>
<li class="chapter" data-level="18.3.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-replicate"><i class="fa fa-check"></i><b>18.3.1</b> <code>replicate()</code>函数</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-copy"><i class="fa fa-check"></i><b>18.4</b> 避免制作副本</a></li>
<li class="chapter" data-level="18.5" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun"><i class="fa fa-check"></i><b>18.5</b> R的计算函数</a><ul>
<li class="chapter" data-level="18.5.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-math"><i class="fa fa-check"></i><b>18.5.1</b> 数学函数</a></li>
<li class="chapter" data-level="18.5.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-sum"><i class="fa fa-check"></i><b>18.5.2</b> 概括函数</a></li>
<li class="chapter" data-level="18.5.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-max"><i class="fa fa-check"></i><b>18.5.3</b> 最值</a></li>
<li class="chapter" data-level="18.5.4" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-sort"><i class="fa fa-check"></i><b>18.5.4</b> 排序</a></li>
<li class="chapter" data-level="18.5.5" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-integrate"><i class="fa fa-check"></i><b>18.5.5</b> 一元定积分<code>integrate</code></a></li>
<li class="chapter" data-level="18.5.6" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-uniroot"><i class="fa fa-check"></i><b>18.5.6</b> 一元函数求根<code>uniroot</code></a></li>
<li class="chapter" data-level="18.5.7" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-fft"><i class="fa fa-check"></i><b>18.5.7</b> 离散傅立叶变换<code>fft</code></a></li>
<li class="chapter" data-level="18.5.8" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mathfun-filter"><i class="fa fa-check"></i><b>18.5.8</b> 用<code>filter</code>函数作迭代</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu"><i class="fa fa-check"></i><b>18.6</b> 并行计算</a><ul>
<li class="chapter" data-level="18.6.1" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex1"><i class="fa fa-check"></i><b>18.6.1</b> 例1：完全不互相依赖的并行运算</a></li>
<li class="chapter" data-level="18.6.2" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex2"><i class="fa fa-check"></i><b>18.6.2</b> 例2：使用相同随机数序列的并行计算</a></li>
<li class="chapter" data-level="18.6.3" data-path="prog-prof.html"><a href="prog-prof.html#p-prof-mcpu-ex3"><i class="fa fa-check"></i><b>18.6.3</b> 例3：使用独立随机数序列的并行计算</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="p-advfunc.html"><a href="p-advfunc.html"><i class="fa fa-check"></i><b>19</b> 函数进阶</a><ul>
<li class="chapter" data-level="19.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-callspe"><i class="fa fa-check"></i><b>19.1</b> 函数调用的各种形式</a></li>
<li class="chapter" data-level="19.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-lex"><i class="fa fa-check"></i><b>19.2</b> 嵌套定义与句法作用域(lexical scoping)</a></li>
<li class="chapter" data-level="19.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-inner"><i class="fa fa-check"></i><b>19.3</b> 辅助嵌套函数</a></li>
<li class="chapter" data-level="19.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-lazy"><i class="fa fa-check"></i><b>19.4</b> 懒惰求值</a></li>
<li class="chapter" data-level="19.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug"><i class="fa fa-check"></i><b>19.5</b> 程序调试</a><ul>
<li class="chapter" data-level="19.5.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-intro"><i class="fa fa-check"></i><b>19.5.1</b> 基本调试策略</a></li>
<li class="chapter" data-level="19.5.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-findfunc"><i class="fa fa-check"></i><b>19.5.2</b> 找到出错的函数</a></li>
<li class="chapter" data-level="19.5.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-browser"><i class="fa fa-check"></i><b>19.5.3</b> 跟踪调试</a></li>
<li class="chapter" data-level="19.5.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-cond"><i class="fa fa-check"></i><b>19.5.4</b> 条件断点</a></li>
<li class="chapter" data-level="19.5.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-debugf"><i class="fa fa-check"></i><b>19.5.5</b> 开启对一个函数的调试</a></li>
<li class="chapter" data-level="19.5.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-opt"><i class="fa fa-check"></i><b>19.5.6</b> 出错调试选项</a></li>
<li class="chapter" data-level="19.5.7" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-stop"><i class="fa fa-check"></i><b>19.5.7</b> <code>stop()</code>、<code>warning()</code>、<code>message()</code></a></li>
<li class="chapter" data-level="19.5.8" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-preventive"><i class="fa fa-check"></i><b>19.5.8</b> 预防性设计</a></li>
<li class="chapter" data-level="19.5.9" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-debug-try"><i class="fa fa-check"></i><b>19.5.9</b> 出错处理机制</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-funcprog"><i class="fa fa-check"></i><b>19.6</b> 函数式编程介绍</a><ul>
<li class="chapter" data-level="19.6.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-pure"><i class="fa fa-check"></i><b>19.6.1</b> 纯函数</a></li>
<li class="chapter" data-level="19.6.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-rec"><i class="fa fa-check"></i><b>19.6.2</b> 副作用和运行环境恢复</a></li>
<li class="chapter" data-level="19.6.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-rsupp"><i class="fa fa-check"></i><b>19.6.3</b> R的函数式编程功能</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-functional"><i class="fa fa-check"></i><b>19.7</b> 泛函</a><ul>
<li class="chapter" data-level="19.7.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-map"><i class="fa fa-check"></i><b>19.7.1</b> <code>purrr::map</code>函数</a></li>
<li class="chapter" data-level="19.7.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-mapv"><i class="fa fa-check"></i><b>19.7.2</b> purrr包中<code>map</code>函数的变种</a></li>
<li class="chapter" data-level="19.7.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-reduce"><i class="fa fa-check"></i><b>19.7.3</b> purrr包中<code>reduce</code>类函数</a></li>
<li class="chapter" data-level="19.7.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-pred"><i class="fa fa-check"></i><b>19.7.4</b> purrr包中使用示性函数的泛函</a></li>
<li class="chapter" data-level="19.7.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-lapp"><i class="fa fa-check"></i><b>19.7.5</b> 基本R的函数式编程支持</a></li>
<li class="chapter" data-level="19.7.6" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-fnctnl-udef"><i class="fa fa-check"></i><b>19.7.6</b> 自定义泛函</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory"><i class="fa fa-check"></i><b>19.8</b> 函数工厂</a><ul>
<li class="chapter" data-level="19.8.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-clex"><i class="fa fa-check"></i><b>19.8.1</b> 闭包例子</a></li>
<li class="chapter" data-level="19.8.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-lazy"><i class="fa fa-check"></i><b>19.8.2</b> 动态查找和懒惰求值引起的问题</a></li>
<li class="chapter" data-level="19.8.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-factory-mem"><i class="fa fa-check"></i><b>19.8.3</b> 函数工厂的内存负担</a></li>
<li class="chapter" data-level="19.8.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-operator"><i class="fa fa-check"></i><b>19.8.4</b> 函数算子</a></li>
</ul></li>
<li class="chapter" data-level="19.9" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env"><i class="fa fa-check"></i><b>19.9</b> 环境</a><ul>
<li class="chapter" data-level="19.9.1" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-def"><i class="fa fa-check"></i><b>19.9.1</b> 基本概念</a></li>
<li class="chapter" data-level="19.9.2" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-recurs"><i class="fa fa-check"></i><b>19.9.2</b> 逐层向上访问环境</a></li>
<li class="chapter" data-level="19.9.3" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-spec"><i class="fa fa-check"></i><b>19.9.3</b> 特殊环境</a></li>
<li class="chapter" data-level="19.9.4" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-callst"><i class="fa fa-check"></i><b>19.9.4</b> 调用栈</a></li>
<li class="chapter" data-level="19.9.5" data-path="p-advfunc.html"><a href="p-advfunc.html#p-advfunc-env-usedt"><i class="fa fa-check"></i><b>19.9.5</b> 将环境用作一般数据结构</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV 制作研究报告和图书</b></span></li>
<li class="chapter" data-level="20" data-path="knitr.html"><a href="knitr.html"><i class="fa fa-check"></i><b>20</b> 用R制作研究报告</a></li>
<li class="chapter" data-level="21" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>21</b> Markdown格式</a><ul>
<li class="chapter" data-level="21.1" data-path="markdown.html"><a href="markdown.html#markdown-intro"><i class="fa fa-check"></i><b>21.1</b> 介绍</a></li>
<li class="chapter" data-level="21.2" data-path="markdown.html"><a href="markdown.html#markdown-app"><i class="fa fa-check"></i><b>21.2</b> Markdown格式文件的应用</a></li>
<li class="chapter" data-level="21.3" data-path="markdown.html"><a href="markdown.html#markdown-format"><i class="fa fa-check"></i><b>21.3</b> markdown格式说明</a><ul>
<li class="chapter" data-level="21.3.1" data-path="markdown.html"><a href="markdown.html#markdown-format-intro"><i class="fa fa-check"></i><b>21.3.1</b> 概述</a></li>
<li class="chapter" data-level="21.3.2" data-path="markdown.html"><a href="markdown.html#markdown-format-paragraph"><i class="fa fa-check"></i><b>21.3.2</b> 段落</a></li>
<li class="chapter" data-level="21.3.3" data-path="markdown.html"><a href="markdown.html#markdown-format-inline"><i class="fa fa-check"></i><b>21.3.3</b> 段内文字格式</a></li>
<li class="chapter" data-level="21.3.4" data-path="markdown.html"><a href="markdown.html#markdown-format-header"><i class="fa fa-check"></i><b>21.3.4</b> 标题和分隔线</a></li>
<li class="chapter" data-level="21.3.5" data-path="markdown.html"><a href="markdown.html#markdown-format-cite"><i class="fa fa-check"></i><b>21.3.5</b> 引用段落</a></li>
<li class="chapter" data-level="21.3.6" data-path="markdown.html"><a href="markdown.html#markdown-format-list"><i class="fa fa-check"></i><b>21.3.6</b> 列表</a></li>
<li class="chapter" data-level="21.3.7" data-path="markdown.html"><a href="markdown.html#markdown-format-code"><i class="fa fa-check"></i><b>21.3.7</b> 源程序</a></li>
<li class="chapter" data-level="21.3.8" data-path="markdown.html"><a href="markdown.html#markdown-format-link"><i class="fa fa-check"></i><b>21.3.8</b> 链接</a></li>
<li class="chapter" data-level="21.3.9" data-path="markdown.html"><a href="markdown.html#markdown-format-fig"><i class="fa fa-check"></i><b>21.3.9</b> 插入图形</a></li>
<li class="chapter" data-level="21.3.10" data-path="markdown.html"><a href="markdown.html#markdown-format-table"><i class="fa fa-check"></i><b>21.3.10</b> 表格</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="markdown.html"><a href="markdown.html#markdown-pandoc"><i class="fa fa-check"></i><b>21.4</b> 附录：pandoc软件介绍</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>22</b> R Markdown文件格式</a><ul>
<li class="chapter" data-level="22.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-intro"><i class="fa fa-check"></i><b>22.1</b> R Markdown文件</a></li>
<li class="chapter" data-level="22.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-compile"><i class="fa fa-check"></i><b>22.2</b> R Markdown文件的编译</a><ul>
<li class="chapter" data-level="22.2.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-compile-proc"><i class="fa fa-check"></i><b>22.2.1</b> 编译的实际过程</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode"><i class="fa fa-check"></i><b>22.3</b> 在R Markdown文件中插入R代码</a></li>
<li class="chapter" data-level="22.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-kable"><i class="fa fa-check"></i><b>22.4</b> 输出表格</a></li>
<li class="chapter" data-level="22.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-graph"><i class="fa fa-check"></i><b>22.5</b> 利用R程序插图</a></li>
<li class="chapter" data-level="22.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-opt"><i class="fa fa-check"></i><b>22.6</b> 代码段选项</a><ul>
<li class="chapter" data-level="22.6.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-outformat"><i class="fa fa-check"></i><b>22.6.1</b> 代码和文本输出结果格式</a></li>
<li class="chapter" data-level="22.6.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-figopt"><i class="fa fa-check"></i><b>22.6.2</b> 图形选项</a></li>
<li class="chapter" data-level="22.6.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-rcode-cache"><i class="fa fa-check"></i><b>22.6.3</b> 缓存(cache)选项</a></li>
</ul></li>
<li class="chapter" data-level="22.7" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd--sectionlink"><i class="fa fa-check"></i><b>22.7</b> 章节目录链接问题</a></li>
<li class="chapter" data-level="22.8" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula"><i class="fa fa-check"></i><b>22.8</b> 数学公式</a><ul>
<li class="chapter" data-level="22.8.1" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-intro"><i class="fa fa-check"></i><b>22.8.1</b> 在Markdown中输入数学公式</a></li>
<li class="chapter" data-level="22.8.2" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-type"><i class="fa fa-check"></i><b>22.8.2</b> 数学公式类别</a></li>
<li class="chapter" data-level="22.8.3" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-basic"><i class="fa fa-check"></i><b>22.8.3</b> 基本功能</a></li>
<li class="chapter" data-level="22.8.4" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-accent"><i class="fa fa-check"></i><b>22.8.4</b> 修饰符</a></li>
<li class="chapter" data-level="22.8.5" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-align"><i class="fa fa-check"></i><b>22.8.5</b> 对齐与矩阵</a></li>
<li class="chapter" data-level="22.8.6" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-formula-fonts"><i class="fa fa-check"></i><b>22.8.6</b> 特殊字体</a></li>
</ul></li>
<li class="chapter" data-level="22.9" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-engines"><i class="fa fa-check"></i><b>22.9</b> 其它编程语言引擎</a></li>
<li class="chapter" data-level="22.10" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-interact"><i class="fa fa-check"></i><b>22.10</b> 交互内容</a></li>
<li class="chapter" data-level="22.11" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-attryaml"><i class="fa fa-check"></i><b>22.11</b> 属性设置</a><ul>
<li class="chapter" data-level="22.11.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-yaml"><i class="fa fa-check"></i><b>22.11.1</b> YAML元数据</a></li>
<li class="chapter" data-level="22.11.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-types"><i class="fa fa-check"></i><b>22.11.2</b> 输出格式</a></li>
<li class="chapter" data-level="22.11.3" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr"><i class="fa fa-check"></i><b>22.11.3</b> 输出格式设置</a></li>
<li class="chapter" data-level="22.11.4" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-toc"><i class="fa fa-check"></i><b>22.11.4</b> 目录设置</a></li>
<li class="chapter" data-level="22.11.5" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-numsec"><i class="fa fa-check"></i><b>22.11.5</b> 章节自动编号</a></li>
<li class="chapter" data-level="22.11.6" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-attr-wordnumsec"><i class="fa fa-check"></i><b>22.11.6</b> Word输出章节自动编号及模板功能</a></li>
<li class="chapter" data-level="22.11.7" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-htmlspecific"><i class="fa fa-check"></i><b>22.11.7</b> HTML特有输出格式设置</a></li>
<li class="chapter" data-level="22.11.8" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-mathjax"><i class="fa fa-check"></i><b>22.11.8</b> 关于数学公式支持的设置</a></li>
<li class="chapter" data-level="22.11.9" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-output-yml"><i class="fa fa-check"></i><b>22.11.9</b> 输出设置文件</a></li>
</ul></li>
<li class="chapter" data-level="22.12" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex"><i class="fa fa-check"></i><b>22.12</b> LaTeX和PDF输出</a><ul>
<li class="chapter" data-level="22.12.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex-tinytex"><i class="fa fa-check"></i><b>22.12.1</b> TinyTex的安装使用</a></li>
<li class="chapter" data-level="22.12.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmd-latex-yaml"><i class="fa fa-check"></i><b>22.12.2</b> Rmd中Latex设置</a></li>
</ul></li>
<li class="chapter" data-level="22.13" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-rticles"><i class="fa fa-check"></i><b>22.13</b> 生成期刊文章</a></li>
<li class="chapter" data-level="22.14" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1"><i class="fa fa-check"></i><b>22.14</b> 附录：经验与问题</a><ul>
<li class="chapter" data-level="22.14.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1-wordtemplate"><i class="fa fa-check"></i><b>22.14.1</b> Word模板制作</a></li>
<li class="chapter" data-level="22.14.2" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-app1-math"><i class="fa fa-check"></i><b>22.14.2</b> 数学公式设置补充</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="bookdown.html"><a href="bookdown.html"><i class="fa fa-check"></i><b>23</b> 用bookdown制作图书</a><ul>
<li class="chapter" data-level="23.1" data-path="bookdown.html"><a href="bookdown.html#bookdown-intro"><i class="fa fa-check"></i><b>23.1</b> 介绍</a></li>
<li class="chapter" data-level="23.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-settings"><i class="fa fa-check"></i><b>23.2</b> 一本书的设置</a></li>
<li class="chapter" data-level="23.3" data-path="bookdown.html"><a href="bookdown.html#bookdown-sectioning"><i class="fa fa-check"></i><b>23.3</b> 章节结构</a></li>
<li class="chapter" data-level="23.4" data-path="bookdown.html"><a href="bookdown.html#bookdown-compile"><i class="fa fa-check"></i><b>23.4</b> 书的编译</a></li>
<li class="chapter" data-level="23.5" data-path="bookdown.html"><a href="bookdown.html#bookdown-cref"><i class="fa fa-check"></i><b>23.5</b> 交叉引用</a></li>
<li class="chapter" data-level="23.6" data-path="bookdown.html"><a href="bookdown.html#bookdown-formula"><i class="fa fa-check"></i><b>23.6</b> 数学公式和公式编号</a></li>
<li class="chapter" data-level="23.7" data-path="bookdown.html"><a href="bookdown.html#bookdown-theorem"><i class="fa fa-check"></i><b>23.7</b> 定理类编号</a></li>
<li class="chapter" data-level="23.8" data-path="bookdown.html"><a href="bookdown.html#bookdown-bib"><i class="fa fa-check"></i><b>23.8</b> 文献引用</a></li>
<li class="chapter" data-level="23.9" data-path="bookdown.html"><a href="bookdown.html#bookdown-graph"><i class="fa fa-check"></i><b>23.9</b> 插图</a></li>
<li class="chapter" data-level="23.10" data-path="bookdown.html"><a href="bookdown.html#bookdown-table"><i class="fa fa-check"></i><b>23.10</b> 表格</a><ul>
<li class="chapter" data-level="23.10.1" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-md"><i class="fa fa-check"></i><b>23.10.1</b> Markdown表格</a></li>
<li class="chapter" data-level="23.10.2" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-kable"><i class="fa fa-check"></i><b>23.10.2</b> 用<code>kable()</code>函数制作表格</a></li>
<li class="chapter" data-level="23.10.3" data-path="bookdown.html"><a href="bookdown.html#bookdown-table-kable"><i class="fa fa-check"></i><b>23.10.3</b> R中其它制作表格的包</a></li>
</ul></li>
<li class="chapter" data-level="23.11" data-path="bookdown.html"><a href="bookdown.html#bookdown-mathjax"><i class="fa fa-check"></i><b>23.11</b> 数学公式的设置</a></li>
<li class="chapter" data-level="23.12" data-path="bookdown.html"><a href="bookdown.html#bookdown-exp"><i class="fa fa-check"></i><b>23.12</b> 使用经验</a></li>
<li class="chapter" data-level="23.13" data-path="bookdown.html"><a href="bookdown.html#bookdown-bugs"><i class="fa fa-check"></i><b>23.13</b> bookdown的一些使用问题</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="rmdsite.html"><a href="rmdsite.html"><i class="fa fa-check"></i><b>24</b> 用R Markdown制作简易网站</a><ul>
<li class="chapter" data-level="24.1" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-intro"><i class="fa fa-check"></i><b>24.1</b> 介绍</a></li>
<li class="chapter" data-level="24.2" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown"><i class="fa fa-check"></i><b>24.2</b> 简易网站制作</a><ul>
<li class="chapter" data-level="24.2.1" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-struct"><i class="fa fa-check"></i><b>24.2.1</b> 网站结构</a></li>
<li class="chapter" data-level="24.2.2" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-build"><i class="fa fa-check"></i><b>24.2.2</b> 编译</a></li>
<li class="chapter" data-level="24.2.3" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-pages"><i class="fa fa-check"></i><b>24.2.3</b> 内容文件</a></li>
<li class="chapter" data-level="24.2.4" data-path="rmdsite.html"><a href="rmdsite.html#rmdsite-rmarkdown-config"><i class="fa fa-check"></i><b>24.2.4</b> 网站设置</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="rmdsite.html"><a href="rmdsite.html#blogdown"><i class="fa fa-check"></i><b>24.3</b> 用blogdown制作网站</a><ul>
<li class="chapter" data-level="24.3.1" data-path="rmdsite.html"><a href="rmdsite.html#blogd-new"><i class="fa fa-check"></i><b>24.3.1</b> 生成新网站的框架</a></li>
<li class="chapter" data-level="24.3.2" data-path="rmdsite.html"><a href="rmdsite.html#blogd-page"><i class="fa fa-check"></i><b>24.3.2</b> 网页内容文件及其设置</a></li>
<li class="chapter" data-level="24.3.3" data-path="rmdsite.html"><a href="rmdsite.html#blogd-workflow"><i class="fa fa-check"></i><b>24.3.3</b> 初学者的工作流程</a></li>
<li class="chapter" data-level="24.3.4" data-path="rmdsite.html"><a href="rmdsite.html#blogd-config"><i class="fa fa-check"></i><b>24.3.4</b> 网站设置文件</a></li>
<li class="chapter" data-level="24.3.5" data-path="rmdsite.html"><a href="rmdsite.html#blogd-static"><i class="fa fa-check"></i><b>24.3.5</b> 静态文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="slides.html"><a href="slides.html"><i class="fa fa-check"></i><b>25</b> 制作幻灯片</a><ul>
<li class="chapter" data-level="25.1" data-path="slides.html"><a href="slides.html#rmd-slides-intro"><i class="fa fa-check"></i><b>25.1</b> 介绍</a></li>
<li class="chapter" data-level="25.2" data-path="slides.html"><a href="slides.html#rmd-slidy"><i class="fa fa-check"></i><b>25.2</b> Slidy幻灯片</a><ul>
<li class="chapter" data-level="25.2.1" data-path="slides.html"><a href="slides.html#rmd-slidy-format"><i class="fa fa-check"></i><b>25.2.1</b> 文件格式</a></li>
<li class="chapter" data-level="25.2.2" data-path="slides.html"><a href="slides.html#rmd-slidy-compile"><i class="fa fa-check"></i><b>25.2.2</b> 幻灯片编译</a></li>
<li class="chapter" data-level="25.2.3" data-path="slides.html"><a href="slides.html#rmd-slidy-play"><i class="fa fa-check"></i><b>25.2.3</b> 播放控制</a></li>
<li class="chapter" data-level="25.2.4" data-path="slides.html"><a href="slides.html#rmd-slidy-handout"><i class="fa fa-check"></i><b>25.2.4</b> 生成单页HTML</a></li>
<li class="chapter" data-level="25.2.5" data-path="slides.html"><a href="slides.html#rmd-slidy-mathjax"><i class="fa fa-check"></i><b>25.2.5</b> 数学公式处理与输出设置文件</a></li>
<li class="chapter" data-level="25.2.6" data-path="slides.html"><a href="slides.html#rmd-slidy-options"><i class="fa fa-check"></i><b>25.2.6</b> 其它选项</a></li>
<li class="chapter" data-level="25.2.7" data-path="slides.html"><a href="slides.html#rmd-slidy-laser"><i class="fa fa-check"></i><b>25.2.7</b> slidy幻灯片激光笔失效问题的修改</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="slides.html"><a href="slides.html#rmdslides-pp"><i class="fa fa-check"></i><b>25.3</b> MS PowerPoint幻灯片</a></li>
<li class="chapter" data-level="25.4" data-path="slides.html"><a href="slides.html#rmdslides-beamer"><i class="fa fa-check"></i><b>25.4</b> Bearmer幻灯片格式</a></li>
<li class="chapter" data-level="25.5" data-path="slides.html"><a href="slides.html#rmdslides-rpres"><i class="fa fa-check"></i><b>25.5</b> R Presentation格式</a></li>
</ul></li>
<li class="part"><span><b>V 数据整理与汇总</b></span></li>
<li class="chapter" data-level="26" data-path="summary-manip.html"><a href="summary-manip.html"><i class="fa fa-check"></i><b>26</b> 数据整理</a><ul>
<li class="chapter" data-level="26.1" data-path="summary-manip.html"><a href="summary-manip.html#summm-tidyv"><i class="fa fa-check"></i><b>26.1</b> tidyverse系统</a></li>
<li class="chapter" data-level="26.2" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-filter"><i class="fa fa-check"></i><b>26.2</b> 用<code>filter()</code>选择行子集</a></li>
<li class="chapter" data-level="26.3" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-head"><i class="fa fa-check"></i><b>26.3</b> 按行序号选择行子集</a></li>
<li class="chapter" data-level="26.4" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-samplen"><i class="fa fa-check"></i><b>26.4</b> 用<code>sample_n()</code>对观测随机抽样</a></li>
<li class="chapter" data-level="26.5" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-distinct"><i class="fa fa-check"></i><b>26.5</b> 用<code>distinct()</code>去除重复行</a></li>
<li class="chapter" data-level="26.6" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-dropna"><i class="fa fa-check"></i><b>26.6</b> 用<code>drop_na()</code>去除指定的变量有缺失值的行</a></li>
<li class="chapter" data-level="26.7" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-select"><i class="fa fa-check"></i><b>26.7</b> 用<code>select()</code>选择列子集</a></li>
<li class="chapter" data-level="26.8" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-pull"><i class="fa fa-check"></i><b>26.8</b> 取出单个变量为向量</a></li>
<li class="chapter" data-level="26.9" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-arrange"><i class="fa fa-check"></i><b>26.9</b> 用<code>arrange()</code>排序</a></li>
<li class="chapter" data-level="26.10" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-rename"><i class="fa fa-check"></i><b>26.10</b> 用<code>rename()</code>修改变量名</a></li>
<li class="chapter" data-level="26.11" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-mutate"><i class="fa fa-check"></i><b>26.11</b> 用<code>mutate()</code>计算新变量</a></li>
<li class="chapter" data-level="26.12" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-transmute"><i class="fa fa-check"></i><b>26.12</b> 用<code>tranmute()</code>生成新变量的数据框</a></li>
<li class="chapter" data-level="26.13" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-pipe"><i class="fa fa-check"></i><b>26.13</b> 用管道连接多次操作</a></li>
<li class="chapter" data-level="26.14" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer"><i class="fa fa-check"></i><b>26.14</b> 宽表转换为长表</a><ul>
<li class="chapter" data-level="26.14.1" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-pl"><i class="fa fa-check"></i><b>26.14.1</b> <code>pivot_longer</code>函数</a></li>
<li class="chapter" data-level="26.14.2" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-prefixvalue"><i class="fa fa-check"></i><b>26.14.2</b> 从列名中提取数值</a></li>
<li class="chapter" data-level="26.14.3" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-colnamemultclassv"><i class="fa fa-check"></i><b>26.14.3</b> 从列名中提取多个分类变量值</a></li>
<li class="chapter" data-level="26.14.4" data-path="summary-manip.html"><a href="summary-manip.html#tidyr-longer-multvarsmultclassv"><i class="fa fa-check"></i><b>26.14.4</b> 一行中有多个属性的多次观测的情形</a></li>
</ul></li>
<li class="chapter" data-level="26.15" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider"><i class="fa fa-check"></i><b>26.15</b> 长表转换为宽表</a><ul>
<li class="chapter" data-level="26.15.1" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-sepvars"><i class="fa fa-check"></i><b>26.15.1</b> 将多个混在一起的变量拆开</a></li>
<li class="chapter" data-level="26.15.2" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-combtimes"><i class="fa fa-check"></i><b>26.15.2</b> 将多个类别合并到一个观测</a></li>
<li class="chapter" data-level="26.15.3" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-combcross"><i class="fa fa-check"></i><b>26.15.3</b> 将交叉类别合并到一个观测</a></li>
<li class="chapter" data-level="26.15.4" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-mvmest"><i class="fa fa-check"></i><b>26.15.4</b> 多个变量的多种值</a></li>
<li class="chapter" data-level="26.15.5" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-wider-mixed"><i class="fa fa-check"></i><b>26.15.5</b> 长宽转换混合使用</a></li>
</ul></li>
<li class="chapter" data-level="26.16" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-spearate"><i class="fa fa-check"></i><b>26.16</b> 拆分数据列</a></li>
<li class="chapter" data-level="26.17" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-unite"><i class="fa fa-check"></i><b>26.17</b> 合并数据列</a></li>
<li class="chapter" data-level="26.18" data-path="summary-manip.html"><a href="summary-manip.html#summ-trans-combv"><i class="fa fa-check"></i><b>26.18</b> 数据框纵向合并</a></li>
<li class="chapter" data-level="26.19" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-join"><i class="fa fa-check"></i><b>26.19</b> 横向合并</a></li>
<li class="chapter" data-level="26.20" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-semi"><i class="fa fa-check"></i><b>26.20</b> 利用第二个数据集筛选</a></li>
<li class="chapter" data-level="26.21" data-path="summary-manip.html"><a href="summary-manip.html#dplyr-set"><i class="fa fa-check"></i><b>26.21</b> 数据集的集合操作</a></li>
<li class="chapter" data-level="26.22" data-path="summary-manip.html"><a href="summary-manip.html#summ-trans-standard"><i class="fa fa-check"></i><b>26.22</b> 标准化</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="summary-summ.html"><a href="summary-summ.html"><i class="fa fa-check"></i><b>27</b> 数据汇总</a><ul>
<li class="chapter" data-level="27.1" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-summ"><i class="fa fa-check"></i><b>27.1</b> 用dplyr作数据汇总</a></li>
<li class="chapter" data-level="27.2" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-summat"><i class="fa fa-check"></i><b>27.2</b> 多个变量的汇总</a></li>
<li class="chapter" data-level="27.3" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-groupby"><i class="fa fa-check"></i><b>27.3</b> 用dplyr作数据分组汇总</a></li>
<li class="chapter" data-level="27.4" data-path="summary-summ.html"><a href="summary-summ.html#dplyr-crossgroup"><i class="fa fa-check"></i><b>27.4</b> 交叉分类的汇总</a></li>
<li class="chapter" data-level="27.5" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest"><i class="fa fa-check"></i><b>27.5</b> tibble中的列表列</a><ul>
<li class="chapter" data-level="27.5.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-intro"><i class="fa fa-check"></i><b>27.5.1</b> <code>nest</code>和<code>unnest</code></a></li>
<li class="chapter" data-level="27.5.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-groupby"><i class="fa fa-check"></i><b>27.5.2</b> <code>group_by</code>与<code>nest</code>配合</a></li>
<li class="chapter" data-level="27.5.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-summarise"><i class="fa fa-check"></i><b>27.5.3</b> <code>summarise</code>统计量用列表表示</a></li>
<li class="chapter" data-level="27.5.4" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-unnest-grammar"><i class="fa fa-check"></i><b>27.5.4</b> <code>unnest</code>的语法格式</a></li>
<li class="chapter" data-level="27.5.5" data-path="summary-summ.html"><a href="summary-summ.html#summ-nest-direct"><i class="fa fa-check"></i><b>27.5.5</b> 直接生成列表类型的列</a></li>
</ul></li>
<li class="chapter" data-level="27.6" data-path="summary-summ.html"><a href="summary-summ.html#summ-base"><i class="fa fa-check"></i><b>27.6</b> 基本R的汇总功能</a><ul>
<li class="chapter" data-level="27.6.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-base-summary"><i class="fa fa-check"></i><b>27.6.1</b> <code>summary()</code>函数</a></li>
<li class="chapter" data-level="27.6.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-cont"><i class="fa fa-check"></i><b>27.6.2</b> 连续型变量概括函数</a></li>
<li class="chapter" data-level="27.6.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-fact"><i class="fa fa-check"></i><b>27.6.3</b> 分类变量概括</a></li>
<li class="chapter" data-level="27.6.4" data-path="summary-summ.html"><a href="summary-summ.html#summ-df"><i class="fa fa-check"></i><b>27.6.4</b> 数据框概括</a></li>
</ul></li>
<li class="chapter" data-level="27.7" data-path="summary-summ.html"><a href="summary-summ.html#summ-by"><i class="fa fa-check"></i><b>27.7</b> 用基本R作分类概括</a><ul>
<li class="chapter" data-level="27.7.1" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-tapply"><i class="fa fa-check"></i><b>27.7.1</b> 用<code>tapply()</code>分组概括向量</a></li>
<li class="chapter" data-level="27.7.2" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-aggregate"><i class="fa fa-check"></i><b>27.7.2</b> 用<code>aggregate()</code>分组概括数据框</a></li>
<li class="chapter" data-level="27.7.3" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-split"><i class="fa fa-check"></i><b>27.7.3</b> 用<code>split()</code>函数分组后概括</a></li>
</ul></li>
<li class="chapter" data-level="27.8" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-plyr"><i class="fa fa-check"></i><b>27.8</b> 用plyr包进行分类概括</a></li>
<li class="chapter" data-level="27.9" data-path="summary-summ.html"><a href="summary-summ.html#summ-by-exer"><i class="fa fa-check"></i><b>27.9</b> 练习</a></li>
</ul></li>
<li class="part"><span><b>VI 绘图</b></span></li>
<li class="chapter" data-level="28" data-path="graph.html"><a href="graph.html"><i class="fa fa-check"></i><b>28</b> 基本R绘图</a><ul>
<li class="chapter" data-level="28.1" data-path="graph.html"><a href="graph.html#graph-ph"><i class="fa fa-check"></i><b>28.1</b> 常用高级图形</a><ul>
<li class="chapter" data-level="28.1.1" data-path="graph.html"><a href="graph.html#graph-ph-barplot"><i class="fa fa-check"></i><b>28.1.1</b> 条形图</a></li>
<li class="chapter" data-level="28.1.2" data-path="graph.html"><a href="graph.html#graph-ph-hist"><i class="fa fa-check"></i><b>28.1.2</b> 直方图和密度估计图</a></li>
<li class="chapter" data-level="28.1.3" data-path="graph.html"><a href="graph.html#graph-ph-boxplot"><i class="fa fa-check"></i><b>28.1.3</b> 盒形图</a></li>
<li class="chapter" data-level="28.1.4" data-path="graph.html"><a href="graph.html#graph-pr-qq"><i class="fa fa-check"></i><b>28.1.4</b> 正态QQ图</a></li>
<li class="chapter" data-level="28.1.5" data-path="graph.html"><a href="graph.html#graph-ph-plot"><i class="fa fa-check"></i><b>28.1.5</b> 散点图</a></li>
<li class="chapter" data-level="28.1.6" data-path="graph.html"><a href="graph.html#graph-ph-curve"><i class="fa fa-check"></i><b>28.1.6</b> 曲线图</a></li>
<li class="chapter" data-level="28.1.7" data-path="graph.html"><a href="graph.html#graph-ph-3d"><i class="fa fa-check"></i><b>28.1.7</b> 三维图</a></li>
<li class="chapter" data-level="28.1.8" data-path="graph.html"><a href="graph.html#graph-ph-rgl"><i class="fa fa-check"></i><b>28.1.8</b> 动态三维图</a></li>
</ul></li>
<li class="chapter" data-level="28.2" data-path="graph.html"><a href="graph.html#graph-pl"><i class="fa fa-check"></i><b>28.2</b> 低级图形函数</a><ul>
<li class="chapter" data-level="28.2.1" data-path="graph.html"><a href="graph.html#graph-pl-abline"><i class="fa fa-check"></i><b>28.2.1</b> <code>abline()</code></a></li>
<li class="chapter" data-level="28.2.2" data-path="graph.html"><a href="graph.html#graph-pl-points"><i class="fa fa-check"></i><b>28.2.2</b> <code>points()</code></a></li>
<li class="chapter" data-level="28.2.3" data-path="graph.html"><a href="graph.html#graph-pl-lines"><i class="fa fa-check"></i><b>28.2.3</b> <code>lines()</code></a></li>
<li class="chapter" data-level="28.2.4" data-path="graph.html"><a href="graph.html#graph-pl-legend"><i class="fa fa-check"></i><b>28.2.4</b> 图例</a></li>
<li class="chapter" data-level="28.2.5" data-path="graph.html"><a href="graph.html#graph-pl-axis"><i class="fa fa-check"></i><b>28.2.5</b> <code>axis()</code></a></li>
<li class="chapter" data-level="28.2.6" data-path="graph.html"><a href="graph.html#graph-pl-text"><i class="fa fa-check"></i><b>28.2.6</b> <code>text()</code></a></li>
<li class="chapter" data-level="28.2.7" data-path="graph.html"><a href="graph.html#graph-pl-locator"><i class="fa fa-check"></i><b>28.2.7</b> <code>locator()</code>和<code>identify()</code></a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="graph.html"><a href="graph.html#graph-par"><i class="fa fa-check"></i><b>28.3</b> 图形参数</a><ul>
<li class="chapter" data-level="28.3.1" data-path="graph.html"><a href="graph.html#graph-par-ex1"><i class="fa fa-check"></i><b>28.3.1</b> 例子：用图形参数解决barplot图形横坐标值过宽</a></li>
<li class="chapter" data-level="28.3.2" data-path="graph.html"><a href="graph.html#graph-par-elem"><i class="fa fa-check"></i><b>28.3.2</b> 图形元素控制</a></li>
<li class="chapter" data-level="28.3.3" data-path="graph.html"><a href="graph.html#graph-par-axis"><i class="fa fa-check"></i><b>28.3.3</b> 坐标轴与坐标刻度</a></li>
<li class="chapter" data-level="28.3.4" data-path="graph.html"><a href="graph.html#graph-par-mar"><i class="fa fa-check"></i><b>28.3.4</b> 图形边空</a></li>
<li class="chapter" data-level="28.3.5" data-path="graph.html"><a href="graph.html#graph-par-mfrow"><i class="fa fa-check"></i><b>28.3.5</b> 一页多图</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="graph.html"><a href="graph.html#graph-pout"><i class="fa fa-check"></i><b>28.4</b> 图形输出</a><ul>
<li class="chapter" data-level="28.4.1" data-path="graph.html"><a href="graph.html#graph-pout-pdf"><i class="fa fa-check"></i><b>28.4.1</b> PDF 输出</a></li>
<li class="chapter" data-level="28.4.2" data-path="graph.html"><a href="graph.html#graph-pout-png"><i class="fa fa-check"></i><b>28.4.2</b> PNG输出</a></li>
</ul></li>
<li class="chapter" data-level="28.5" data-path="graph.html"><a href="graph.html#graph-pzhn"><i class="fa fa-check"></i><b>28.5</b> 包含多种中文字体的图形</a></li>
<li class="chapter" data-level="28.6" data-path="graph.html"><a href="graph.html#graph-other"><i class="fa fa-check"></i><b>28.6</b> 其它图形</a><ul>
<li class="chapter" data-level="28.6.1" data-path="graph.html"><a href="graph.html#graph-other-corr"><i class="fa fa-check"></i><b>28.6.1</b> 相关系数图</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="29" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>29</b> ggplot作图入门</a><ul>
<li class="chapter" data-level="29.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-intro"><i class="fa fa-check"></i><b>29.1</b> 介绍</a></li>
<li class="chapter" data-level="29.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-principles"><i class="fa fa-check"></i><b>29.2</b> 作图的一般原则</a></li>
<li class="chapter" data-level="29.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point"><i class="fa fa-check"></i><b>29.3</b> 散点图：ggplot入门</a><ul>
<li class="chapter" data-level="29.3.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-base"><i class="fa fa-check"></i><b>29.3.1</b> 基本的散点图</a></li>
<li class="chapter" data-level="29.3.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-layers"><i class="fa fa-check"></i><b>29.3.2</b> 逐步改善</a></li>
<li class="chapter" data-level="29.3.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-otheraes"><i class="fa fa-check"></i><b>29.3.3</b> 颜色、符号、线型等映射</a></li>
<li class="chapter" data-level="29.3.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-geomaes"><i class="fa fa-check"></i><b>29.3.4</b> 在geom函数中映射变量</a></li>
<li class="chapter" data-level="29.3.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-contcolor"><i class="fa fa-check"></i><b>29.3.5</b> 连续变量的颜色映射</a></li>
<li class="chapter" data-level="29.3.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-point-save"><i class="fa fa-check"></i><b>29.3.6</b> 保存图像</a></li>
</ul></li>
<li class="chapter" data-level="29.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right"><i class="fa fa-check"></i><b>29.4</b> 折线图、分组、小图</a><ul>
<li class="chapter" data-level="29.4.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-group"><i class="fa fa-check"></i><b>29.4.1</b> 图形中的分组和折线图</a></li>
<li class="chapter" data-level="29.4.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-facet"><i class="fa fa-check"></i><b>29.4.2</b> 小图(facet)</a></li>
</ul></li>
<li class="chapter" data-level="29.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-bar-trans"><i class="fa fa-check"></i><b>29.5</b> 数据变换与条形图</a><ul>
<li class="chapter" data-level="29.5.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-right-morebar"><i class="fa fa-check"></i><b>29.5.1</b> 分段与并列条形图</a></li>
<li class="chapter" data-level="29.5.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-bar-morebar"><i class="fa fa-check"></i><b>29.5.2</b> 条形图的其它应用</a></li>
</ul></li>
<li class="chapter" data-level="29.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-hist"><i class="fa fa-check"></i><b>29.6</b> 直方图与密度估计</a></li>
<li class="chapter" data-level="29.7" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm"><i class="fa fa-check"></i><b>29.7</b> 绘图语法介绍</a><ul>
<li class="chapter" data-level="29.7.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm-gramm"><i class="fa fa-check"></i><b>29.7.1</b> 绘图语法</a></li>
<li class="chapter" data-level="29.7.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-gramm-geoms"><i class="fa fa-check"></i><b>29.7.2</b> 图形种类</a></li>
</ul></li>
<li class="chapter" data-level="29.8" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom"><i class="fa fa-check"></i><b>29.8</b> 更多图形种类</a><ul>
<li class="chapter" data-level="29.8.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-continuousvar"><i class="fa fa-check"></i><b>29.8.1</b> 连续变量的分组图形</a></li>
<li class="chapter" data-level="29.8.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-text"><i class="fa fa-check"></i><b>29.8.2</b> 坐标系中的文字</a></li>
<li class="chapter" data-level="29.8.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-textops"><i class="fa fa-check"></i><b>29.8.3</b> 文字选项</a></li>
<li class="chapter" data-level="29.8.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-moregeom-outliers"><i class="fa fa-check"></i><b>29.8.4</b> 标出特殊点</a></li>
</ul></li>
<li class="chapter" data-level="29.9" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-scale"><i class="fa fa-check"></i><b>29.9</b> 刻度(scale)</a></li>
<li class="chapter" data-level="29.10" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-color"><i class="fa fa-check"></i><b>29.10</b> 如何使用颜色</a><ul>
<li class="chapter" data-level="29.10.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-qual"><i class="fa fa-check"></i><b>29.10.1</b> 名义型变量的颜色</a></li>
<li class="chapter" data-level="29.10.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-tile"><i class="fa fa-check"></i><b>29.10.2</b> 色块图</a></li>
<li class="chapter" data-level="29.10.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-seq"><i class="fa fa-check"></i><b>29.10.3</b> 有序型变量的颜色</a></li>
<li class="chapter" data-level="29.10.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-div"><i class="fa fa-check"></i><b>29.10.4</b> 相异型变量的颜色</a></li>
<li class="chapter" data-level="29.10.5" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-num"><i class="fa fa-check"></i><b>29.10.5</b> 连续数值变量的颜色</a></li>
</ul></li>
<li class="chapter" data-level="29.11" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs"><i class="fa fa-check"></i><b>29.11</b> 标题、标注、指南、拼接</a><ul>
<li class="chapter" data-level="29.11.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-labs"><i class="fa fa-check"></i><b>29.11.1</b> 标题</a></li>
<li class="chapter" data-level="29.11.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-anno"><i class="fa fa-check"></i><b>29.11.2</b> 标注功能</a></li>
<li class="chapter" data-level="29.11.3" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-guides"><i class="fa fa-check"></i><b>29.11.3</b> 指南(guides)</a></li>
<li class="chapter" data-level="29.11.4" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-auxfuncs-compfig"><i class="fa fa-check"></i><b>29.11.4</b> 拼接图形</a></li>
</ul></li>
<li class="chapter" data-level="29.12" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine"><i class="fa fa-check"></i><b>29.12</b> 图形定制调整</a><ul>
<li class="chapter" data-level="29.12.1" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-refine-asasec"><i class="fa fa-check"></i><b>29.12.1</b> 图形逐步调整例子</a></li>
</ul></li>
<li class="chapter" data-level="29.13" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-theme"><i class="fa fa-check"></i><b>29.13</b> 主题</a></li>
<li class="chapter" data-level="29.14" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-ref"><i class="fa fa-check"></i><b>29.14</b> 参考文献</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="ggplotvis.html"><a href="ggplotvis.html"><i class="fa fa-check"></i><b>30</b> ggplot的各种图形</a><ul>
<li class="chapter" data-level="30.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-intro"><i class="fa fa-check"></i><b>30.1</b> 介绍</a></li>
<li class="chapter" data-level="30.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount"><i class="fa fa-check"></i><b>30.2</b> 表现数量</a><ul>
<li class="chapter" data-level="30.2.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-bar"><i class="fa fa-check"></i><b>30.2.1</b> 条形图</a></li>
<li class="chapter" data-level="30.2.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-point"><i class="fa fa-check"></i><b>30.2.2</b> 点图</a></li>
<li class="chapter" data-level="30.2.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-amount-heatmap"><i class="fa fa-check"></i><b>30.2.3</b> 热力图</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist"><i class="fa fa-check"></i><b>30.3</b> 表现分布</a><ul>
<li class="chapter" data-level="30.3.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-suni-hist"><i class="fa fa-check"></i><b>30.3.1</b> 单个一元分布的直方图与密度估计图</a></li>
<li class="chapter" data-level="30.3.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-muni"><i class="fa fa-check"></i><b>30.3.2</b> 多个一元分布的直方图和密度图形</a></li>
<li class="chapter" data-level="30.3.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-cdf"><i class="fa fa-check"></i><b>30.3.3</b> 经验分布函数图</a></li>
<li class="chapter" data-level="30.3.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-qqplot"><i class="fa fa-check"></i><b>30.3.4</b> QQ图</a></li>
<li class="chapter" data-level="30.3.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-boxplot"><i class="fa fa-check"></i><b>30.3.5</b> 盒形图</a></li>
<li class="chapter" data-level="30.3.6" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-violin"><i class="fa fa-check"></i><b>30.3.6</b> 小提琴图</a></li>
<li class="chapter" data-level="30.3.7" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-mdens"><i class="fa fa-check"></i><b>30.3.7</b> 多个密度的其它画法</a></li>
<li class="chapter" data-level="30.3.8" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-dist-2d"><i class="fa fa-check"></i><b>30.3.8</b> 二元分布直方图和等值线图</a></li>
</ul></li>
<li class="chapter" data-level="30.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop"><i class="fa fa-check"></i><b>30.4</b> 表现比例</a><ul>
<li class="chapter" data-level="30.4.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-uni"><i class="fa fa-check"></i><b>30.4.1</b> 单个分布</a></li>
<li class="chapter" data-level="30.4.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-mult"><i class="fa fa-check"></i><b>30.4.2</b> 组间的比例分布的比较</a></li>
<li class="chapter" data-level="30.4.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-prop-nest"><i class="fa fa-check"></i><b>30.4.3</b> 嵌套比例分布的比较</a></li>
</ul></li>
<li class="chapter" data-level="30.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar"><i class="fa fa-check"></i><b>30.5</b> 表现多个变量间的关系</a><ul>
<li class="chapter" data-level="30.5.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-scatter"><i class="fa fa-check"></i><b>30.5.1</b> 散点图</a></li>
<li class="chapter" data-level="30.5.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-scatmat"><i class="fa fa-check"></i><b>30.5.2</b> 散点图矩阵</a></li>
<li class="chapter" data-level="30.5.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-corrgram"><i class="fa fa-check"></i><b>30.5.3</b> 相关系数矩阵图</a></li>
<li class="chapter" data-level="30.5.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-dimreduct"><i class="fa fa-check"></i><b>30.5.4</b> 数据降维</a></li>
<li class="chapter" data-level="30.5.5" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-mulvar-paird"><i class="fa fa-check"></i><b>30.5.5</b> 成对数据</a></li>
</ul></li>
<li class="chapter" data-level="30.6" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts"><i class="fa fa-check"></i><b>30.6</b> 时间序列图</a><ul>
<li class="chapter" data-level="30.6.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-uni"><i class="fa fa-check"></i><b>30.6.1</b> 一元时间序列</a></li>
<li class="chapter" data-level="30.6.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-mul"><i class="fa fa-check"></i><b>30.6.2</b> 多元时间序列</a></li>
<li class="chapter" data-level="30.6.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-ts-het"><i class="fa fa-check"></i><b>30.6.3</b> 多个不同类型指标的时间序列</a></li>
</ul></li>
<li class="chapter" data-level="30.7" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit"><i class="fa fa-check"></i><b>30.7</b> 拟合曲线图</a><ul>
<li class="chapter" data-level="30.7.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit-smooth"><i class="fa fa-check"></i><b>30.7.1</b> 平滑方法</a></li>
<li class="chapter" data-level="30.7.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-fit-param"><i class="fa fa-check"></i><b>30.7.2</b> 参数模型方法</a></li>
</ul></li>
<li class="chapter" data-level="30.8" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert"><i class="fa fa-check"></i><b>30.8</b> 表现不确定性</a><ul>
<li class="chapter" data-level="30.8.1" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-prob"><i class="fa fa-check"></i><b>30.8.1</b> 表现概率</a></li>
<li class="chapter" data-level="30.8.2" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-se"><i class="fa fa-check"></i><b>30.8.2</b> 表现点估计精度</a></li>
<li class="chapter" data-level="30.8.3" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-cband"><i class="fa fa-check"></i><b>30.8.3</b> 拟合曲线的置信带</a></li>
<li class="chapter" data-level="30.8.4" data-path="ggplotvis.html"><a href="ggplotvis.html#ggplotvis-uncert-dyn"><i class="fa fa-check"></i><b>30.8.4</b> 随机结果动态演示</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII 统计模型</b></span></li>
<li class="chapter" data-level="31" data-path="stat-basics.html"><a href="stat-basics.html"><i class="fa fa-check"></i><b>31</b> R初等统计分析</a><ul>
<li class="chapter" data-level="31.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-distr"><i class="fa fa-check"></i><b>31.1</b> 概率分布</a></li>
<li class="chapter" data-level="31.2" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-mle"><i class="fa fa-check"></i><b>31.2</b> 最大似然估计</a><ul>
<li class="chapter" data-level="31.2.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-mle-norm1"><i class="fa fa-check"></i><b>31.2.1</b> 一元正态分布参数最大似然估计</a></li>
</ul></li>
<li class="chapter" data-level="31.3" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest"><i class="fa fa-check"></i><b>31.3</b> 假设检验和置信区间</a><ul>
<li class="chapter" data-level="31.3.1" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-mu"><i class="fa fa-check"></i><b>31.3.1</b> 均值的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.2" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-prop"><i class="fa fa-check"></i><b>31.3.2</b> 比例的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.3" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-sigma"><i class="fa fa-check"></i><b>31.3.3</b> 方差的假设检验和置信区间</a></li>
<li class="chapter" data-level="31.3.4" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-gof"><i class="fa fa-check"></i><b>31.3.4</b> 拟合优度检验</a></li>
<li class="chapter" data-level="31.3.5" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-gof-vcd"><i class="fa fa-check"></i><b>31.3.5</b> 检验分布类型</a></li>
<li class="chapter" data-level="31.3.6" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-indepcont"><i class="fa fa-check"></i><b>31.3.6</b> 列联表独立性卡方检验</a></li>
<li class="chapter" data-level="31.3.7" data-path="stat-basics.html"><a href="stat-basics.html#stat-base-hyptest-npar"><i class="fa fa-check"></i><b>31.3.7</b> 非参数检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="32" data-path="stat-reg.html"><a href="stat-reg.html"><i class="fa fa-check"></i><b>32</b> R相关与回归</a><ul>
<li class="chapter" data-level="32.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor"><i class="fa fa-check"></i><b>32.1</b> 相关分析</a><ul>
<li class="chapter" data-level="32.1.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-prop"><i class="fa fa-check"></i><b>32.1.1</b> 相关系数的性质</a></li>
<li class="chapter" data-level="32.1.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-caus"><i class="fa fa-check"></i><b>32.1.2</b> 相关与因果</a></li>
<li class="chapter" data-level="32.1.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-magn"><i class="fa fa-check"></i><b>32.1.3</b> 相关系数大小</a></li>
<li class="chapter" data-level="32.1.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-test"><i class="fa fa-check"></i><b>32.1.4</b> 相关系数的检验</a></li>
<li class="chapter" data-level="32.1.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cor-vcorr"><i class="fa fa-check"></i><b>32.1.5</b> 相关阵</a></li>
</ul></li>
<li class="chapter" data-level="32.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp"><i class="fa fa-check"></i><b>32.2</b> 一元回归分析</a><ul>
<li class="chapter" data-level="32.2.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-model"><i class="fa fa-check"></i><b>32.2.1</b> 模型</a></li>
<li class="chapter" data-level="32.2.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-ls"><i class="fa fa-check"></i><b>32.2.2</b> 最小二乘法</a></li>
<li class="chapter" data-level="32.2.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-test"><i class="fa fa-check"></i><b>32.2.3</b> 回归有效性</a></li>
<li class="chapter" data-level="32.2.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-prog"><i class="fa fa-check"></i><b>32.2.4</b> R程序</a></li>
<li class="chapter" data-level="32.2.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-diag"><i class="fa fa-check"></i><b>32.2.5</b> 回归诊断</a></li>
<li class="chapter" data-level="32.2.6" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-ci"><i class="fa fa-check"></i><b>32.2.6</b> 预测区间</a></li>
<li class="chapter" data-level="32.2.7" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regsimp-control"><i class="fa fa-check"></i><b>32.2.7</b> 控制</a></li>
</ul></li>
<li class="chapter" data-level="32.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu"><i class="fa fa-check"></i><b>32.3</b> 多元线性回归</a><ul>
<li class="chapter" data-level="32.3.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-mod"><i class="fa fa-check"></i><b>32.3.1</b> 模型</a></li>
<li class="chapter" data-level="32.3.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-est"><i class="fa fa-check"></i><b>32.3.2</b> 参数估计</a></li>
<li class="chapter" data-level="32.3.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-rcode"><i class="fa fa-check"></i><b>32.3.3</b> R的多元回归程序</a></li>
<li class="chapter" data-level="32.3.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-test"><i class="fa fa-check"></i><b>32.3.4</b> 模型的检验</a></li>
<li class="chapter" data-level="32.3.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-subset"><i class="fa fa-check"></i><b>32.3.5</b> 回归自变量筛选</a></li>
<li class="chapter" data-level="32.3.6" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-dum"><i class="fa fa-check"></i><b>32.3.6</b> 哑变量与变截距项的模型</a></li>
<li class="chapter" data-level="32.3.7" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-resid"><i class="fa fa-check"></i><b>32.3.7</b> 残差诊断</a></li>
<li class="chapter" data-level="32.3.8" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-colin"><i class="fa fa-check"></i><b>32.3.8</b> 多重共线性</a></li>
<li class="chapter" data-level="32.3.9" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-lev"><i class="fa fa-check"></i><b>32.3.9</b> 强影响点分析</a></li>
<li class="chapter" data-level="32.3.10" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-overfit"><i class="fa fa-check"></i><b>32.3.10</b> 过度拟合示例</a></li>
<li class="chapter" data-level="32.3.11" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-comp-inset"><i class="fa fa-check"></i><b>32.3.11</b> 嵌套模型的比较</a></li>
<li class="chapter" data-level="32.3.12" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-pred"><i class="fa fa-check"></i><b>32.3.12</b> 拟合与预测</a></li>
<li class="chapter" data-level="32.3.13" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-curve"><i class="fa fa-check"></i><b>32.3.13</b> 利用线性回归模型做曲线拟合</a></li>
<li class="chapter" data-level="32.3.14" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-regmu-group"><i class="fa fa-check"></i><b>32.3.14</b> 分组建立多个模型</a></li>
</ul></li>
<li class="chapter" data-level="32.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-npar"><i class="fa fa-check"></i><b>32.4</b> 非参数回归</a><ul>
<li class="chapter" data-level="32.4.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-npar-mod"><i class="fa fa-check"></i><b>32.4.1</b> 模型</a></li>
<li class="chapter" data-level="32.4.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-spl1d"><i class="fa fa-check"></i><b>32.4.2</b> 样条平滑</a></li>
<li class="chapter" data-level="32.4.3" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-loess"><i class="fa fa-check"></i><b>32.4.3</b> 局部多项式曲线平滑</a></li>
<li class="chapter" data-level="32.4.4" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-bs"><i class="fa fa-check"></i><b>32.4.4</b> 样条函数变换</a></li>
<li class="chapter" data-level="32.4.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-cfit-gam"><i class="fa fa-check"></i><b>32.4.5</b> 线性可加模型</a></li>
</ul></li>
<li class="chapter" data-level="32.5" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog"><i class="fa fa-check"></i><b>32.5</b> Logistic回归</a><ul>
<li class="chapter" data-level="32.5.1" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog-mod"><i class="fa fa-check"></i><b>32.5.1</b> 模型</a></li>
<li class="chapter" data-level="32.5.2" data-path="stat-reg.html"><a href="stat-reg.html#stat-base-reg-reglog-rcode"><i class="fa fa-check"></i><b>32.5.2</b> R程序</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="33" data-path="stat-tsa.html"><a href="stat-tsa.html"><i class="fa fa-check"></i><b>33</b> R时间序列分析</a><ul>
<li class="chapter" data-level="33.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-defs"><i class="fa fa-check"></i><b>33.1</b> 基本概念</a></li>
<li class="chapter" data-level="33.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype"><i class="fa fa-check"></i><b>33.2</b> 时间序列数据类型</a><ul>
<li class="chapter" data-level="33.2.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype-ts"><i class="fa fa-check"></i><b>33.2.1</b> ts类型</a></li>
<li class="chapter" data-level="33.2.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-dtype-xts"><i class="fa fa-check"></i><b>33.2.2</b> xts类型与常用函数</a></li>
</ul></li>
<li class="chapter" data-level="33.3" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-basicstat"><i class="fa fa-check"></i><b>33.3</b> 基本分析与作图</a></li>
<li class="chapter" data-level="33.4" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima"><i class="fa fa-check"></i><b>33.4</b> ARIMA建模和模拟</a><ul>
<li class="chapter" data-level="33.4.1" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-def"><i class="fa fa-check"></i><b>33.4.1</b> 模型公式</a></li>
<li class="chapter" data-level="33.4.2" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-sim"><i class="fa fa-check"></i><b>33.4.2</b> 模拟</a></li>
<li class="chapter" data-level="33.4.3" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-armod"><i class="fa fa-check"></i><b>33.4.3</b> AR建模</a></li>
<li class="chapter" data-level="33.4.4" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-armamod"><i class="fa fa-check"></i><b>33.4.4</b> ARMA建模</a></li>
<li class="chapter" data-level="33.4.5" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-diag"><i class="fa fa-check"></i><b>33.4.5</b> 模型诊断</a></li>
<li class="chapter" data-level="33.4.6" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-lbtest"><i class="fa fa-check"></i><b>33.4.6</b> 白噪声检验</a></li>
<li class="chapter" data-level="33.4.7" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-sparse"><i class="fa fa-check"></i><b>33.4.7</b> 稀疏系数估计</a></li>
<li class="chapter" data-level="33.4.8" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-adftest"><i class="fa fa-check"></i><b>33.4.8</b> 单位根检验</a></li>
<li class="chapter" data-level="33.4.9" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-arima-cfuncs"><i class="fa fa-check"></i><b>33.4.9</b> ARMA模型的一些自定义函数</a></li>
</ul></li>
<li class="chapter" data-level="33.5" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-spectra"><i class="fa fa-check"></i><b>33.5</b> 谱密度估计</a></li>
<li class="chapter" data-level="33.6" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-garch"><i class="fa fa-check"></i><b>33.6</b> GARCH类模型</a></li>
<li class="chapter" data-level="33.7" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-mtsa"><i class="fa fa-check"></i><b>33.7</b> 多元时间序列基础统计</a></li>
<li class="chapter" data-level="33.8" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-var"><i class="fa fa-check"></i><b>33.8</b> VAR模型</a></li>
<li class="chapter" data-level="33.9" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-coint"><i class="fa fa-check"></i><b>33.9</b> 协整分析</a></li>
<li class="chapter" data-level="33.10" data-path="stat-tsa.html"><a href="stat-tsa.html#stat-tsa-causal"><i class="fa fa-check"></i><b>33.10</b> 因果性检验</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="stat-learning.html"><a href="stat-learning.html"><i class="fa fa-check"></i><b>34</b> 统计学习介绍</a><ul>
<li class="chapter" data-level="34.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro"><i class="fa fa-check"></i><b>34.1</b> 统计学习的基本概念和一般步骤</a><ul>
<li class="chapter" data-level="34.1.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro-basic"><i class="fa fa-check"></i><b>34.1.1</b> 统计学习的基本概念和方法</a></li>
<li class="chapter" data-level="34.1.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-intro-biasvar"><i class="fa fa-check"></i><b>34.1.2</b> 偏差与方差折衷</a></li>
<li class="chapter" data-level="34.1.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-cv"><i class="fa fa-check"></i><b>34.1.3</b> 交叉验证</a></li>
<li class="chapter" data-level="34.1.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-steps"><i class="fa fa-check"></i><b>34.1.4</b> 一般步骤</a></li>
</ul></li>
<li class="chapter" data-level="34.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters"><i class="fa fa-check"></i><b>34.2</b> Hitters数据分析</a><ul>
<li class="chapter" data-level="34.2.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-subset"><i class="fa fa-check"></i><b>34.2.1</b> 回归自变量选择</a></li>
<li class="chapter" data-level="34.2.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-ridge"><i class="fa fa-check"></i><b>34.2.2</b> 岭回归</a></li>
<li class="chapter" data-level="34.2.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-lasso"><i class="fa fa-check"></i><b>34.2.3</b> Lasso回归</a></li>
<li class="chapter" data-level="34.2.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-simpt"><i class="fa fa-check"></i><b>34.2.4</b> 树回归的简单演示</a></li>
<li class="chapter" data-level="34.2.5" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-tree"><i class="fa fa-check"></i><b>34.2.5</b> 树回归</a></li>
<li class="chapter" data-level="34.2.6" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-bag"><i class="fa fa-check"></i><b>34.2.6</b> 装袋法</a></li>
<li class="chapter" data-level="34.2.7" data-path="stat-learning.html"><a href="stat-learning.html#statl-hitters-rf"><i class="fa fa-check"></i><b>34.2.7</b> 随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart"><i class="fa fa-check"></i><b>34.3</b> Heart数据分析</a><ul>
<li class="chapter" data-level="34.3.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-tree"><i class="fa fa-check"></i><b>34.3.1</b> 树回归</a></li>
<li class="chapter" data-level="34.3.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-bag"><i class="fa fa-check"></i><b>34.3.2</b> 用装袋法</a></li>
<li class="chapter" data-level="34.3.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-heart-rf"><i class="fa fa-check"></i><b>34.3.3</b> 用随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-car"><i class="fa fa-check"></i><b>34.4</b> 汽车销量数据分析</a><ul>
<li class="chapter" data-level="34.4.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-car-tree"><i class="fa fa-check"></i><b>34.4.1</b> 判别树</a></li>
<li class="chapter" data-level="34.4.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-car-rf"><i class="fa fa-check"></i><b>34.4.2</b> 随机森林</a></li>
</ul></li>
<li class="chapter" data-level="34.5" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston"><i class="fa fa-check"></i><b>34.5</b> 波士顿郊区房价数据</a><ul>
<li class="chapter" data-level="34.5.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-tree"><i class="fa fa-check"></i><b>34.5.1</b> 回归树</a></li>
<li class="chapter" data-level="34.5.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-bag"><i class="fa fa-check"></i><b>34.5.2</b> 装袋法</a></li>
<li class="chapter" data-level="34.5.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-rf"><i class="fa fa-check"></i><b>34.5.3</b> 随机森林</a></li>
<li class="chapter" data-level="34.5.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-boston-boost"><i class="fa fa-check"></i><b>34.5.4</b> 提升法</a></li>
</ul></li>
<li class="chapter" data-level="34.6" data-path="stat-learning.html"><a href="stat-learning.html#statl-svm"><i class="fa fa-check"></i><b>34.6</b> 支持向量机方法</a><ul>
<li class="chapter" data-level="34.6.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-svm-heart"><i class="fa fa-check"></i><b>34.6.1</b> 支持向量机用于Heart数据</a></li>
</ul></li>
<li class="chapter" data-level="34.7" data-path="stat-learning.html"><a href="stat-learning.html#statl-app"><i class="fa fa-check"></i><b>34.7</b> 附录</a><ul>
<li class="chapter" data-level="34.7.1" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-hitters"><i class="fa fa-check"></i><b>34.7.1</b> Hitters数据</a></li>
<li class="chapter" data-level="34.7.2" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-heart"><i class="fa fa-check"></i><b>34.7.2</b> Heart数据</a></li>
<li class="chapter" data-level="34.7.3" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-car"><i class="fa fa-check"></i><b>34.7.3</b> CarSeats数据</a></li>
<li class="chapter" data-level="34.7.4" data-path="stat-learning.html"><a href="stat-learning.html#statl-app-boston"><i class="fa fa-check"></i><b>34.7.4</b> Boston数据</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="35" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>35</b> 随机模拟</a><ul>
<li class="chapter" data-level="35.1" data-path="simulation.html"><a href="simulation.html#simint"><i class="fa fa-check"></i><b>35.1</b> 随机数</a></li>
<li class="chapter" data-level="35.2" data-path="simulation.html"><a href="simulation.html#simsamp"><i class="fa fa-check"></i><b>35.2</b> <code>sample()</code>函数</a></li>
<li class="chapter" data-level="35.3" data-path="simulation.html"><a href="simulation.html#simexamp"><i class="fa fa-check"></i><b>35.3</b> 随机模拟示例</a><ul>
<li class="chapter" data-level="35.3.1" data-path="simulation.html"><a href="simulation.html#simexamp-expect"><i class="fa fa-check"></i><b>35.3.1</b> 估计期望值</a></li>
<li class="chapter" data-level="35.3.2" data-path="simulation.html"><a href="simulation.html#simexamp-lm"><i class="fa fa-check"></i><b>35.3.2</b> 线性回归模拟</a></li>
<li class="chapter" data-level="35.3.3" data-path="simulation.html"><a href="simulation.html#simexamp-kde"><i class="fa fa-check"></i><b>35.3.3</b> 核密度的bootstrap置信区间</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VIII 特殊应用</b></span></li>
<li class="chapter" data-level="36" data-path="text.html"><a href="text.html"><i class="fa fa-check"></i><b>36</b> R语言的文本处理</a><ul>
<li class="chapter" data-level="36.1" data-path="text.html"><a href="text.html#text-simple"><i class="fa fa-check"></i><b>36.1</b> 简单的文本处理</a><ul>
<li class="chapter" data-level="36.1.1" data-path="text.html"><a href="text.html#text-simple-const"><i class="fa fa-check"></i><b>36.1.1</b> 字符型常量与字符型向量</a></li>
<li class="chapter" data-level="36.1.2" data-path="text.html"><a href="text.html#text-paste"><i class="fa fa-check"></i><b>36.1.2</b> 字符串连接、重复</a></li>
<li class="chapter" data-level="36.1.3" data-path="text.html"><a href="text.html#text-formatout"><i class="fa fa-check"></i><b>36.1.3</b> 格式化输出</a></li>
<li class="chapter" data-level="36.1.4" data-path="text.html"><a href="text.html#text-length"><i class="fa fa-check"></i><b>36.1.4</b> 字符串长度</a></li>
<li class="chapter" data-level="36.1.5" data-path="text.html"><a href="text.html#text-substring"><i class="fa fa-check"></i><b>36.1.5</b> 取子串</a></li>
<li class="chapter" data-level="36.1.6" data-path="text.html"><a href="text.html#text-convert"><i class="fa fa-check"></i><b>36.1.6</b> 字符串变换</a></li>
<li class="chapter" data-level="36.1.7" data-path="text.html"><a href="text.html#text-simp-find"><i class="fa fa-check"></i><b>36.1.7</b> 简单匹配与查找</a></li>
<li class="chapter" data-level="36.1.8" data-path="text.html"><a href="text.html#text-simple-gsub"><i class="fa fa-check"></i><b>36.1.8</b> 字符串替换</a></li>
<li class="chapter" data-level="36.1.9" data-path="text.html"><a href="text.html#text-simple-strsplit"><i class="fa fa-check"></i><b>36.1.9</b> 字符串拆分</a></li>
</ul></li>
<li class="chapter" data-level="36.2" data-path="text.html"><a href="text.html#text-file"><i class="fa fa-check"></i><b>36.2</b> 文本文件读写</a></li>
<li class="chapter" data-level="36.3" data-path="text.html"><a href="text.html#text-regex"><i class="fa fa-check"></i><b>36.3</b> 正则表达式</a><ul>
<li class="chapter" data-level="36.3.1" data-path="text.html"><a href="text.html#text-regex-strview"><i class="fa fa-check"></i><b>36.3.1</b> 字面匹配与匹配显示</a></li>
<li class="chapter" data-level="36.3.2" data-path="text.html"><a href="text.html#text-regex-ignore"><i class="fa fa-check"></i><b>36.3.2</b> 不区分大小写匹配和<code>regex</code>函数</a></li>
<li class="chapter" data-level="36.3.3" data-path="text.html"><a href="text.html#text-regex-dot"><i class="fa fa-check"></i><b>36.3.3</b> 用句点匹配单个字符</a></li>
<li class="chapter" data-level="36.3.4" data-path="text.html"><a href="text.html#text-regex-set"><i class="fa fa-check"></i><b>36.3.4</b> 匹配一组字符中的某一个</a></li>
<li class="chapter" data-level="36.3.5" data-path="text.html"><a href="text.html#text-regex-metalit"><i class="fa fa-check"></i><b>36.3.5</b> 原样匹配元字符</a></li>
<li class="chapter" data-level="36.3.6" data-path="text.html"><a href="text.html#text-regex-space"><i class="fa fa-check"></i><b>36.3.6</b> 匹配空白</a></li>
<li class="chapter" data-level="36.3.7" data-path="text.html"><a href="text.html#text-regex-digit"><i class="fa fa-check"></i><b>36.3.7</b> 匹配数字</a></li>
<li class="chapter" data-level="36.3.8" data-path="text.html"><a href="text.html#text-regex-alnum"><i class="fa fa-check"></i><b>36.3.8</b> 匹配字母、数字、下划线</a></li>
<li class="chapter" data-level="36.3.9" data-path="text.html"><a href="text.html#text-regex-hex"><i class="fa fa-check"></i><b>36.3.9</b> 十六进制和八进制数</a></li>
<li class="chapter" data-level="36.3.10" data-path="text.html"><a href="text.html#text-regex-posix"><i class="fa fa-check"></i><b>36.3.10</b> POSIX字符类</a></li>
<li class="chapter" data-level="36.3.11" data-path="text.html"><a href="text.html#text-regex-start"><i class="fa fa-check"></i><b>36.3.11</b> 匹配开头和末尾</a></li>
<li class="chapter" data-level="36.3.12" data-path="text.html"><a href="text.html#text-regex-wordb"><i class="fa fa-check"></i><b>36.3.12</b> 单词边界</a></li>
<li class="chapter" data-level="36.3.13" data-path="text.html"><a href="text.html#text-regex-repeat"><i class="fa fa-check"></i><b>36.3.13</b> 重复匹配</a></li>
<li class="chapter" data-level="36.3.14" data-path="text.html"><a href="text.html#text-regex-lazy"><i class="fa fa-check"></i><b>36.3.14</b> 贪婪匹配和懒惰匹配</a></li>
<li class="chapter" data-level="36.3.15" data-path="text.html"><a href="text.html#text-regex-smlines"><i class="fa fa-check"></i><b>36.3.15</b> 句点全匹配与多行模式</a></li>
<li class="chapter" data-level="36.3.16" data-path="text.html"><a href="text.html#text-regex-alt"><i class="fa fa-check"></i><b>36.3.16</b> 备择模式</a></li>
<li class="chapter" data-level="36.3.17" data-path="text.html"><a href="text.html#text-regex-group"><i class="fa fa-check"></i><b>36.3.17</b> 分组与捕获</a></li>
</ul></li>
<li class="chapter" data-level="36.4" data-path="text.html"><a href="text.html#text-stringr-funcs"><i class="fa fa-check"></i><b>36.4</b> stringr包的正则表达式函数</a><ul>
<li class="chapter" data-level="36.4.1" data-path="text.html"><a href="text.html#text-stringr-funcs-strview"><i class="fa fa-check"></i><b>36.4.1</b> <code>str_view()</code>函数</a></li>
<li class="chapter" data-level="36.4.2" data-path="text.html"><a href="text.html#text-stringr-funcs-regex"><i class="fa fa-check"></i><b>36.4.2</b> <code>regex()</code>函数</a></li>
<li class="chapter" data-level="36.4.3" data-path="text.html"><a href="text.html#text-stringr-funcs-detect"><i class="fa fa-check"></i><b>36.4.3</b> 检查那些元素能够匹配</a></li>
<li class="chapter" data-level="36.4.4" data-path="text.html"><a href="text.html#text-stringr-funcs-replace"><i class="fa fa-check"></i><b>36.4.4</b> 替换</a></li>
<li class="chapter" data-level="36.4.5" data-path="text.html"><a href="text.html#text-stringr-funcs-subset"><i class="fa fa-check"></i><b>36.4.5</b> 返回匹配的元素</a></li>
<li class="chapter" data-level="36.4.6" data-path="text.html"><a href="text.html#text-stringr-funcs-extract"><i class="fa fa-check"></i><b>36.4.6</b> 提取匹配内容</a></li>
<li class="chapter" data-level="36.4.7" data-path="text.html"><a href="text.html#text-stringr-funcs-match"><i class="fa fa-check"></i><b>36.4.7</b> 提取分组捕获内容</a></li>
<li class="chapter" data-level="36.4.8" data-path="text.html"><a href="text.html#text-stringr-funcs-locate"><i class="fa fa-check"></i><b>36.4.8</b> 定位匹配位置</a></li>
</ul></li>
<li class="chapter" data-level="36.5" data-path="text.html"><a href="text.html#text-regex-bfuncs"><i class="fa fa-check"></i><b>36.5</b> 利用基本R函数进行正则表达式处理</a><ul>
<li class="chapter" data-level="36.5.1" data-path="text.html"><a href="text.html#text-regex-bfuncs-igcase"><i class="fa fa-check"></i><b>36.5.1</b> 不区分大小写匹配</a></li>
<li class="chapter" data-level="36.5.2" data-path="text.html"><a href="text.html#text-regex-bfuncs-dotp"><i class="fa fa-check"></i><b>36.5.2</b> 匹配单个字符</a></li>
<li class="chapter" data-level="36.5.3" data-path="text.html"><a href="text.html#text-regex-bfuncs-setp"><i class="fa fa-check"></i><b>36.5.3</b> 匹配一组字符中的某一个</a></li>
<li class="chapter" data-level="36.5.4" data-path="text.html"><a href="text.html#text-regex-bfuncs-metalit"><i class="fa fa-check"></i><b>36.5.4</b> 原样匹配元字符</a></li>
<li class="chapter" data-level="36.5.5" data-path="text.html"><a href="text.html#text-regex-bfuncs-digit"><i class="fa fa-check"></i><b>36.5.5</b> 匹配数字</a></li>
<li class="chapter" data-level="36.5.6" data-path="text.html"><a href="text.html#text-regex-bfuncs-start"><i class="fa fa-check"></i><b>36.5.6</b> 匹配开头和末尾</a></li>
<li class="chapter" data-level="36.5.7" data-path="text.html"><a href="text.html#text-regex-bfuncs-alnum"><i class="fa fa-check"></i><b>36.5.7</b> 匹配字母、数字、下划线</a></li>
<li class="chapter" data-level="36.5.8" data-path="text.html"><a href="text.html#text-regex-bfuncs-hex"><i class="fa fa-check"></i><b>36.5.8</b> 十六进制和八进制数</a></li>
<li class="chapter" data-level="36.5.9" data-path="text.html"><a href="text.html#text-regex-bfuncs-posix"><i class="fa fa-check"></i><b>36.5.9</b> POSIX字符类</a></li>
<li class="chapter" data-level="36.5.10" data-path="text.html"><a href="text.html#text-regex-bfuncs-plus"><i class="fa fa-check"></i><b>36.5.10</b> 加号重复匹配</a></li>
<li class="chapter" data-level="36.5.11" data-path="text.html"><a href="text.html#text-regex-bfuncs-ast"><i class="fa fa-check"></i><b>36.5.11</b> 星号和问号重复匹配</a></li>
<li class="chapter" data-level="36.5.12" data-path="text.html"><a href="text.html#text-regex-bfuncs-repnum"><i class="fa fa-check"></i><b>36.5.12</b> 计数重复</a></li>
<li class="chapter" data-level="36.5.13" data-path="text.html"><a href="text.html#text-regex-bfuncs-lazy"><i class="fa fa-check"></i><b>36.5.13</b> 贪婪匹配和懒惰匹配</a></li>
<li class="chapter" data-level="36.5.14" data-path="text.html"><a href="text.html#text-regex-bfuncs-wordb"><i class="fa fa-check"></i><b>36.5.14</b> 单词边界</a></li>
<li class="chapter" data-level="36.5.15" data-path="text.html"><a href="text.html#text-regex-bfuncs-sm"><i class="fa fa-check"></i><b>36.5.15</b> 句点全匹配与多行模式</a></li>
<li class="chapter" data-level="36.5.16" data-path="text.html"><a href="text.html#text-regex-bfuncs-alt"><i class="fa fa-check"></i><b>36.5.16</b> 备择模式</a></li>
<li class="chapter" data-level="36.5.17" data-path="text.html"><a href="text.html#text-regex-bfuncs-group"><i class="fa fa-check"></i><b>36.5.17</b> 分组与捕获</a></li>
</ul></li>
<li class="chapter" data-level="36.6" data-path="text.html"><a href="text.html#text-regexex"><i class="fa fa-check"></i><b>36.6</b> 正则表达式应用例子</a><ul>
<li class="chapter" data-level="36.6.1" data-path="text.html"><a href="text.html#text-regexex-pre"><i class="fa fa-check"></i><b>36.6.1</b> 数据预处理</a></li>
<li class="chapter" data-level="36.6.2" data-path="text.html"><a href="text.html#text-regexex-excelmore"><i class="fa fa-check"></i><b>36.6.2</b> 不规则Excel文件处理</a></li>
<li class="chapter" data-level="36.6.3" data-path="text.html"><a href="text.html#text-regexex-wordfreq"><i class="fa fa-check"></i><b>36.6.3</b> 字频统计</a></li>
<li class="chapter" data-level="36.6.4" data-path="text.html"><a href="text.html#text-regexex-digits"><i class="fa fa-check"></i><b>36.6.4</b> 数字验证</a></li>
<li class="chapter" data-level="36.6.5" data-path="text.html"><a href="text.html#text-regexex-digfn"><i class="fa fa-check"></i><b>36.6.5</b> 文件名中的数字提取</a></li>
</ul></li>
<li class="chapter" data-level="36.7" data-path="text.html"><a href="text.html#text-webscape"><i class="fa fa-check"></i><b>36.7</b> 网站数据获取</a></li>
<li class="chapter" data-level="36.8" data-path="text.html"><a href="text.html#text-jiebaR"><i class="fa fa-check"></i><b>36.8</b> 中文分词与词频</a></li>
</ul></li>
<li class="part"><span><b>IX 用Rcpp访问C++代码</b></span></li>
<li class="chapter" data-level="37" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>37</b> Rcpp介绍</a><ul>
<li class="chapter" data-level="37.1" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-use"><i class="fa fa-check"></i><b>37.1</b> Rcpp的用途</a></li>
<li class="chapter" data-level="37.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp"><i class="fa fa-check"></i><b>37.2</b> Rcpp入门样例</a><ul>
<li class="chapter" data-level="37.2.1" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex1"><i class="fa fa-check"></i><b>37.2.1</b> 用<code>cppFunction()</code>转换简单的C++函数—Fibnacci例子</a></li>
<li class="chapter" data-level="37.2.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex2"><i class="fa fa-check"></i><b>37.2.2</b> 用<code>sourceCpp()</code>转换C++程序—正负交替迭代例子</a></li>
<li class="chapter" data-level="37.2.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex3"><i class="fa fa-check"></i><b>37.2.3</b> 用<code>sourceCpp()</code>转换C++源文件中的程序—正负交替迭代例子</a></li>
<li class="chapter" data-level="37.2.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-ex4"><i class="fa fa-check"></i><b>37.2.4</b> 用<code>sourceCpp()</code>转换C++源程序文件—卷积例子</a></li>
<li class="chapter" data-level="37.2.5" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro-examp-rmdconv"><i class="fa fa-check"></i><b>37.2.5</b> 在Rmd文件中使用C++源程序文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="38" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html"><i class="fa fa-check"></i><b>38</b> R与C++的类型转换</a><ul>
<li class="chapter" data-level="38.1" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-wrap"><i class="fa fa-check"></i><b>38.1</b> 用<code>wrap()</code>把C++变量返回到R中</a></li>
<li class="chapter" data-level="38.2" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-as"><i class="fa fa-check"></i><b>38.2</b> 用<code>as()</code>函数把R变量转换为C++类型</a></li>
<li class="chapter" data-level="38.3" data-path="rcpp-typeconv.html"><a href="rcpp-typeconv.html#rcpp-typeconv-implicit"><i class="fa fa-check"></i><b>38.3</b> <code>as()</code>和<code>wrap()</code>的隐含调用</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="rcpp-attr.html"><a href="rcpp-attr.html"><i class="fa fa-check"></i><b>39</b> Rcpp 属性</a><ul>
<li class="chapter" data-level="39.1" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-intro"><i class="fa fa-check"></i><b>39.1</b> Rcpp属性介绍</a></li>
<li class="chapter" data-level="39.2" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-export"><i class="fa fa-check"></i><b>39.2</b> 在C++源程序中指定要导出的C++函数</a></li>
<li class="chapter" data-level="39.3" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-sourcecpp"><i class="fa fa-check"></i><b>39.3</b> 在R中编译链接C++代码</a></li>
<li class="chapter" data-level="39.4" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc"><i class="fa fa-check"></i><b>39.4</b> Rcpp属性的其它功能</a><ul>
<li class="chapter" data-level="39.4.1" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-default"><i class="fa fa-check"></i><b>39.4.1</b> 自变量有缺省值的函数</a></li>
<li class="chapter" data-level="39.4.2" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-interrupt"><i class="fa fa-check"></i><b>39.4.2</b> 允许用户中断</a></li>
<li class="chapter" data-level="39.4.3" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-rinclude"><i class="fa fa-check"></i><b>39.4.3</b> 把R代码写在C++源文件中</a></li>
<li class="chapter" data-level="39.4.4" data-path="rcpp-attr.html"><a href="rcpp-attr.html#rcpp-attr-misc-rand"><i class="fa fa-check"></i><b>39.4.4</b> 在C++中调用R的随机数发生器</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="40" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html"><i class="fa fa-check"></i><b>40</b> Rcpp提供的C++数据类型</a><ul>
<li class="chapter" data-level="40.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-robject"><i class="fa fa-check"></i><b>40.1</b> RObject类</a></li>
<li class="chapter" data-level="40.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec"><i class="fa fa-check"></i><b>40.2</b> IntegerVector类</a><ul>
<li class="chapter" data-level="40.2.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec-ex1"><i class="fa fa-check"></i><b>40.2.1</b> IntegerVector示例1：返回完全数</a></li>
<li class="chapter" data-level="40.2.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-ivec-ex2"><i class="fa fa-check"></i><b>40.2.2</b> IntegerVector示例2：输入整数向量</a></li>
</ul></li>
<li class="chapter" data-level="40.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num"><i class="fa fa-check"></i><b>40.3</b> NumericVector类</a><ul>
<li class="chapter" data-level="40.3.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex1"><i class="fa fa-check"></i><b>40.3.1</b> 示例1：计算元素<span class="math inline">\(p\)</span>次方的和</a></li>
<li class="chapter" data-level="40.3.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex2"><i class="fa fa-check"></i><b>40.3.2</b> 示例2：<code>clone</code>函数</a></li>
<li class="chapter" data-level="40.3.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-num-ex3"><i class="fa fa-check"></i><b>40.3.3</b> 示例3：向量子集</a></li>
</ul></li>
<li class="chapter" data-level="40.4" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat"><i class="fa fa-check"></i><b>40.4</b> NumericMatrix类</a><ul>
<li class="chapter" data-level="40.4.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex1"><i class="fa fa-check"></i><b>40.4.1</b> 示例1：计算矩阵各列模的最大值</a></li>
<li class="chapter" data-level="40.4.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex2"><i class="fa fa-check"></i><b>40.4.2</b> 示例2：把输入矩阵制作副本计算元素平方根</a></li>
<li class="chapter" data-level="40.4.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-mat-ex3"><i class="fa fa-check"></i><b>40.4.3</b> 示例3：访问列子集</a></li>
</ul></li>
<li class="chapter" data-level="40.5" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-other"><i class="fa fa-check"></i><b>40.5</b> Rcpp的其它向量类</a><ul>
<li class="chapter" data-level="40.5.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-logic"><i class="fa fa-check"></i><b>40.5.1</b> Rcpp的LogicalVector类</a></li>
<li class="chapter" data-level="40.5.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-vectype-char"><i class="fa fa-check"></i><b>40.5.2</b> Rcpp的CharacterVector类型</a></li>
</ul></li>
<li class="chapter" data-level="40.6" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types"><i class="fa fa-check"></i><b>40.6</b> Rcpp提供的其它数据类型</a><ul>
<li class="chapter" data-level="40.6.1" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-named"><i class="fa fa-check"></i><b>40.6.1</b> Named类型</a></li>
<li class="chapter" data-level="40.6.2" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-list"><i class="fa fa-check"></i><b>40.6.2</b> List类型</a></li>
<li class="chapter" data-level="40.6.3" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-df"><i class="fa fa-check"></i><b>40.6.3</b> Rcpp的DataFrame类</a></li>
<li class="chapter" data-level="40.6.4" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-func"><i class="fa fa-check"></i><b>40.6.4</b> Rcpp的Function类</a></li>
<li class="chapter" data-level="40.6.5" data-path="rcpp-vectype.html"><a href="rcpp-vectype.html#rcpp-types-environ"><i class="fa fa-check"></i><b>40.6.5</b> Rcpp的Environment类</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="41" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html"><i class="fa fa-check"></i><b>41</b> Rcpp糖</a><ul>
<li class="chapter" data-level="41.1" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-examp"><i class="fa fa-check"></i><b>41.1</b> 简单示例</a></li>
<li class="chapter" data-level="41.2" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop"><i class="fa fa-check"></i><b>41.2</b> 向量化的运算符</a><ul>
<li class="chapter" data-level="41.2.1" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-arith"><i class="fa fa-check"></i><b>41.2.1</b> 向量化的四则运算</a></li>
<li class="chapter" data-level="41.2.2" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-binop"><i class="fa fa-check"></i><b>41.2.2</b> 向量化的二元逻辑运算</a></li>
<li class="chapter" data-level="41.2.3" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-vecop-uop"><i class="fa fa-check"></i><b>41.2.3</b> 向量化的一元运算符</a></li>
</ul></li>
<li class="chapter" data-level="41.3" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-mathfunc"><i class="fa fa-check"></i><b>41.3</b> 用Rcpp访问数学函数</a></li>
<li class="chapter" data-level="41.4" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-any"><i class="fa fa-check"></i><b>41.4</b> 返回单一逻辑值的函数</a></li>
<li class="chapter" data-level="41.5" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-expfunc"><i class="fa fa-check"></i><b>41.5</b> 返回糖表达式的函数</a></li>
<li class="chapter" data-level="41.6" data-path="rcpp-sugar.html"><a href="rcpp-sugar.html#rcpp-sugar-diff"><i class="fa fa-check"></i><b>41.6</b> R与Rcpp不同语法示例</a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="rcpp-package.html"><a href="rcpp-package.html"><i class="fa fa-check"></i><b>42</b> 用Rcpp帮助制作R扩展包</a><ul>
<li class="chapter" data-level="42.1" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-wo"><i class="fa fa-check"></i><b>42.1</b> 不用扩展包共享C++代码的方法</a></li>
<li class="chapter" data-level="42.2" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen"><i class="fa fa-check"></i><b>42.2</b> 生成扩展包</a><ul>
<li class="chapter" data-level="42.2.1" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-exist"><i class="fa fa-check"></i><b>42.2.1</b> 利用已有基于Rcpp属性的源程序制作扩展包</a></li>
<li class="chapter" data-level="42.2.2" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-desc"><i class="fa fa-check"></i><b>42.2.2</b> DESCRIPTION文件</a></li>
<li class="chapter" data-level="42.2.3" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-gen-namespace"><i class="fa fa-check"></i><b>42.2.3</b> NAMESPACE文件</a></li>
</ul></li>
<li class="chapter" data-level="42.3" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-recomp"><i class="fa fa-check"></i><b>42.3</b> 重新编译</a></li>
<li class="chapter" data-level="42.4" data-path="rcpp-package.html"><a href="rcpp-package.html#rcpp-package-interface"><i class="fa fa-check"></i><b>42.4</b> 建立C++用的接口界面</a></li>
</ul></li>
<li class="part"><span><b>X 编程例子</b></span></li>
<li class="chapter" data-level="43" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>43</b> R编程例子</a><ul>
<li class="chapter" data-level="43.1" data-path="examples.html"><a href="examples.html#examples-rlang"><i class="fa fa-check"></i><b>43.1</b> R语言</a><ul>
<li class="chapter" data-level="43.1.1" data-path="examples.html"><a href="examples.html#examples-rlang-inverse"><i class="fa fa-check"></i><b>43.1.1</b> 用向量作逆变换</a></li>
<li class="chapter" data-level="43.1.2" data-path="examples.html"><a href="examples.html#examples-rlang-fibonacci"><i class="fa fa-check"></i><b>43.1.2</b> 斐波那契数列计算</a></li>
<li class="chapter" data-level="43.1.3" data-path="examples.html"><a href="examples.html#examples-rlang-permutation"><i class="fa fa-check"></i><b>43.1.3</b> 穷举所有排列</a></li>
<li class="chapter" data-level="43.1.4" data-path="examples.html"><a href="examples.html#examples-rlang-repgroup"><i class="fa fa-check"></i><b>43.1.4</b> 可重复分组方式穷举</a></li>
<li class="chapter" data-level="43.1.5" data-path="examples.html"><a href="examples.html#examples-rlang-runs"><i class="fa fa-check"></i><b>43.1.5</b> 升降连计数</a></li>
</ul></li>
<li class="chapter" data-level="43.2" data-path="examples.html"><a href="examples.html#examples-prob"><i class="fa fa-check"></i><b>43.2</b> 概率</a><ul>
<li class="chapter" data-level="43.2.1" data-path="examples.html"><a href="examples.html#examples-prob-thsage"><i class="fa fa-check"></i><b>43.2.1</b> 智者千虑必有一失</a></li>
<li class="chapter" data-level="43.2.2" data-path="examples.html"><a href="examples.html#examples-prob-coupleseats"><i class="fa fa-check"></i><b>43.2.2</b> 圆桌夫妇座位问题</a></li>
</ul></li>
<li class="chapter" data-level="43.3" data-path="examples.html"><a href="examples.html#examples-scicomp"><i class="fa fa-check"></i><b>43.3</b> 科学计算</a><ul>
<li class="chapter" data-level="43.3.1" data-path="examples.html"><a href="examples.html#examples-scicomp-citylink"><i class="fa fa-check"></i><b>43.3.1</b> 城市间最短路径</a></li>
<li class="chapter" data-level="43.3.2" data-path="examples.html"><a href="examples.html#examples-scicomp-daub"><i class="fa fa-check"></i><b>43.3.2</b> Daubechies小波函数计算</a></li>
<li class="chapter" data-level="43.3.3" data-path="examples.html"><a href="examples.html#examples-scicomp-heating"><i class="fa fa-check"></i><b>43.3.3</b> 房间加热温度变化</a></li>
</ul></li>
<li class="chapter" data-level="43.4" data-path="examples.html"><a href="examples.html#examples-statcomp"><i class="fa fa-check"></i><b>43.4</b> 统计计算</a><ul>
<li class="chapter" data-level="43.4.1" data-path="examples.html"><a href="examples.html#examples-statcomp-kernden"><i class="fa fa-check"></i><b>43.4.1</b> 核回归与核密度估计</a></li>
<li class="chapter" data-level="43.4.2" data-path="examples.html"><a href="examples.html#examples-statcomp-mcquad2d"><i class="fa fa-check"></i><b>43.4.2</b> 二维随机模拟积分</a></li>
<li class="chapter" data-level="43.4.3" data-path="examples.html"><a href="examples.html#examples-statcomp-hidfreq"><i class="fa fa-check"></i><b>43.4.3</b> 潜周期估计</a></li>
<li class="chapter" data-level="43.4.4" data-path="examples.html"><a href="examples.html#examples-statcomp-armaest"><i class="fa fa-check"></i><b>43.4.4</b> ARMA(1,1)模型估计</a></li>
<li class="chapter" data-level="43.4.5" data-path="examples.html"><a href="examples.html#examples-statcomp-varprop"><i class="fa fa-check"></i><b>43.4.5</b> VAR模型平稳性</a></li>
<li class="chapter" data-level="43.4.6" data-path="examples.html"><a href="examples.html#examples-statcomp-storereliab"><i class="fa fa-check"></i><b>43.4.6</b> 贮存可靠性评估</a></li>
</ul></li>
<li class="chapter" data-level="43.5" data-path="examples.html"><a href="examples.html#examples-datatreat"><i class="fa fa-check"></i><b>43.5</b> 数据处理</a><ul>
<li class="chapter" data-level="43.5.1" data-path="examples.html"><a href="examples.html#examples-datatreat-subscore"><i class="fa fa-check"></i><b>43.5.1</b> 小题分题型分数汇总</a></li>
<li class="chapter" data-level="43.5.2" data-path="examples.html"><a href="examples.html#examples-datatreat-cluslab"><i class="fa fa-check"></i><b>43.5.2</b> 类别编号重排</a></li>
</ul></li>
<li class="chapter" data-level="43.6" data-path="examples.html"><a href="examples.html#examples-texttr"><i class="fa fa-check"></i><b>43.6</b> 文本处理</a><ul>
<li class="chapter" data-level="43.6.1" data-path="examples.html"><a href="examples.html#examples-texttr-hongloument"><i class="fa fa-check"></i><b>43.6.1</b> 用R语言下载处理《红楼梦》htm文件</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://www.math.pku.edu.cn/teachers/lidf/" target="blank">编著：李东风</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R语言教程</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stat-reg" class="section level1">
<h1><span class="header-section-number">32</span> R相关与回归</h1>
<div id="stat-base-reg-cor" class="section level2">
<h2><span class="header-section-number">32.1</span> 相关分析</h2>
<p>考虑连续型随机变量之间的关系。相关系数定义为
<span class="math display">\[\rho(X, Y) = \frac{E\left[ (X - EX)(Y-EY) \right]}
{\sqrt{\text{Var}(X)\text{Var}(Y)}}
\]</span>
又称Pearson相关系数。</p>
<p><span class="math inline">\(-1 \leq \rho \leq 1\)</span>。<span class="math inline">\(\rho\)</span>接近于<span class="math inline">\(+1\)</span>表示<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>有正向的相关；
<span class="math inline">\(\rho\)</span>接近于<span class="math inline">\(-1\)</span>表示<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>有负向的相关。</p>
<p>相关系数代表的是<strong>线性</strong>相关性，
对于<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>的其它相关可能反映不出来，
比如<span class="math inline">\(X \sim \text{N}(0,1)\)</span>，<span class="math inline">\(Y = X^2\)</span>，
有<span class="math inline">\(\rho(X, Y) = 0\)</span>。</p>
<p>给定样本<span class="math inline">\((X_i, Y_i), i=1,2,\dots,n\)</span>，样本相关系数为
<span class="math display">\[r = \frac{\sum_{i=1}^n (X_i - \bar X) (Y_i - \bar Y)}
{\sqrt{\sum_{i=1}^n (X_i - \bar X)^2
\sum_{i=1}^n (Y_i - \bar Y)^2}}
\]</span></p>
<p>用散点图和散点图矩阵直观地查看变量间的相关。</p>
<p>例如，线性相关的模拟数据的散点图:</p>
<div class="sourceCode" id="cb2126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2126-1"><a href="stat-reg.html#cb2126-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2126-2"><a href="stat-reg.html#cb2126-2"></a>nsamp &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb2126-3"><a href="stat-reg.html#cb2126-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(nsamp, <span class="dv">-10</span>, <span class="dv">10</span>)</span>
<span id="cb2126-4"><a href="stat-reg.html#cb2126-4"></a>y &lt;-<span class="st"> </span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb2126-5"><a href="stat-reg.html#cb2126-5"></a><span class="kw">plot</span>(x, y)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-corsim01"></span>
<img src="static/picture/stat-base-reg-corsim01-1.png" alt="线性相关数据" width="672" />
<p class="caption">
图32.1: 线性相关数据
</p>
</div>
<p>二次曲线相关的模拟数据散点图:</p>
<div class="sourceCode" id="cb2127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2127-1"><a href="stat-reg.html#cb2127-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2127-2"><a href="stat-reg.html#cb2127-2"></a>y2 &lt;-<span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb2127-3"><a href="stat-reg.html#cb2127-3"></a><span class="kw">plot</span>(x, y2)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-corsim02"></span>
<img src="static/picture/stat-base-reg-corsim02-1.png" alt="二次曲线相关数据" width="672" />
<p class="caption">
图32.2: 二次曲线相关数据
</p>
</div>
<p>指数关系的例子:</p>
<div class="sourceCode" id="cb2128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2128-1"><a href="stat-reg.html#cb2128-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2128-2"><a href="stat-reg.html#cb2128-2"></a>y3 &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.2</span><span class="op">*</span>(x<span class="op">+</span><span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb2128-3"><a href="stat-reg.html#cb2128-3"></a><span class="kw">plot</span>(x, y3)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-corsim03"></span>
<img src="static/picture/stat-base-reg-corsim03-1.png" alt="指数关系相关数据" width="672" />
<p class="caption">
图32.3: 指数关系相关数据
</p>
</div>
<p>对数关系的例子:</p>
<div class="sourceCode" id="cb2129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2129-1"><a href="stat-reg.html#cb2129-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2129-2"><a href="stat-reg.html#cb2129-2"></a>y4 &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="dv">10</span><span class="op">*</span>(x<span class="op">+</span><span class="dv">12</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="fl">0.1</span>)</span>
<span id="cb2129-3"><a href="stat-reg.html#cb2129-3"></a><span class="kw">plot</span>(x, y4)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-corsim04"></span>
<img src="static/picture/stat-base-reg-corsim04-1.png" alt="对数关系相关数据" width="672" />
<p class="caption">
图32.4: 对数关系相关数据
</p>
</div>
<div id="stat-base-reg-cor-prop" class="section level3">
<h3><span class="header-section-number">32.1.1</span> 相关系数的性质</h3>
<ul>
<li>取值<span class="math inline">\(-1 \leq r \leq 1\)</span>。</li>
<li><span class="math inline">\(r&gt;0\)</span>表示正线性相关；
<span class="math inline">\(r&lt;0\)</span>表示负线性相关。</li>
<li>当<span class="math inline">\(r=1\)</span>时<span class="math inline">\((x_i, y_i), i=1,\dots,n\)</span>这<span class="math inline">\(n\)</span>个点完全在一条正斜率的直线上，
属于确定性关系。</li>
<li>当<span class="math inline">\(r=-1\)</span>时<span class="math inline">\((x_i, y_i), i=1,\dots,n\)</span>这<span class="math inline">\(n\)</span>个点完全在一条负斜率的直线上，
属于确定性关系。</li>
<li>计算相关系数时与<span class="math inline">\(x, y\)</span>的次序或记号无关。</li>
<li>如果对变量<span class="math inline">\(x\)</span>或者<span class="math inline">\(y\)</span>分别乘以倍数，再分别加上不同的平移量，
相关系数不变。
即：<span class="math inline">\(a + bx\)</span>与<span class="math inline">\(c + dy\)</span>的相关系数，
等于<span class="math inline">\(x, y\)</span>的相关系数。
这样，相关系数不受单位、量纲的影响。
相关系数是无量纲的。</li>
<li>如果<span class="math inline">\(x\)</span>和<span class="math inline">\(y\)</span>之间是非线性相关，
相关系数不一定能准确反映其关系，
只能作为一定程度的近似。</li>
</ul>
<p>设变量<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>的样本存放于R向量<code>x</code>和<code>y</code>中，
用<code>cor(x,y)</code>计算样本相关系数。</p>
<div class="sourceCode" id="cb2130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2130-1"><a href="stat-reg.html#cb2130-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2130-2"><a href="stat-reg.html#cb2130-2"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb2130-3"><a href="stat-reg.html#cb2130-3"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2130-4"><a href="stat-reg.html#cb2130-4"></a>y &lt;-<span class="st"> </span><span class="dv">40</span> <span class="op">-</span><span class="st"> </span>(x<span class="dv">-7</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb2130-5"><a href="stat-reg.html#cb2130-5"></a>yy &lt;-<span class="st"> </span><span class="dv">40</span> <span class="op">-</span><span class="st"> </span>(xx<span class="dv">-7</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb2130-6"><a href="stat-reg.html#cb2130-6"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>)</span>
<span id="cb2130-7"><a href="stat-reg.html#cb2130-7"></a><span class="kw">lines</span>(xx, yy)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-cor-prop01"></span>
<img src="static/picture/stat-base-reg-cor-prop01-1.png" alt="曲线相关数据的相关系数例1" width="672" />
<p class="caption">
图32.5: 曲线相关数据的相关系数例1
</p>
</div>
<div class="sourceCode" id="cb2131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2131-1"><a href="stat-reg.html#cb2131-1"></a><span class="kw">cor</span>(x, y)</span></code></pre></div>
<pre><code>## [1] 0.8244374</code></pre>
<div class="sourceCode" id="cb2133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2133-1"><a href="stat-reg.html#cb2133-1"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb2133-2"><a href="stat-reg.html#cb2133-2"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2133-3"><a href="stat-reg.html#cb2133-3"></a>y &lt;-<span class="st"> </span><span class="dv">40</span> <span class="op">-</span><span class="st"> </span>(x<span class="dv">-5</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb2133-4"><a href="stat-reg.html#cb2133-4"></a>yy &lt;-<span class="st"> </span><span class="dv">40</span> <span class="op">-</span><span class="st"> </span>(xx<span class="dv">-5</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb2133-5"><a href="stat-reg.html#cb2133-5"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>)</span>
<span id="cb2133-6"><a href="stat-reg.html#cb2133-6"></a><span class="kw">lines</span>(xx, yy)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-cor-prop02"></span>
<img src="static/picture/stat-base-reg-cor-prop02-1.png" alt="曲线相关数据的相关系数例2" width="672" />
<p class="caption">
图32.6: 曲线相关数据的相关系数例2
</p>
</div>
<div class="sourceCode" id="cb2134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2134-1"><a href="stat-reg.html#cb2134-1"></a><span class="kw">cor</span>(x, y)</span></code></pre></div>
<pre><code>## [1] -0.042684</code></pre>
<div class="sourceCode" id="cb2136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2136-1"><a href="stat-reg.html#cb2136-1"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb2136-2"><a href="stat-reg.html#cb2136-2"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2136-3"><a href="stat-reg.html#cb2136-3"></a>y &lt;-<span class="st"> </span><span class="dv">40</span><span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span>x<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb2136-4"><a href="stat-reg.html#cb2136-4"></a>yy &lt;-<span class="st"> </span><span class="dv">40</span><span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span>xx<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb2136-5"><a href="stat-reg.html#cb2136-5"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>)</span>
<span id="cb2136-6"><a href="stat-reg.html#cb2136-6"></a><span class="kw">lines</span>(xx, yy)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-cor-prop03"></span>
<img src="static/picture/stat-base-reg-cor-prop03-1.png" alt="曲线相关数据的相关系数例3" width="672" />
<p class="caption">
图32.7: 曲线相关数据的相关系数例3
</p>
</div>
<div class="sourceCode" id="cb2137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2137-1"><a href="stat-reg.html#cb2137-1"></a><span class="kw">cor</span>(x, y)</span></code></pre></div>
<pre><code>## [1] -0.8841117</code></pre>
</div>
<div id="stat-base-reg-cor-caus" class="section level3">
<h3><span class="header-section-number">32.1.2</span> 相关与因果</h3>
<p>相关系数是从数据中得到的<span class="math inline">\(x\)</span>和<span class="math inline">\(y\)</span>两个变量关系的一种描述，
不能直接引申为因果关系。</p>
<p>例如，增加身高，不一定增长体重。</p>
<p>实际中有许多错误理解相关与因果性的例子。
例如：研究发现喝咖啡的人群比不喝咖啡的人群心脏病发病率高。
于是断言喝咖啡导致心脏病危险增加。
进一步研究更多的因素发现，
喝咖啡放糖很多的人心脏病发病率才增高了。</p>
</div>
<div id="stat-base-reg-cor-magn" class="section level3">
<h3><span class="header-section-number">32.1.3</span> 相关系数大小</h3>
<ul>
<li>相关系数绝对值在0.8以上认为高度相关。</li>
<li>在0.5到0.8之间认为中度相关。</li>
<li>在0.3到0.5之间认为低度相关。</li>
<li>在0.3以下认为不相关或相关性很弱以至于没有实际价值。</li>
<li>当然，在特别重要的问题中，
只要经过检验显著不等于零的相关都认为是有意义的。</li>
</ul>
</div>
<div id="stat-base-reg-cor-test" class="section level3">
<h3><span class="header-section-number">32.1.4</span> 相关系数的检验</h3>
<p>相关系数<span class="math inline">\(r\)</span>是总体相关系数<span class="math inline">\(\rho\)</span>的估计。
<span class="math display">\[H_0: \rho=0 \longleftrightarrow H_a: \rho\neq 0\]</span>
检验统计量
<span class="math display">\[t = \frac{r \sqrt{n-2}}{\sqrt{1 - r^2}}\]</span>
当总体<span class="math inline">\((X, Y)\)</span>服从二元正态分布且<span class="math inline">\(H_0: \rho=0\)</span>成立时，
<span class="math inline">\(t\)</span>服从<span class="math inline">\(t(n-2)\)</span>分布。
设<span class="math inline">\(t\)</span>统计量值为<span class="math inline">\(t_0\)</span>，p值为
<span class="math display">\[P(|t(n-2)| &gt; |t_0|)\]</span></p>
<p>在R中用<code>cor.test(x,y)</code>计算检验。</p>
<p>例如：</p>
<div class="sourceCode" id="cb2139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2139-1"><a href="stat-reg.html#cb2139-1"></a><span class="kw">cor.test</span>(d.class<span class="op">$</span>height, d.class<span class="op">$</span>weight)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  d.class$height and d.class$weight
## t = 7.5549, df = 17, p-value = 7.887e-07
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.7044314 0.9523101
## sample estimates:
##       cor 
## 0.8777852</code></pre>
<p>得身高与体重的相关系数为0.88，检验的p值为<code>7.887e-07</code>，
95%置信区间为<span class="math inline">\([0.70, 0.95]\)</span>。</p>
<p>再例如:</p>
<div class="sourceCode" id="cb2141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2141-1"><a href="stat-reg.html#cb2141-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2141-2"><a href="stat-reg.html#cb2141-2"></a>nsamp &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb2141-3"><a href="stat-reg.html#cb2141-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(nsamp, <span class="dv">-10</span>, <span class="dv">10</span>)</span>
<span id="cb2141-4"><a href="stat-reg.html#cb2141-4"></a>y &lt;-<span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb2141-5"><a href="stat-reg.html#cb2141-5"></a><span class="kw">cor.test</span>(x, y)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  x and y
## t = 0.93076, df = 28, p-value = 0.3599
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  -0.1994815  0.5021658
## sample estimates:
##       cor 
## 0.1732378</code></pre>
<p>得x与y的样本相关系数为0.17, p值为0.36，不显著。</p>
</div>
<div id="stat-base-reg-cor-vcorr" class="section level3">
<h3><span class="header-section-number">32.1.5</span> 相关阵</h3>
<p>如果<code>x</code>是一个仅包含数值型列的数据框，
则<code>cor(x)</code>计算样本相关系数矩阵；
<code>var(x)</code>计算样本协方差阵。</p>
<p><code>corrgram::corrgram()</code>可以绘制相关系数矩阵的图形，
用颜色和阴影浓度代表相关系数正负和绝对值大小，
用饼图中阴影部分大小代表相关系数绝对值大小。
如：</p>
<div class="sourceCode" id="cb2143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2143-1"><a href="stat-reg.html#cb2143-1"></a><span class="kw">library</span>(corrgram)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;seriation&#39;:
##   method         from 
##   reorder.hclust gclus</code></pre>
<div class="sourceCode" id="cb2145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2145-1"><a href="stat-reg.html#cb2145-1"></a><span class="kw">corrgram</span>(</span>
<span id="cb2145-2"><a href="stat-reg.html#cb2145-2"></a>  baseball[,<span class="kw">c</span>(<span class="st">&quot;Assists&quot;</span>,<span class="st">&quot;Atbat&quot;</span>,<span class="st">&quot;Errors&quot;</span>,<span class="st">&quot;Hits&quot;</span>,<span class="st">&quot;Homer&quot;</span>,<span class="st">&quot;logSal&quot;</span>,</span>
<span id="cb2145-3"><a href="stat-reg.html#cb2145-3"></a>           <span class="st">&quot;Putouts&quot;</span>,<span class="st">&quot;RBI&quot;</span>,<span class="st">&quot;Runs&quot;</span>,<span class="st">&quot;Walks&quot;</span>,<span class="st">&quot;Years&quot;</span>)], </span>
<span id="cb2145-4"><a href="stat-reg.html#cb2145-4"></a>  <span class="dt">order=</span><span class="ot">TRUE</span>, <span class="dt">main=</span><span class="st">&quot;Baseball data PC2/PC1 order&quot;</span>,</span>
<span id="cb2145-5"><a href="stat-reg.html#cb2145-5"></a>  <span class="dt">lower.panel=</span>panel.shade, <span class="dt">upper.panel=</span>panel.pie)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-corrgram011"></span>
<img src="static/picture/stat-base-reg-corrgram011-1.png" alt="相关阵图形" width="672" />
<p class="caption">
图32.8: 相关阵图形
</p>
</div>
<p>其中选项<code>order=TRUE</code>重排各列的次序使得较接近的列排列在相邻位置。</p>
</div>
</div>
<div id="stat-base-reg-regsimp" class="section level2">
<h2><span class="header-section-number">32.2</span> 一元回归分析</h2>
<div id="stat-base-reg-regsimp-model" class="section level3">
<h3><span class="header-section-number">32.2.1</span> 模型</h3>
<p>考虑两个变量<span class="math inline">\(Y\)</span>与<span class="math inline">\(X\)</span>的关系，希望用<span class="math inline">\(X\)</span>值的变化解释<span class="math inline">\(Y\)</span>值的变化。
<span class="math inline">\(X\)</span>称为自变量(independent variable)，<span class="math inline">\(Y\)</span>称为因变量(response
variable)。</p>
<p>假设模型
<span class="math display">\[\begin{aligned}
Y = a + b X + \varepsilon, 
\quad \varepsilon \sim \text{N}(0,\sigma^2)
\end{aligned}
\]</span></p>
<p>设观测值为<span class="math inline">\((X_i, Y_i), i=1,2,\dots,n\)</span>，假设观测值满足上模型。
即
<span class="math display">\[\begin{aligned}
Y_i = a + b X_i + \varepsilon_i, 
\quad \varepsilon_i \text{ iid }\sim \text{N}(0,\sigma^2)
\end{aligned}
\]</span></p>
</div>
<div id="stat-base-reg-regsimp-ls" class="section level3">
<h3><span class="header-section-number">32.2.2</span> 最小二乘法</h3>
<p>直观上看，要找最优的直线<span class="math inline">\(y=a+bx\)</span>使得直线与观测到的点最接近。
例如：</p>
<div class="sourceCode" id="cb2146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2146-1"><a href="stat-reg.html#cb2146-1"></a><span class="kw">plot</span>(x, y)</span>
<span id="cb2146-2"><a href="stat-reg.html#cb2146-2"></a><span class="kw">abline</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-regsim01"></span>
<img src="static/picture/stat-base-reg-regsim01-1.png" alt="一元线性回归最小二乘估计" width="672" />
<p class="caption">
图32.9: 一元线性回归最小二乘估计
</p>
</div>
<p><span class="math inline">\(a,b\)</span>的解用<strong>最小二乘法</strong>得到:</p>
<p><span class="math display">\[\min_{a,b} \sum_{i=1}^n \left( y_i - a - b x_i \right)^2\]</span></p>
<p>最小二乘解表达式为</p>
<p><span class="math display">\[\begin{aligned}
\hat b =&amp; \frac{\sum_i (x_i - \bar x)(y_i - \bar y)}
{\sum_i (x_i - \bar x)^2}
= r_{xy} \frac{S_y}{S_x} \\
\hat a =&amp; \bar y - \hat b \bar x
\end{aligned}\]</span>
其中<span class="math inline">\(r_{xy}\)</span>为<span class="math inline">\(X\)</span>与<span class="math inline">\(Y\)</span>的样本相关系数，
<span class="math inline">\(S_x\)</span>与<span class="math inline">\(S_y\)</span>分别为<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>的样本标准差。</p>
<p>随机误差方差<span class="math inline">\(\sigma^2\)</span>的估计取为</p>
<p><span class="math display">\[
\hat\sigma^2 = \frac{1}{n-2}\sum_i (y_i - \hat a - \hat b x_i)^2
\]</span></p>
<p>标准误差: 为衡量<span class="math inline">\(\hat a\)</span>和<span class="math inline">\(\hat b\)</span>的估计精度，
计算<span class="math inline">\(\text{SE}(\hat a)\)</span>和<span class="math inline">\(\text{SE}(\hat b)\)</span>。</p>
<p>估计结果:</p>
<ul>
<li><p>拟合值(预测值)
<span class="math display">\[\hat y_i = \hat a + \hat b x_i, \quad i=1,2,\dots,n\]</span></p></li>
<li><p>残差 <span class="math display">\[e_i = y_i - \hat y_i, \quad i=1,2,\dots,n\]</span></p></li>
<li><p><span class="math inline">\(\text{SSE}=\sum_i e_i^2\)</span> 称为残差平方和，残差平方和小则拟合优。</p></li>
</ul>
</div>
<div id="stat-base-reg-regsimp-test" class="section level3">
<h3><span class="header-section-number">32.2.3</span> 回归有效性</h3>
<div id="stat-base-reg-regsimp-diag-rsqr" class="section level4">
<h4><span class="header-section-number">32.2.3.1</span> 拟合优度指标</h4>
<p>按照最小二乘估计公式，只要<span class="math inline">\(x_1, x_2, \dots, x_n\)</span>不全相等，
不论<span class="math inline">\(x, y\)</span>之间有没有相关关系，
都能计算出参数估计值。
得到的回归直线与观测数据的散点之间的接近程度代表了回归结果的优劣。</p>
<p>残差平方和
<span class="math display">\[\text{SSE}=\sum_{i=1}^n (y_i - \hat a - \hat b x_i)^2\]</span>
残差平方和越小，
说明回归直线与观测数据点吻合得越好。</p>
<p><span class="math inline">\(y\)</span>是因变量，
因变量的数据的离差平方和
<span class="math display">\[\text{SST}=\sum_{i=1}^n (y_i - \bar y)^2\]</span>
代表了因变量的未知变动大小，
需要对这样的变动用自变量进行解释，
称SST为总平方和。</p>
<p>可以证明如下平方和分解公式：
<span class="math display">\[\text{SST} = \text{SSR} + \text{SSE}\]</span>
其中SSR称为回归平方和。</p>
<p>令<span class="math inline">\(\hat y_i = \hat\beta_0 + \hat\beta_1 x_i\)</span>称为第<span class="math inline">\(i\)</span>个拟合值，
回归平方和为
<span class="math display">\[\text{SSR}=\sum_{i=1}^n (\hat y_i - \bar y)^2
= \hat b^2 \sum_{i=1}^n (x_i - \bar x)^2
\]</span></p>
<p>在总平方和中，
回归平方和是能够用回归斜率与自变量的变动解释的部分，
残差平方和是自变量不能解释的变动。
分解中，回归平方和越大，误差平方和越小，
拟合越好。
令
<span class="math display">\[R^2 = \frac{\text{SSR}}{\text{SST}} = 1 - \frac{\text{SSE}}{\text{SST}}\]</span>
称为回归的复相关系数，或判定系数。</p>
<p><span class="math inline">\(0 \leq R^2 \leq 1\)</span>。判定系数越大，回归拟合越好。
<span class="math inline">\(R^2=1\)</span>时，观测点完全落在一条直线上面。
一元回归中<span class="math inline">\(R^2\)</span>是<span class="math inline">\(x\)</span>和<span class="math inline">\(y\)</span>的样本相关系数的平方。
在多元回归时只能用复相关系数。</p>
<p>估计误差项方差<span class="math inline">\(\sigma^2\)</span>为
<span class="math display">\[
\hat\sigma^2 = \frac{1}{n-2}\sum_{i=1}^n (y_i - \hat a - \hat b x_i)^2
= \frac{1}{n-2} \text{SSE}
\]</span></p>
<p><span class="math inline">\(\hat\sigma\)</span>是<span class="math inline">\(\sigma\)</span>的估计，
R的回归结果中显示为“residual standard error”（残差标准误差）。
<span class="math inline">\(\hat\sigma\)</span>是残差<span class="math inline">\(e_i = y_i - \hat y_i\)</span>的标准差的一个粗略估计。</p>
</div>
<div id="stat-base-reg-regsimp-diag-ftest" class="section level4">
<h4><span class="header-section-number">32.2.3.2</span> 线性关系显著性检验</h4>
<p>当<span class="math inline">\(b=0\)</span>时，模型退化为<span class="math inline">\(Y = a + \varepsilon\)</span>，<span class="math inline">\(X\)</span>不出现在模型中，
说明<span class="math inline">\(Y\)</span>与<span class="math inline">\(X\)</span>不相关。检验
<span class="math display">\[
H_0: b=0 \longleftrightarrow H_\text{a}: b \neq 0
\]</span></p>
<p>取统计量
<span class="math display">\[F = \frac{\text{SSR}}{\text{SSE}/(n-2)}\]</span>
检验p值为<span class="math inline">\(P(F(1, n-2) &gt; c)\)</span>(设<span class="math inline">\(c\)</span>为<span class="math inline">\(F\)</span>统计量的值)。
取检验水平<span class="math inline">\(\alpha\)</span>, p值小于等于<span class="math inline">\(\alpha\)</span>时拒绝<span class="math inline">\(H_0\)</span>，
认为<span class="math inline">\(y\)</span>与<span class="math inline">\(x\)</span>有显著的线性相关关系，
否则认为<span class="math inline">\(y\)</span>与<span class="math inline">\(x\)</span>没有显著的线性相关关系。</p>
<p>也可以使用t统计量
<span class="math display">\[t = \frac{\hat b}{\text{SE}_{\hat b}}\]</span>
其中
<span class="math display">\[
\text{SE}_{\hat b} = \hat\sigma / \sqrt{\sum_{i=1}^n (x_i - \bar x)^2}
\]</span>
设t统计量的值为<span class="math inline">\(c\)</span>，
检验p值为<span class="math inline">\(P(|t(n-2)| &gt; |c|)\)</span>。</p>
</div>
</div>
<div id="stat-base-reg-regsimp-prog" class="section level3">
<h3><span class="header-section-number">32.2.4</span> R程序</h3>
<p>设数据保存在数据框d中，变量名为y和x，用R的<code>lm()</code>函数计算回归，如:</p>
<div class="sourceCode" id="cb2147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2147-1"><a href="stat-reg.html#cb2147-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2147-2"><a href="stat-reg.html#cb2147-2"></a>nsamp &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb2147-3"><a href="stat-reg.html#cb2147-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(nsamp, <span class="dv">-10</span>, <span class="dv">10</span>)</span>
<span id="cb2147-4"><a href="stat-reg.html#cb2147-4"></a>y &lt;-<span class="st"> </span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb2147-5"><a href="stat-reg.html#cb2147-5"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)</span>
<span id="cb2147-6"><a href="stat-reg.html#cb2147-6"></a>lm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data=</span>d); lm1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x, data = d)
## 
## Coefficients:
## (Intercept)            x  
##     20.0388       0.4988</code></pre>
<p>结果只有回归系数。需要用<code>summary()</code>显示较详细的结果。如</p>
<div class="sourceCode" id="cb2149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2149-1"><a href="stat-reg.html#cb2149-1"></a><span class="kw">summary</span>(lm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x, data = d)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.03030 -0.16436 -0.05741  0.29511  0.64046 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 20.03883    0.07226   277.3   &lt;2e-16 ***
## x            0.49876    0.01244    40.1   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3956 on 28 degrees of freedom
## Multiple R-squared:  0.9829, Adjusted R-squared:  0.9823 
## F-statistic:  1608 on 1 and 28 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>结果中<span class="math inline">\(H_0: b=0\)</span>的检验结果p值为<span class="math inline">\(&lt;2e-16\)</span>。</p>
<p>又如对d.class数据集，建立体重对身高的回归方程:</p>
<div class="sourceCode" id="cb2151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2151-1"><a href="stat-reg.html#cb2151-1"></a>lm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span>height, <span class="dt">data=</span>d.class)</span>
<span id="cb2151-2"><a href="stat-reg.html#cb2151-2"></a><span class="kw">summary</span>(lm2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ height, data = d.class)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -17.6807  -6.0642   0.5115   9.2846  18.3698 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -143.0269    32.2746  -4.432 0.000366 ***
## height         3.8990     0.5161   7.555 7.89e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.23 on 17 degrees of freedom
## Multiple R-squared:  0.7705, Adjusted R-squared:  0.757 
## F-statistic: 57.08 on 1 and 17 DF,  p-value: 7.887e-07</code></pre>
<p>身高对体重的影响是显著的(p值<code>7.89e-7</code>)。</p>
</div>
<div id="stat-base-reg-regsimp-diag" class="section level3">
<h3><span class="header-section-number">32.2.5</span> 回归诊断</h3>
<p>除了系数的显著性检验以外，
对误差项是否符合回归模型假定中的独立性、方差齐性、正态性等，
可以利用回归残差进行一系列的回归诊断。
还可以计算一些异常值、强影响点的诊断。</p>
<p>对<span class="math inline">\(n\)</span>组观测值，回归模型为
<span class="math display">\[
y_i = a + b x_i + \varepsilon_i
\]</span>
拟合值为
<span class="math display">\[
\hat y_i = \hat a + \hat b x_i
\]</span>
残差（residual）为
<span class="math display">\[e_i = y_i - \hat y_i\]</span></p>
<p>残差相当于模型中的随机误差，
但仅在模型假定成立时才是随机误差的合理估计。
所以残差能够反映违反模型假定的情况。</p>
<p><span class="math inline">\(e_i\)</span>有量纲，不好比较大小。
定义标准化残差（内部学生化残差）：
<span class="math display">\[
r_i = \frac{e_i}{S_e\sqrt{1 - \frac{1}{n} - 
  \frac{(x_i - \bar x)^2}{\sum_{k=1}^n (x_k - \bar x)^2}}}
\]</span>
样本量较大时标准化残差近似服从标准正态分布，
于是取值于<span class="math inline">\([-2,2]\)</span>范围外的点是可疑的离群点。</p>
<p>R中用<code>residuals()</code>从回归结果计算残差，
用<code>rstandard()</code>从回归结果计算标准化残差。</p>
<p>R中<code>plot(lmres)</code>(lmres为回归结果变量)可以做简单回归诊断。</p>
<div class="sourceCode" id="cb2153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2153-1"><a href="stat-reg.html#cb2153-1"></a><span class="kw">plot</span>(lm2)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-19class-diag01-1.png" width="672" /><img src="static/picture/stat-base-reg-19class-diag01-2.png" width="672" /><img src="static/picture/stat-base-reg-19class-diag01-3.png" width="672" /><img src="static/picture/stat-base-reg-19class-diag01-4.png" width="672" /></p>
<p>第一个图是残差对预测值散点图，
散点应该随机在0线上下波动，不应该有曲线模式、分散程度增大模式、
特别突出的离群点等情况。</p>
<p>第二个图是残差的正态QQ图，
散点接近于直线时可以认为模型误差项的正态分布假定是合理的。</p>
<p>第三个图是误差大小(标准化残差绝对值的平方根)对拟合值的图形，
可以判断方差齐性假设(方差<span class="math inline">\(\sigma^2\)</span>不变)。</p>
<p>第四个图是残差对杠杆量图，并叠加了Cook距离等值线。
杠杆量代表了回归自变量对结果的影响大小， 超过<span class="math inline">\(4/n\)</span>的值是需要重视的。
Cook距离考察删去第<span class="math inline">\(i\)</span>个观测对回归结果的影响。</p>
<div class="sourceCode" id="cb2154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2154-1"><a href="stat-reg.html#cb2154-1"></a><span class="kw">cbind</span>(<span class="kw">residuals</span>(lm2), <span class="kw">rstandard</span>(lm2))</span></code></pre></div>
<pre><code>##           [,1]        [,2]
## 1    6.7317083  0.64090788
## 2  -13.5797581 -1.25514370
## 3  -17.6807278 -1.62510342
## 4    0.5115143  0.04884012
## 5   -5.6350916 -0.51945382
## 6   -4.2585944 -0.39749776
## 7   -6.4933343 -0.69635607
## 8   11.8375266  1.08337723
## 9    0.6678176  0.06113186
## 10 -13.5061701 -1.30222590
## 11  -2.0615036 -0.18894975
## 12  14.7918904  1.38780152
## 13   2.6124840  0.24615612
## 14 -16.6624734 -1.52495912
## 15  12.4841326  1.15698074
## 16  12.2967391  1.26478834
## 17  18.3697570  1.69265472
## 18   3.8326780  0.36028625
## 19  -4.2585944 -0.39749776</code></pre>
<p>可以用<span class="math inline">\(e_i\)</span>或<span class="math inline">\(r_i\)</span>作为纵坐标，
<span class="math inline">\(x_i\)</span>或者<span class="math inline">\(\hat y_i\)</span>作为横坐标，
作残差图。</p>
<p>下面给出残差图的几种常见的缺陷：</p>
<p>非线性:</p>
<div class="sourceCode" id="cb2156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2156-1"><a href="stat-reg.html#cb2156-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2156-2"><a href="stat-reg.html#cb2156-2"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb2156-3"><a href="stat-reg.html#cb2156-3"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2156-4"><a href="stat-reg.html#cb2156-4"></a>y &lt;-<span class="st"> </span><span class="dv">40</span> <span class="op">-</span><span class="st"> </span>(x<span class="dv">-7</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb2156-5"><a href="stat-reg.html#cb2156-5"></a>yy &lt;-<span class="st"> </span><span class="dv">40</span> <span class="op">-</span><span class="st"> </span>(xx<span class="dv">-7</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb2156-6"><a href="stat-reg.html#cb2156-6"></a>lms1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb2156-7"><a href="stat-reg.html#cb2156-7"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2156-8"><a href="stat-reg.html#cb2156-8"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">main=</span><span class="st">&quot;数据和真实模型&quot;</span>)</span>
<span id="cb2156-9"><a href="stat-reg.html#cb2156-9"></a><span class="kw">lines</span>(xx, yy)</span>
<span id="cb2156-10"><a href="stat-reg.html#cb2156-10"></a><span class="kw">plot</span>(x, <span class="kw">rstandard</span>(lms1), <span class="dt">main=</span><span class="st">&quot;使用线性回归的残差&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-resp01"></span>
<img src="static/picture/stat-base-reg-resp01-1.png" alt="残差中非线性模式" width="672" />
<p class="caption">
图32.10: 残差中非线性模式
</p>
</div>
<div class="sourceCode" id="cb2157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2157-1"><a href="stat-reg.html#cb2157-1"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p>异方差:</p>
<div class="sourceCode" id="cb2158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2158-1"><a href="stat-reg.html#cb2158-1"></a>x &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">runif</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb2158-2"><a href="stat-reg.html#cb2158-2"></a>y &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>)<span class="op">*</span>(<span class="kw">seq</span>(<span class="dv">30</span>)<span class="op">/</span><span class="dv">10</span>)</span>
<span id="cb2158-3"><a href="stat-reg.html#cb2158-3"></a>lms2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb2158-4"><a href="stat-reg.html#cb2158-4"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2158-5"><a href="stat-reg.html#cb2158-5"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">main=</span><span class="st">&quot;数据和真实模型&quot;</span>)</span>
<span id="cb2158-6"><a href="stat-reg.html#cb2158-6"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">10</span>, <span class="dt">b=</span><span class="dv">2</span>)</span>
<span id="cb2158-7"><a href="stat-reg.html#cb2158-7"></a><span class="kw">plot</span>(x, <span class="kw">rstandard</span>(lms2), <span class="dt">main=</span><span class="st">&quot;线性模型的残差&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-resp02-1.png" width="672" /></p>
<div class="sourceCode" id="cb2159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2159-1"><a href="stat-reg.html#cb2159-1"></a><span class="kw">par</span>(opar)</span></code></pre></div>
<p>序列自相关：</p>
<p>当数据随时间变化时，还需要考虑前后是否有序列自相关。
自相关残差图形例子：</p>
<div class="sourceCode" id="cb2160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2160-1"><a href="stat-reg.html#cb2160-1"></a>ar1 &lt;-<span class="st"> </span><span class="kw">arima.sim</span>(<span class="kw">list</span>(<span class="dt">ar=</span><span class="kw">c</span>(<span class="fl">0.5</span>)), <span class="dt">n=</span><span class="dv">30</span>)</span>
<span id="cb2160-2"><a href="stat-reg.html#cb2160-2"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, ar1[], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;time&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;residual&quot;</span>,</span>
<span id="cb2160-3"><a href="stat-reg.html#cb2160-3"></a>     <span class="dt">main=</span><span class="st">&quot;有序列自相关的残差图形&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-resp03-1.png" width="672" /></p>
<p>图中横坐标是观测序号。</p>
<p><code>car::ncvTest()</code>检验方差齐性。零假设是方差齐性成立。
如</p>
<div class="sourceCode" id="cb2161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2161-1"><a href="stat-reg.html#cb2161-1"></a>car<span class="op">::</span><span class="kw">ncvTest</span>(lm2)</span></code></pre></div>
<pre><code>## Non-constant Variance Score Test 
## Variance formula: ~ fitted.values 
## Chisquare = 1.664307, Df = 1, p = 0.19702</code></pre>
<p>用Durbin-Watson检验（DW检验）可以检验残差中是否有序列自相关，
零假设是没有序列自相关。
R中用<code>car::durbinWatsonTest()</code>检验。
序列自相关检验仅当数据中数据是延时间等间隔记录时有意义。
如</p>
<div class="sourceCode" id="cb2163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2163-1"><a href="stat-reg.html#cb2163-1"></a>car<span class="op">::</span><span class="kw">durbinWatsonTest</span>(lm1)</span></code></pre></div>
<pre><code>##  lag Autocorrelation D-W Statistic p-value
##    1       0.1959139       1.57293    0.21
##  Alternative hypothesis: rho != 0</code></pre>
<p>也可以对回归残差绘制ACF图，
如果除了横坐标0之外都落在两条水平界限内则认为没有序列自相关，
如果有明显超出界限的就认为有序列自相关。
如</p>
<div class="sourceCode" id="cb2165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2165-1"><a href="stat-reg.html#cb2165-1"></a><span class="kw">acf</span>(<span class="kw">residuals</span>(lm1), <span class="dt">lag.max =</span> <span class="dv">10</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regsim02-acf-1.png" width="672" /></p>
</div>
<div id="stat-base-reg-regsimp-ci" class="section level3">
<h3><span class="header-section-number">32.2.6</span> 预测区间</h3>
<p>设<span class="math inline">\(X\)</span>取<span class="math inline">\(x_0\)</span>，<span class="math inline">\(Y\)</span>的预测值为<span class="math inline">\(\hat y_0 = \hat a + \hat b x_0\)</span>。
置信水平为<span class="math inline">\(1-\alpha\)</span>的预测区间为
<span class="math display">\[\hat y_0 \pm \lambda \hat\sigma
\sqrt{1 + \frac{1}{n} 
+ \frac{(\bar x - x_0)^2}{\sum_i (x_i - \bar x)^2}}
\]</span>
其含义是<span class="math inline">\(P(y_0 \in \text{预测区间}) = 1 - \alpha\)</span>。
<span class="math inline">\(\lambda\)</span>是标准正态分布双侧<span class="math inline">\(\alpha\)</span>分位数<code>qnorm(1 - alpha/2)</code>。</p>
<p>用<code>predict(lmres)</code>得到<span class="math inline">\(\hat y_i, i=1,\dots,n\)</span>的值，
<code>lmres</code>表示回归结果变量。</p>
<p>用<code>predict(lmres, interval="prediction")</code>
同时得到预测的置信区间，
需要的话加入<code>level=</code>选项设定置信度。</p>
<p>回归的置信区间有两种，
上述的区间是“预测区间”(CLI)，
使得<span class="math inline">\(P(y_0 \in \text{预测区间}) = 1 - \alpha\)</span>;
另一种区间称为均值的置信区间(CLM)，
使得<span class="math inline">\(P(Ey_0 \in \text{均值置信区间}) = 1 - \alpha\)</span>。</p>
</div>
<div id="stat-base-reg-regsimp-control" class="section level3">
<h3><span class="header-section-number">32.2.7</span> 控制</h3>
<p>如果需要把<span class="math inline">\(Y\)</span>的值控制在<span class="math inline">\([y_l, y_u]\)</span>范围内，问如何控制<span class="math inline">\(X\)</span>的范围，
可以求解<span class="math inline">\(x_0\)</span>的范围使上面的置信区间包含在<span class="math inline">\([y_l, y_u]\)</span>内。</p>
<p>近似地可以解不等式
<span class="math display">\[\begin{aligned}
\hat a + \hat b x_0 - z_{1-\frac{\alpha}{2}} \hat \sigma \geq &amp; y_l \\
\hat a + \hat b x_0 + z_{1-\frac{\alpha}{2}} \hat \sigma \leq &amp; y_u
\end{aligned}\]</span>
其中<span class="math inline">\(z_{1-\frac{\alpha}{2}}\)</span>为标准正态分布双侧<span class="math inline">\(\alpha\)</span>分位数
（用<code>qnorm(1-alpha/2)</code>计算）。</p>
</div>
</div>
<div id="stat-base-reg-regmu" class="section level2">
<h2><span class="header-section-number">32.3</span> 多元线性回归</h2>
<p>建模步骤：</p>
<ul>
<li>确定要研究的因变量，以及可能对因变量有影响并且数据可以获得的自变量集合</li>
<li>假定因变量<span class="math inline">\(y\)</span>与<span class="math inline">\(p\)</span>个自变量之间为线性相关关系，建立模型</li>
<li>对模型进行评估和检验</li>
<li>判断模型中是否存在多重共线性，如果存在，应进行处理</li>
<li>预测</li>
<li>残差分析</li>
</ul>
<div id="stat-base-reg-regmu-mod" class="section level3">
<h3><span class="header-section-number">32.3.1</span> 模型</h3>
<p>模型
<span class="math display">\[
y = \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p + \varepsilon
\]</span>
其中</p>
<ul>
<li><span class="math inline">\(y\)</span>: 因变量，随机变量</li>
<li><span class="math inline">\(x_1, \dots, x_p\)</span>: 自变量，非随机</li>
<li><span class="math inline">\(\varepsilon\)</span>: 随机误差项，随机变量</li>
<li><span class="math inline">\(\beta_0\)</span>: 截距项</li>
<li><span class="math inline">\(\beta_j\)</span>: 对应于<span class="math inline">\(x_j\)</span>的斜率项</li>
<li>模型表明因变量<span class="math inline">\(y\)</span>近似等于自变量的线性组合</li>
<li><span class="math inline">\(E \varepsilon=0\)</span>, <span class="math inline">\(\text{Var}(\varepsilon)=\sigma^2\)</span></li>
</ul>
<p>对<span class="math inline">\(n\)</span>组观测数据，
有
<span class="math display">\[
y_i = \beta_0 + \beta_1 x_{i1} + \dots + \beta_p x_{ip} + \varepsilon_i,
\quad i=1,2,\dots, n
\]</span>
对其中的随机误差项<span class="math inline">\(\varepsilon_i\)</span>, <span class="math inline">\(i=1,2,\dots,n\)</span>，假定：</p>
<ul>
<li>期望为零，服从正态分布；</li>
<li>方差齐性: 方差为<span class="math inline">\(\sigma^2\)</span>与自变量值无关；</li>
<li>相互独立。</li>
</ul>
<p>总之，<span class="math inline">\(\varepsilon_1, \varepsilon_2, \dots, \varepsilon_n\)</span>
相互独立，服从<span class="math inline">\(\text{N}(0, \sigma^2)\)</span>分布。</p>
<p>数据格式如：
<span class="math display">\[
\left(\begin{array}{cccc|c}
x_1 &amp; x_2 &amp; \cdots &amp; x_p &amp; y\\
\hline
x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1p} &amp; y_1 \\
x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2p} &amp; y_2 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
x_{n1} &amp; x_{n2} &amp; \cdots &amp; x_{np} &amp; y_n
\end{array}\right)
\]</span>
R中回归数据放在一个数据框中，有一列<span class="math inline">\(y\)</span>和<span class="math inline">\(p\)</span>列自变量。</p>
<p>根据模型有
<span class="math display">\[
Ey = \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p
\]</span></p>
</div>
<div id="stat-base-reg-regmu-est" class="section level3">
<h3><span class="header-section-number">32.3.2</span> 参数估计</h3>
<p>未知的参数有回归系数<span class="math inline">\(\beta_0, \beta_1, \dots, \beta_p, \sigma^2\)</span>，
另外误差项也是未知的。</p>
<p>模型估计仍使用最小二乘法，得到系数估计
<span class="math inline">\(\hat\beta_0, \hat\beta_1, \dots, \hat\beta_p\)</span>
及误差方差估计<span class="math inline">\(\hat\sigma^2\)</span>。
得到估计的多元线性回归方程：
<span class="math display">\[
\hat y = \hat\beta_0 + \hat\beta_1 x_1 + \dots + \hat\beta_p x_p
\]</span></p>
<p>对第<span class="math inline">\(i\)</span>组观测值，将自变量值代入估计的回归方程中得拟合值
<span class="math display">\[
\hat y_i = \hat\beta_0 + \hat\beta_1 x_{i1} + \dots + \hat\beta_p x_{ip}
\]</span>
<span class="math inline">\(e_i = y_i - \hat y_i\)</span>称为残差。
回归参数估计，用残差最小作为目标，令
<span class="math display">\[
Q = \sum_{i=1}^n \left[ y_i - (\beta_0 + \beta_1 x_{i1} + \dots + \beta_p x_{ip}) \right]^2
\]</span>
取使得<span class="math inline">\(Q\)</span>达到最小的<span class="math inline">\((\beta_0, \beta_1, \dots, \beta_p)\)</span>作为参数估计，
称为<strong>最小二乘估计</strong>，记为<span class="math inline">\((\hat\beta_0, \hat\beta_1, \dots, \hat\beta_p)\)</span>。
称得到的最小值为SSE，<span class="math inline">\(\sigma^2\)</span>的估计为
<span class="math display">\[
\hat\sigma^2 = \frac{1}{n-p-1} \text{SSE}
= \frac{1}{n-p-1} \sum_{i=1}^n e_i^2
\]</span></p>
</div>
<div id="stat-base-reg-regmu-rcode" class="section level3">
<h3><span class="header-section-number">32.3.3</span> R的多元回归程序</h3>
<p>在R中用<code>lm(y ~ x1 + x2 + x3, data=d)</code>这样的程序来做多元回归，
数据集为d， 自变量为x1,x2,x3三列。</p>
<div id="stat-base-reg-regmu-rcode-exclass" class="section level4">
<h4><span class="header-section-number">32.3.3.1</span> 例：体重对身高和年龄的回归</h4>
<p>考虑d.class数据集中体重对身高和年龄的回归:</p>
<div class="sourceCode" id="cb2166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2166-1"><a href="stat-reg.html#cb2166-1"></a>lm3 &lt;-<span class="st"> </span><span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span>age, <span class="dt">data=</span>d.class)</span>
<span id="cb2166-2"><a href="stat-reg.html#cb2166-2"></a><span class="kw">summary</span>(lm3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ height + age, data = d.class)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -17.962  -6.010  -0.067   7.553  20.796 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -141.2238    33.3831  -4.230 0.000637 ***
## height         3.5970     0.9055   3.973 0.001093 ** 
## age            1.2784     3.1101   0.411 0.686492    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.51 on 16 degrees of freedom
## Multiple R-squared:  0.7729, Adjusted R-squared:  0.7445 
## F-statistic: 27.23 on 2 and 16 DF,  p-value: 7.074e-06</code></pre>
<p>得到的回归模型可以写成
<span class="math display">\[
\widehat{\text{weight}}
= -141.2 + 3.597 \times \text{height}
+ 1.278 \times \text{age}
\]</span>
其中身高的系数3.597表示，
如果两个学生年龄相同，
则身高增加1个单位（这里是英寸），
体重平均增加3.597个单位（这里是磅）。
注意在仅有身高作为自变量时，
系数为3.899。
年龄的系数1.278也类似解释，
在两个学生身高相同时，
如果一个学生年龄大1岁，
则此学生的体重平均多1.278个单位。</p>
</div>
<div id="stat-base-reg-regmu-rcode-exbutler" class="section level4">
<h4><span class="header-section-number">32.3.3.2</span> 例：驾驶员行驶时间的模型</h4>
<p>Butler Trucking Company是一个短途货运公司。
老板想研究每个驾驶员每天的行驶时间的影响因素。
随机抽取了10名驾驶员一天的数据。考虑行驶里程(Miles)对行驶时间的影响。</p>
<div class="sourceCode" id="cb2168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2168-1"><a href="stat-reg.html#cb2168-1"></a><span class="kw">with</span>(Butler, <span class="kw">plot</span>(Miles, Time))</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-exbutler-tsp-1.png" width="672" /></p>
<p>从散点图看，行驶里程与行驶时间有线性相关关系。
作一元线性回归：</p>
<div class="sourceCode" id="cb2169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2169-1"><a href="stat-reg.html#cb2169-1"></a>lmbut01 &lt;-<span class="st"> </span><span class="kw">lm</span>(Time <span class="op">~</span><span class="st"> </span>Miles, <span class="dt">data=</span>Butler)</span>
<span id="cb2169-2"><a href="stat-reg.html#cb2169-2"></a><span class="kw">summary</span>(lmbut01)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Time ~ Miles, data = Butler)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.5565 -0.4913  0.1783  0.7120  1.2435 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  1.27391    1.40074   0.909  0.38969   
## Miles        0.06783    0.01706   3.977  0.00408 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.002 on 8 degrees of freedom
## Multiple R-squared:  0.6641, Adjusted R-squared:  0.6221 
## F-statistic: 15.81 on 1 and 8 DF,  p-value: 0.00408</code></pre>
<p>这里Miles的系数解释为：行驶里程增加1英里，时间平均增加0.068小时。
老板想进一步改进对行驶时间的预测，
增加“派送地点数”（Deliveries）作为第二个自变量。
作多元回归：</p>
<div class="sourceCode" id="cb2171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2171-1"><a href="stat-reg.html#cb2171-1"></a>lmbut02 &lt;-<span class="st"> </span><span class="kw">lm</span>(Time <span class="op">~</span><span class="st"> </span>Miles <span class="op">+</span><span class="st"> </span>Deliveries, <span class="dt">data=</span>Butler)</span>
<span id="cb2171-2"><a href="stat-reg.html#cb2171-2"></a><span class="kw">summary</span>(lmbut02)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Time ~ Miles + Deliveries, data = Butler)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.79875 -0.32477  0.06333  0.29739  0.91333 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.868701   0.951548  -0.913 0.391634    
## Miles        0.061135   0.009888   6.182 0.000453 ***
## Deliveries   0.923425   0.221113   4.176 0.004157 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.5731 on 7 degrees of freedom
## Multiple R-squared:  0.9038, Adjusted R-squared:  0.8763 
## F-statistic: 32.88 on 2 and 7 DF,  p-value: 0.0002762</code></pre>
<p>这里Miles的系数从一元回归时的0.068改成了0.061，
解释为：在派送地点数相同的条件下，行驶里程每增加1英里，
行驶时间平均增加0.061小时。</p>
<p>Deliveries的系数解释为：在行驶里程相同的条件下，
派送地点数每增加一个地点，行驶时间平均增加0.92小时。</p>
</div>
</div>
<div id="stat-base-reg-regmu-test" class="section level3">
<h3><span class="header-section-number">32.3.4</span> 模型的检验</h3>
<div id="stat-base-reg-regmu-test-rsqr" class="section level4">
<h4><span class="header-section-number">32.3.4.1</span> 复相关系数平方</h4>
<p>将总平方和分解为：
<span class="math display">\[
\text{SST} = \text{SSR} + \text{SSE}
\]</span>
其中
- 总平方和
<span class="math display">\[\text{SST} = \sum_{i=1}^n (y_i - \bar y)^2\]</span>
- 回归平方和
<span class="math display">\[\text{SSR} = \sum_{i=1}^n (\hat y_i - \bar y)^2\]</span>
是能够用回归系数和自变量的变量解释的因变量变化。
- 残差平方和
<span class="math display">\[\text{SSE} = \sum_{i=1}^n (y_i - \hat y_i)^2\]</span>
是回归模型不能解释的因变量变化。</p>
<p>回归平方和越大，残差平方和越小，回归拟合越好。
定义复相关系数平方（判定系数）
<span class="math display">\[
R^2 = \frac{\text{SSR}}{\text{SST}}
= 1 - \frac{\text{SSE}}{\text{SST}}
\]</span>
则<span class="math inline">\(0 \leq R^2 \leq 1\)</span>。
<span class="math inline">\(R^2\)</span>越大，说明数据中的自变量拟合因变量值拟合越好。</p>
<p>但是，“拟合好”不是唯一标准。
仅考虑拟合好，
可能产生很复杂的仅对建模用数据有效但是对其它数据无效的模型，
这称为“过度拟合”。</p>
<p>定义调整的（修正的）复相关系数平方：
<span class="math display">\[
R^{*2} = 1 - (1-R^2)\frac{n-1}{n-p-1}
\]</span>
克服了<span class="math inline">\(R^2\)</span>的部分缺点。</p>
<p>在体重与身高、年龄的模型结果中，
<span class="math inline">\(R^2=0.7729\)</span>，
<span class="math inline">\(R^{*2}=0.7445\)</span>。</p>
</div>
<div id="stat-base-reg-regmu-test-sigmae" class="section level4">
<h4><span class="header-section-number">32.3.4.2</span> 残差标准误差</h4>
<p>模型中<span class="math inline">\(\varepsilon\)</span>的方差<span class="math inline">\(\sigma^2\)</span>的估计为<span class="math inline">\(\hat\sigma_e^2\)</span>,
<span class="math display">\[
\hat\sigma^2 = \frac{1}{n-p-1}\text{SSE}
\]</span></p>
<p><span class="math inline">\(\hat\sigma\)</span>是随机误差的标准差<span class="math inline">\(\sigma\)</span>的估计量，
称为“残差标准误差”（Residual standard error）。
这是残差<span class="math inline">\(e_i = y_i - \hat y_i\)</span>的标准差的一个较粗略的近似估计。</p>
<p>在体重与身高、年龄的模型结果中，
<span class="math inline">\(\hat\sigma=11.51\)</span>。</p>
</div>
<div id="stat-base-reg-regmu-test-ftest" class="section level4">
<h4><span class="header-section-number">32.3.4.3</span> 线性关系检验</h4>
<p>为了检验整个回归模型是否都无效，考虑假设检验:
<span class="math display">\[
H_0: \beta_1 = \dots = \beta_p = 0
\]</span>
当<span class="math inline">\(H_0\)</span>成立时模型退化成<span class="math inline">\(y=\beta_0 + \varepsilon\)</span>，
<span class="math inline">\(y\)</span>与<span class="math inline">\(x_1, x_2, \dots, x_p\)</span>之间不再具有线性相关关系。</p>
<p>取统计量为
<span class="math display">\[
F = \frac{\text{SSR}/p}{\text{SSE}/(n-p-1)}
\]</span>
在模型前提条件都满足且<span class="math inline">\(H_0\)</span>成立时<span class="math inline">\(F\)</span>服从<span class="math inline">\(F(p, n-p-1)\)</span>分布。
计算右侧<span class="math inline">\(p\)</span>值，给出检验结论。</p>
<p>当检验显著时，各斜率项不全为零。
结果不显著时，当前回归模型不能使用。</p>
<p>在体重与身高、年龄的模型结果中，
<span class="math inline">\(F=27.23\)</span>，p值为<span class="math inline">\(7.074\times 10^{-6}\)</span>，
在0.05水平下显著，
模型有意义。</p>
</div>
<div id="stat-base-reg-regmu-test-ttest" class="section level4">
<h4><span class="header-section-number">32.3.4.4</span> 单个斜率项的显著性检验</h4>
<p>为了检验某一个自变量<span class="math inline">\(X_j\)</span>是否对因变量的解释有贡献
（在模型中已经包含了其它自变量的情况下），检验
<span class="math display">\[H_0: \beta_j = 0\]</span>
如果不拒绝<span class="math inline">\(H_0\)</span>，
相当于<span class="math inline">\(x_j\)</span>可以不出现在模型中。
但是，
在多元线性回归中这不代表<span class="math inline">\(x_j\)</span>与<span class="math inline">\(y\)</span>之间没有线性相关，
可能是由于其它的自变量包含了<span class="math inline">\(x_j\)</span>中的信息。</p>
<p>检验使用如下<span class="math inline">\(t\)</span>统计量
<span class="math display">\[
t = \frac{\hat\beta_j}{\text{SE}_{\hat\beta_j}}
\]</span>
在模型前提条件都满足且<span class="math inline">\(H_0\)</span>成立时<span class="math inline">\(t\)</span>服从<span class="math inline">\(t(n-p-1)\)</span>分布。
给定检验水平<span class="math inline">\(\alpha\)</span>，计算双侧<span class="math inline">\(p\)</span>值，做出检验结论。</p>
<p>对单个回归系数的检验，检验水平可取得略高，如0.10, 0.15。</p>
<p>在体重与身高、年龄的模型结果中，
身高的斜率项显著性p值为0.001,
在0.15水平下显著；
体重的斜率项显著性p值为0.686，
在0.15水平下不显著，
可考虑从模型中去掉体重变量。</p>
</div>
</div>
<div id="stat-base-reg-regmu-subset" class="section level3">
<h3><span class="header-section-number">32.3.5</span> 回归自变量筛选</h3>
<p>在19个学生的体重与身高、年龄的线性回归模型结果中，
发现关于年龄的系数为零的检验p值为0.686, 不显著，
说明在模型中已经包含身高的情况下， 年龄不提供对体重的额外信息。</p>
<p>但是如果体重对年龄单独建模的话，年龄的影响还是显著的：</p>
<div class="sourceCode" id="cb2173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2173-1"><a href="stat-reg.html#cb2173-1"></a>lm4 &lt;-<span class="st"> </span><span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span>age, <span class="dt">data=</span>d.class)</span>
<span id="cb2173-2"><a href="stat-reg.html#cb2173-2"></a><span class="kw">summary</span>(lm4)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ age, data = d.class)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -23.349  -7.609  -5.260   7.945  42.847 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -50.493     33.290  -1.517 0.147706    
## age           11.304      2.485   4.548 0.000285 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 15.74 on 17 degrees of freedom
## Multiple R-squared:  0.5489, Adjusted R-squared:  0.5224 
## F-statistic: 20.69 on 1 and 17 DF,  p-value: 0.0002848</code></pre>
<p>模型中不显著的自变量应该逐一剔除。可以用
<code>step</code>函数进行逐步回归变量选择，如:</p>
<div class="sourceCode" id="cb2175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2175-1"><a href="stat-reg.html#cb2175-1"></a>lm5 &lt;-<span class="st"> </span><span class="kw">step</span>(<span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sex, <span class="dt">data=</span>d.class))</span></code></pre></div>
<pre><code>## Start:  AIC=94.93
## weight ~ height + age + sex
## 
##          Df Sum of Sq    RSS     AIC
## - age     1    113.76 1957.8  94.067
## &lt;none&gt;                1844.0  94.930
## - sex     1    276.09 2120.1  95.581
## - height  1   1020.61 2864.6 101.299
## 
## Step:  AIC=94.07
## weight ~ height + sex
## 
##          Df Sum of Sq    RSS     AIC
## - sex     1     184.7 2142.5  93.780
## &lt;none&gt;                1957.8  94.067
## - height  1    5696.8 7654.6 117.974
## 
## Step:  AIC=93.78
## weight ~ height
## 
##          Df Sum of Sq    RSS    AIC
## &lt;none&gt;                2142.5  93.78
## - height  1    7193.2 9335.7 119.75</code></pre>
<div class="sourceCode" id="cb2177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2177-1"><a href="stat-reg.html#cb2177-1"></a><span class="kw">summary</span>(lm5)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ height, data = d.class)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -17.6807  -6.0642   0.5115   9.2846  18.3698 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -143.0269    32.2746  -4.432 0.000366 ***
## height         3.8990     0.5161   7.555 7.89e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.23 on 17 degrees of freedom
## Multiple R-squared:  0.7705, Adjusted R-squared:  0.757 
## F-statistic: 57.08 on 1 and 17 DF,  p-value: 7.887e-07</code></pre>
<p>考虑另一个例子数据。
在数据框Resturant中包含25个餐馆的一些信息，包括：</p>
<ul>
<li><span class="math inline">\(y\)</span>, 营业额, 日均营业额（万元）</li>
<li><span class="math inline">\(x_1\)</span>, 居民数, 周边居民人数（万人）</li>
<li><span class="math inline">\(x_2\)</span>, 人均餐费, 用餐平均支出(元/人)</li>
<li><span class="math inline">\(x_3\)</span>, 月收入, 周边居民月平均收入（元）</li>
<li><span class="math inline">\(x_4\)</span>, 餐馆数, 周边餐馆数（个）</li>
<li><span class="math inline">\(x_5\)</span>, 距离, 距市中心距离（km）</li>
</ul>
<p>对营业额进行回归建模研究。
变量间的相关系数图：</p>
<div class="sourceCode" id="cb2179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2179-1"><a href="stat-reg.html#cb2179-1"></a>corrgram<span class="op">::</span><span class="kw">corrgram</span>(</span>
<span id="cb2179-2"><a href="stat-reg.html#cb2179-2"></a>  Resturant, <span class="dt">order=</span><span class="ot">TRUE</span>, </span>
<span id="cb2179-3"><a href="stat-reg.html#cb2179-3"></a>  <span class="dt">lower.panel=</span>corrgram<span class="op">::</span>panel.shade,</span>
<span id="cb2179-4"><a href="stat-reg.html#cb2179-4"></a>  <span class="dt">upper.panel =</span> corrgram<span class="op">::</span>panel.pie,</span>
<span id="cb2179-5"><a href="stat-reg.html#cb2179-5"></a>  <span class="dt">text.panel =</span> corrgram<span class="op">::</span>panel.txt)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-resturant-corrgram-1.png" width="672" /></p>
<div class="sourceCode" id="cb2180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2180-1"><a href="stat-reg.html#cb2180-1"></a>lmrst01 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="st">`</span><span class="dt">营业额</span><span class="st">`</span> <span class="op">~</span><span class="st"> `</span><span class="dt">居民数</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">人均餐费</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">月收入</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">餐馆数</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">距离</span><span class="st">`</span>, </span>
<span id="cb2180-2"><a href="stat-reg.html#cb2180-2"></a>              <span class="dt">data=</span>Resturant)</span>
<span id="cb2180-3"><a href="stat-reg.html#cb2180-3"></a><span class="kw">summary</span>(lmrst01)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = 营业额 ~ 居民数 + 人均餐费 + 月收入 + 餐馆数 + 距离, 
##     data = Resturant)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -16.7204  -6.0600   0.7152   3.2144  21.4805 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  4.2604768 10.4679833   0.407  0.68856   
## 居民数       0.1273254  0.0959790   1.327  0.20037   
## 人均餐费     0.1605660  0.0556834   2.884  0.00952 **
## 月收入       0.0007636  0.0013556   0.563  0.57982   
## 餐馆数      -0.3331990  0.3986248  -0.836  0.41362   
## 距离        -0.5746462  0.3087506  -1.861  0.07826 . 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.65 on 19 degrees of freedom
## Multiple R-squared:  0.8518, Adjusted R-squared:  0.8128 
## F-statistic: 21.84 on 5 and 19 DF,  p-value: 2.835e-07</code></pre>
<p>在0.15水平上只有人均餐费和到市中心距离是显著的。
进行逐步回归筛选：</p>
<div class="sourceCode" id="cb2182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2182-1"><a href="stat-reg.html#cb2182-1"></a>lmrst02 &lt;-<span class="st"> </span><span class="kw">step</span>(lmrst01)</span></code></pre></div>
<pre><code>## Start:  AIC=123.39
## 营业额 ~ 居民数 + 人均餐费 + 月收入 + 餐馆数 + 距离
## 
##            Df Sum of Sq    RSS    AIC
## - 月收入    1     35.96 2189.0 121.81
## - 餐馆数    1     79.17 2232.2 122.30
## &lt;none&gt;                  2153.0 123.39
## - 居民数    1    199.42 2352.4 123.61
## - 距离      1    392.54 2545.6 125.58
## - 人均餐费  1    942.22 3095.2 130.47
## 
## Step:  AIC=121.81
## 营业额 ~ 居民数 + 人均餐费 + 餐馆数 + 距离
## 
##            Df Sum of Sq    RSS    AIC
## - 餐馆数    1     78.22 2267.2 120.69
## &lt;none&gt;                  2189.0 121.81
## - 距离      1    445.69 2634.7 124.44
## - 人均餐费  1    925.88 3114.9 128.63
## - 居民数    1   1133.27 3322.3 130.24
## 
## Step:  AIC=120.69
## 营业额 ~ 居民数 + 人均餐费 + 距离
## 
##            Df Sum of Sq    RSS    AIC
## &lt;none&gt;                  2267.2 120.69
## - 距离      1    404.28 2671.5 122.79
## - 人均餐费  1   1050.90 3318.1 128.21
## - 居民数    1   1661.83 3929.0 132.43</code></pre>
<div class="sourceCode" id="cb2184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2184-1"><a href="stat-reg.html#cb2184-1"></a><span class="kw">summary</span>(lmrst02)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = 营业额 ~ 居民数 + 人均餐费 + 距离, data = Resturant)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -14.027  -5.361  -1.560   2.304  23.001 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1.68928    6.25242  -0.270  0.78966    
## 居民数       0.19022    0.04848   3.923  0.00078 ***
## 人均餐费     0.15763    0.05052   3.120  0.00518 ** 
## 距离        -0.56979    0.29445  -1.935  0.06656 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.39 on 21 degrees of freedom
## Multiple R-squared:  0.8439, Adjusted R-squared:  0.8216 
## F-statistic: 37.85 on 3 and 21 DF,  p-value: 1.187e-08</code></pre>
<p>最后进保留了周边居民人数、人均餐费、到市中心距离三个自变量，
删去了周边居民月收入和周边餐馆数两个自变量。</p>
</div>
<div id="stat-base-reg-regmu-dum" class="section level3">
<h3><span class="header-section-number">32.3.6</span> 哑变量与变截距项的模型</h3>
<div id="stat-base-reg-regmu-dum-var" class="section level4">
<h4><span class="header-section-number">32.3.6.1</span> 哑变量</h4>
<p>回归分析的因变量是连续型的，服从正态分布。
回归分析的自变量是数值型的，可以连续取值也可以离散取值。
但是，如果自变量是类别变量，
用简单的1,2,3编码并不能正确地表现不同类别的作用。
可以将类别变量转换成一个或者多个取0、1值的变量，
称为哑变量（dummy variables）或虚拟变量。</p>
<div id="stat-base-reg-regmu-dum-bin" class="section level5">
<h5><span class="header-section-number">32.3.6.1.1</span> 二值哑变量与平行线模型</h5>
<p>如果<span class="math inline">\(f\)</span>是一个二值分类变量，将其中一个类编码为1，
另一个类编码为零。
例如，<span class="math inline">\(f=1\)</span>表示处理组，<span class="math inline">\(f=0\)</span>表示对照组。
这样编码后二值分类变量可以直接用在回归模型中。</p>
<p>例如
<span class="math display">\[
Ey = \beta_0 + \beta_1 x + \beta_2 f
\]</span>
相当于
<span class="math display">\[\begin{aligned}
  Ey = \begin{cases}
  \beta_0 + \beta_1 x, &amp; \text{对照组} \\
  (\beta_0 + \beta_2) + \beta_1 x, &amp; \text{处理组}
  \end{cases}
\end{aligned}\]</span>
这样的模型叫做平行线模型，
处理组的数据与对照组的数据服从斜率相同、截距不同的一元线性回归模型。
比每个组单独建模更有效。</p>
<p>如果检验：
<span class="math display">\[H_0: \beta_2 = 0\]</span>
则不显著时，
可以认为在处理组和对照组中<span class="math inline">\(y\)</span>与<span class="math inline">\(x\)</span>的关系没有显著差异。</p>
<p>进一步考虑
<span class="math display">\[
Ey = \beta_0 + \beta_1 x + \beta_2 f + \beta_3 f x
\]</span>
相当于
<span class="math display">\[\begin{aligned}
  Ey = \begin{cases}
  \beta_0 + \beta_1 x, &amp; \text{对照组} \\
  (\beta_0 + \beta_2) + (\beta_1 + \beta_3) x, &amp; \text{处理组}
  \end{cases}
\end{aligned}\]</span>
比每个组单独建立回归模型更有效。
可以检验
<span class="math display">\[H_0: \beta_3=0\]</span>
不显著时可以用平行线模型。</p>
<p>比如，为了表示男生和女生的体重有不同，
可以在以体重为因变量的回归中加入自变量性别:</p>
<div class="sourceCode" id="cb2186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2186-1"><a href="stat-reg.html#cb2186-1"></a>lm6 &lt;-<span class="st"> </span><span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span>sex, <span class="dt">data=</span>d.class)</span>
<span id="cb2186-2"><a href="stat-reg.html#cb2186-2"></a><span class="kw">summary</span>(lm6)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ height + sex, data = d.class)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -19.7627  -5.9583  -0.3682   8.7725  15.7758 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -126.1687    34.6352  -3.643  0.00219 ** 
## height         3.6789     0.5392   6.823 4.09e-06 ***
## sexF          -6.6208     5.3887  -1.229  0.23697    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.06 on 16 degrees of freedom
## Multiple R-squared:  0.7903, Adjusted R-squared:  0.7641 
## F-statistic: 30.15 on 2 and 16 DF,  p-value: 3.74e-06</code></pre>
<p>结果中的sexM项表示以女生为基数，男生体重的平均增加量。
这一项不显著。</p>
<p>有些例子中如果忽略了分类变量，
结论可能是错误的。
例如，
考察iris数据中花萼长宽之间的关系。
数据中有三个品种的花，
仅考虑其中的setosa和versicolor两个品种。</p>
<div class="sourceCode" id="cb2188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2188-1"><a href="stat-reg.html#cb2188-1"></a>d &lt;-<span class="st"> </span>iris[iris[[<span class="st">&quot;Species&quot;</span>]] <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolor&quot;</span>), </span>
<span id="cb2188-2"><a href="stat-reg.html#cb2188-2"></a>          <span class="kw">c</span>(<span class="st">&quot;Sepal.Length&quot;</span>, <span class="st">&quot;Sepal.Width&quot;</span>, <span class="st">&quot;Species&quot;</span>)]</span>
<span id="cb2188-3"><a href="stat-reg.html#cb2188-3"></a>d<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">as.character</span>(d<span class="op">$</span>Species))</span>
<span id="cb2188-4"><a href="stat-reg.html#cb2188-4"></a>lm7 &lt;-<span class="st"> </span><span class="kw">lm</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Sepal.Length, <span class="dt">data=</span>d)</span>
<span id="cb2188-5"><a href="stat-reg.html#cb2188-5"></a><span class="kw">with</span>(d, <span class="kw">plot</span>(Sepal.Length, Sepal.Width, <span class="dt">col=</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)[Species]))</span>
<span id="cb2188-6"><a href="stat-reg.html#cb2188-6"></a><span class="kw">with</span>(d, <span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">pch=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">legend=</span><span class="kw">levels</span>(Species)))</span>
<span id="cb2188-7"><a href="stat-reg.html#cb2188-7"></a><span class="kw">abline</span>(lm7, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-2inter-iris01-1.png" width="672" /></p>
<div class="sourceCode" id="cb2189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2189-1"><a href="stat-reg.html#cb2189-1"></a><span class="kw">summary</span>(lm7)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Width ~ Sepal.Length, data = d)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.17136 -0.26382 -0.04468  0.29966  1.33618 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.93951    0.40621   9.698 5.47e-16 ***
## Sepal.Length -0.15363    0.07375  -2.083   0.0398 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4709 on 98 degrees of freedom
## Multiple R-squared:  0.04241,    Adjusted R-squared:  0.03263 
## F-statistic:  4.34 on 1 and 98 DF,  p-value: 0.03984</code></pre>
<p>回归结果花萼长、宽是负相关的，
这明显不合理，出现了“悖论”。
实际是因为两个品种的样本混杂在一起了。</p>
<p>加入<code>Species</code>分类变量作为回归自变量：</p>
<div class="sourceCode" id="cb2191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2191-1"><a href="stat-reg.html#cb2191-1"></a>lm8 &lt;-<span class="st"> </span><span class="kw">lm</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Species <span class="op">+</span><span class="st"> </span>Sepal.Length, <span class="dt">data=</span>d)</span>
<span id="cb2191-2"><a href="stat-reg.html#cb2191-2"></a><span class="kw">summary</span>(lm8)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Width ~ Species + Sepal.Length, data = d)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.88917 -0.14677 -0.02517  0.16643  0.64444 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        1.06519    0.32272   3.301  0.00135 ** 
## Speciesversicolor -1.09696    0.08170 -13.427  &lt; 2e-16 ***
## Sepal.Length       0.47200    0.06398   7.377 5.51e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2799 on 97 degrees of freedom
## Multiple R-squared:  0.665,  Adjusted R-squared:  0.6581 
## F-statistic: 96.28 on 2 and 97 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>现在花萼长度变量的系数为正而且高度显著。
两个品种区别的变量<code>Speciesversicolor</code>表示versicolor品种取1，
setosa取0的哑变量。
versicolor品种的花萼宽度与setosa相比在长度相等的情况下平均较小。</p>
<p>作两条回归直线的图形：</p>
<div class="sourceCode" id="cb2193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2193-1"><a href="stat-reg.html#cb2193-1"></a><span class="kw">with</span>(d, <span class="kw">plot</span>(Sepal.Length, Sepal.Width, <span class="dt">col=</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)[Species]))</span>
<span id="cb2193-2"><a href="stat-reg.html#cb2193-2"></a><span class="kw">with</span>(d, <span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">pch=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">legend=</span><span class="kw">levels</span>(Species)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))</span>
<span id="cb2193-3"><a href="stat-reg.html#cb2193-3"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="kw">coef</span>(lm8)[<span class="dv">1</span>], <span class="dt">b=</span><span class="kw">coef</span>(lm8)[<span class="dv">3</span>], <span class="dt">col=</span><span class="dv">2</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb2193-4"><a href="stat-reg.html#cb2193-4"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="kw">sum</span>(<span class="kw">coef</span>(lm8)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]), <span class="dt">b=</span><span class="kw">coef</span>(lm8)[<span class="dv">3</span>], <span class="dt">col=</span><span class="dv">3</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-2inter-iris03-1.png" width="672" /></p>
</div>
<div id="stat-base-reg-regmu-dum-mulv" class="section level5">
<h5><span class="header-section-number">32.3.6.1.2</span> 多值哑变量</h5>
<p>如果变量<span class="math inline">\(f\)</span>是一个有<span class="math inline">\(k\)</span>分类的变量，
可以将<span class="math inline">\(f\)</span>变成<span class="math inline">\(k-1\)</span>个取0、1值的哑变量
<span class="math inline">\(z_1, z_2, \dots, z_{k-1}\)</span>。</p>
<p>例如，<span class="math inline">\(f\)</span>取三种不同的类别，可以转换为两个哑变量<span class="math inline">\(z_1, z_2\)</span>,
常用的编码方式为：
<span class="math display">\[\begin{aligned}
&amp; f=1 \Leftrightarrow (z_1, z_2)=(0,0), \\
&amp; f=2 \Leftrightarrow (z_1, z_2)=(1,0), \\
&amp; f=3 \Leftrightarrow (z_1, z_2)=(0,1)
\end{aligned}\]</span>
这是将<span class="math inline">\(f=1\)</span>看成对照组。</p>
<p>在R中，
用<code>model.matrix(y ~ x1 + f, data=d)</code>
可以生成将因子<code>f</code>转换成哑变量后的包含因变量和自变量的矩阵。</p>
</div>
</div>
</div>
<div id="stat-base-reg-regmu-resid" class="section level3">
<h3><span class="header-section-number">32.3.7</span> 残差诊断</h3>
<p>先复习一些回归理论。
将模型写成矩阵形式
<span class="math display">\[
{\boldsymbol Y} = {\boldsymbol X}\boldsymbol\beta
+ \boldsymbol\varepsilon 
\]</span>
<span class="math inline">\({\boldsymbol Y}\)</span>为<span class="math inline">\(n \times 1\)</span>向量,
<span class="math inline">\({\boldsymbol X}\)</span>为<span class="math inline">\(n \times p\)</span>矩阵,
一般第一列元素全是1, 代表截距项。
<span class="math inline">\(\boldsymbol\beta\)</span>为<span class="math inline">\(p \times 1\)</span>未知参数向量;
<span class="math inline">\(\boldsymbol\varepsilon\)</span>为<span class="math inline">\(n \times 1\)</span>随机误差向量,
<span class="math inline">\(\varepsilon\)</span>的元素独立且方差为相等的<span class="math inline">\(\sigma^2\)</span>(未知)。</p>
<p>假设矩阵<span class="math inline">\(\boldsymbol X\)</span>满秩，系数的估计为
<span class="math display">\[\begin{aligned}
\hat{\boldsymbol\beta}  
= \left( {{\boldsymbol X^T \boldsymbol X}} \right)^{-1}
{\boldsymbol X^T \boldsymbol Y}
\end{aligned}\]</span></p>
<p>拟合值(或称预报值)向量为
<span class="math display">\[\begin{aligned}
\hat{\boldsymbol Y} 
= {\boldsymbol X}
\left( {{\boldsymbol X \boldsymbol X}} \right)^{-1} 
{\boldsymbol X^T \boldsymbol Y} 
= {\boldsymbol H \boldsymbol Y}
\end{aligned}\]</span>
其中<span class="math inline">\({\boldsymbol H} = {\boldsymbol X}\left( {{\boldsymbol X&#39;X}} \right)^{-1} {\boldsymbol X&#39;}\)</span>
是<span class="math inline">\(R^n\)</span>空间的向量向<span class="math inline">\({\boldsymbol X}\)</span>
的列张成的线性空间<span class="math inline">\(\mu({\boldsymbol X})\)</span>
投影的投影算子矩阵, 叫做<strong>帽子矩阵</strong>。
设<span class="math inline">\(\boldsymbol H = \left( h_{ij} \right)_{n\times n}\)</span>。</p>
<p><strong>拟合残差</strong>向量为
<span class="math display">\[\begin{aligned}
 \boldsymbol e  = {\boldsymbol Y} - \hat{\boldsymbol Y} 
 = ({\boldsymbol I} - {\boldsymbol H}){\boldsymbol Y}
\end{aligned}\]</span>
<strong>残差平方和</strong>为
<span class="math display">\[\begin{aligned}
 \mbox{ESS} = \boldsymbol e^T \boldsymbol e
 = \sum\limits_{i = 1}^n {\left( {Y_i  - \hat Y_i } \right)^2 }
\end{aligned}\]</span></p>
<p>误差项方差的估计
(要求设计阵<span class="math inline">\({\boldsymbol X}\)</span>满秩)为均方误差(MSE)
<span class="math display">\[\begin{aligned}
\hat\sigma^2  = \mbox{MSE} = \frac{1}{{n - p}} \mbox{ESS}
\end{aligned}\]</span>
（其中<span class="math inline">\(p\)</span>在有截距项时是自变量个数加1）</p>
<p>在线性模型的假设下, 若设计阵<span class="math inline">\({\boldsymbol X}\)</span>满秩,
<span class="math inline">\(\hat\beta\)</span>和<span class="math inline">\(\hat\sigma^2\)</span>
分别是<span class="math inline">\(\beta\)</span>和<span class="math inline">\(\sigma^2\)</span>的无偏估计。</p>
<p>系数估计的方差阵
<span class="math display">\[
\text{Var}(\hat{\boldsymbol\beta}) 
= \sigma^2 
\left( {\boldsymbol X}&#39; {\boldsymbol X} \right)^{-1}
\]</span></p>
<p><strong>回归残差</strong>及其方差为
<span class="math display">\[\begin{aligned}
  e_i =&amp; y_i - \hat y_i, \quad i=1,2,\dots,n \\
  \text{Var}(e_i) =&amp; \sigma^2 (1 - h_{ii})
    \quad(h_{ii}\text{是}H\text{的主对角线元素})
\end{aligned}\]</span></p>
<p>若<code>lmres</code>是R中<code>lm()</code>的回归结果，
用<code>residuals(lmres)</code>可以求残差。</p>
<p>把<span class="math inline">\(e_i\)</span>除以其标准差估计，
称为<strong>标准化残差</strong>，或<strong>内部学生化残差</strong>：
<span class="math display">\[\begin{aligned}
  r_i = \frac{e_i}{s \sqrt{1 - h_{ii}}}, \quad i=1,2,\dots,n
\end{aligned}\]</span>
<span class="math inline">\(r_i\)</span>渐近服从正态分布。</p>
<p>若<code>lmres</code>是R中<code>lm()</code>的回归结果，
用<code>rstandard(lmres)</code>可以求标准化残差。</p>
<p>如果计算<span class="math inline">\(y_i\)</span>的预测值时，
删除第<span class="math inline">\(i\)</span>个观测后建立回归模型得到<span class="math inline">\(\sigma^2\)</span>
的估计<span class="math inline">\(s_{(i)}^2\)</span>，
则<strong>外部学生化残差</strong>为
<span class="math display">\[\begin{aligned}
  t_i = \frac{e_i}{s_{(i)} \sqrt{1 - h_{ii}}}
\end{aligned}\]</span>
<span class="math inline">\(t_i\)</span>近似服从<span class="math inline">\(t(n-p-1)\)</span>分布
（有截距项时<span class="math inline">\(p\)</span>等于自变量个数加1）。
其中<span class="math inline">\(s_{(i)}\)</span>有简单公式：
<span class="math display">\[\begin{aligned}
  s_{(i)}^2 = \frac{n-p-r_i^2}{n-p-1} \hat\sigma^2
\end{aligned}\]</span></p>
<p>若<code>lmres</code>是R中<code>lm()</code>的回归结果，
用<code>rstudent(lmres)</code>可以求外部学生化残差。</p>
<p>在R中，
与一元回归的诊断类似。
用<code>plot()</code>作4个残差诊断图。
可以用<code>which=1</code>指定仅作第一幅图。</p>
<p>如餐馆营业额例子的残差诊断：</p>
<div class="sourceCode" id="cb2194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2194-1"><a href="stat-reg.html#cb2194-1"></a><span class="kw">plot</span>(lmrst02, <span class="dt">which=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-resturant03-1.png" width="672" /></p>
<p>上图是残差对拟合值的散点图，
可以查看有无非线性。
有轻微的非线性关系。</p>
<div class="sourceCode" id="cb2195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2195-1"><a href="stat-reg.html#cb2195-1"></a><span class="kw">plot</span>(lmrst02, <span class="dt">which=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-resturant04-1.png" width="672" /></p>
<p>上图是残差的正态QQ图，
查看残差是否正态分布。
残差分布略有右偏，不算太严重。</p>
<div class="sourceCode" id="cb2196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2196-1"><a href="stat-reg.html#cb2196-1"></a><span class="kw">plot</span>(lmrst02, <span class="dt">which=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-resturant05-1.png" width="672" />
上图是标准化残差绝对值平方根对拟合值的散点图，
可以查看是否有异方差。
没有明显的异方差。</p>
<div class="sourceCode" id="cb2197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2197-1"><a href="stat-reg.html#cb2197-1"></a><span class="kw">plot</span>(lmrst02, <span class="dt">which=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-resturant06-1.png" width="672" /></p>
<p>上图用来查看强影响点，
4号观测是一个强影响点。</p>
<p>货运公司例子的多元回归的残差诊断：</p>
<div class="sourceCode" id="cb2198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2198-1"><a href="stat-reg.html#cb2198-1"></a><span class="kw">plot</span>(lmbut02)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-exbutler03-1.png" width="672" /><img src="static/picture/stat-base-reg-regmu-exbutler03-2.png" width="672" /><img src="static/picture/stat-base-reg-regmu-exbutler03-3.png" width="672" /><img src="static/picture/stat-base-reg-regmu-exbutler03-4.png" width="672" /></p>
<p>有一定的异方差倾向，但是数据量不大就不做处理。</p>
</div>
<div id="stat-base-reg-regmu-colin" class="section level3">
<h3><span class="header-section-number">32.3.8</span> 多重共线性</h3>
<p>狭义的多重共线性（multicollinearity）：
自变量的数据存在线性组合近似地等于零，
使得矩阵求解回归系数时结果不稳定，
回归结果很差。</p>
<p>广义的多重共线性：
自变量之间存在较强的相关性，
这样自变量是联动的，
互相之间有替代作用。
甚至于斜率项的正负号都因为这种替代作用而可能是错误的方向。</p>
<p>例如，
餐馆营业额例子中，
F检验显著，
5个自变量如果用在一元回归中斜率项都显著，
但是在多元回归中，
在0.15水平下仅有人均餐费和到市中心的距离的系数是显著的，
月收入、餐馆数、居民数的系数不显著。</p>
<p>但是实际上，单独使用这三个自变量作一元线性回归，
结果都是显著的：</p>
<div class="sourceCode" id="cb2199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2199-1"><a href="stat-reg.html#cb2199-1"></a><span class="kw">summary</span>(<span class="kw">lm</span>(<span class="st">`</span><span class="dt">营业额</span><span class="st">`</span> <span class="op">~</span><span class="st"> `</span><span class="dt">月收入</span><span class="st">`</span>, <span class="dt">data=</span>Resturant))</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = 营业额 ~ 月收入, data = Resturant)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -32.151 -10.725  -0.696   6.033  47.819 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.484580   5.955478   0.081    0.936    
## 月收入      0.004995   0.000944   5.291 2.27e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 16.88 on 23 degrees of freedom
## Multiple R-squared:  0.549,  Adjusted R-squared:  0.5294 
## F-statistic: 27.99 on 1 and 23 DF,  p-value: 2.273e-05</code></pre>
<p>如何识别多重共线性？</p>
<p>如果两个自变量之间的相关系数显著地不等于零，
这两个自变量就有广义的共线性。</p>
<p>如果线性关系的F检验显著但是单个回归系数都不显著，
可能是由于多重共线性。</p>
<p>如果有单个回归系数显著但是<span class="math inline">\(F\)</span>检验不显著，
可能是由于多重共线性。</p>
<p>如果某些回归系数的正负号与通常的认识相反，
可能是由于多重共线性。</p>
<p>将第<span class="math inline">\(i\)</span>个自变量<span class="math inline">\(x_i\)</span>作为因变量，
用其它的<span class="math inline">\(p-1\)</span>个自变量作为自变量作多元线性回归，
得到一个复相关系数平方<span class="math inline">\(R_i^2\)</span>，
这个<span class="math inline">\(R_i^2\)</span>接近于1时<span class="math inline">\(x_i\)</span>与其他自变量之间存在多重共线性。
令<span class="math inline">\(x_i\)</span>的容忍度（tolerance）等于<span class="math inline">\(1-R_i^2\)</span>，
容忍度接近于0时存在多重共线性。</p>
<p>容忍度小于0.1时多重共线性为严重程度。</p>
<p>称容忍度的倒数为方差膨胀因子（VIF），
VIF大于10或者大于5作为严重的多重共线性。</p>
<p>为了计算VIF, 首先把矩阵<span class="math inline">\(X^T X\)</span>看成一个协方差阵，
把它转换为相关系数阵设为<span class="math inline">\(M\)</span>，
则<span class="math inline">\(M^{-1}\)</span>的各主对角线元素就是各个VIF。</p>
<p>car包的<code>vif()</code>函数计算方差膨胀因子。</p>
<p>如：</p>
<div class="sourceCode" id="cb2201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2201-1"><a href="stat-reg.html#cb2201-1"></a>car<span class="op">::</span><span class="kw">vif</span>(lmrst01)</span></code></pre></div>
<pre><code>##   居民数 人均餐费   月收入   餐馆数     距离 
## 8.233159 2.629940 5.184365 1.702361 1.174053</code></pre>
<p>可以认为变量“居民数”和“月收入”有共线问题。</p>
<p>做共线诊断还可以用条件数(Conditional Index):
这是一个正数，用来衡量<span class="math inline">\((X^T X)^{-1}\)</span>的稳定性，
定义为<span class="math inline">\(X^T X\)</span>的最大特征值与最小特征值之比。
条件数在0—100之间时认为无共线性，
在100—1000之间时认为自变量之间有中等或较强共线性，
在1000以上认为自变量之间有强共线性。</p>
<p>解决多重共线性问题，
最简单的方法是回归自变量选择，
剔除掉有严重共线性的自变量，
这些自变量的信息可以由其他变量代替。
还可以对自变量作变换，如用主成分分析降维。
可以用收缩方法如岭回归、lasso回归等。</p>
</div>
<div id="stat-base-reg-regmu-lev" class="section level3">
<h3><span class="header-section-number">32.3.9</span> 强影响点分析</h3>
<p>强影响点是删去以后严重改变参数估计值的观测。
包括自变量取值离群和因变量拟合离群的点。</p>
<p>杠杆(leverage)指帽子矩阵的对角线元素<span class="math inline">\(h_{ii}\)</span>,
<span class="math display">\[\begin{aligned}
\frac{1}{n} \leq h_{ii} \leq \frac{1}{d_i}
\end{aligned}\]</span>
其中<span class="math inline">\(d_i\)</span>是第<span class="math inline">\(i\)</span>个观测的重复观测次数。
某观测杠杆值高说明该观测自变量有异常值。
杠杆值大于<span class="math inline">\(2p/n\)</span>的观测需要仔细考察
（有截距项时<span class="math inline">\(p\)</span>等于自变量个数加1）。</p>
<p>若<code>lmres</code>是R中<code>lm()</code>的回归结果，
用<code>hatvalues(lmres)</code>可以求杠杆值。</p>
<p>考察外学生化残差<span class="math inline">\(t_i\)</span>，
绝对值超过2的观测拟合误差大，
在<span class="math inline">\(y\)</span>方向离群，需要关注。</p>
<p>若<code>lmres</code>是R中<code>lm()</code>的回归结果，
用<code>rstudent(lmres)</code>可以求外学生化。</p>
<p>Cook距离统计量：
<span class="math display">\[\begin{aligned}
D_i = \frac{1}{p} r_i^2 \frac{h_{ii}}{1 - h_{ii}}
\end{aligned}\]</span>
包含了<span class="math inline">\(y\)</span>方向的离群<span class="math inline">\(r_i\)</span>和<span class="math inline">\(x\)</span>方向的离群<span class="math inline">\(h_{ii}\)</span>的信息。
超过<span class="math inline">\(\frac{4}{n}\)</span>的值需要注意。</p>
<p>若<code>lmres</code>是R中<code>lm()</code>的回归结果，
用<code>cooks.distance(lmres)</code>可以求Cook距离。</p>
<p>R中的强影响点诊断函数还有
<code>dfbetas()</code>, <code>dffits()</code>,
<code>covratio()</code>。</p>
<p><strong>偏杠杆值</strong>衡量每个自变量(包括截距项)对杠杆的贡献。
把第j个自变量关于其它自变量回归得到残差，
第i个残差的平方占总残差平方和的比例为第j自变量在第i观测处的偏杠杆值。
偏杠杆值影响自变量选择时对该变量的选择。</p>
</div>
<div id="stat-base-reg-regmu-overfit" class="section level3">
<h3><span class="header-section-number">32.3.10</span> 过度拟合示例</h3>
<p><span class="math inline">\(R^2\)</span>代表了模型对数据的拟合程度，
模型中加入的自变量越多，
<span class="math inline">\(R^2\)</span>越大。
是不是模型中的自变量越多越好？
可能会发生“过度拟合”。
用来建模的数据都拟合误差很小，
但是模型很难有合理解释，
对新的数据的预测效果很差甚至于完全错误。</p>
<div class="sourceCode" id="cb2203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2203-1"><a href="stat-reg.html#cb2203-1"></a><span class="kw">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb2203-2"><a href="stat-reg.html#cb2203-2"></a>n &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb2203-3"><a href="stat-reg.html#cb2203-3"></a>x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">size=</span>n, <span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb2203-4"><a href="stat-reg.html#cb2203-4"></a>a &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb2203-5"><a href="stat-reg.html#cb2203-5"></a>b &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb2203-6"><a href="stat-reg.html#cb2203-6"></a>sigma &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb2203-7"><a href="stat-reg.html#cb2203-7"></a>y &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b<span class="op">*</span>x <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(n, <span class="dv">4</span>)<span class="op">*</span>sigma</span>
<span id="cb2203-8"><a href="stat-reg.html#cb2203-8"></a>xnew &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>)</span>
<span id="cb2203-9"><a href="stat-reg.html#cb2203-9"></a>ynew &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b<span class="op">*</span>xnew <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(xnew), <span class="dv">0</span>, sigma)</span>
<span id="cb2203-10"><a href="stat-reg.html#cb2203-10"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, n<span class="op">+</span><span class="dv">1</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">90</span>,<span class="dv">140</span>))</span>
<span id="cb2203-11"><a href="stat-reg.html#cb2203-11"></a><span class="kw">points</span>(xnew, ynew, <span class="dt">pch=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb2203-12"><a href="stat-reg.html#cb2203-12"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">2</span>), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="cb2203-13"><a href="stat-reg.html#cb2203-13"></a>       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;拟合用&quot;</span>, <span class="st">&quot;测试用&quot;</span>))</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-overfit01-1.png" width="672" /></p>
<p>作线性回归：</p>
<div class="sourceCode" id="cb2204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2204-1"><a href="stat-reg.html#cb2204-1"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, n<span class="op">+</span><span class="dv">1</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">90</span>,<span class="dv">140</span>))</span>
<span id="cb2204-2"><a href="stat-reg.html#cb2204-2"></a><span class="kw">points</span>(xnew, ynew, <span class="dt">pch=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb2204-3"><a href="stat-reg.html#cb2204-3"></a>lmof1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb2204-4"><a href="stat-reg.html#cb2204-4"></a><span class="kw">abline</span>(lmof1)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-overfit02-1.png" width="672" /></p>
<p>回归系数：</p>
<div class="sourceCode" id="cb2205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2205-1"><a href="stat-reg.html#cb2205-1"></a><span class="kw">summary</span>(lmof1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.8206 -4.0691 -0.2855  3.9371 11.7011 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  97.9570     3.0244  32.388  &lt; 2e-16 ***
## x             2.0521     0.3163   6.489 4.21e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.767 on 18 degrees of freedom
## Multiple R-squared:  0.7005, Adjusted R-squared:  0.6839 
## F-statistic:  42.1 on 1 and 18 DF,  p-value: 4.209e-06</code></pre>
<p>二次多项式回归：</p>
<div class="sourceCode" id="cb2207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2207-1"><a href="stat-reg.html#cb2207-1"></a><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, n<span class="op">+</span><span class="dv">1</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">90</span>,<span class="dv">140</span>))</span>
<span id="cb2207-2"><a href="stat-reg.html#cb2207-2"></a><span class="kw">points</span>(xnew, ynew, <span class="dt">pch=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb2207-3"><a href="stat-reg.html#cb2207-3"></a>lmof2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb2207-4"><a href="stat-reg.html#cb2207-4"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, n, <span class="dt">length=</span><span class="dv">100</span>)</span>
<span id="cb2207-5"><a href="stat-reg.html#cb2207-5"></a>yy &lt;-<span class="st"> </span><span class="kw">predict</span>(lmof2, <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">x=</span>xx))</span>
<span id="cb2207-6"><a href="stat-reg.html#cb2207-6"></a><span class="kw">lines</span>(xx, yy)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-overfit04-1.png" width="672" /></p>
<p>回归系数：</p>
<div class="sourceCode" id="cb2208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2208-1"><a href="stat-reg.html#cb2208-1"></a><span class="kw">summary</span>(lmof2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x + I(x^2))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -11.175  -3.059  -0.439   3.358   9.400 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 102.59339    5.32854  19.254 5.57e-13 ***
## x             0.73688    1.28561   0.573    0.574    
## I(x^2)        0.07371    0.06985   1.055    0.306    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.749 on 17 degrees of freedom
## Multiple R-squared:  0.7189, Adjusted R-squared:  0.6859 
## F-statistic: 21.74 on 2 and 17 DF,  p-value: 2.066e-05</code></pre>
<p>这个回归结果出现了多重共线性问题。
也已经过度拟合。</p>
<p>三次多项式回归：</p>
<p><img src="static/picture/stat-base-reg-regmu-overfit06-1.png" width="672" /></p>
<p>回归系数：</p>
<div class="sourceCode" id="cb2210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2210-1"><a href="stat-reg.html#cb2210-1"></a><span class="kw">summary</span>(lmof3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x + I(x^2) + I(x^3))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -11.1976  -3.0835  -0.3567   3.6324   8.8020 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 105.162401   8.827478  11.913 2.29e-09 ***
## x            -0.558534   3.734856  -0.150    0.883    
## I(x^2)        0.240987   0.456853   0.527    0.605    
## I(x^3)       -0.006124   0.016518  -0.371    0.716    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.901 on 16 degrees of freedom
## Multiple R-squared:  0.7213, Adjusted R-squared:  0.6691 
## F-statistic:  13.8 on 3 and 16 DF,  p-value: 0.0001053</code></pre>
<p>这个回归结果出现了多重共线性问题。
也已经过度拟合。</p>
<p>四次多项式回归：</p>
<p><img src="static/picture/stat-base-reg-regmu-overfit08-1.png" width="672" /></p>
<p>回归系数：</p>
<div class="sourceCode" id="cb2212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2212-1"><a href="stat-reg.html#cb2212-1"></a><span class="kw">summary</span>(lmof4)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x + I(x^2) + I(x^3) + I(x^4))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.8975 -3.5647  0.1241  4.7063  7.4675 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 122.380891  18.117315   6.755 6.47e-06 ***
## x           -12.830942  11.890980  -1.079    0.298    
## I(x^2)        2.785077   2.385359   1.168    0.261    
## I(x^3)       -0.206102   0.184800  -1.115    0.282    
## I(x^4)        0.005273   0.004854   1.086    0.294    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.868 on 15 degrees of freedom
## Multiple R-squared:  0.7416, Adjusted R-squared:  0.6727 
## F-statistic: 10.76 on 4 and 15 DF,  p-value: 0.0002563</code></pre>
<p>五次多项式回归：</p>
<p><img src="static/picture/stat-base-reg-regmu-overfit10-1.png" width="672" /></p>
<p>已经明显过度拟合。</p>
<p>回归系数：</p>
<div class="sourceCode" id="cb2214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2214-1"><a href="stat-reg.html#cb2214-1"></a><span class="kw">summary</span>(lmof5)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x + I(x^2) + I(x^3) + I(x^4) + I(x^5))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.9204 -3.4541  0.2201  3.7495  8.5922 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 181.846244  41.023546   4.433 0.000568 ***
## x           -65.530939  34.875410  -1.879 0.081224 .  
## I(x^2)       18.157919   9.886841   1.837 0.087594 .  
## I(x^3)       -2.170388   1.242055  -1.747 0.102453    
## I(x^4)        0.118729   0.071167   1.668 0.117456    
## I(x^5)       -0.002418   0.001513  -1.598 0.132453    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.586 on 14 degrees of freedom
## Multiple R-squared:  0.7815, Adjusted R-squared:  0.7034 
## F-statistic: 10.01 on 5 and 14 DF,  p-value: 0.0003082</code></pre>
<p>六次多项式回归：
<img src="static/picture/stat-base-reg-regmu-overfit12-1.png" width="672" /></p>
<p>回归系数：</p>
<div class="sourceCode" id="cb2216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2216-1"><a href="stat-reg.html#cb2216-1"></a><span class="kw">summary</span>(lmof6)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x + I(x^2) + I(x^3) + I(x^4) + I(x^5) + I(x^6))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.4627 -3.2409 -0.6654  3.1208  8.0410 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  2.699e+02  8.387e+01   3.218  0.00673 **
## x           -1.585e+02  8.483e+01  -1.868  0.08447 . 
## I(x^2)       5.346e+01  3.103e+01   1.723  0.10864   
## I(x^3)      -8.572e+00  5.481e+00  -1.564  0.14188   
## I(x^4)       7.158e-01  5.033e-01   1.422  0.17849   
## I(x^5)      -2.999e-02  2.307e-02  -1.300  0.21606   
## I(x^6)       4.982e-04  4.159e-04   1.198  0.25229   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.501 on 13 degrees of freedom
## Multiple R-squared:  0.8032, Adjusted R-squared:  0.7124 
## F-statistic: 8.843 on 6 and 13 DF,  p-value: 0.0005655</code></pre>
</div>
<div id="stat-base-reg-regmu-comp-inset" class="section level3">
<h3><span class="header-section-number">32.3.11</span> 嵌套模型的比较</h3>
<p>如果两个多元线性回归模型，
第一个模型中的自变量都在第二个模型中，
且第二个模型具有更多的自变量，
则称第一个模型嵌套在第二个模型中。</p>
<p>例如：第一个模型中自变量为<span class="math inline">\(x_1, x_2, x_5\)</span>,
第二个模型自变量为<span class="math inline">\(x_1, x_2, x_3, x_4, x_5\)</span>，
则第一个模型嵌套在第二个模型中。</p>
<p>又如：第一个模型自变量为<span class="math inline">\(x_1, x_2\)</span>,
第二个模型自变量为<span class="math inline">\(x_1, x_2, x_1^2, x_2^2, x_1 x_2\)</span>，
则第一个模型嵌套在第二个模型中。
这时令<span class="math inline">\(x_3=x_1^2\)</span>, <span class="math inline">\(x_4=x_2^2\)</span>, <span class="math inline">\(x_5=x_1 x_2\)</span>，
第二个模型变成有5个自变量的多元线性回归模型。</p>
<p>在嵌套的模型中，
相对而言自变量多的模型叫做完全模型（full model），
自变量少的模型叫做简化模型（reduced model）。</p>
<p>完全模型是否比简化模型更好？
在回归模型选择中贯彻一个“精简性”原则（Ocam’s razor）：
在对建模数据拟合效果相近的情况下，
越简单的模型越好。</p>
<p>例如：全模型是
<span class="math display">\[
Ey = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + \beta_4 x_4
\]</span>
精简模型是
<span class="math display">\[
Ey=\beta_0 + \beta_1 x_1 + \beta_2 x_2
\]</span>
判断两个模型是否没有显著差异，只要检验：
<span class="math display">\[
H_0: \beta_3 = \beta_4 = 0
\]</span>
这可以构造一个方差分析F检验，</p>
<p>设全模型有<span class="math inline">\(t\)</span>个自变量，
模型得到的回归残差平方和为<span class="math inline">\(\text{SSE}_f\)</span>;
设精简模型有<span class="math inline">\(s\)</span>个自变量（<span class="math inline">\(s &lt; t\)</span>），
模型得到的回归残差平方和为<span class="math inline">\(\text{SSE}_r\)</span>；
检验零假设为多出的自变量对应的系数都等于零。
检验统计量为
<span class="math display">\[
F = \frac{(\text{SSE}_r - \text{SSE}_f)/(t-s)}{\text{SSE}_f/(n-t-1)}
\]</span>
在全模型成立且<span class="math inline">\(H_0\)</span>成立时，<span class="math inline">\(F\)</span>服从<span class="math inline">\(F(t-s, n-t-1)\)</span>分布。
计算右侧p值。</p>
<p>在R中用<code>anova()</code>函数比较两个嵌套的线性回归结果可以进行这样的方差分析F检验。</p>
<p>例如，餐馆营业额回归模型的比较。
<code>lmrst01</code>是完全模型，包含5个自变量；
<code>lmrst02</code>是嵌套的精简模型，
包含居民数、人均餐费、到市中心距离共3个自变量。
用<code>anova()</code>函数可以检验多出的变量是否有意义：</p>
<div class="sourceCode" id="cb2218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2218-1"><a href="stat-reg.html#cb2218-1"></a><span class="kw">anova</span>(lmrst01, lmrst02)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: 营业额 ~ 居民数 + 人均餐费 + 月收入 + 餐馆数 + 距离
## Model 2: 营业额 ~ 居民数 + 人均餐费 + 距离
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1     19 2153.0                           
## 2     21 2267.2 -2   -114.17 0.5038 0.6121</code></pre>
<p>模型p值为0.61，
在0.05水平下不拒绝多出的月收入和餐馆数的系数全为零的零假设，
两个模型的效果没有显著差异，
应选择更精简的模型。</p>
<p>方差分析检验仅能比较嵌套模型。
对不同模型计算AIC，
取AIC较小的模型，
这可以对非嵌套的模型进行比较选择。
R中用<code>AIC()</code>函数比较两个回归结果的AIC值。</p>
<p>如：</p>
<div class="sourceCode" id="cb2220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2220-1"><a href="stat-reg.html#cb2220-1"></a><span class="kw">AIC</span>(lmrst01, lmrst02)</span></code></pre></div>
<pre><code>##         df      AIC
## lmrst01  7 196.3408
## lmrst02  5 193.6325</code></pre>
<p>精简模型<code>lmrst02</code>的AIC更小，是更好的模型。</p>
</div>
<div id="stat-base-reg-regmu-pred" class="section level3">
<h3><span class="header-section-number">32.3.12</span> 拟合与预测</h3>
<div id="stat-base-reg-regmu-pred-fit" class="section level4">
<h4><span class="header-section-number">32.3.12.1</span> 拟合</h4>
<p>有了参数最小二乘估计后，对建模用的每个数据点计算
<span class="math display">\[
\hat y_i 
= \hat\beta_0 + \hat\beta_1 x_{i1} 
+ \dots + \hat\beta_p x_{ip}
\]</span>
称为拟合值（fitted value）。</p>
<p>得到回归模型结果lmres后，要对原数据框中的观测值做预测，
只要使用<code>predict(lmres)</code>。</p>
</div>
<div id="stat-base-reg-regmu-pred-pred" class="section level4">
<h4><span class="header-section-number">32.3.12.2</span> 点预测</h4>
<p>为了使用得到的模型结果lmres对新数据做预测，
建立包含了自变量的一组新的观测值的数据框dp,
用<code>predict(lmres, newdata=dp)</code>做预测。</p>
<p>如餐馆营业额的选择自变量的回归模型<code>lmrst02</code>的拟合值：</p>
<div class="sourceCode" id="cb2222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2222-1"><a href="stat-reg.html#cb2222-1"></a><span class="kw">predict</span>(lmrst02)</span></code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
## 52.1892541 -4.5010247 21.9626575 65.1136964  6.1284803 22.4083426  1.2783244 
##          8          9         10         11         12         13         14 
## 34.7189934 10.6275869 37.8433996 62.8524888 18.2959990 -5.5101343 14.9558131 
##         15         16         17         18         19         20         21 
##  8.8598588 29.8309866 78.0159456 13.1673581 15.8469287 50.7274217 27.4608977 
##         22         23         24         25 
##  0.2331759 22.6274030 48.9610796 27.0050675</code></pre>
<p>如果是一元回归，一般还画数据的散点图并画回归直线。
多元回归的图形无法在二维表现出来。</p>
<p>有了估计的回归方程后，
对一组新的自变量值<span class="math inline">\((x_{01}, \dots, x_{0p})\)</span>，
可以计算对应的因变量的预测值：
<span class="math display">\[
\hat y_0 = \hat\beta_0 + \hat\beta_1 x_{01} 
+ \dots + \hat\beta_p x_{0p}
\]</span></p>
<p>在R中，设<code>lmres</code>保存了回归结果，
<code>newd</code>是一个保存了新的自变量值的数据框，
此数据框结构与原建模用数据框类似但是自变量与原来不同，
且不需要有因变量。
这时用<code>predict(lm1, data=newd)</code>预测。</p>
<p>例如，利用包含居民数、人均餐费、到市中心距离的模型<code>lmrst02</code>，
求居民数=50(万居民)，人均餐费=100(元)，
距市中心10千米的餐馆的日均营业额：</p>
<div class="sourceCode" id="cb2224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2224-1"><a href="stat-reg.html#cb2224-1"></a><span class="kw">predict</span>(</span>
<span id="cb2224-2"><a href="stat-reg.html#cb2224-2"></a>  lmrst02,</span>
<span id="cb2224-3"><a href="stat-reg.html#cb2224-3"></a>  <span class="dt">newdata=</span><span class="kw">data.frame</span>(</span>
<span id="cb2224-4"><a href="stat-reg.html#cb2224-4"></a>    <span class="st">`</span><span class="dt">居民数</span><span class="st">`</span>=<span class="dv">50</span>, <span class="st">`</span><span class="dt">人均餐费</span><span class="st">`</span>=<span class="dv">100</span>, <span class="st">`</span><span class="dt">距离</span><span class="st">`</span>=<span class="dv">10</span></span>
<span id="cb2224-5"><a href="stat-reg.html#cb2224-5"></a>  ))</span></code></pre></div>
<pre><code>##        1 
## 17.88685</code></pre>
<p>预测的日均营业额为17.9千元。</p>
<p>函数<code>expand.grid()</code>可以对若干个变量的指定值，
生成包含所有组合的数据框，如：</p>
<div class="sourceCode" id="cb2226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2226-1"><a href="stat-reg.html#cb2226-1"></a>newd &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb2226-2"><a href="stat-reg.html#cb2226-2"></a>  <span class="st">`</span><span class="dt">居民数</span><span class="st">`</span>=<span class="kw">c</span>(<span class="dv">60</span>, <span class="dv">140</span>), </span>
<span id="cb2226-3"><a href="stat-reg.html#cb2226-3"></a>  <span class="st">`</span><span class="dt">人均餐费</span><span class="st">`</span>=<span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">130</span>), </span>
<span id="cb2226-4"><a href="stat-reg.html#cb2226-4"></a>  <span class="st">`</span><span class="dt">距离</span><span class="st">`</span>=<span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">16</span>))</span>
<span id="cb2226-5"><a href="stat-reg.html#cb2226-5"></a>newd</span></code></pre></div>
<pre><code>##   居民数 人均餐费 距离
## 1     60       50    6
## 2    140       50    6
## 3     60      130    6
## 4    140      130    6
## 5     60       50   16
## 6    140       50   16
## 7     60      130   16
## 8    140      130   16</code></pre>
<div class="sourceCode" id="cb2228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2228-1"><a href="stat-reg.html#cb2228-1"></a><span class="kw">predict</span>(lmrst02, <span class="dt">newdata=</span>newd)</span></code></pre></div>
<pre><code>##         1         2         3         4         5         6         7         8 
## 14.186636 29.404103 26.797108 42.014574  8.488759 23.706225 21.099230 36.316696</code></pre>
</div>
<div id="stat-base-reg-regmu-pred-clm" class="section level4">
<h4><span class="header-section-number">32.3.12.3</span> 均值的置信区间</h4>
<p>对<span class="math inline">\(Ey=\beta_0 + \beta_1 x_1 + \dots + \beta_p x_p\)</span>,
可以计算置信度为<span class="math inline">\(1-\alpha\)</span>的置信区间，
称为均值的置信区间。</p>
<p>在<code>predict()</code>中加选项<code>interval="confidence"</code>,
用<code>level=</code>指定置信度，
可以计算均值的置信区间。</p>
<p>如</p>
<div class="sourceCode" id="cb2230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2230-1"><a href="stat-reg.html#cb2230-1"></a><span class="kw">predict</span>(</span>
<span id="cb2230-2"><a href="stat-reg.html#cb2230-2"></a>  lmrst02, <span class="dt">interval=</span><span class="st">&quot;confidence&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>,</span>
<span id="cb2230-3"><a href="stat-reg.html#cb2230-3"></a>  <span class="dt">newdata=</span><span class="kw">data.frame</span>(</span>
<span id="cb2230-4"><a href="stat-reg.html#cb2230-4"></a>    <span class="st">`</span><span class="dt">居民数</span><span class="st">`</span>=<span class="dv">50</span>, <span class="st">`</span><span class="dt">人均餐费</span><span class="st">`</span>=<span class="dv">100</span>, <span class="st">`</span><span class="dt">距离</span><span class="st">`</span>=<span class="dv">10</span></span>
<span id="cb2230-5"><a href="stat-reg.html#cb2230-5"></a>  ))</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 17.88685 10.98784 24.78585</code></pre>
<p>其中<code>fit</code>是预测值，<code>lwr</code>和<code>upr</code>分别是置信下限和置信上限。</p>
</div>
<div id="stat-base-reg-regmu-pred-cli" class="section level4">
<h4><span class="header-section-number">32.3.12.4</span> 个别值的预测区间</h4>
<p>对<span class="math inline">\(y=\beta_0 + \beta_1 x_1 + \dots + \beta_p x_p + \varepsilon\)</span>,
可以计算置信度为<span class="math inline">\(1-\alpha\)</span>的预测区间，
称为预测区间，预测区间比均值的置信区间要宽。</p>
<p>在<code>predict()</code>中加选项<code>interval="prediction"</code>,
用<code>level=</code>指定置信度，
可以计算预测区间。</p>
<p>如</p>
<div class="sourceCode" id="cb2232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2232-1"><a href="stat-reg.html#cb2232-1"></a><span class="kw">predict</span>(</span>
<span id="cb2232-2"><a href="stat-reg.html#cb2232-2"></a>  lmrst02, <span class="dt">interval=</span><span class="st">&quot;prediction&quot;</span>, <span class="dt">level=</span><span class="fl">0.95</span>,</span>
<span id="cb2232-3"><a href="stat-reg.html#cb2232-3"></a>  <span class="dt">newdata=</span><span class="kw">data.frame</span>(</span>
<span id="cb2232-4"><a href="stat-reg.html#cb2232-4"></a>    <span class="st">`</span><span class="dt">居民数</span><span class="st">`</span>=<span class="dv">50</span>, <span class="st">`</span><span class="dt">人均餐费</span><span class="st">`</span>=<span class="dv">100</span>, <span class="st">`</span><span class="dt">距离</span><span class="st">`</span>=<span class="dv">10</span></span>
<span id="cb2232-5"><a href="stat-reg.html#cb2232-5"></a>  ))</span></code></pre></div>
<pre><code>##        fit       lwr      upr
## 1 17.88685 -4.795935 40.56963</code></pre>
<p>其中<code>fit</code>是预测值，<code>lwr</code>和<code>upr</code>分别是预测下限和预测上限。</p>
</div>
</div>
<div id="stat-base-reg-regmu-curve" class="section level3">
<h3><span class="header-section-number">32.3.13</span> 利用线性回归模型做曲线拟合</h3>
<p>某些非线性关系可以通过对因变量和自变量的简单变换变成线性回归模型。</p>
<p>例如，
彩色显影中，
染料光学密度<span class="math inline">\(Y\)</span>与析出银的光学密度<span class="math inline">\(x\)</span>
有如下类型的关系
<span class="math display">\[
Y \approx A e^{-B/x}, \quad B &gt; 0
\]</span>
这不是线性关系。两边取对数得
<span class="math display">\[
\ln Y \approx \ln A - B \frac{1}{x}
\]</span>
令
<span class="math display">\[
Y^* = \ln Y, \qquad x^* = \frac{1}{x}
\]</span>
则
<span class="math display">\[
Y^* \approx \ln A - B x^*
\]</span>
为线性关系。</p>
<p>从<span class="math inline">\(n\)</span>组数据
<span class="math inline">\((x_1, y_1), (x_2, y_2), \dots, (x_n, y_n)\)</span>得到变换的数据
<span class="math inline">\((x_1^*, y_1^*), (x_2^*, y_2^*), \dots, (x_n^*, y_n^*)\)</span>。
对变换后的数据建立线性回归方程
<span class="math display">\[\hat y^* = \hat a + \hat b x^*\]</span>
反变换得
<span class="math display">\[\hat A = e^{\hat a}, \qquad  \hat B = -b\]</span>
则有
<span class="math display">\[\hat Y = \hat A e^{-\hat B / x}\]</span></p>
<p>再考虑一个钢包容积的例子。
炼钢钢包随使用次数增加而容积增大。
测量了13组这样的数据:</p>
<div class="sourceCode" id="cb2234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2234-1"><a href="stat-reg.html#cb2234-1"></a>SteelBag &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb2234-2"><a href="stat-reg.html#cb2234-2"></a>  <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>,</span>
<span id="cb2234-3"><a href="stat-reg.html#cb2234-3"></a>         <span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">18</span>, <span class="dv">19</span>),</span>
<span id="cb2234-4"><a href="stat-reg.html#cb2234-4"></a>  <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">106.42</span>, <span class="fl">108.20</span>, <span class="fl">109.58</span>, <span class="fl">109.50</span>, <span class="fl">110.0</span>,</span>
<span id="cb2234-5"><a href="stat-reg.html#cb2234-5"></a>         <span class="fl">109.93</span>, <span class="fl">110.49</span>, <span class="fl">110.59</span>, <span class="fl">110.60</span>, <span class="fl">110.90</span>,</span>
<span id="cb2234-6"><a href="stat-reg.html#cb2234-6"></a>         <span class="fl">110.76</span>, <span class="fl">111.00</span>, <span class="fl">111.20</span>)</span>
<span id="cb2234-7"><a href="stat-reg.html#cb2234-7"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb2235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2235-1"><a href="stat-reg.html#cb2235-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(SteelBag)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
<th align="right">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">106.42</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">108.20</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">109.58</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">109.50</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">110.00</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">109.93</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">110.49</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">110.59</td>
</tr>
<tr class="odd">
<td align="right">14</td>
<td align="right">110.60</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">110.90</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">110.76</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">111.00</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">111.20</td>
</tr>
</tbody>
</table>
<p>散点图：</p>
<div class="sourceCode" id="cb2236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2236-1"><a href="stat-reg.html#cb2236-1"></a><span class="kw">with</span>(SteelBag, <span class="kw">plot</span>(</span>
<span id="cb2236-2"><a href="stat-reg.html#cb2236-2"></a>  x, y, <span class="dt">xlab=</span><span class="st">&quot;使用次数&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;钢包容积&quot;</span></span>
<span id="cb2236-3"><a href="stat-reg.html#cb2236-3"></a>))</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-sb03-1.png" width="672" /></p>
<p>散点图呈现非线性。
用线性回归近似：</p>
<div class="sourceCode" id="cb2237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2237-1"><a href="stat-reg.html#cb2237-1"></a>lmsb1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data=</span>SteelBag)</span>
<span id="cb2237-2"><a href="stat-reg.html#cb2237-2"></a><span class="kw">summary</span>(lmsb1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x, data = SteelBag)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.97615 -0.38502  0.04856  0.53724  0.80611 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 108.01842    0.44389 243.346  &lt; 2e-16 ***
## x             0.18887    0.03826   4.937 0.000445 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7744 on 11 degrees of freedom
## Multiple R-squared:  0.689,  Adjusted R-squared:  0.6607 
## F-statistic: 24.37 on 1 and 11 DF,  p-value: 0.000445</code></pre>
<p>结果显著。
<span class="math inline">\(R^2=0.69\)</span>。
拟合图：</p>
<div class="sourceCode" id="cb2239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2239-1"><a href="stat-reg.html#cb2239-1"></a><span class="kw">with</span>(SteelBag, <span class="kw">plot</span>(</span>
<span id="cb2239-2"><a href="stat-reg.html#cb2239-2"></a>  x, y, <span class="dt">xlab=</span><span class="st">&quot;使用次数&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;钢包容积&quot;</span>,</span>
<span id="cb2239-3"><a href="stat-reg.html#cb2239-3"></a>  <span class="dt">main=</span><span class="st">&quot;线性近似&quot;</span></span>
<span id="cb2239-4"><a href="stat-reg.html#cb2239-4"></a>))</span>
<span id="cb2239-5"><a href="stat-reg.html#cb2239-5"></a><span class="kw">abline</span>(lmsb1, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-sb05-1.png" width="672" /></p>
<p>残差诊断：</p>
<div class="sourceCode" id="cb2240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2240-1"><a href="stat-reg.html#cb2240-1"></a><span class="kw">plot</span>(lmsb1, <span class="dt">which=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-sb06-1.png" width="672" /></p>
<p>残差图呈现非线性。</p>
<p>用双曲线模型：
<span class="math display">\[
\frac{1}{y} \approx a + b \frac{1}{x}
\]</span></p>
<p>令<span class="math inline">\(x^* = 1/x, y^* = 1/y\)</span>，化为线性模型
<span class="math display">\[y^* \approx a + b x^*\]</span></p>
<p><span class="math inline">\((x^*, y^*)\)</span>的散点图：</p>
<div class="sourceCode" id="cb2241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2241-1"><a href="stat-reg.html#cb2241-1"></a><span class="kw">with</span>(SteelBag, <span class="kw">plot</span>(</span>
<span id="cb2241-2"><a href="stat-reg.html#cb2241-2"></a>  <span class="dv">1</span><span class="op">/</span>x, <span class="dv">1</span><span class="op">/</span>y, <span class="dt">xlab=</span><span class="st">&quot;1/使用次数&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;1/钢包容积&quot;</span>,</span>
<span id="cb2241-3"><a href="stat-reg.html#cb2241-3"></a>  <span class="dt">main=</span><span class="st">&quot;x和y都做倒数变换&quot;</span></span>
<span id="cb2241-4"><a href="stat-reg.html#cb2241-4"></a>))</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-sb07-1.png" width="672" /></p>
<p><span class="math inline">\(y^*\)</span>对<span class="math inline">\(x^*\)</span>的回归：</p>
<div class="sourceCode" id="cb2242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2242-1"><a href="stat-reg.html#cb2242-1"></a>lmsb2 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">I</span>(<span class="dv">1</span><span class="op">/</span>y) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span><span class="op">/</span>x), <span class="dt">data=</span>SteelBag)</span>
<span id="cb2242-2"><a href="stat-reg.html#cb2242-2"></a><span class="kw">summary</span>(lmsb2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = I(1/y) ~ I(1/x), data = SteelBag)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -4.817e-05 -3.686e-06  4.000e-07  1.008e-05  2.642e-05 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 8.967e-03  8.371e-06 1071.14  &lt; 2e-16 ***
## I(1/x)      8.292e-04  4.118e-05   20.14 4.97e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.903e-05 on 11 degrees of freedom
## Multiple R-squared:  0.9736, Adjusted R-squared:  0.9712 
## F-statistic: 405.4 on 1 and 11 DF,  p-value: 4.97e-10</code></pre>
<p>结果显著。
解得<span class="math inline">\(\hat a = 0.008967\)</span>, <span class="math inline">\(\hat b = 0.0008292\)</span>,
经验公式为
<span class="math display">\[
\frac{1}{\hat y} = 0.008967 + 0.0008292 \frac{1}{x}
\]</span>
<span class="math inline">\(R^2\)</span>从线性近似的0.69提高到了0.97。</p>
<p>拟合图：</p>
<div class="sourceCode" id="cb2244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2244-1"><a href="stat-reg.html#cb2244-1"></a><span class="kw">with</span>(SteelBag, <span class="kw">plot</span>(</span>
<span id="cb2244-2"><a href="stat-reg.html#cb2244-2"></a>  x, y, <span class="dt">xlab=</span><span class="st">&quot;使用次数&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;钢包容积&quot;</span>,</span>
<span id="cb2244-3"><a href="stat-reg.html#cb2244-3"></a>  <span class="dt">main=</span><span class="st">&quot;线性和非线性回归&quot;</span></span>
<span id="cb2244-4"><a href="stat-reg.html#cb2244-4"></a>))</span>
<span id="cb2244-5"><a href="stat-reg.html#cb2244-5"></a><span class="kw">abline</span>(lmsb1, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb2244-6"><a href="stat-reg.html#cb2244-6"></a><span class="kw">curve</span>(<span class="dv">1</span><span class="op">/</span>(<span class="fl">0.008967</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.0008292</span><span class="op">/</span>x), <span class="dv">1</span>, <span class="dv">20</span>,</span>
<span id="cb2244-7"><a href="stat-reg.html#cb2244-7"></a>      <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</span>
<span id="cb2244-8"><a href="stat-reg.html#cb2244-8"></a><span class="kw">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">2</span>, </span>
<span id="cb2244-9"><a href="stat-reg.html#cb2244-9"></a>       <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>),</span>
<span id="cb2244-10"><a href="stat-reg.html#cb2244-10"></a>       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;线性回归&quot;</span>, <span class="st">&quot;曲线回归&quot;</span>))</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-sb09-1.png" width="672" /></p>
<p>考虑Reynolds, Inc.销售业绩数据分析问题。
Reynolds, Inc.是一个工业和试验室量具厂商。
为研究销售业务员的业绩，
考察业务员从业年限(Months, 单位：月)与其销售的电子量具数量(Sales)的关系。
随机抽查了15名业务员。</p>
<div class="sourceCode" id="cb2245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2245-1"><a href="stat-reg.html#cb2245-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(Reynolds)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Months</th>
<th align="right">Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">41</td>
<td align="right">275</td>
</tr>
<tr class="even">
<td align="right">106</td>
<td align="right">296</td>
</tr>
<tr class="odd">
<td align="right">76</td>
<td align="right">317</td>
</tr>
<tr class="even">
<td align="right">104</td>
<td align="right">376</td>
</tr>
<tr class="odd">
<td align="right">22</td>
<td align="right">162</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">150</td>
</tr>
<tr class="odd">
<td align="right">85</td>
<td align="right">367</td>
</tr>
<tr class="even">
<td align="right">111</td>
<td align="right">308</td>
</tr>
<tr class="odd">
<td align="right">40</td>
<td align="right">189</td>
</tr>
<tr class="even">
<td align="right">51</td>
<td align="right">235</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">83</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">67</td>
</tr>
<tr class="even">
<td align="right">56</td>
<td align="right">325</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">189</td>
</tr>
</tbody>
</table>
<p>散点图：</p>
<div class="sourceCode" id="cb2246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2246-1"><a href="stat-reg.html#cb2246-1"></a><span class="kw">with</span>(Reynolds, <span class="kw">plot</span>(Months, Sales))</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-re02-1.png" width="672" /></p>
<p>散点图呈现非线性。</p>
<p>用线性近似：</p>
<div class="sourceCode" id="cb2247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2247-1"><a href="stat-reg.html#cb2247-1"></a>lmre1 &lt;-<span class="st"> </span><span class="kw">lm</span>(Sales <span class="op">~</span><span class="st"> </span>Months, <span class="dt">data=</span>Reynolds)</span>
<span id="cb2247-2"><a href="stat-reg.html#cb2247-2"></a><span class="kw">summary</span>(lmre1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sales ~ Months, data = Reynolds)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -67.166 -38.684   2.557  28.875  80.673 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 111.2279    21.6280   5.143 0.000189 ***
## Months        2.3768     0.3489   6.812 1.24e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 49.52 on 13 degrees of freedom
## Multiple R-squared:  0.7812, Adjusted R-squared:  0.7643 
## F-statistic: 46.41 on 1 and 13 DF,  p-value: 1.239e-05</code></pre>
<p>结果显著。
<span class="math inline">\(R^2=0.78\)</span>。
拟合图：</p>
<div class="sourceCode" id="cb2249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2249-1"><a href="stat-reg.html#cb2249-1"></a><span class="kw">with</span>(Reynolds, <span class="kw">plot</span>(Months, Sales, <span class="dt">main=</span><span class="st">&quot;线性近似&quot;</span>))</span>
<span id="cb2249-2"><a href="stat-reg.html#cb2249-2"></a><span class="kw">abline</span>(lmre1, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-re04-1.png" width="672" /></p>
<p>残差诊断：</p>
<div class="sourceCode" id="cb2250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2250-1"><a href="stat-reg.html#cb2250-1"></a><span class="kw">plot</span>(lmre1, <span class="dt">which=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-re05-1.png" width="672" /></p>
<p>残差图有明显的非线性。</p>
<p>考虑最简单的非线性模型：
<span class="math display">\[
y = \beta_0 + \beta_1 x + \beta_2 x^2 + \varepsilon
\]</span>
令<span class="math inline">\(x_1 = x\)</span>, <span class="math inline">\(x_2=x^2\)</span>，有
<span class="math display">\[
y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \varepsilon
\]</span>
是二元线性回归模型。
作二次多项式回归：</p>
<div class="sourceCode" id="cb2251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2251-1"><a href="stat-reg.html#cb2251-1"></a>lmre2 &lt;-<span class="st"> </span><span class="kw">lm</span>(Sales <span class="op">~</span><span class="st"> </span>Months <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(Months<span class="op">^</span><span class="dv">2</span>), <span class="dt">data=</span>Reynolds)</span>
<span id="cb2251-2"><a href="stat-reg.html#cb2251-2"></a><span class="kw">summary</span>(lmre2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sales ~ Months + I(Months^2), data = Reynolds)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -54.963 -16.691  -6.242  31.996  43.789 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 45.347579  22.774654   1.991  0.06973 .  
## Months       6.344807   1.057851   5.998 6.24e-05 ***
## I(Months^2) -0.034486   0.008948  -3.854  0.00229 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 34.45 on 12 degrees of freedom
## Multiple R-squared:  0.9022, Adjusted R-squared:  0.8859 
## F-statistic: 55.36 on 2 and 12 DF,  p-value: 8.746e-07</code></pre>
<p>模型显著。
<span class="math inline">\(R^2\)</span>从线性近似的0.78提高到0.90。
<span class="math inline">\(x^2\)</span>项的系数的显著性检验p值为0.002，显著不等于零，
说明二次项是必要的。</p>
<p>这样添加二次项容易造成<span class="math inline">\(x\)</span>与<span class="math inline">\(x^2\)</span>之间的共线性，
所以添加中心化的二次项：
<span class="math display">\[x_2 = (x - 60)^2\]</span></p>
<div class="sourceCode" id="cb2253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2253-1"><a href="stat-reg.html#cb2253-1"></a>lmre3 &lt;-<span class="st"> </span><span class="kw">lm</span>(Sales <span class="op">~</span><span class="st"> </span>Months <span class="op">+</span><span class="st"> </span><span class="kw">I</span>((Months<span class="dv">-60</span>)<span class="op">^</span><span class="dv">2</span>), <span class="dt">data=</span>Reynolds)</span>
<span id="cb2253-2"><a href="stat-reg.html#cb2253-2"></a><span class="kw">summary</span>(lmre3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sales ~ Months + I((Months - 60)^2), data = Reynolds)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -54.963 -16.691  -6.242  31.996  43.789 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        169.495742  21.331978   7.946 4.03e-06 ***
## Months               2.206535   0.246744   8.943 1.18e-06 ***
## I((Months - 60)^2)  -0.034486   0.008948  -3.854  0.00229 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 34.45 on 12 degrees of freedom
## Multiple R-squared:  0.9022, Adjusted R-squared:  0.8859 
## F-statistic: 55.36 on 2 and 12 DF,  p-value: 8.746e-07</code></pre>
<div class="sourceCode" id="cb2255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2255-1"><a href="stat-reg.html#cb2255-1"></a><span class="kw">with</span>(Reynolds, <span class="kw">plot</span>(Months, Sales, <span class="dt">main=</span><span class="st">&quot;线性和非线性回归&quot;</span>))</span>
<span id="cb2255-2"><a href="stat-reg.html#cb2255-2"></a><span class="kw">abline</span>(lmre1, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb2255-3"><a href="stat-reg.html#cb2255-3"></a><span class="kw">curve</span>(<span class="fl">196.50</span> <span class="op">+</span><span class="st"> </span><span class="fl">2.2065</span><span class="op">*</span>x <span class="op">-</span><span class="st"> </span><span class="fl">0.03449</span><span class="op">*</span>(x<span class="dv">-60</span>)<span class="op">^</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">110</span>, </span>
<span id="cb2255-4"><a href="stat-reg.html#cb2255-4"></a>      <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</span>
<span id="cb2255-5"><a href="stat-reg.html#cb2255-5"></a><span class="kw">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">2</span>, </span>
<span id="cb2255-6"><a href="stat-reg.html#cb2255-6"></a>       <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>),</span>
<span id="cb2255-7"><a href="stat-reg.html#cb2255-7"></a>       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;线性回归&quot;</span>, <span class="st">&quot;曲线回归&quot;</span>))</span></code></pre></div>
<p><img src="static/picture/stat-base-reg-regmu-curve-re08-1.png" width="672" /></p>
</div>
<div id="stat-base-reg-regmu-group" class="section level3">
<h3><span class="header-section-number">32.3.14</span> 分组建立多个模型</h3>
<p>有时希望将数据按照一个或者几个分类变量分组，
每一组分别建立模型，
并将模型结果统一列表比较。
<code>broom</code>包可以用来将模型结果转换成规范的数据框格式。</p>
<p>以肺癌病人数据为例，
建立<code>v1</code>对<code>v0</code>和<code>age</code>的多元线性回归模型：</p>
<div class="sourceCode" id="cb2256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2256-1"><a href="stat-reg.html#cb2256-1"></a><span class="kw">print</span>(d.cancer)</span></code></pre></div>
<pre><code>## # A tibble: 34 x 6
##       id   age sex   type     v0     v1
##    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     1    70 F     腺癌   26.5   2.91
##  2     2    70 F     腺癌  135.   35.1 
##  3     3    69 F     腺癌  210.   74.4 
##  4     4    68 M     腺癌   61    35.0 
##  5     5    67 M     鳞癌  238.  128.  
##  6     6    75 F     腺癌  330.  112.  
##  7     7    52 M     鳞癌  105.   32.1 
##  8     8    71 M     鳞癌   85.2  29.2 
##  9     9    68 M     鳞癌  102.   22.2 
## 10    10    79 M     鳞癌   65.5  21.9 
## # ... with 24 more rows</code></pre>
<div class="sourceCode" id="cb2258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2258-1"><a href="stat-reg.html#cb2258-1"></a>lmgr01 &lt;-<span class="st"> </span><span class="kw">lm</span>(v1 <span class="op">~</span><span class="st"> </span>v0 <span class="op">+</span><span class="st"> </span>age, <span class="dt">data =</span> d.cancer)</span>
<span id="cb2258-2"><a href="stat-reg.html#cb2258-2"></a><span class="kw">summary</span>(lmgr01)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = v1 ~ v0 + age, data = d.cancer)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -42.757 -11.010  -2.475  11.907  52.941 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.90818   33.14895   0.239    0.814    
## v0           0.43288    0.05564   7.780 1.79e-07 ***
## age         -0.12846    0.53511  -0.240    0.813    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21.76 on 20 degrees of freedom
##   (11 observations deleted due to missingness)
## Multiple R-squared:  0.7683, Adjusted R-squared:  0.7451 
## F-statistic: 33.16 on 2 and 20 DF,  p-value: 4.463e-07</code></pre>
<p>用broom包的<code>tidy()</code>函数可以将系数估计结果转换成合适的tibble数据框格式:</p>
<div class="sourceCode" id="cb2260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2260-1"><a href="stat-reg.html#cb2260-1"></a><span class="kw">library</span>(broom)</span></code></pre></div>
<pre><code>## Warning: 程辑包&#39;broom&#39;是用R版本3.6.3 来建造的</code></pre>
<div class="sourceCode" id="cb2262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2262-1"><a href="stat-reg.html#cb2262-1"></a><span class="kw">tidy</span>(lmgr01)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term        estimate std.error statistic     p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 (Intercept)    7.91    33.1        0.239 0.814      
## 2 v0             0.433    0.0556     7.78  0.000000179
## 3 age           -0.128    0.535     -0.240 0.813</code></pre>
<p>用broom包的<code>augment()</code>函数可以获得拟合值、残差等每个观测的回归结果：</p>
<div class="sourceCode" id="cb2264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2264-1"><a href="stat-reg.html#cb2264-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">augment</span>(lmgr01), <span class="dt">digits=</span><span class="dv">2</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">.rownames</th>
<th align="right">v1</th>
<th align="right">v0</th>
<th align="right">age</th>
<th align="right">.fitted</th>
<th align="right">.se.fit</th>
<th align="right">.resid</th>
<th align="right">.hat</th>
<th align="right">.sigma</th>
<th align="right">.cooksd</th>
<th align="right">.std.resid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">2.91</td>
<td align="right">26.51</td>
<td align="right">70</td>
<td align="right">10.39</td>
<td align="right">7.92</td>
<td align="right">-7.48</td>
<td align="right">0.13</td>
<td align="right">22.25</td>
<td align="right">0.01</td>
<td align="right">-0.37</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">35.08</td>
<td align="right">135.48</td>
<td align="right">70</td>
<td align="right">57.56</td>
<td align="right">5.43</td>
<td align="right">-22.48</td>
<td align="right">0.06</td>
<td align="right">21.68</td>
<td align="right">0.03</td>
<td align="right">-1.07</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">74.44</td>
<td align="right">209.74</td>
<td align="right">69</td>
<td align="right">89.84</td>
<td align="right">6.92</td>
<td align="right">-15.40</td>
<td align="right">0.10</td>
<td align="right">22.01</td>
<td align="right">0.02</td>
<td align="right">-0.75</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">34.97</td>
<td align="right">61.00</td>
<td align="right">68</td>
<td align="right">25.58</td>
<td align="right">6.06</td>
<td align="right">9.39</td>
<td align="right">0.08</td>
<td align="right">22.21</td>
<td align="right">0.01</td>
<td align="right">0.45</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">128.34</td>
<td align="right">237.75</td>
<td align="right">67</td>
<td align="right">102.22</td>
<td align="right">8.06</td>
<td align="right">26.12</td>
<td align="right">0.14</td>
<td align="right">21.37</td>
<td align="right">0.09</td>
<td align="right">1.29</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">112.34</td>
<td align="right">330.24</td>
<td align="right">75</td>
<td align="right">141.23</td>
<td align="right">12.50</td>
<td align="right">-28.89</td>
<td align="right">0.33</td>
<td align="right">20.81</td>
<td align="right">0.43</td>
<td align="right">-1.62</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">32.10</td>
<td align="right">104.90</td>
<td align="right">52</td>
<td align="right">46.64</td>
<td align="right">7.83</td>
<td align="right">-14.54</td>
<td align="right">0.13</td>
<td align="right">22.04</td>
<td align="right">0.03</td>
<td align="right">-0.72</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="right">29.15</td>
<td align="right">85.15</td>
<td align="right">71</td>
<td align="right">35.65</td>
<td align="right">6.31</td>
<td align="right">-6.50</td>
<td align="right">0.08</td>
<td align="right">22.27</td>
<td align="right">0.00</td>
<td align="right">-0.31</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="right">22.15</td>
<td align="right">101.65</td>
<td align="right">68</td>
<td align="right">43.18</td>
<td align="right">5.10</td>
<td align="right">-21.03</td>
<td align="right">0.05</td>
<td align="right">21.77</td>
<td align="right">0.02</td>
<td align="right">-0.99</td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="right">21.94</td>
<td align="right">65.54</td>
<td align="right">79</td>
<td align="right">26.13</td>
<td align="right">10.19</td>
<td align="right">-4.19</td>
<td align="right">0.22</td>
<td align="right">22.30</td>
<td align="right">0.00</td>
<td align="right">-0.22</td>
</tr>
<tr class="odd">
<td align="left">11</td>
<td align="right">12.33</td>
<td align="right">125.31</td>
<td align="right">55</td>
<td align="right">55.09</td>
<td align="right">6.88</td>
<td align="right">-42.76</td>
<td align="right">0.10</td>
<td align="right">19.79</td>
<td align="right">0.16</td>
<td align="right">-2.07</td>
</tr>
<tr class="even">
<td align="left">12</td>
<td align="right">99.44</td>
<td align="right">224.36</td>
<td align="right">54</td>
<td align="right">98.09</td>
<td align="right">10.54</td>
<td align="right">1.35</td>
<td align="right">0.23</td>
<td align="right">22.32</td>
<td align="right">0.00</td>
<td align="right">0.07</td>
</tr>
<tr class="odd">
<td align="left">13</td>
<td align="right">2.30</td>
<td align="right">12.93</td>
<td align="right">55</td>
<td align="right">6.44</td>
<td align="right">7.58</td>
<td align="right">-4.14</td>
<td align="right">0.12</td>
<td align="right">22.30</td>
<td align="right">0.00</td>
<td align="right">-0.20</td>
</tr>
<tr class="even">
<td align="left">14</td>
<td align="right">23.96</td>
<td align="right">40.21</td>
<td align="right">75</td>
<td align="right">15.68</td>
<td align="right">9.24</td>
<td align="right">8.28</td>
<td align="right">0.18</td>
<td align="right">22.23</td>
<td align="right">0.01</td>
<td align="right">0.42</td>
</tr>
<tr class="odd">
<td align="left">15</td>
<td align="right">7.39</td>
<td align="right">12.58</td>
<td align="right">61</td>
<td align="right">5.52</td>
<td align="right">6.93</td>
<td align="right">1.87</td>
<td align="right">0.10</td>
<td align="right">22.32</td>
<td align="right">0.00</td>
<td align="right">0.09</td>
</tr>
<tr class="even">
<td align="left">16</td>
<td align="right">112.58</td>
<td align="right">231.04</td>
<td align="right">76</td>
<td align="right">98.16</td>
<td align="right">8.81</td>
<td align="right">14.42</td>
<td align="right">0.16</td>
<td align="right">22.03</td>
<td align="right">0.03</td>
<td align="right">0.72</td>
</tr>
<tr class="odd">
<td align="left">17</td>
<td align="right">91.62</td>
<td align="right">172.13</td>
<td align="right">65</td>
<td align="right">74.07</td>
<td align="right">5.57</td>
<td align="right">17.55</td>
<td align="right">0.07</td>
<td align="right">21.93</td>
<td align="right">0.02</td>
<td align="right">0.83</td>
</tr>
<tr class="even">
<td align="left">18</td>
<td align="right">13.95</td>
<td align="right">39.26</td>
<td align="right">66</td>
<td align="right">16.42</td>
<td align="right">6.37</td>
<td align="right">-2.47</td>
<td align="right">0.09</td>
<td align="right">22.32</td>
<td align="right">0.00</td>
<td align="right">-0.12</td>
</tr>
<tr class="odd">
<td align="left">20</td>
<td align="right">122.45</td>
<td align="right">161.00</td>
<td align="right">63</td>
<td align="right">69.51</td>
<td align="right">5.43</td>
<td align="right">52.94</td>
<td align="right">0.06</td>
<td align="right">18.47</td>
<td align="right">0.14</td>
<td align="right">2.51</td>
</tr>
<tr class="even">
<td align="left">21</td>
<td align="right">68.35</td>
<td align="right">105.26</td>
<td align="right">67</td>
<td align="right">44.87</td>
<td align="right">4.84</td>
<td align="right">23.48</td>
<td align="right">0.05</td>
<td align="right">21.63</td>
<td align="right">0.02</td>
<td align="right">1.11</td>
</tr>
<tr class="odd">
<td align="left">22</td>
<td align="right">5.25</td>
<td align="right">13.25</td>
<td align="right">51</td>
<td align="right">7.09</td>
<td align="right">8.67</td>
<td align="right">-1.84</td>
<td align="right">0.16</td>
<td align="right">22.32</td>
<td align="right">0.00</td>
<td align="right">-0.09</td>
</tr>
<tr class="even">
<td align="left">23</td>
<td align="right">3.34</td>
<td align="right">18.70</td>
<td align="right">49</td>
<td align="right">9.71</td>
<td align="right">9.27</td>
<td align="right">-6.37</td>
<td align="right">0.18</td>
<td align="right">22.27</td>
<td align="right">0.01</td>
<td align="right">-0.32</td>
</tr>
<tr class="odd">
<td align="left">24</td>
<td align="right">50.36</td>
<td align="right">60.23</td>
<td align="right">49</td>
<td align="right">27.69</td>
<td align="right">8.91</td>
<td align="right">22.67</td>
<td align="right">0.17</td>
<td align="right">21.59</td>
<td align="right">0.09</td>
<td align="right">1.14</td>
</tr>
</tbody>
</table>
<p>用broom包的<code>glance()</code>函数可以将回归的复相关系数平方、F检验p值等整体结果做成一行的数据框：</p>
<div class="sourceCode" id="cb2265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2265-1"><a href="stat-reg.html#cb2265-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">glance</span>(lmgr01), <span class="dt">digits=</span><span class="dv">2</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">r.squared</th>
<th align="right">adj.r.squared</th>
<th align="right">sigma</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">df</th>
<th align="right">logLik</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
<th align="right">deviance</th>
<th align="right">df.residual</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.77</td>
<td align="right">0.75</td>
<td align="right">21.76</td>
<td align="right">33.16</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">-101.87</td>
<td align="right">211.74</td>
<td align="right">216.28</td>
<td align="right">9470.34</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<p>下面将男病人与女病人分别建模，
并以表格形式合并分组的建模结果。
用dplyr包的<code>group_by()</code>函数分组，
用tidyr包的<code>nest()</code>函数可以将分组后的数据框转换成一个新的数据框，
新数据框中有一列是列表类型，
每个元素是一个子数据框：</p>
<div class="sourceCode" id="cb2266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2266-1"><a href="stat-reg.html#cb2266-1"></a>d.cancer <span class="op">%&gt;%</span></span>
<span id="cb2266-2"><a href="stat-reg.html#cb2266-2"></a><span class="st">  </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></span>
<span id="cb2266-3"><a href="stat-reg.html#cb2266-3"></a><span class="st">  </span><span class="kw">nest</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
## # Groups:   sex [2]
##   sex   data             
##   &lt;chr&gt; &lt;list&gt;           
## 1 F     &lt;tibble [13 x 5]&gt;
## 2 M     &lt;tibble [21 x 5]&gt;</code></pre>
<p>这样，
可以用<code>purr::map()</code>函数对每一组分别建模，
建模结果可以借助broom包制作成合适的数据框格式，
然后用<code>unnest()</code>函数将不同组的结果合并成一个大数据框，如：</p>
<div class="sourceCode" id="cb2268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2268-1"><a href="stat-reg.html#cb2268-1"></a>d.cancer <span class="op">%&gt;%</span></span>
<span id="cb2268-2"><a href="stat-reg.html#cb2268-2"></a><span class="st">  </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span></span>
<span id="cb2268-3"><a href="stat-reg.html#cb2268-3"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb2268-4"><a href="stat-reg.html#cb2268-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map</span>(data, <span class="cf">function</span>(df) <span class="kw">summary</span>(<span class="kw">lm</span>(v1 <span class="op">~</span><span class="st"> </span>v0 <span class="op">+</span><span class="st"> </span>age, <span class="dt">data=</span>df))),</span>
<span id="cb2268-5"><a href="stat-reg.html#cb2268-5"></a>         <span class="dt">tidied =</span> <span class="kw">map</span>(model, tidy)) <span class="op">%&gt;%</span></span>
<span id="cb2268-6"><a href="stat-reg.html#cb2268-6"></a><span class="st">  </span><span class="kw">unnest</span>(tidied, <span class="dt">.drop =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning: The `.drop` argument of `unnest()` is deprecated as of tidyr 1.0.0.
## All list-columns are now preserved.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## # A tibble: 6 x 8
## # Groups:   sex [2]
##   sex   data           model    term      estimate std.error statistic   p.value
##   &lt;chr&gt; &lt;list&gt;         &lt;list&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 F     &lt;tibble [13 x~ &lt;smmry.~ (Interce~  171.     147.         1.16    3.10e-1
## 2 F     &lt;tibble [13 x~ &lt;smmry.~ v0           0.485    0.136      3.56    2.35e-2
## 3 F     &lt;tibble [13 x~ &lt;smmry.~ age         -2.74     2.39      -1.15    3.16e-1
## 4 M     &lt;tibble [21 x~ &lt;smmry.~ (Interce~  -17.2     30.5       -0.563   5.83e-1
## 5 M     &lt;tibble [21 x~ &lt;smmry.~ v0           0.486    0.0657     7.39    5.28e-6
## 6 M     &lt;tibble [21 x~ &lt;smmry.~ age          0.204    0.484      0.421   6.81e-1</code></pre>
<p>当需要分组拟合许多个模型时，
这种方法比较方便。</p>
</div>
</div>
<div id="stat-base-reg-npar" class="section level2">
<h2><span class="header-section-number">32.4</span> 非参数回归</h2>
<div id="stat-base-reg-npar-mod" class="section level3">
<h3><span class="header-section-number">32.4.1</span> 模型</h3>
<p>线性回归模型可以看成非线性回归模型的特例:
<span class="math display">\[Y = f(X) + \varepsilon\]</span>
其中<span class="math inline">\(f(x)\)</span>为未知的回归函数。</p>
<p>参数方法：假定<span class="math inline">\(f(x)\)</span>具有某种形式，如</p>
<ul>
<li><span class="math inline">\(f(x) = a + b x\)</span>: 线性回归；</li>
<li><span class="math inline">\(f(x) = a + b x + c x^2\)</span>:　二次多项式回归；</li>
<li><span class="math inline">\(f(x) = A e^{bx}\)</span>: 指数模型，等等。</li>
</ul>
<p>二次多项式回归可以令<span class="math inline">\(X_1 = x, X_2 = x^2\)</span>， 变成二元回归模型来解决。
指数模型可以令<span class="math inline">\(z = \ln Y\)</span>, 模型化为<span class="math inline">\(z = a + bx\)</span>。
有一些曲线模型可以通过变换化为线性回归。</p>
<p>在多元情形，
一般的非线性回归模型为
<span class="math display">\[
Y = f(x_1, x_2, \dots, x_p) + \varepsilon
\]</span>
但是这样可选的模型就过于复杂，
难以把握。
比较简单的是不考虑变量之间交互作用的可加模型：</p>
<p><span class="math display">\[
Y = \sum_{j=1}^p f_j(x_j) + \varepsilon
\]</span>
其中<span class="math inline">\(f_j(\cdot)\)</span>是未知的回归函数，
需要满足一定的光滑性条件。</p>
<p><span class="math inline">\(f_j(\cdot)\)</span>可以是参数形式的，
比如二次多项式、三次多项式、阶梯函数等。
较好的一种选择是使用三次样条函数。</p>
</div>
<div id="stat-base-reg-cfit-spl1d" class="section level3">
<h3><span class="header-section-number">32.4.2</span> 样条平滑</h3>
<p>为了得到一般性的<span class="math inline">\(Y\)</span>与<span class="math inline">\(X\)</span>的曲线关系<span class="math inline">\(f(x)\)</span>的估计，
可以使用样条函数。
三次样条函数将实数轴用若干个<strong>节点</strong>(knots) <span class="math inline">\(\{ z_k \}\)</span>分成几段，
每一段上<span class="math inline">\(\hat f(x)\)</span>为三次多项式，
函数在节点处有连续的二阶导数。
样条函数是光滑的分段三次多项式。</p>
<p>用样条函数估计<span class="math inline">\(f(x)\)</span>的准则是曲线接近各观测值点
<span class="math inline">\((x_i, y_i)\)</span>，同时曲线足够光滑。</p>
<p>在R中用<code>smooth.spline</code>函数进行样条曲线拟合。
取每个自变量<span class="math inline">\(x_i\)</span>处为一个节点，
对于给定的某个光滑度/模型复杂度系数值<span class="math inline">\(\lambda\)</span>，
求函数<span class="math inline">\(f(x)\)</span>使得
<span class="math display">\[
\min_{f(\cdot)}
\left\{
\sum_i [y_i - f(x_i)]^2 + \lambda \int [f&#39;&#39;(x)]^2 \,dx
\right\}
\]</span>
<span class="math inline">\(\lambda\)</span>越大，
所得的曲线越光滑。
<code>smooth.spline()</code>函数可以通过交叉验证方法自动取得一个对于预测最优的光滑参数<span class="math inline">\(\lambda\)</span>值，
也可以通过<code>df=</code>选项指定一个等效自由度，
等效自由度越大，
模型越复杂，
曲线光滑程度越低。
<code>df</code>值相当于多元线性回归中的自变量个数。</p>
<p>如</p>
<div class="sourceCode" id="cb2271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2271-1"><a href="stat-reg.html#cb2271-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2271-2"><a href="stat-reg.html#cb2271-2"></a>nsamp &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb2271-3"><a href="stat-reg.html#cb2271-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(nsamp, <span class="dv">-10</span>, <span class="dv">10</span>)</span>
<span id="cb2271-4"><a href="stat-reg.html#cb2271-4"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dt">length.out=</span><span class="dv">100</span>)</span>
<span id="cb2271-5"><a href="stat-reg.html#cb2271-5"></a>x &lt;-<span class="st"> </span><span class="kw">sort</span>(x)</span>
<span id="cb2271-6"><a href="stat-reg.html#cb2271-6"></a>y &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">*</span><span class="kw">sin</span>(x<span class="op">/</span><span class="dv">10</span><span class="op">*</span>pi)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="fl">0.3</span>)</span>
<span id="cb2271-7"><a href="stat-reg.html#cb2271-7"></a><span class="kw">plot</span>(x, y)</span>
<span id="cb2271-8"><a href="stat-reg.html#cb2271-8"></a><span class="kw">curve</span>(<span class="dv">10</span><span class="op">*</span><span class="kw">sin</span>(x<span class="op">/</span><span class="dv">10</span><span class="op">*</span>pi)<span class="op">^</span><span class="dv">2</span>, <span class="dv">-10</span>, <span class="dv">10</span>, <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb2271-9"><a href="stat-reg.html#cb2271-9"></a></span>
<span id="cb2271-10"><a href="stat-reg.html#cb2271-10"></a><span class="kw">library</span>(splines)</span>
<span id="cb2271-11"><a href="stat-reg.html#cb2271-11"></a>res &lt;-<span class="st"> </span><span class="kw">smooth.spline</span>(x, y)</span>
<span id="cb2271-12"><a href="stat-reg.html#cb2271-12"></a><span class="kw">lines</span>(<span class="kw">spline</span>(x, res<span class="op">$</span>y), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb2271-13"><a href="stat-reg.html#cb2271-13"></a>res2 &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">degree=</span><span class="dv">2</span>, <span class="dt">span=</span><span class="fl">0.3</span>)</span>
<span id="cb2271-14"><a href="stat-reg.html#cb2271-14"></a><span class="kw">lines</span>(xx, <span class="kw">predict</span>(res2, <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">x=</span>xx)), </span>
<span id="cb2271-15"><a href="stat-reg.html#cb2271-15"></a>      <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb2271-16"><a href="stat-reg.html#cb2271-16"></a><span class="kw">legend</span>(<span class="st">&quot;top&quot;</span>, <span class="dt">lwd=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb2271-17"><a href="stat-reg.html#cb2271-17"></a>       <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb2271-18"><a href="stat-reg.html#cb2271-18"></a>       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;真实函数关系&quot;</span>, <span class="st">&quot;样条平滑结果&quot;</span>, <span class="st">&quot;局部线性拟合&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-cfit-examp01"></span>
<img src="static/picture/stat-base-reg-cfit-examp01-1.png" alt="曲线平滑示例" width="672" />
<p class="caption">
图32.11: 曲线平滑示例
</p>
</div>
<p>其中res的元素y为拟合值，用<code>spline(x,y)</code>从一组散点输出
光滑曲线以便用<code>lines()</code>函数绘图。</p>
<p>R函数<code>splines(x,y)</code>不是做样条平滑，
而是做样条插值，
其结果是在原始的自变量<code>x</code>范围内产生等间隔距离的格子点值，
输出包含格子点上的样条插值<code>x</code>和<code>y</code>坐标的列表。
样条平滑曲线不需要穿过输入的各个散点，
但是插值则需要穿过输入的各个散点。</p>
<p>R函数<code>approx(x,y)</code>用线性插值方法产生线性插值后的连续函数在等间隔的横坐标上的坐标值。</p>
</div>
<div id="stat-base-reg-cfit-loess" class="section level3">
<h3><span class="header-section-number">32.4.3</span> 局部多项式曲线平滑</h3>
<p>另一种非参数的拟合非线性回归曲线<span class="math inline">\(f(x)\)</span>的方法是对每个自变量<span class="math inline">\(x\)</span>
处选一个局部的小邻域，
用这个小邻域附近的<span class="math inline">\((x_i, y_i)\)</span>点拟合一个局部的零次、一次或二次多项式，
用拟合的局部多项式在<span class="math inline">\(x\)</span>处的值作为回归函数在<span class="math inline">\(x\)</span>处的值的估计。</p>
<p>局部零次多项式的方法叫做核回归，
公式为
<span class="math display">\[
\hat f(x) 
= \frac{\sum\limits_{i = 1}^n {K\left( {\frac{{x - X_i }}{h}} \right)Y_i } }
{\sum\limits_{i = 1}^n {K\left( {\frac{{x - X_i }}{h}} \right)} } 
\]</span>
其中<span class="math inline">\(K(\cdot)\)</span>称为核函数，
是类似标准正态密度这样的中间高两边低的可以用来加权的函数，
比如，
双三次核函数：
<span class="math display">\[
K(x) = \left\{ {\begin{array}{*{20}c}
   {\left( {1 - \left| x \right|^3 } \right)^3 } &amp; {\left| x \right| \leq 1}  \\
   0 &amp; \mbox{其它}  \\
\end{array}} \right.
\]</span></p>
<div class="sourceCode" id="cb2272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2272-1"><a href="stat-reg.html#cb2272-1"></a>kernel.dcube &lt;-<span class="st"> </span><span class="cf">function</span>(u){</span>
<span id="cb2272-2"><a href="stat-reg.html#cb2272-2"></a>  y &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(u))</span>
<span id="cb2272-3"><a href="stat-reg.html#cb2272-3"></a>  sele &lt;-<span class="st"> </span>(<span class="kw">abs</span>(u) <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb2272-4"><a href="stat-reg.html#cb2272-4"></a>  y[sele] &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">abs</span>(u[sele])<span class="op">^</span><span class="dv">3</span>)<span class="op">^</span><span class="dv">3</span></span>
<span id="cb2272-5"><a href="stat-reg.html#cb2272-5"></a>  y</span>
<span id="cb2272-6"><a href="stat-reg.html#cb2272-6"></a>}</span>
<span id="cb2272-7"><a href="stat-reg.html#cb2272-7"></a><span class="kw">curve</span>(kernel.dcube, <span class="fl">-1.5</span>, <span class="fl">1.5</span>, <span class="dt">main=</span><span class="st">&quot;双三次核函数&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-cfit-loess-dcube01"></span>
<img src="static/picture/stat-base-reg-cfit-loess-dcube01-1.png" alt="双三次核函数" width="672" />
<p class="caption">
图32.12: 双三次核函数
</p>
</div>
<p>参数<span class="math inline">\(h\)</span>称为窗宽，
<span class="math inline">\(h\)</span>越大，参与平均的点越多，
曲线越光滑，
回归复杂度越低。
<span class="math inline">\(h\)</span>选取可以用交叉验证方法。</p>
<p>R扩展包KernSmooth的函数
<code>locpoly(x, y, degree=1, bandwidth=0.25)</code>可以计算核回归，
其中<code>bandwidth</code>是输入的窗宽，
函数<code>dpill(x,y)</code>可以帮助确定窗宽。
如
<code>locpoly(x, y, degree=1, bandwidth=dpill(x,y))</code>。
stats包的<code>ksmooth()</code>函数也可以计算核回归。</p>
<p>当局部拟合的是一次或者二次多项式时，
这种曲线拟合方法叫做局部多项式回归。
R函数<code>loess(y ~ x, degree=1, span=0.75)</code>拟合局部线性函数，
用<code>span=</code>控制结果的光滑度，
<code>span</code>是局部拟合所用的点的比例，
越接近于1结果越光滑。
取<code>degree=2</code>拟合局部二次多项式函数。
见图<a href="stat-reg.html#fig:stat-base-reg-cfit-examp01">32.11</a>。</p>
</div>
<div id="stat-base-reg-cfit-bs" class="section level3">
<h3><span class="header-section-number">32.4.4</span> 样条函数变换</h3>
<p><span class="math inline">\(m\)</span>个节点的三次样条函数需要<span class="math inline">\(n+4\)</span>个参数，
因为每段需要<span class="math inline">\(4\)</span>个参数，
<span class="math inline">\(m+1\)</span>段需要<span class="math inline">\(4m+4\)</span>个参数，
而在<span class="math inline">\(m\)</span>个节点上连续、一阶导数连续、二阶导数连续构成三个约束条件，
所以参数个数为<span class="math inline">\(m+4\)</span>个。</p>
<p>自然样条函数假定函数在最左边一段和最右边一段为线性函数，
这样<span class="math inline">\(m\)</span>个节点需要<span class="math inline">\(m+2\)</span>个参数。
R的<code>lm()</code>函数中对自变量<code>x</code>指定<code>ns(x)</code>
可以对输入的<code>x</code>指定作自然样条变换，
<code>ns()</code>可以用<code>df=</code>指定自由度作为曲线复杂度的度量。
如</p>
<div class="sourceCode" id="cb2273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2273-1"><a href="stat-reg.html#cb2273-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2273-2"><a href="stat-reg.html#cb2273-2"></a>nsamp &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb2273-3"><a href="stat-reg.html#cb2273-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(nsamp, <span class="dv">-10</span>, <span class="dv">10</span>)</span>
<span id="cb2273-4"><a href="stat-reg.html#cb2273-4"></a>xx &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dt">length.out=</span><span class="dv">100</span>)</span>
<span id="cb2273-5"><a href="stat-reg.html#cb2273-5"></a>x &lt;-<span class="st"> </span><span class="kw">sort</span>(x)</span>
<span id="cb2273-6"><a href="stat-reg.html#cb2273-6"></a>y &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">*</span><span class="kw">sin</span>(x<span class="op">/</span><span class="dv">10</span><span class="op">*</span>pi)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(nsamp,<span class="dv">0</span>,<span class="fl">0.3</span>)</span>
<span id="cb2273-7"><a href="stat-reg.html#cb2273-7"></a><span class="kw">plot</span>(x, y)</span>
<span id="cb2273-8"><a href="stat-reg.html#cb2273-8"></a><span class="kw">curve</span>(<span class="dv">10</span><span class="op">*</span><span class="kw">sin</span>(x<span class="op">/</span><span class="dv">10</span><span class="op">*</span>pi)<span class="op">^</span><span class="dv">2</span>, <span class="dv">-10</span>, <span class="dv">10</span>, <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb2273-9"><a href="stat-reg.html#cb2273-9"></a></span>
<span id="cb2273-10"><a href="stat-reg.html#cb2273-10"></a>res &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dt">df=</span><span class="dv">4</span>))</span>
<span id="cb2273-11"><a href="stat-reg.html#cb2273-11"></a><span class="kw">lines</span>(xx, <span class="kw">predict</span>(res, <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">x=</span>xx)), </span>
<span id="cb2273-12"><a href="stat-reg.html#cb2273-12"></a>      <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb2273-13"><a href="stat-reg.html#cb2273-13"></a>res2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dt">df=</span><span class="dv">8</span>))</span>
<span id="cb2273-14"><a href="stat-reg.html#cb2273-14"></a><span class="kw">lines</span>(xx, <span class="kw">predict</span>(res2, <span class="dt">newdata=</span><span class="kw">data.frame</span>(<span class="dt">x=</span>xx)), </span>
<span id="cb2273-15"><a href="stat-reg.html#cb2273-15"></a>      <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb2273-16"><a href="stat-reg.html#cb2273-16"></a><span class="kw">legend</span>(<span class="st">&quot;top&quot;</span>, <span class="dt">lwd=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb2273-17"><a href="stat-reg.html#cb2273-17"></a>       <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb2273-18"><a href="stat-reg.html#cb2273-18"></a>       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;真实函数关系&quot;</span>, <span class="st">&quot;ns(df=4)&quot;</span>, <span class="st">&quot;ns(df=8)&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-cfit-examp02"></span>
<img src="static/picture/stat-base-reg-cfit-examp02-1.png" alt="自然样条回归示例" width="672" />
<p class="caption">
图32.13: 自然样条回归示例
</p>
</div>
<p>在多元回归中也可以用<code>ns(x)</code>对单个自变量引入非线性。</p>
</div>
<div id="stat-base-reg-cfit-gam" class="section level3">
<h3><span class="header-section-number">32.4.5</span> 线性可加模型</h3>
<p>虽然在用<code>lm()</code>作多元回归时可以用<code>ns()</code>、<code>poly()</code>等函数引入非线性成分，
但需要指定复杂度参数。
对可加模型
<span class="math display">\[
Y = \sum_{j=1}^p f_j(x_j) + \varepsilon
\]</span>
最好能从数据中自动确定<span class="math inline">\(f_j(\cdot)\)</span>的复杂度（光滑度）参数。</p>
<p>R扩展包mgcv的<code>gam()</code>函数可以执行这样的可加模型的非参数回归拟合。
模型中可以用<code>s(x)</code>指定<code>x</code>的样条平滑，
用<code>lo(x)</code>指定<code>x</code>的局部多项式平滑。
具体的计算是迭代地对每个自变量<span class="math inline">\(x_j\)</span>进行，
估计<span class="math inline">\(x_j\)</span>的平滑函数<span class="math inline">\(f_j(\cdot)\)</span>时，
采用数据<span class="math inline">\(\tilde y = Y - \sum_{k \neq j} f_k(x_k)\)</span>，
迭代估计到结果基本不变为止。</p>
<p>例如，MASS包的rock数据框是石油勘探中12块岩石样本分别产生4个切片得到的测量数据，
共48个观测，
因变量是渗透率(permeability)，
自变量为area, peri, shape。</p>
<p>先作线性回归：</p>
<div class="sourceCode" id="cb2274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2274-1"><a href="stat-reg.html#cb2274-1"></a>lm.rock &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(perm) <span class="op">~</span><span class="st"> </span>area <span class="op">+</span><span class="st"> </span>peri <span class="op">+</span><span class="st"> </span>shape, <span class="dt">data=</span>rock)</span>
<span id="cb2274-2"><a href="stat-reg.html#cb2274-2"></a><span class="kw">summary</span>(lm.rock)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(perm) ~ area + peri + shape, data = rock)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.8092 -0.5413  0.1734  0.6493  1.4788 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  5.333e+00  5.487e-01   9.720 1.59e-12 ***
## area         4.850e-04  8.657e-05   5.602 1.29e-06 ***
## peri        -1.527e-03  1.770e-04  -8.623 5.24e-11 ***
## shape        1.757e+00  1.756e+00   1.000    0.323    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8521 on 44 degrees of freedom
## Multiple R-squared:  0.7483, Adjusted R-squared:  0.7311 
## F-statistic:  43.6 on 3 and 44 DF,  p-value: 3.094e-13</code></pre>
<p>其中shape变量不显著。
可能的原因有：</p>
<ul>
<li>shape与因变量没有关系；</li>
<li>样本量不足；</li>
<li>shape与因变量之间有非线性关系，该非线性无法用线性近似。</li>
</ul>
<p>用样条平滑的<code>gam()</code>建模：</p>
<div class="sourceCode" id="cb2276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2276-1"><a href="stat-reg.html#cb2276-1"></a><span class="kw">library</span>(mgcv)</span></code></pre></div>
<pre><code>## 载入需要的程辑包：nlme</code></pre>
<pre><code>## Warning: 程辑包&#39;nlme&#39;是用R版本3.6.3 来建造的</code></pre>
<pre><code>## 
## 载入程辑包：&#39;nlme&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<pre><code>## This is mgcv 1.8-31. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<div class="sourceCode" id="cb2282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2282-1"><a href="stat-reg.html#cb2282-1"></a>gam.rock1 &lt;-<span class="st"> </span><span class="kw">gam</span>(</span>
<span id="cb2282-2"><a href="stat-reg.html#cb2282-2"></a>  <span class="kw">log</span>(perm) <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(area) <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(peri) <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(shape), <span class="dt">data=</span>rock)</span>
<span id="cb2282-3"><a href="stat-reg.html#cb2282-3"></a><span class="kw">summary</span>(gam.rock1)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## log(perm) ~ s(area) + s(peri) + s(shape)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   5.1075     0.1222   41.81   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df     F  p-value    
## s(area)  1.000  1.000 29.13 1.96e-06 ***
## s(peri)  1.000  1.000 71.30 4.12e-12 ***
## s(shape) 1.402  1.705  0.58    0.425    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.735   Deviance explained = 75.4%
## GCV = 0.78865  Scale est. = 0.71631   n = 48</code></pre>
<p>对<code>gam()</code>回归结果做单个变量的曲线拟合图：</p>
<div class="sourceCode" id="cb2284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2284-1"><a href="stat-reg.html#cb2284-1"></a><span class="kw">plot</span>(gam.rock1)</span></code></pre></div>
<div class="figure"><span id="fig:stat-base-reg-cfit-rock031"></span>
<img src="static/picture/stat-base-reg-cfit-rock03-1.png" alt="渗透率gam建模" width="672" />
<p class="caption">
图32.14: 渗透率gam建模
</p>
</div>
<div class="figure"><span id="fig:stat-base-reg-cfit-rock032"></span>
<img src="static/picture/stat-base-reg-cfit-rock03-2.png" alt="渗透率gam建模" width="672" />
<p class="caption">
图32.15: 渗透率gam建模
</p>
</div>
<div class="figure"><span id="fig:stat-base-reg-cfit-rock033"></span>
<img src="static/picture/stat-base-reg-cfit-rock03-3.png" alt="渗透率gam建模" width="672" />
<p class="caption">
图32.16: 渗透率gam建模
</p>
</div>
<p>可以看出三条曲线都基本不需要非线性。
比较两个模型：</p>
<div class="sourceCode" id="cb2285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2285-1"><a href="stat-reg.html#cb2285-1"></a><span class="kw">anova</span>(lm.rock, gam.rock1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: log(perm) ~ area + peri + shape
## Model 2: log(perm) ~ s(area) + s(peri) + s(shape)
##   Res.Df    RSS      Df Sum of Sq      F Pr(&gt;F)
## 1 44.000 31.949                                
## 2 43.598 31.230 0.40237   0.71914 2.4951  0.125</code></pre>
<p>结果也不显著，
说明线性模型是可取的。</p>
</div>
</div>
<div id="stat-base-reg-reglog" class="section level2">
<h2><span class="header-section-number">32.5</span> Logistic回归</h2>
<div id="stat-base-reg-reglog-mod" class="section level3">
<h3><span class="header-section-number">32.5.1</span> 模型</h3>
<p>当因变量<span class="math inline">\(Y\)</span>是零壹变量时，即<span class="math inline">\(Y\)</span>表示分两类的类别，取值1和0，
我们关心的是<span class="math inline">\(P(Y=1)\)</span>。这是一个<span class="math inline">\([0,1]\)</span>区间内的值。
如果把<span class="math inline">\(Y\)</span>当作一般因变量做线性回归，
会给出不合理的结果，比如负值，
另外线性回归假定误差项为正态分布在这里也不适用。</p>
<p>为此考虑广义的回归模型(广义线性模型):
<span class="math display">\[\begin{aligned}
Y \sim &amp; F(y;\theta)  \\
g(\theta) =&amp; \beta_0 + \beta_1 X_1 + \dots + \beta_p X_p
\end{aligned}\]</span></p>
<p>特别地，定义logit函数
<span class="math display">\[
\text{logit}(p) = \ln \left( \frac{p}{1-p} \right)
\]</span></p>
<p>Logit模型:
<span class="math display">\[\begin{aligned}
Y \sim&amp; b(1, p) \\
\text{logit}(p) =&amp; \beta_0 + \beta_1 X_1 + \dots + \beta_p X_p
\end{aligned}\]</span></p>
</div>
<div id="stat-base-reg-reglog-rcode" class="section level3">
<h3><span class="header-section-number">32.5.2</span> R程序</h3>
<p>进行logistic回归的R程序如<code>glm(y ~ x1 + x2, family=binomial, data=d)</code>,
其中y为取0或1的向量，输入数据集为d。</p>
<p>y也可以是一个两列的矩阵，第一列为成功数，第二列为失败数。</p>
<p>例如，“remiss.csv”中保存了癌症病人康复的数据，
变量remiss为康复与否(1为康复，0为未康复)，
另外的6个变量为可能影响康复概率的自变量。</p>
<p>程序:</p>
<div class="sourceCode" id="cb2287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2287-1"><a href="stat-reg.html#cb2287-1"></a>d.remiss &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;remiss.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</span>
<span id="cb2287-2"><a href="stat-reg.html#cb2287-2"></a>glm1 &lt;-<span class="st"> </span><span class="kw">glm</span>(</span>
<span id="cb2287-3"><a href="stat-reg.html#cb2287-3"></a>  remiss <span class="op">~</span><span class="st"> </span>cell<span class="op">+</span>smear<span class="op">+</span>infil<span class="op">+</span>li<span class="op">+</span>blast<span class="op">+</span>temp, </span>
<span id="cb2287-4"><a href="stat-reg.html#cb2287-4"></a>  <span class="dt">family=</span>binomial, <span class="dt">data=</span>d.remiss)</span>
<span id="cb2287-5"><a href="stat-reg.html#cb2287-5"></a><span class="kw">summary</span>(glm1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = remiss ~ cell + smear + infil + li + blast + temp, 
##     family = binomial, data = d.remiss)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.95165  -0.66491  -0.04372   0.74304   1.67069  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  58.0385    71.2364   0.815   0.4152  
## cell         24.6615    47.8377   0.516   0.6062  
## smear        19.2936    57.9500   0.333   0.7392  
## infil       -19.6013    61.6815  -0.318   0.7507  
## li            3.8960     2.3371   1.667   0.0955 .
## blast         0.1511     2.2786   0.066   0.9471  
## temp        -87.4339    67.5735  -1.294   0.1957  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 34.372  on 26  degrees of freedom
## Residual deviance: 21.751  on 20  degrees of freedom
## AIC: 35.751
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>以p值0.30为界限，逐步删去不显著的自变量:</p>
<div class="sourceCode" id="cb2289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2289-1"><a href="stat-reg.html#cb2289-1"></a>glm1b &lt;-<span class="st"> </span><span class="kw">glm</span>(</span>
<span id="cb2289-2"><a href="stat-reg.html#cb2289-2"></a>  remiss <span class="op">~</span><span class="st"> </span>cell <span class="op">+</span><span class="st"> </span>smear <span class="op">+</span><span class="st"> </span>infil <span class="op">+</span><span class="st"> </span>li <span class="op">+</span><span class="st"> </span>temp, </span>
<span id="cb2289-3"><a href="stat-reg.html#cb2289-3"></a>  <span class="dt">family=</span>binomial, <span class="dt">data=</span>d.remiss)</span>
<span id="cb2289-4"><a href="stat-reg.html#cb2289-4"></a><span class="kw">summary</span>(glm1b)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = remiss ~ cell + smear + infil + li + temp, family = binomial, 
##     data = d.remiss)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.93753  -0.65855  -0.04328   0.75287   1.65475  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)   57.128     69.977   0.816    0.414  
## cell          24.180     47.257   0.512    0.609  
## smear         18.370     56.218   0.327    0.744  
## infil        -18.477     59.260  -0.312    0.755  
## li             3.987      1.902   2.097    0.036 *
## temp         -86.137     64.785  -1.330    0.184  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 34.372  on 26  degrees of freedom
## Residual deviance: 21.755  on 21  degrees of freedom
## AIC: 33.755
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<div class="sourceCode" id="cb2291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2291-1"><a href="stat-reg.html#cb2291-1"></a>glm1c &lt;-<span class="st"> </span><span class="kw">glm</span>(</span>
<span id="cb2291-2"><a href="stat-reg.html#cb2291-2"></a>  remiss <span class="op">~</span><span class="st"> </span>cell <span class="op">+</span><span class="st"> </span>infil <span class="op">+</span><span class="st"> </span>li <span class="op">+</span><span class="st"> </span>temp, </span>
<span id="cb2291-3"><a href="stat-reg.html#cb2291-3"></a>  <span class="dt">family=</span>binomial, <span class="dt">data=</span>d.remiss)</span>
<span id="cb2291-4"><a href="stat-reg.html#cb2291-4"></a><span class="kw">summary</span>(glm1c)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = remiss ~ cell + infil + li + temp, family = binomial, 
##     data = d.remiss)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.88516  -0.66796  -0.07282   0.78697   1.72442  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  70.6171    59.1148   1.195   0.2323  
## cell          9.1434     7.9124   1.156   0.2479  
## infil         0.9088     3.1356   0.290   0.7719  
## li            3.9005     1.8108   2.154   0.0312 *
## temp        -85.2481    64.0897  -1.330   0.1835  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 34.372  on 26  degrees of freedom
## Residual deviance: 21.869  on 22  degrees of freedom
## AIC: 31.869
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<div class="sourceCode" id="cb2293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2293-1"><a href="stat-reg.html#cb2293-1"></a>glm1d &lt;-<span class="st"> </span><span class="kw">glm</span>(</span>
<span id="cb2293-2"><a href="stat-reg.html#cb2293-2"></a>  remiss <span class="op">~</span><span class="st"> </span>cell <span class="op">+</span><span class="st"> </span>li <span class="op">+</span><span class="st"> </span>temp, </span>
<span id="cb2293-3"><a href="stat-reg.html#cb2293-3"></a>  <span class="dt">family=</span>binomial, <span class="dt">data=</span>d.remiss)</span>
<span id="cb2293-4"><a href="stat-reg.html#cb2293-4"></a><span class="kw">summary</span>(glm1d)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = remiss ~ cell + li + temp, family = binomial, data = d.remiss)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.02043  -0.66313  -0.08323   0.81282   1.65887  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)   67.634     56.888   1.189   0.2345  
## cell           9.652      7.751   1.245   0.2130  
## li             3.867      1.778   2.175   0.0297 *
## temp         -82.074     61.712  -1.330   0.1835  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 34.372  on 26  degrees of freedom
## Residual deviance: 21.953  on 23  degrees of freedom
## AIC: 29.953
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<p>或可用逐步回归:</p>
<div class="sourceCode" id="cb2295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2295-1"><a href="stat-reg.html#cb2295-1"></a>glm2 &lt;-<span class="st"> </span><span class="kw">step</span>(<span class="kw">glm</span>(</span>
<span id="cb2295-2"><a href="stat-reg.html#cb2295-2"></a>  remiss <span class="op">~</span><span class="st"> </span>cell <span class="op">+</span><span class="st"> </span>smear <span class="op">+</span><span class="st"> </span>infil <span class="op">+</span><span class="st"> </span>li <span class="op">+</span><span class="st"> </span>blast <span class="op">+</span><span class="st"> </span>temp, </span>
<span id="cb2295-3"><a href="stat-reg.html#cb2295-3"></a>  <span class="dt">family=</span>binomial, <span class="dt">data=</span>d.remiss))</span></code></pre></div>
<pre><code>## Start:  AIC=35.75
## remiss ~ cell + smear + infil + li + blast + temp
## 
##         Df Deviance    AIC
## - blast  1   21.755 33.755
## - infil  1   21.857 33.857
## - smear  1   21.869 33.869
## - cell   1   22.071 34.071
## &lt;none&gt;       21.751 35.751
## - temp   1   23.877 35.877
## - li     1   26.095 38.095
## 
## Step:  AIC=33.76
## remiss ~ cell + smear + infil + li + temp
## 
##         Df Deviance    AIC
## - infil  1   21.858 31.858
## - smear  1   21.869 31.869
## - cell   1   22.073 32.073
## &lt;none&gt;       21.755 33.755
## - temp   1   24.198 34.199
## - li     1   30.216 40.216
## 
## Step:  AIC=31.86
## remiss ~ cell + smear + li + temp
## 
##         Df Deviance    AIC
## - smear  1   21.953 29.953
## &lt;none&gt;       21.858 31.858
## - temp   1   24.292 32.292
## - cell   1   24.477 32.477
## - li     1   30.434 38.434
## 
## Step:  AIC=29.95
## remiss ~ cell + li + temp
## 
##        Df Deviance    AIC
## &lt;none&gt;      21.953 29.953
## - temp  1   24.341 30.341
## - cell  1   24.648 30.648
## - li    1   30.829 36.829</code></pre>
<div class="sourceCode" id="cb2297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2297-1"><a href="stat-reg.html#cb2297-1"></a><span class="kw">summary</span>(glm2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = remiss ~ cell + li + temp, family = binomial, data = d.remiss)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.02043  -0.66313  -0.08323   0.81282   1.65887  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)   67.634     56.888   1.189   0.2345  
## cell           9.652      7.751   1.245   0.2130  
## li             3.867      1.778   2.175   0.0297 *
## temp         -82.074     61.712  -1.330   0.1835  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 34.372  on 26  degrees of freedom
## Residual deviance: 21.953  on 23  degrees of freedom
## AIC: 29.953
## 
## Number of Fisher Scoring iterations: 7</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="stat-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stat-tsa.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="static/js/app.min.js"></script>
<script src="static/js/lunr.js"></script>
<script src="static/js/clipboard.min.js"></script>
<script src="static/js/plugin-search.js"></script>
<script src="static/js/plugin-sharing.js"></script>
<script src="static/js/plugin-fontsettings.js"></script>
<script src="static/js/plugin-bookdown.js"></script>
<script src="static/js/jquery.highlight.js"></script>
<script src="static/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Rbook.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
